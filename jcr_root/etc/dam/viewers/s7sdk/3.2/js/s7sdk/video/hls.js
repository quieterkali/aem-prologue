/*!************************************************************************
* Portions copyright (c) 2016 Adobe Systems Incorporated
**************************************************************************/
(function(a){a.pkg("s7sdk.video");(function(b){a.Hls=b()})(function(){var f,c,b;return(function d(g,l,j){function h(q,n){if(!l[q]){if(!g[q]){var m=typeof require=="function"&&require;if(!n&&m){return m(q,!0)}if(e){return e(q,!0)}var p=new Error("Cannot find module '"+q+"'");throw p.code="MODULE_NOT_FOUND",p}var i=l[q]={exports:{}};g[q][0].call(i.exports,function(o){var r=g[q][1][o];return h(r?r:o)},i,i.exports,d,g,l,j)}return l[q].exports}var e=typeof require=="function"&&require;for(var k=0;k<j.length;k++){h(j[k])}return h})({1:[function(l,j,h){function k(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}j.exports=k;k.EventEmitter=k;k.prototype._events=undefined;k.prototype._maxListeners=undefined;k.defaultMaxListeners=10;k.prototype.setMaxListeners=function(o){if(!i(o)||o<0||isNaN(o)){throw TypeError("n must be a positive number")}this._maxListeners=o;return this};k.prototype.emit=function(s){var t,r,n,o,p,q;if(!this._events){this._events={}}if(s==="error"){if(!this._events.error||(e(this._events.error)&&!this._events.error.length)){t=arguments[1];if(t instanceof Error){throw t}throw TypeError('Uncaught, unspecified "error" event.')}}r=this._events[s];if(g(r)){return false}if(m(r)){switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1);r.apply(this,o)}}else{if(e(r)){o=Array.prototype.slice.call(arguments,1);q=r.slice();n=q.length;for(p=0;p<n;p++){q[p].apply(this,o)}}}return true};k.prototype.addListener=function(o,p){var n;if(!m(p)){throw TypeError("listener must be a function")}if(!this._events){this._events={}}if(this._events.newListener){this.emit("newListener",o,m(p.listener)?p.listener:p)}if(!this._events[o]){this._events[o]=p}else{if(e(this._events[o])){this._events[o].push(p)}else{this._events[o]=[this._events[o],p]}}if(e(this._events[o])&&!this._events[o].warned){if(!g(this._maxListeners)){n=this._maxListeners}else{n=k.defaultMaxListeners}if(n&&n>0&&this._events[o].length>n){this._events[o].warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[o].length);if(typeof console.trace==="function"){console.trace()}}}return this};k.prototype.on=k.prototype.addListener;k.prototype.once=function(n,p){if(!m(p)){throw TypeError("listener must be a function")}var q=false;function o(){this.removeListener(n,o);if(!q){q=true;p.apply(this,arguments)}}o.listener=p;this.on(n,o);return this};k.prototype.removeListener=function(p,s){var r,n,q,o;if(!m(s)){throw TypeError("listener must be a function")}if(!this._events||!this._events[p]){return this}r=this._events[p];q=r.length;n=-1;if(r===s||(m(r.listener)&&r.listener===s)){delete this._events[p];if(this._events.removeListener){this.emit("removeListener",p,s)}}else{if(e(r)){for(o=q;o-->0;){if(r[o]===s||(r[o].listener&&r[o].listener===s)){n=o;break}}if(n<0){return this}if(r.length===1){r.length=0;delete this._events[p]}else{r.splice(n,1)}if(this._events.removeListener){this.emit("removeListener",p,s)}}}return this};k.prototype.removeAllListeners=function(p){var n,o;if(!this._events){return this}if(!this._events.removeListener){if(arguments.length===0){this._events={}}else{if(this._events[p]){delete this._events[p]}}return this}if(arguments.length===0){for(n in this._events){if(n==="removeListener"){continue}this.removeAllListeners(n)}this.removeAllListeners("removeListener");this._events={};return this}o=this._events[p];if(m(o)){this.removeListener(p,o)}else{if(o){while(o.length){this.removeListener(p,o[o.length-1])}}}delete this._events[p];return this};k.prototype.listeners=function(o){var n;if(!this._events||!this._events[o]){n=[]}else{if(m(this._events[o])){n=[this._events[o]]}else{n=this._events[o].slice()}}return n};k.prototype.listenerCount=function(n){if(this._events){var o=this._events[n];if(m(o)){return 1}else{if(o){return o.length}}}return 0};k.listenerCount=function(o,n){return o.listenerCount(n)};function m(n){return typeof n==="function"}function i(n){return typeof n==="number"}function e(n){return typeof n==="object"&&n!==null}function g(n){return n===void 0}},{}],2:[function(j,i,g){var l=arguments[3];var h=arguments[4];var e=arguments[5];var k=JSON.stringify;i.exports=function(u){var y=[];var v;var r=Object.keys(e);for(var q=0,o=r.length;q<o;q++){var x=r[q];var p=e[x].exports;if(p===u||p.__default===u){v=x;break}}if(!v){v=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var s={};for(var q=0,o=r.length;q<o;q++){var x=r[q];s[x]=x}h[v]=[Function(["require","module","exports"],"("+u+")(self)"),s]}var w=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var n={};n[v]=v;h[w]=[Function(["require"],("var f = require("+k(v)+");(f.__default ? f.__default : f)(self);")),n];var m="("+l+")({"+Object.keys(h).map(function(z){return k(z)+":["+h[z][0]+","+k(h[z][1])+"]"}).join(",")+"},{},["+k(w)+"])";var t=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(t.createObjectURL(new Blob([m],{type:"text/javascript"})))}},{}],3:[function(l,h,x){Object.defineProperty(x,"__esModule",{value:true});var v=function(){function y(C,A){for(var z=0;z<A.length;z++){var B=A[z];B.enumerable=B.enumerable||false;B.configurable=true;if("value" in B){B.writable=true}Object.defineProperty(C,B.key,B)}}return function(B,z,A){if(z){y(B.prototype,z)}if(A){y(B,A)}return B}}();var r=l("../events");var n=g(r);var i=l("../event-handler");var j=g(i);var s=l("../helper/buffer-helper");var t=g(s);var w=l("../errors");var o=l("../utils/logger");var q=l("./ewma-bandwidth-estimator");var e=g(q);function g(y){return y&&y.__esModule?y:{__default:y}}function k(y,z){if(!(y instanceof z)){throw new TypeError("Cannot call a class as a function")}}function p(y,z){if(!y){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return z&&(typeof z==="object"||typeof z==="function")?z:y}function u(z,y){if(typeof y!=="function"&&y!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof y)}z.prototype=Object.create(y&&y.prototype,{constructor:{value:z,enumerable:false,writable:true,configurable:true}});if(y){Object.setPrototypeOf?Object.setPrototypeOf(z,y):z.__proto__=y}}var m=function(H){u(F,H);function F(I){k(this,F);var J=p(this,Object.getPrototypeOf(F).call(this,I,n.__default.FRAG_LOADING,n.__default.FRAG_LOADED,n.__default.ERROR));J.lastLoadedFragLevel=0;J._autoLevelCapping=-1;J._nextAutoLevel=-1;J.hls=I;J.onCheck=J.abandonRulesCheck.bind(J);return J}v(F,[{key:"destroy",value:function E(){this.clearTimer();j.__default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function z(N){var P=N.frag;if(P.type==="main"){if(!this.timer){this.timer=setInterval(this.onCheck,100)}if(!this.bwEstimator){var K=this.hls,O=N.frag.level,M=K.levels[O].details.live,J=K.config,I=void 0,L=void 0;if(M){I=J.abrEwmaFastLive;L=J.abrEwmaSlowLive}else{I=J.abrEwmaFastVoD;L=J.abrEwmaSlowVoD}this.bwEstimator=new e.__default(K,L,I,J.abrEwmaDefaultEstimate)}this.fragCurrent=P}}},{key:"abandonRulesCheck",value:function G(){var I=this.hls,U=I.media,V=this.fragCurrent,S=V.loader;if(!S||S.stats&&S.stats.aborted){o.logger.warn("frag loader destroy or aborted, disarm abandonRulesCheck");this.clearTimer();return}var O=S.stats;if(U&&(!U.paused&&U.playbackRate!==0||!U.readyState)&&V.autoLevel&&V.level){var P=performance.now()-O.trequest,J=Math.abs(U.playbackRate);if(P>500*V.duration/J){var W=I.levels,R=Math.max(1,O.bw?O.bw/8:O.loaded*1000/P),M=O.total?O.total:Math.max(O.loaded,Math.round(V.duration*W[V.level].bitrate/8)),Q=U.currentTime,L=(M-O.loaded)/R,K=(t.__default.bufferInfo(U,Q,I.config.maxBufferHole).end-Q)/J;if(K<2*V.duration/J&&L>K){var T=void 0,N=void 0;for(N=V.level-1;N>=0;N--){T=V.duration*W[N].bitrate/(8*0.8*R);o.logger.log("fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay["+N+"] :"+L.toFixed(1)+"/"+K.toFixed(1)+"/"+T.toFixed(1));if(T<K){break}}if(T<L){N=Math.max(0,N);I.nextLoadLevel=N;this.bwEstimator.sample(P,O.loaded);o.logger.warn("loading too slow, abort fragment loading and switch to level "+N);V.loader.abort();this.clearTimer();I.trigger(n.__default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:V})}}}}}},{key:"onFragLoaded",value:function B(J){var K=J.frag;if(K.type==="main"){var I=J.stats;if(I.aborted===undefined&&K.loadCounter===1){this.bwEstimator.sample(performance.now()-I.trequest,I.loaded)}this.clearTimer();this.lastLoadedFragLevel=K.level;this._nextAutoLevel=-1}}},{key:"onError",value:function A(I){switch(I.details){case w.ErrorDetails.FRAG_LOAD_ERROR:case w.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}}},{key:"clearTimer",value:function C(){if(this.timer){clearInterval(this.timer);this.timer=null}}},{key:"autoLevelCapping",get:function y(){return this._autoLevelCapping},set:function D(I){this._autoLevelCapping=I}},{key:"nextAutoLevel",get:function y(){var I=this.hls,K=I.config,Q=I.levels,O=I.media,L=void 0,M=void 0;if(this._autoLevelCapping===-1&&Q&&Q.length){M=Q.length-1}else{M=this._autoLevelCapping}if(this._nextAutoLevel!==-1){return Math.min(this._nextAutoLevel,M)}var J=O&&O.playbackRate!==0?Math.abs(O.playbackRate):1,P=this.bwEstimator?this.bwEstimator.getEstimate()/J:K.abrEwmaDefaultEstimate/J,N=void 0;for(L=0;L<=M;L++){if(L<=this.lastLoadedFragLevel){N=K.abrBandWidthFactor*P}else{N=K.abrBandWidthUpFactor*P}if(N<Q[L].bitrate){return Math.max(0,L-1)}}return L-1},set:function D(I){this._nextAutoLevel=I}}]);return F}(j.__default);x.__default=m},{"../errors":24,"../event-handler":25,"../events":26,"../helper/buffer-helper":28,"../utils/logger":43,"./ewma-bandwidth-estimator":8}],4:[function(o,h,E){Object.defineProperty(E,"__esModule",{value:true});var A=function(){function F(J,H){for(var G=0;G<H.length;G++){var I=H[G];I.enumerable=I.enumerable||false;I.configurable=true;if("value" in I){I.writable=true}Object.defineProperty(J,I.key,I)}}return function(I,G,H){if(G){F(I.prototype,G)}if(H){F(I,H)}return I}}();var x=o("../utils/binary-search");var g=e(x);var v=o("../helper/buffer-helper");var y=e(v);var D=o("../demux/demuxer");var l=e(D);var t=o("../events");var r=e(t);var j=o("../event-handler");var m=e(j);var k=o("../helper/level-helper");var C=e(k);var p=o("../utils/timeRanges");var i=e(p);var B=o("../errors");var q=o("../utils/logger");function e(F){return F&&F.__esModule?F:{__default:F}}function n(F,G){if(!(F instanceof G)){throw new TypeError("Cannot call a class as a function")}}function s(F,G){if(!F){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return G&&(typeof G==="object"||typeof G==="function")?G:F}function z(G,F){if(typeof F!=="function"&&F!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof F)}G.prototype=Object.create(F&&F.prototype,{constructor:{value:G,enumerable:false,writable:true,configurable:true}});if(F){Object.setPrototypeOf?Object.setPrototypeOf(G,F):G.__proto__=F}}var u={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR"};var w=function(Y){z(R,Y);function R(ad){n(this,R);var ae=s(this,Object.getPrototypeOf(R).call(this,ad,r.__default.MEDIA_ATTACHED,r.__default.MEDIA_DETACHING,r.__default.AUDIO_TRACKS_UPDATED,r.__default.AUDIO_TRACK_SWITCH,r.__default.AUDIO_TRACK_LOADED,r.__default.KEY_LOADED,r.__default.FRAG_LOADED,r.__default.FRAG_PARSING_INIT_SEGMENT,r.__default.FRAG_PARSING_DATA,r.__default.FRAG_PARSED,r.__default.ERROR,r.__default.BUFFER_CREATED,r.__default.BUFFER_APPENDED,r.__default.BUFFER_FLUSHED));ae.config=ad.config;ae.audioCodecSwap=false;ae.ticks=0;ae.ontick=ae.tick.bind(ae);return ae}A(R,[{key:"destroy",value:function ab(){this.stopLoad();if(this.timer){clearInterval(this.timer);this.timer=null}m.__default.prototype.destroy.call(this);this.state=u.STOPPED}},{key:"startLoad",value:function U(ae){if(this.tracks){var af=this.media,ad=this.lastCurrentTime;this.stopLoad();if(!this.timer){this.timer=setInterval(this.ontick,100)}this.fragLoadError=0;if(af&&ad){q.logger.log("configure startPosition @"+ad);this.state=u.IDLE}else{this.lastCurrentTime=this.startPosition?this.startPosition:ae;this.state=u.STARTING}this.nextLoadPosition=this.startPosition=this.lastCurrentTime;this.tick()}else{this.startPosition=ae;this.state=u.STOPPED}}},{key:"stopLoad",value:function K(){var ad=this.fragCurrent;if(ad){if(ad.loader){ad.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.state=u.STOPPED}},{key:"tick",value:function Z(){this.ticks++;if(this.ticks===1){this.doTick();if(this.ticks>1){setTimeout(this.tick,1)}this.ticks=0}}},{key:"doTick",value:function W(){var al,aq,an,av=this.hls,aw=av.config;switch(this.state){case u.ERROR:case u.PAUSED:break;case u.STARTING:this.state=u.WAITING_TRACK;this.loadedmetadata=false;break;case u.IDLE:if(!this.media&&(this.startFragRequested||!aw.startFragPrefetch)){break}if(this.loadedmetadata){al=this.media.currentTime}else{al=this.nextLoadPosition}var am=this.mediaBuffer?this.mediaBuffer:this.media;var ap=y.__default.bufferInfo(am,al,aw.maxBufferHole),at=ap.len,ai=ap.end,ak=this.fragPrevious,ao=aw.maxMaxBufferLength;if(at<ao&&this.trackId<this.tracks.length){an=this.tracks[this.trackId].details;if(typeof an==="undefined"){this.state=u.WAITING_TRACK;break}if(!an.live&&ak&&ak.sn===an.endSN){if(!this.media.seeking||this.media.duration-ai<ak.duration/2){this.hls.trigger(r.__default.BUFFER_EOS,{type:"audio"});this.state=u.ENDED;break}}var ax=an.fragments,ar=ax.length,aj=ax[0].start,ah=ax[ar-1].start+ax[ar-1].duration,af=void 0;if(ai<aj){af=ax[0]}else{(function(){var az=void 0;var ay=aw.maxFragLookUpTolerance;if(ai<ah){if(ai>ah-ay){ay=0}az=g.__default.search(ax,function(aA){if(aA.start+aA.duration-ay<=ai){return 1}else{if(aA.start-ay>ai){return -1}}return 0})}else{az=ax[ar-1]}if(az){af=az;aj=az.start;if(ak&&af.level===ak.level&&af.sn===ak.sn){if(af.sn<an.endSN){af=ax[af.sn+1-an.startSN];q.logger.log("SN just loaded, load next one: "+af.sn)}else{af=null}}}})()}if(af){if(af.decryptdata.uri!=null&&af.decryptdata.key==null){q.logger.log("Loading key for "+af.sn+" of ["+an.startSN+" ,"+an.endSN+"],track "+this.trackId);this.state=u.KEY_LOADING;av.trigger(r.__default.KEY_LOADING,{frag:af})}else{q.logger.log("Loading "+af.sn+" of ["+an.startSN+" ,"+an.endSN+"],track "+this.trackId+", currentTime:"+al+",bufferEnd:"+ai.toFixed(3));if(this.fragLoadIdx!==undefined){this.fragLoadIdx++}else{this.fragLoadIdx=0}if(af.loadCounter){af.loadCounter++;var au=aw.fragLoadingLoopThreshold;if(af.loadCounter>au&&Math.abs(this.fragLoadIdx-af.loadIdx)<au){av.trigger(r.__default.ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:false,frag:af});return}}else{af.loadCounter=1}af.loadIdx=this.fragLoadIdx;this.fragCurrent=af;this.startFragRequested=true;av.trigger(r.__default.FRAG_LOADING,{frag:af});this.state=u.FRAG_LOADING}}}break;case u.WAITING_TRACK:aq=this.tracks[this.trackId];if(aq&&aq.details){this.state=u.IDLE}break;case u.FRAG_LOADING_WAITING_RETRY:var ag=performance.now();var ae=this.retryDate;am=this.media;var ad=am&&am.seeking;if(!ae||ag>=ae||ad){q.logger.log("audioStreamController: retryDate reached, switch back to IDLE state");this.state=u.IDLE}break;case u.STOPPED:case u.FRAG_LOADING:case u.PARSING:case u.PARSED:case u.ENDED:break;default:break}}},{key:"onMediaAttached",value:function X(ae){var af=this.media=this.mediaBuffer=ae.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvended=this.onMediaEnded.bind(this);af.addEventListener("seeking",this.onvseeking);af.addEventListener("ended",this.onvended);var ad=this.config;if(this.tracks&&ad.autoStartLoad){this.startLoad(ad.startPosition)}}},{key:"onMediaDetaching",value:function ac(){var ae=this.media;if(ae&&ae.ended){q.logger.log("MSE detaching and video ended, reset startPosition");this.startPosition=this.lastCurrentTime=0}var ad=this.tracks;if(ad){ad.forEach(function(af){if(af.details){af.details.fragments.forEach(function(ag){ag.loadCounter=undefined})}})}if(ae){ae.removeEventListener("seeking",this.onvseeking);ae.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvended=null}this.media=null;this.loadedmetadata=false;this.stopLoad()}},{key:"onMediaSeeking",value:function Q(){if(this.state===u.ENDED){this.state=u.IDLE}if(this.media){this.lastCurrentTime=this.media.currentTime}if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}this.tick()}},{key:"onMediaEnded",value:function H(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function L(ad){q.logger.log("audio tracks updated");this.tracks=ad.audioTracks}},{key:"onAudioTrackSwitch",value:function P(ad){this.trackId=ad.id;this.state=u.IDLE;this.fragCurrent=null;this.state=u.PAUSED;if(ad.type==="main"){if(this.demuxer){this.demuxer.destroy();this.demuxer=null}}else{if(!this.timer){this.timer=setInterval(this.ontick,100)}}this.hls.trigger(r.__default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"});this.tick()}},{key:"onAudioTrackLoaded",value:function N(ag){var af=ag.details,ai=ag.id,ad=this.tracks[ai],ah=af.totalduration;q.logger.log("track "+ai+" loaded ["+af.startSN+","+af.endSN+"],duration:"+ah);af.PTSKnown=false;ad.details=af;if(!this.startFragRequested){if(this.startPosition===-1){var ae=af.startTimeOffset;if(!isNaN(ae)){q.logger.log("start time offset found in playlist, adjust startPosition to "+ae);this.startPosition=ae}else{this.startPosition=0}}this.nextLoadPosition=this.startPosition}if(this.state===u.WAITING_TRACK){this.state=u.IDLE}this.tick()}},{key:"onKeyLoaded",value:function V(){if(this.state===u.KEY_LOADING){this.state=u.IDLE;this.tick()}}},{key:"onFragLoaded",value:function S(aj){var ak=this.fragCurrent;if(this.state===u.FRAG_LOADING&&ak&&aj.frag.type==="audio"&&aj.frag.level===ak.level&&aj.frag.sn===ak.sn){this.state=u.PARSING;this.stats=aj.stats;var ag=this.tracks[this.trackId],ad=ag.details,ai=ad.totalduration,ae=ak.start,af=ak.level,ah=ak.sn,al=this.config.defaultAudioCodec||ag.audioCodec;this.pendingAppending=0;if(!this.demuxer){this.demuxer=new l.__default(this.hls,"audio")}q.logger.log("Demuxing "+ah+" of ["+ad.startSN+" ,"+ad.endSN+"],track "+af);this.demuxer.push(aj.payload,al,null,ae,ak.cc,af,ah,ai,ak.decryptdata)}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function O(ag){var af=this.fragCurrent;if(af&&ag.id==="audio"&&ag.sn===af.sn&&ag.level===af.level&&this.state===u.PARSING){var ae=ag.tracks,ad=void 0;ad=ae.audio;if(ad){ad.levelCodec="mp4a.40.2";ad.id=ag.id;this.hls.trigger(r.__default.BUFFER_CODECS,ae);q.logger.log("audio track:audio,container:"+ad.container+",codecs[level/parsed]=["+ad.levelCodec+"/"+ad.codec+"]");var ah=ad.initSegment;if(ah){this.pendingAppending++;this.hls.trigger(r.__default.BUFFER_APPENDING,{type:"audio",data:ah,parent:"audio",content:"initSegment"})}this.tick()}}}},{key:"onFragParsingData",value:function aa(ag){var af=this;var ae=this.fragCurrent;if(ae&&ag.id==="audio"&&ag.sn===ae.sn&&ag.level===ae.level&&this.state===u.PARSING){var ad=this.tracks[this.trackId],ah=this.fragCurrent;q.logger.log("parsed "+ag.type+",PTS:["+ag.startPTS.toFixed(3)+","+ag.endPTS.toFixed(3)+"],DTS:["+ag.startDTS.toFixed(3)+"/"+ag.endDTS.toFixed(3)+"],nb:"+ag.nb);C.__default.updateFragPTSDTS(ad.details,ah.sn,ag.startPTS,ag.endPTS);[ag.data1,ag.data2].forEach(function(ai){if(ai){af.pendingAppending++;af.hls.trigger(r.__default.BUFFER_APPENDING,{type:ag.type,data:ai,parent:"audio",content:"data"})}});this.nextLoadPosition=ag.endPTS;this.tick()}}},{key:"onFragParsed",value:function J(ae){var ad=this.fragCurrent;if(ad&&ae.id==="audio"&&ae.sn===ad.sn&&ae.level===ad.level&&this.state===u.PARSING){this.stats.tparsed=performance.now();this.state=u.PARSED;this._checkAppendedParsed()}}},{key:"onBufferCreated",value:function G(ae){var ad=ae.tracks.audio;if(ad){this.mediaBuffer=ad.buffer;this.loadedmetadata=true}}},{key:"onBufferAppended",value:function M(ad){if(ad.parent==="audio"){switch(this.state){case u.PARSING:case u.PARSED:this.pendingAppending--;this._checkAppendedParsed();break;default:break}}}},{key:"_checkAppendedParsed",value:function F(){if(this.state===u.PARSED&&this.pendingAppending===0){var af=this.fragCurrent,ad=this.stats;if(af){this.fragPrevious=af;ad.tbuffered=performance.now();this.hls.trigger(r.__default.FRAG_BUFFERED,{stats:ad,frag:af,id:"audio"});var ae=this.mediaBuffer?this.mediaBuffer:this.media;q.logger.log("audio buffered : "+i.__default.toString(ae.buffered));this.state=u.IDLE}this.tick()}}},{key:"onError",value:function I(af){var ag=af.frag;if(ag&&ag.type!=="audio"){return}switch(af.details){case B.ErrorDetails.FRAG_LOAD_ERROR:case B.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!af.fatal){var ae=this.fragLoadError;if(ae){ae++}else{ae=1}if(ae<=this.config.fragLoadingMaxRetry){this.fragLoadError=ae;ag.loadCounter=0;var ad=Math.min(Math.pow(2,ae-1)*this.config.fragLoadingRetryDelay,64000);q.logger.warn("audioStreamController: frag loading failed, retry in "+ad+" ms");this.retryDate=performance.now()+ad;this.state=u.FRAG_LOADING_WAITING_RETRY}else{q.logger.error("audioStreamController: "+af.details+" reaches max retry, redispatch as fatal ...");af.fatal=true;this.hls.trigger(r.__default.ERROR,af);this.state=u.ERROR}}break;case B.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case B.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case B.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case B.ErrorDetails.KEY_LOAD_ERROR:case B.ErrorDetails.KEY_LOAD_TIMEOUT:if(this.state!==u.ERROR){this.state=af.fatal?u.ERROR:u.IDLE;q.logger.warn("audioStreamController: "+af.details+" while loading frag,switch to "+this.state+" state ...")}break;default:break}}},{key:"onBufferFlushed",value:function T(){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.state=u.IDLE;this.fragPrevious=null;this.tick()}}]);return R}(m.__default);E.__default=w},{"../demux/demuxer":20,"../errors":24,"../event-handler":25,"../events":26,"../helper/buffer-helper":28,"../helper/level-helper":29,"../utils/binary-search":39,"../utils/logger":43,"../utils/timeRanges":45}],5:[function(e,g,m){Object.defineProperty(m,"__esModule",{value:true});var j=function(){function t(x,v){for(var u=0;u<v.length;u++){var w=v[u];w.enumerable=w.enumerable||false;w.configurable=true;if("value" in w){w.writable=true}Object.defineProperty(x,w.key,w)}}return function(w,u,v){if(u){t(w.prototype,u)}if(v){t(w,v)}return w}}();var o=e("../events");var p=s(o);var i=e("../event-handler");var h=s(i);var l=e("../utils/logger");function s(t){return t&&t.__esModule?t:{__default:t}}function n(t,u){if(!(t instanceof u)){throw new TypeError("Cannot call a class as a function")}}function q(t,u){if(!t){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return u&&(typeof u==="object"||typeof u==="function")?u:t}function r(u,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}u.prototype=Object.create(t&&t.prototype,{constructor:{value:u,enumerable:false,writable:true,configurable:true}});if(t){Object.setPrototypeOf?Object.setPrototypeOf(u,t):u.__proto__=t}}var k=function(B){r(w,B);function w(C){n(this,w);return q(this,Object.getPrototypeOf(w).call(this,C,p.__default.MANIFEST_LOADING,p.__default.MANIFEST_LOADED,p.__default.AUDIO_TRACK_LOADED))}j(w,[{key:"destroy",value:function A(){h.__default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function x(){this.tracks=[];this.trackId=-1}},{key:"onManifestLoaded",value:function y(F){var E=this;var D=F.audioTracks||[];var C=false;this.tracks=D;this.hls.trigger(p.__default.AUDIO_TRACKS_UPDATED,{audioTracks:D});var G=0;D.forEach(function(H){if(H.__default){E.audioTrack=G;C=true;return}G++});if(C===false&&D.length){l.logger.log("no default audio track defined, use first audio track as default");this.audioTrack=0}}},{key:"onAudioTrackLoaded",value:function u(C){if(C.id<this.tracks.length){l.logger.log("audioTrack "+C.id+" loaded");this.tracks[C.id].details=C.details;if(C.details.live&&!this.timer){this.timer=setInterval(this.ontick,1000*C.details.targetduration)}if(!C.details.live&&this.timer){clearInterval(this.timer);this.timer=null}}}},{key:"setAudioTrackInternal",value:function t(D){if(D>=0&&D<this.tracks.length){if(this.timer){clearInterval(this.timer);this.timer=null}this.trackId=D;l.logger.log("switching to audioTrack "+D);var C=this.tracks[D],F=C.type;this.hls.trigger(p.__default.AUDIO_TRACK_SWITCH,{id:D,type:F});var E=C.details;if(F!=="main"&&(E===undefined||E.live===true)){l.logger.log("(re)loading playlist for audioTrack "+D);this.hls.trigger(p.__default.AUDIO_TRACK_LOADING,{url:C.url,id:D})}}}},{key:"audioTracks",get:function v(){return this.tracks}},{key:"audioTrack",get:function v(){return this.trackId},set:function z(C){if(this.trackId!==C||this.tracks[C].details===undefined){this.setAudioTrackInternal(C)}}}]);return w}(h.__default);m.__default=k},{"../event-handler":25,"../events":26,"../utils/logger":43}],6:[function(e,g,m){Object.defineProperty(m,"__esModule",{value:true});var k=function(){function u(y,w){for(var v=0;v<w.length;v++){var x=w[v];x.enumerable=x.enumerable||false;x.configurable=true;if("value" in x){x.writable=true}Object.defineProperty(y,x.key,x)}}return function(x,v,w){if(v){u(x.prototype,v)}if(w){u(x,w)}return x}}();var o=e("../events");var p=t(o);var j=e("../event-handler");var h=t(j);var l=e("../utils/logger");var i=e("../errors");function t(u){return u&&u.__esModule?u:{__default:u}}function n(u,v){if(!(u instanceof v)){throw new TypeError("Cannot call a class as a function")}}function q(u,v){if(!u){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return v&&(typeof v==="object"||typeof v==="function")?v:u}function s(v,u){if(typeof u!=="function"&&u!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof u)}v.prototype=Object.create(u&&u.prototype,{constructor:{value:v,enumerable:false,writable:true,configurable:true}});if(u){Object.setPrototypeOf?Object.setPrototypeOf(v,u):v.__proto__=u}}var r=function(M){s(z,M);function z(T){n(this,z);var U=q(this,Object.getPrototypeOf(z).call(this,T,p.__default.MEDIA_ATTACHING,p.__default.MEDIA_DETACHING,p.__default.MANIFEST_PARSED,p.__default.BUFFER_RESET,p.__default.BUFFER_APPENDING,p.__default.BUFFER_CODECS,p.__default.BUFFER_EOS,p.__default.BUFFER_FLUSHING,p.__default.LEVEL_UPDATED));U._msDuration=null;U._levelDuration=null;U.onsbue=U.onSBUpdateEnd.bind(U);U.onsbe=U.onSBUpdateError.bind(U);U.pendingTracks={};return U}k(z,[{key:"destroy",value:function O(){h.__default.prototype.destroy.call(this)}},{key:"onManifestParsed",value:function Q(T){var W=T.audio,V=T.video,U=0;if(T.altAudio&&(W||V)){U=(W?1:0)+(V?1:0);l.logger.log(U+" sourceBuffer(s) expected")}this.sourceBufferNb=U}},{key:"onMediaAttaching",value:function u(U){var V=this.media=U.media;if(V){var T=this.mediaSource=new MediaSource();this.onmso=this.onMediaSourceOpen.bind(this);this.onmse=this.onMediaSourceEnded.bind(this);this.onmsc=this.onMediaSourceClose.bind(this);T.addEventListener("sourceopen",this.onmso);T.addEventListener("sourceended",this.onmse);T.addEventListener("sourceclose",this.onmsc);V.src=URL.createObjectURL(T)}}},{key:"onMediaDetaching",value:function P(){l.logger.log("media source detaching");var T=this.mediaSource;if(T){if(T.readyState==="open"){try{T.endOfStream()}catch(U){l.logger.warn("onMediaDetaching:"+U.message+" while calling endOfStream")}}T.removeEventListener("sourceopen",this.onmso);T.removeEventListener("sourceended",this.onmse);T.removeEventListener("sourceclose",this.onmsc);if(this.media){this.media.removeAttribute("src");this.media.load()}this.mediaSource=null;this.media=null;this.pendingTracks={};this.sourceBuffer={}}this.onmso=this.onmse=this.onmsc=null;this.hls.trigger(p.__default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function C(){l.logger.log("media source opened");this.hls.trigger(p.__default.MEDIA_ATTACHED,{media:this.media});var T=this.mediaSource;if(T){T.removeEventListener("sourceopen",this.onmso)}this.checkPendingTracks()}},{key:"checkPendingTracks",value:function A(){var U=this.pendingTracks,T=Object.keys(U).length;if(T&&(this.sourceBufferNb===T||this.sourceBufferNb===0)){this.createSourceBuffers(U);this.pendingTracks={};this.doAppending()}}},{key:"onMediaSourceClose",value:function S(){l.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function K(){l.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function E(){if(this._needsFlush){this.doFlush()}if(this._needsEos){this.checkEos()}this.appending=false;this.hls.trigger(p.__default.BUFFER_APPENDED,{parent:this.parent});if(!this._needsFlush){this.doAppending()}this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function I(T){l.logger.error("sourceBuffer error:"+T);this.hls.trigger(p.__default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:false})}},{key:"onBufferReset",value:function J(){var V=this.sourceBuffer;for(var T in V){var W=V[T];try{this.mediaSource.removeSourceBuffer(W);W.removeEventListener("updateend",this.onsbue);W.removeEventListener("error",this.onsbe)}catch(U){}}this.sourceBuffer={};this.flushRange=[];this.segments=[];this.appended=0}},{key:"onBufferCodecs",value:function v(U){if(Object.keys(this.sourceBuffer).length===0){for(var V in U){this.pendingTracks[V]=U[V]}var T=this.mediaSource;if(T&&T.readyState==="open"){this.checkPendingTracks()}}}},{key:"createSourceBuffers",value:function y(X){var Y=this.sourceBuffer,U=this.mediaSource;for(var ab in X){if(!Y[ab]){var V=X[ab];var aa=V.levelCodec||V.codec;var T=V.container+";codecs="+aa;l.logger.log("creating sourceBuffer with mimeType:"+T);try{var Z=Y[ab]=U.addSourceBuffer(T);Z.addEventListener("updateend",this.onsbue);Z.addEventListener("error",this.onsbe);V.buffer=Z}catch(W){l.logger.error("error while trying to add sourceBuffer:"+W.message);this.hls.trigger(p.__default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:false,err:W,mimeType:T})}}}this.hls.trigger(p.__default.BUFFER_CREATED,{tracks:X})}},{key:"onBufferAppending",value:function N(T){if(!this._needsFlush){if(!this.segments){this.segments=[T]}else{this.segments.push(T)}this.doAppending()}}},{key:"onBufferAppendFail",value:function w(T){l.logger.error("sourceBuffer error:"+T.event);this.hls.trigger(p.__default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:false,frag:this.fragCurrent})}},{key:"onBufferEos",value:function H(V){var W=this.sourceBuffer;var T=V.type;for(var U in W){if(!T||U===T){if(!W[U].ended){W[U].ended=true;l.logger.log(U+" sourceBuffer now EOS")}}}this.checkEos()}},{key:"checkEos",value:function G(){var V=this.sourceBuffer,T=this.mediaSource;if(!T||T.readyState!=="open"){this._needsEos=false;return}for(var U in V){if(!V[U].ended){return}if(V[U].updating){this._needsEos=true;return}}l.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");T.endOfStream();this._needsEos=false}},{key:"onBufferFlushing",value:function L(T){this.flushRange.push({start:T.startOffset,end:T.endOffset,type:T.type});this.flushBufferCounter=0;this.doFlush()}},{key:"onLevelUpdated",value:function R(U){var T=U.details;if(T.fragments.length===0){return}this._levelDuration=T.totalduration+T.fragments[0].start;this.updateMediaElementDuration()}},{key:"updateMediaElementDuration",value:function B(){if(this._levelDuration===null){return}var W=this.media,T=this.mediaSource,V=this.sourceBuffer;if(!W||!T||!V||W.readyState===0||T.readyState!=="open"){return}for(var U in V){if(V[U].updating){return}}if(this._msDuration===null){this._msDuration=T.duration}if(this._levelDuration>this._msDuration){l.logger.log("Updating mediasource duration to "+this._levelDuration);T.duration=this._levelDuration;this._msDuration=this._levelDuration}}},{key:"doFlush",value:function F(){while(this.flushRange.length){var T=this.flushRange[0];if(this.flushBuffer(T.start,T.end,T.type)){this.flushRange.shift();this.flushBufferCounter=0}else{this._needsFlush=true;return}}if(this.flushRange.length===0){this._needsFlush=false;var U=0;var W=this.sourceBuffer;for(var V in W){U+=W[V].buffered.length}this.appended=U;this.hls.trigger(p.__default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function x(){var U=this.hls,Z=this.sourceBuffer,T=this.segments;if(Object.keys(Z).length){if(this.media.error){this.segments=[];l.logger.error("trying to append although a media error occured, flush segment and abort");return}if(this.appending){return}if(T&&T.length){var Y=T.shift();try{var V=Y.type;if(Z[V]){Z[V].ended=false;this.parent=Y.parent;Z[V].appendBuffer(Y.data);this.appendError=0;this.appended++;this.appending=true}else{this.onSBUpdateEnd()}}catch(X){l.logger.error("error while trying to append buffer:"+X.message);T.unshift(Y);var W={type:i.ErrorTypes.MEDIA_ERROR};if(X.code!==22){if(this.appendError){this.appendError++}else{this.appendError=1}W.details=i.ErrorDetails.BUFFER_APPEND_ERROR;W.frag=this.fragCurrent;if(this.appendError>U.config.appendErrorMaxRetry){l.logger.log("fail "+U.config.appendErrorMaxRetry+" times to append segment in sourceBuffer");T=[];W.fatal=true;U.trigger(p.__default.ERROR,W);return}else{W.fatal=false;U.trigger(p.__default.ERROR,W)}}else{this.segments=[];W.details=i.ErrorDetails.BUFFER_FULL_ERROR;U.trigger(p.__default.ERROR,W);return}}}}}},{key:"flushBuffer",value:function D(X,aa,W){var ac,U,T,ab,ad,V,Z=this.sourceBuffer;if(Object.keys(Z).length){l.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime+"/"+X+"/"+aa);if(this.flushBufferCounter<this.appended){for(var Y in Z){if(W&&Y!==W){continue}ac=Z[Y];if(!ac.updating){for(U=0;U<ac.buffered.length;U++){T=ac.buffered.start(U);ab=ac.buffered.end(U);if(navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&aa===Number.POSITIVE_INFINITY){ad=X;V=aa}else{ad=Math.max(T,X);V=Math.min(ab,aa)}if(Math.min(V,ab)-ad>0.5){this.flushBufferCounter++;l.logger.log("flush "+Y+" ["+ad+","+V+"], of ["+T+","+ab+"], pos:"+this.media.currentTime);ac.remove(ad,V);return false}}}else{l.logger.warn("cannot flush, sb updating in progress");return false}}}else{l.logger.warn("abort flushing too many retries")}l.logger.log("buffer flushed")}return true}}]);return z}(h.__default);m.__default=r},{"../errors":24,"../event-handler":25,"../events":26,"../utils/logger":43}],7:[function(g,h,l){Object.defineProperty(l,"__esModule",{value:true});var k=function(){function s(w,u){for(var t=0;t<u.length;t++){var v=u[t];v.enumerable=v.enumerable||false;v.configurable=true;if("value" in v){v.writable=true}Object.defineProperty(w,v.key,v)}}return function(v,t,u){if(t){s(v.prototype,t)}if(u){s(v,u)}return v}}();var n=g("../events");var o=r(n);var j=g("../event-handler");var i=r(j);function r(s){return s&&s.__esModule?s:{__default:s}}function m(s,t){if(!(s instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(s,t){if(!s){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:s}function q(t,s){if(typeof s!=="function"&&s!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof s)}t.prototype=Object.create(s&&s.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}});if(s){Object.setPrototypeOf?Object.setPrototypeOf(t,s):t.__proto__=s}}var e=function(B){q(t,B);function t(C){m(this,t);return p(this,Object.getPrototypeOf(t).call(this,C,o.__default.FPS_DROP_LEVEL_CAPPING,o.__default.MEDIA_ATTACHING,o.__default.MANIFEST_PARSED))}k(t,[{key:"destroy",value:function A(){if(this.hls.config.capLevelToPlayerSize){this.media=this.restrictedLevels=null;this.autoLevelCapping=Number.POSITIVE_INFINITY;if(this.timer){this.timer=clearInterval(this.timer)}}}},{key:"onFpsDropLevelCapping",value:function u(C){if(!this.restrictedLevels){this.restrictedLevels=[]}if(!this.isLevelRestricted(C.droppedLevel)){this.restrictedLevels.push(C.droppedLevel)}}},{key:"onMediaAttaching",value:function w(C){this.media=C.media instanceof HTMLVideoElement?C.media:null}},{key:"onManifestParsed",value:function s(C){if(this.hls.config.capLevelToPlayerSize){this.autoLevelCapping=Number.POSITIVE_INFINITY;this.levels=C.levels;this.hls.firstLevel=this.getMaxLevel(C.firstLevel);clearInterval(this.timer);this.timer=setInterval(this.detectPlayerSize.bind(this),1000);this.detectPlayerSize()}}},{key:"detectPlayerSize",value:function z(){if(this.media){var C=this.levels?this.levels.length:0;if(C){this.hls.autoLevelCapping=this.getMaxLevel(C-1);if(this.hls.autoLevelCapping>this.autoLevelCapping){this.hls.streamController.nextLevelSwitch()}this.autoLevelCapping=this.hls.autoLevelCapping}}}},{key:"getMaxLevel",value:function x(D){var C=0,G=void 0,J=void 0,E=this.mediaWidth,I=this.mediaHeight,F=0,H=0;for(G=0;G<=D;G++){J=this.levels[G];if(this.isLevelRestricted(G)){break}C=G;F=J.width;H=J.height;if(E<=F||I<=H){break}}return C}},{key:"isLevelRestricted",value:function y(C){return this.restrictedLevels&&this.restrictedLevels.indexOf(C)!==-1?true:false}},{key:"contentScaleFactor",get:function v(){var D=1;try{D=window.devicePixelRatio}catch(C){}return D}},{key:"mediaWidth",get:function v(){var C=void 0;if(this.media){C=this.media.width||this.media.clientWidth||this.media.offsetWidth;C*=this.contentScaleFactor}return C}},{key:"mediaHeight",get:function v(){var C=void 0;if(this.media){C=this.media.height||this.media.clientHeight||this.media.offsetHeight;C*=this.contentScaleFactor}return C}}]);return t}(i.__default);l.__default=e},{"../event-handler":25,"../events":26}],8:[function(h,i,k){Object.defineProperty(k,"__esModule",{value:true});var j=function(){function o(s,q){for(var p=0;p<q.length;p++){var r=q[p];r.enumerable=r.enumerable||false;r.configurable=true;if("value" in r){r.writable=true}Object.defineProperty(s,r.key,r)}}return function(r,p,q){if(p){o(r.prototype,p)}if(q){o(r,q)}return r}}();var e=h("../utils/ewma");var g=n(e);function n(o){return o&&o.__esModule?o:{__default:o}}function l(o,p){if(!(o instanceof p)){throw new TypeError("Cannot call a class as a function")}}var m=function(){function o(t,u,s,v){l(this,o);this.hls=t;this.defaultEstimate_=v;this.minWeight_=0.001;this.minDelayMs_=50;this.slow_=new g.__default(u);this.fast_=new g.__default(s)}j(o,[{key:"sample",value:function r(t,s){t=Math.max(t,this.minDelayMs_);var u=8000*s/t,v=t/1000;this.fast_.sample(v,u);this.slow_.sample(v,u)}},{key:"getEstimate",value:function q(){if(!this.fast_||!this.slow_||this.fast_.getTotalWeight()<this.minWeight_){return this.defaultEstimate_}return Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())}},{key:"destroy",value:function p(){}}]);return o}();k.__default=m},{"../utils/ewma":42}],9:[function(e,g,l){Object.defineProperty(l,"__esModule",{value:true});var j=function(){function t(x,v){for(var u=0;u<v.length;u++){var w=v[u];w.enumerable=w.enumerable||false;w.configurable=true;if("value" in w){w.writable=true}Object.defineProperty(x,w.key,w)}}return function(w,u,v){if(u){t(w.prototype,u)}if(v){t(w,v)}return w}}();var n=e("../events");var p=s(n);var i=e("../event-handler");var h=s(i);var k=e("../utils/logger");function s(t){return t&&t.__esModule?t:{__default:t}}function m(t,u){if(!(t instanceof u)){throw new TypeError("Cannot call a class as a function")}}function q(t,u){if(!t){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return u&&(typeof u==="object"||typeof u==="function")?u:t}function r(u,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}u.prototype=Object.create(t&&t.prototype,{constructor:{value:u,enumerable:false,writable:true,configurable:true}});if(t){Object.setPrototypeOf?Object.setPrototypeOf(u,t):u.__proto__=t}}var o=function(w){r(y,w);function y(z){m(this,y);return q(this,Object.getPrototypeOf(y).call(this,z,p.__default.MEDIA_ATTACHING))}j(y,[{key:"destroy",value:function v(){if(this.timer){clearInterval(this.timer)}this.isVideoPlaybackQualityAvailable=false}},{key:"onMediaAttaching",value:function t(z){if(this.hls.config.capLevelOnFPSDrop){this.video=z.media instanceof HTMLVideoElement?z.media:null;if(typeof this.video.getVideoPlaybackQuality==="function"){this.isVideoPlaybackQualityAvailable=true}clearInterval(this.timer);this.timer=setInterval(this.checkFPSInterval.bind(this),this.hls.config.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function x(A,E,F){var B=performance.now();if(E){if(this.lastTime){var H=B-this.lastTime,D=F-this.lastDroppedFrames,G=E-this.lastDecodedFrames,C=1000*D/H;this.hls.trigger(p.__default.FPS_DROP,{currentDropped:D,currentDecoded:G,totalDroppedFrames:F});if(C>0){if(D>this.hls.config.fpsDroppedMonitoringThreshold*G){var z=this.hls.currentLevel;k.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+z);if(z>0&&(this.hls.autoLevelCapping===-1||this.hls.autoLevelCapping>=z)){z=z-1;this.hls.trigger(p.__default.FPS_DROP_LEVEL_CAPPING,{level:z,droppedLevel:this.hls.currentLevel});this.hls.autoLevelCapping=z;this.hls.streamController.nextLevelSwitch()}}}}this.lastTime=B;this.lastDroppedFrames=F;this.lastDecodedFrames=E}}},{key:"checkFPSInterval",value:function u(){if(this.video){if(this.isVideoPlaybackQualityAvailable){var z=this.video.getVideoPlaybackQuality();this.checkFPS(this.video,z.totalVideoFrames,z.droppedVideoFrames)}else{this.checkFPS(this.video,this.video.webkitDecodedFrameCount,this.video.webkitDroppedFrameCount)}}}}]);return y}(h.__default);l.__default=o},{"../event-handler":25,"../events":26,"../utils/logger":43}],10:[function(e,g,m){Object.defineProperty(m,"__esModule",{value:true});var k=function(){function u(y,w){for(var v=0;v<w.length;v++){var x=w[v];x.enumerable=x.enumerable||false;x.configurable=true;if("value" in x){x.writable=true}Object.defineProperty(y,x.key,x)}}return function(x,v,w){if(v){u(x.prototype,v)}if(w){u(x,w)}return x}}();var o=e("../events");var p=t(o);var j=e("../event-handler");var h=t(j);var l=e("../utils/logger");var i=e("../errors");function t(u){return u&&u.__esModule?u:{__default:u}}function n(u,v){if(!(u instanceof v)){throw new TypeError("Cannot call a class as a function")}}function r(u,v){if(!u){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return v&&(typeof v==="object"||typeof v==="function")?v:u}function s(v,u){if(typeof u!=="function"&&u!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof u)}v.prototype=Object.create(u&&u.prototype,{constructor:{value:v,enumerable:false,writable:true,configurable:true}});if(u){Object.setPrototypeOf?Object.setPrototypeOf(v,u):v.__proto__=u}}var q=function(F){s(z,F);function z(G){n(this,z);var H=r(this,Object.getPrototypeOf(z).call(this,G,p.__default.MANIFEST_LOADED,p.__default.LEVEL_LOADED,p.__default.ERROR));H.ontick=H.tick.bind(H);H._manualLevel=H._autoLevelCapping=-1;return H}k(z,[{key:"destroy",value:function E(){if(this.timer){clearTimeout(this.timer);this.timer=null}this._manualLevel=-1}},{key:"startLoad",value:function C(){this.canload=true;if(this.timer){this.tick()}}},{key:"stopLoad",value:function A(){this.canload=false}},{key:"onManifestLoaded",value:function B(I){var K=[],O=[],L,J,N={},H=false,M=false,G=this.hls;I.levels.forEach(function(Q){if(Q.videoCodec){H=true}if(Q.audioCodec||Q.attrs&&Q.attrs.AUDIO){M=true}var P=N[Q.bitrate];if(P===undefined){N[Q.bitrate]=K.length;Q.url=[Q.url];Q.urlId=0;K.push(Q)}else{K[P].url.push(Q.url)}});if(H&&M){K.forEach(function(P){if(P.videoCodec){O.push(P)}})}else{O=K}O=O.filter(function(T){var S=function S(U){return MediaSource.isTypeSupported("audio/mp4;codecs="+U)};var R=function R(U){return MediaSource.isTypeSupported("video/mp4;codecs="+U)};var Q=T.audioCodec,P=T.videoCodec;return(!Q||S(Q))&&(!P||R(P))});if(O.length){L=O[0].bitrate;O.sort(function(Q,P){return Q.bitrate-P.bitrate});this._levels=O;for(J=0;J<O.length;J++){if(O[J].bitrate===L){this._firstLevel=J;l.logger.log("manifest loaded,"+O.length+" level(s) found, first bitrate:"+L);break}}G.trigger(p.__default.MANIFEST_PARSED,{levels:this._levels,firstLevel:this._firstLevel,stats:I.stats,audio:M,video:H,altAudio:I.audioTracks.length>0})}else{G.trigger(p.__default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:true,url:G.url,reason:"no level with compatible codecs found in manifest"})}return}},{key:"setLevelInternal",value:function v(H){var J=this._levels;if(H>=0&&H<J.length){if(this.timer){clearTimeout(this.timer);this.timer=null}this._level=H;l.logger.log("switching to level "+H);this.hls.trigger(p.__default.LEVEL_SWITCH,{level:H});var K=J[H],G=K.details;if(!G||G.live===true&&performance.now()-G.tload>1000){l.logger.log("(re)loading playlist for level "+H);var I=K.urlId;this.hls.trigger(p.__default.LEVEL_LOADING,{url:K.url[I],level:H,id:I})}}else{this.hls.trigger(p.__default.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.LEVEL_SWITCH_ERROR,level:H,fatal:false,reason:"invalid level idx"})}}},{key:"onError",value:function y(J){if(J.fatal){return}var H=J.details,G=this.hls,I=void 0,M=void 0,L=false;switch(H){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:case i.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case i.ErrorDetails.KEY_LOAD_ERROR:case i.ErrorDetails.KEY_LOAD_TIMEOUT:I=J.frag.level;break;case i.ErrorDetails.LEVEL_LOAD_ERROR:case i.ErrorDetails.LEVEL_LOAD_TIMEOUT:I=J.context.level;L=true;break;default:break}if(I!==undefined){M=this._levels[I];if(M.urlId<M.url.length-1){M.urlId++;M.details=undefined;l.logger.warn("level controller,"+H+" for level "+I+": switching to redundant stream id "+M.urlId)}else{var K=this._manualLevel===-1&&I;if(K){l.logger.warn("level controller,"+H+": emergency switch-down for next fragment");G.abrController.nextAutoLevel=0}else{if(M&&M.details&&M.details.live){l.logger.warn("level controller,"+H+" on live stream, discard");if(L){this._level=undefined}}else{if(H!==i.ErrorDetails.FRAG_LOAD_ERROR&&H!==i.ErrorDetails.FRAG_LOAD_TIMEOUT){l.logger.error("cannot recover "+H+" error");this._level=undefined;if(this.timer){clearTimeout(this.timer);this.timer=null}J.fatal=true;G.trigger(p.__default.ERROR,J)}}}}}}},{key:"onLevelLoaded",value:function u(K){if(K.level===this._level){var H=K.details;if(H.live){var I=1000*(H.averagetargetduration?H.averagetargetduration:H.targetduration),G=this._levels[K.level],J=G.details;if(J&&H.endSN===J.endSN){I/=2;l.logger.log("same live playlist, reload twice faster")}I-=performance.now()-K.stats.trequest;I=Math.max(1000,Math.round(I));l.logger.log("live playlist, reload in "+I+" ms");this.timer=setTimeout(this.ontick,I)}else{this.timer=null}}}},{key:"tick",value:function x(){var G=this._level;if(G!==undefined&&this.canload){var I=this._levels[G],H=I.urlId;this.hls.trigger(p.__default.LEVEL_LOADING,{url:I.url[H],level:G,id:H})}}},{key:"levels",get:function w(){return this._levels}},{key:"level",get:function w(){return this._level},set:function D(G){var H=this._levels;if(H&&H.length>G){if(this._level!==G||H[G].details===undefined){this.setLevelInternal(G)}}}},{key:"manualLevel",get:function w(){return this._manualLevel},set:function D(G){this._manualLevel=G;if(this._startLevel===undefined){this._startLevel=G}if(G!==-1){this.level=G}}},{key:"firstLevel",get:function w(){return this._firstLevel},set:function D(G){this._firstLevel=G}},{key:"startLevel",get:function w(){if(this._startLevel===undefined){return this._firstLevel}else{return this._startLevel}},set:function D(G){this._startLevel=G}},{key:"nextLoadLevel",get:function w(){if(this._manualLevel!==-1){return this._manualLevel}else{return this.hls.abrController.nextAutoLevel}},set:function D(G){this.level=G;if(this._manualLevel===-1){this.hls.abrController.nextAutoLevel=G}}}]);return z}(h.__default);m.__default=q},{"../errors":24,"../event-handler":25,"../events":26,"../utils/logger":43}],11:[function(o,h,E){Object.defineProperty(E,"__esModule",{value:true});var z=function(){function F(J,H){for(var G=0;G<H.length;G++){var I=H[G];I.enumerable=I.enumerable||false;I.configurable=true;if("value" in I){I.writable=true}Object.defineProperty(J,I.key,I)}}return function(I,G,H){if(G){F(I.prototype,G)}if(H){F(I,H)}return I}}();var w=o("../utils/binary-search");var g=e(w);var v=o("../helper/buffer-helper");var x=e(v);var D=o("../demux/demuxer");var l=e(D);var t=o("../events");var r=e(t);var j=o("../event-handler");var m=e(j);var k=o("../helper/level-helper");var B=e(k);var p=o("../utils/timeRanges");var i=e(p);var A=o("../errors");var q=o("../utils/logger");function e(F){return F&&F.__esModule?F:{__default:F}}function n(F,G){if(!(F instanceof G)){throw new TypeError("Cannot call a class as a function")}}function s(F,G){if(!F){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return G&&(typeof G==="object"||typeof G==="function")?G:F}function y(G,F){if(typeof F!=="function"&&F!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof F)}G.prototype=Object.create(F&&F.prototype,{constructor:{value:G,enumerable:false,writable:true,configurable:true}});if(F){Object.setPrototypeOf?Object.setPrototypeOf(G,F):G.__proto__=F}}var u={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR"};var C=function(ae){y(ag,ae);function ag(ay){n(this,ag);var az=s(this,Object.getPrototypeOf(ag).call(this,ay,r.__default.MEDIA_ATTACHED,r.__default.MEDIA_DETACHING,r.__default.MANIFEST_LOADING,r.__default.MANIFEST_PARSED,r.__default.LEVEL_LOADED,r.__default.KEY_LOADED,r.__default.FRAG_LOADED,r.__default.FRAG_LOAD_EMERGENCY_ABORTED,r.__default.FRAG_PARSING_INIT_SEGMENT,r.__default.FRAG_PARSING_DATA,r.__default.FRAG_PARSED,r.__default.ERROR,r.__default.AUDIO_TRACK_SWITCH,r.__default.BUFFER_CREATED,r.__default.BUFFER_APPENDED,r.__default.BUFFER_FLUSHED));az.config=ay.config;az.audioCodecSwap=false;az.ticks=0;az.ontick=az.tick.bind(az);return az}z(ag,[{key:"destroy",value:function ak(){this.stopLoad();if(this.timer){clearInterval(this.timer);this.timer=null}m.__default.prototype.destroy.call(this);this.state=u.STOPPED}},{key:"startLoad",value:function I(az){if(this.levels){var aA=this.media,ay=this.lastCurrentTime;this.stopLoad();this.demuxer=new l.__default(this.hls,"main");if(!this.timer){this.timer=setInterval(this.ontick,100)}this.level=-1;this.fragLoadError=0;if(aA&&ay>0){q.logger.log("configure startPosition @"+ay);if(!this.lastPaused){q.logger.log("resuming video");aA.play()}this.state=u.IDLE}else{this.lastCurrentTime=this.startPosition?this.startPosition:az;this.state=u.STARTING}this.nextLoadPosition=this.startPosition=this.lastCurrentTime;this.tick()}else{q.logger.warn("cannot start loading as manifest not parsed yet");this.state=u.STOPPED}}},{key:"stopLoad",value:function Z(){var ay=this.fragCurrent;if(ay){if(ay.loader){ay.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.state=u.STOPPED}},{key:"tick",value:function F(){this.ticks++;if(this.ticks===1){this.doTick();if(this.ticks>1){setTimeout(this.tick,1)}this.ticks=0}}},{key:"doTick",value:function K(){switch(this.state){case u.STARTING:var aA=this.hls;var aB=aA.startLevel;if(aB===-1){aB=0;this.fragBitrateTest=true}this.level=aA.nextLoadLevel=aB;this.state=u.WAITING_LEVEL;this.loadedmetadata=false;break;case u.IDLE:if(!this._doTickIdle()){return}break;case u.WAITING_LEVEL:var aC=this.levels[this.level];if(aC&&aC.details){this.state=u.IDLE}break;case u.FRAG_LOADING_WAITING_RETRY:var az=performance.now();var ay=this.retryDate;if(!ay||az>=ay||this.media&&this.media.seeking){q.logger.log("mediaController: retryDate reached, switch back to IDLE state");this.state=u.IDLE}break;case u.ERROR:case u.PAUSED:case u.STOPPED:case u.FRAG_LOADING:case u.PARSING:case u.PARSED:case u.ENDED:break;default:break}this._checkBuffer();this._checkFragmentChanged()}},{key:"_doTickIdle",value:function Q(){var ay=this.hls,aD=ay.config,aB=this.media;if(!aB&&(this.startFragRequested||!aD.startFragPrefetch)){return true}var aH=void 0;if(this.loadedmetadata){aH=aB.currentTime}else{aH=this.nextLoadPosition}var aA=ay.nextLoadLevel;var aI=void 0;if(this.levels[aA].hasOwnProperty("bitrate")){aI=Math.max(8*aD.maxBufferSize/this.levels[aA].bitrate,aD.maxBufferLength);aI=Math.min(aI,aD.maxMaxBufferLength)}else{aI=aD.maxBufferLength}var aF=x.__default.bufferInfo(this.mediaBuffer?this.mediaBuffer:aB,aH,aD.maxBufferHole),aC=aF.len;if(aC>=aI){return true}q.logger.trace("buffer length of "+aC.toFixed(3)+" is below max of "+aI.toFixed(3)+". checking for more payload ...");ay.nextLoadLevel=aA;this.level=aA;var aG=this.levels[aA].details;if(typeof aG==="undefined"||aG.live&&this.levelLastLoaded!==aA){this.state=u.WAITING_LEVEL;return true}var az=this.fragPrevious;if(!aG.live&&az&&az.sn===aG.endSN){if(!aB.seeking||aB.duration-aF.end<az.duration/2){var aE={};if(this.audioTrackType==="AUDIO"){aE.type="video"}this.hls.trigger(r.__default.BUFFER_EOS,aE);this.state=u.ENDED;return true}}return this._fetchPayloadOrEos({pos:aH,bufferInfo:aF,levelDetails:aG})}},{key:"_fetchPayloadOrEos",value:function G(aC){var aG=aC.pos;var aD=aC.bufferInfo;var aH=aC.levelDetails;var az=this.fragPrevious,ay=this.level;var aF=aH.fragments,aE=aF.length,aA=aF[0].start,aB=aF[aE-1].start+aF[aE-1].duration,aJ=aD.end,aI=void 0;if(aH.live){aI=this._ensureFragmentAtLivePoint({levelDetails:aH,bufferEnd:aJ,start:aA,end:aB,fragPrevious:az,fragments:aF,fragLen:aE});if(aI===null){return false}}else{if(aJ<aA){aI=aF[0]}}if(!aI){aI=this._findFragment({start:aA,fragPrevious:az,fragLen:aE,fragments:aF,bufferEnd:aJ,end:aB,levelDetails:aH})}if(aI){return this._loadFragmentOrKey({frag:aI,level:ay,levelDetails:aH,pos:aG,bufferEnd:aJ})}return true}},{key:"_ensureFragmentAtLivePoint",value:function J(aC){var aH=aC.levelDetails;var aL=aC.bufferEnd;var az=aC.start;var aE=aC.end;var ay=aC.fragPrevious;var aG=aC.fragments;var aF=aC.fragLen;var aB=this.hls.config;var aK=void 0;var aJ=aB.liveMaxLatencyDuration!==undefined?aB.liveMaxLatencyDuration:aB.liveMaxLatencyDurationCount*aH.targetduration;if(aL<Math.max(az,aE-aJ)){var aI=this.liveSyncPosition=this.computeLivePosition(az,aH);q.logger.log("buffer end: "+aL+" is located too far from the end of live sliding playlist, reset currentTime to : "+aI.toFixed(3));aL=aI;var aA=this.media;if(aA&&aA.readyState&&aA.duration>aI){aA.currentTime=aI}}if(aH.PTSKnown&&aL>aE){return null}if(this.startFragRequested&&!aH.PTSKnown){if(ay){var aD=ay.sn+1;if(aD>=aH.startSN&&aD<=aH.endSN){aK=aG[aD-aH.startSN];q.logger.log("live playlist, switching playlist, load frag with next SN: "+aK.sn)}}if(!aK){aK=aG[Math.min(aF-1,Math.round(aF/2))];q.logger.log("live playlist, switching playlist, unknown, load middle frag : "+aK.sn)}}return aK}},{key:"_findFragment",value:function T(aF){var aB=aF.start;var az=aF.fragPrevious;var aH=aF.fragLen;var aI=aF.fragments;var aL=aF.bufferEnd;var aG=aF.end;var aJ=aF.levelDetails;var aE=this.hls.config;var aK=void 0,aA=void 0,aD=aE.maxFragLookUpTolerance;if(aL<aG){if(aL>aG-aD){aD=0}aA=g.__default.search(aI,function(aM){if(aM.start+aM.duration-aD<=aL){return 1}else{if(aM.start-aD>aL&&aM.start){return -1}}return 0})}else{aA=aI[aH-1]}if(aA){aK=aA;aB=aA.start;if(az&&aK.level===az.level&&aK.sn===az.sn){if(aK.sn<aJ.endSN){var aC=az.deltaPTS,ay=aK.sn-aJ.startSN;if(aC&&aC>aE.maxBufferHole&&az.dropped&&ay){aK=aI[ay-1];q.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this");az.loadCounter--}else{aK=aI[ay+1];q.logger.log("SN just loaded, load next one: "+aK.sn)}}else{aK=null}}}return aK}},{key:"_loadFragmentOrKey",value:function ab(aA){var aF=aA.frag;var az=aA.level;var aD=aA.levelDetails;var aC=aA.pos;var aG=aA.bufferEnd;var ay=this.hls,aB=ay.config;if(aF.decryptdata.uri!=null&&aF.decryptdata.key==null){q.logger.log("Loading key for "+aF.sn+" of ["+aD.startSN+" ,"+aD.endSN+"],level "+az);this.state=u.KEY_LOADING;ay.trigger(r.__default.KEY_LOADING,{frag:aF})}else{q.logger.log("Loading "+aF.sn+" of ["+aD.startSN+" ,"+aD.endSN+"],level "+az+", currentTime:"+aC+",bufferEnd:"+aG.toFixed(3));if(this.fragLoadIdx!==undefined){this.fragLoadIdx++}else{this.fragLoadIdx=0}if(aF.loadCounter){aF.loadCounter++;var aE=aB.fragLoadingLoopThreshold;if(aF.loadCounter>aE&&Math.abs(this.fragLoadIdx-aF.loadIdx)<aE){ay.trigger(r.__default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:false,frag:aF});return false}}else{aF.loadCounter=1}aF.loadIdx=this.fragLoadIdx;aF.autoLevel=ay.autoLevelEnabled;this.fragCurrent=aF;this.startFragRequested=true;ay.trigger(r.__default.FRAG_LOADING,{frag:aF});this.state=u.FRAG_LOADING;return true}}},{key:"getBufferRange",value:function H(az){var aB,aA,ay=this.bufferRange;if(ay){for(aB=ay.length-1;aB>=0;aB--){aA=ay[aB];if(az>=aA.start&&az<=aA.end){return aA}}}return null}},{key:"followingBufferRange",value:function S(ay){if(ay){return this.getBufferRange(ay.end+0.5)}return null}},{key:"isBuffered",value:function O(ay){var aB=this.media;if(aB){var aA=aB.buffered;for(var az=0;az<aA.length;az++){if(ay>=aA.start(az)&&ay<=aA.end(az)){return true}}}return false}},{key:"_checkFragmentChanged",value:function ap(){var aB,az,ay=this.media;if(ay&&ay.seeking===false){az=ay.currentTime;if(az>ay.playbackRate*this.lastCurrentTime){this.lastCurrentTime=az}if(this.isBuffered(az)){aB=this.getBufferRange(az)}else{if(this.isBuffered(az+0.1)){aB=this.getBufferRange(az+0.1)}}if(aB){var aA=aB.frag;if(aA!==this.fragPlaying){this.fragPlaying=aA;this.hls.trigger(r.__default.FRAG_CHANGED,{frag:aA})}}}}},{key:"immediateLevelSwitch",value:function X(){q.logger.log("immediateLevelSwitch");if(!this.immediateSwitch){this.immediateSwitch=true;var aA=this.media,az=void 0;if(aA){az=aA.paused;aA.pause()}else{az=true}this.previouslyPaused=az}var ay=this.fragCurrent;if(ay&&ay.loader){ay.loader.abort()}this.fragCurrent=null;this.state=u.PAUSED;this.hls.trigger(r.__default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY})}},{key:"immediateLevelSwitchEnd",value:function ao(){var ay=this.media;if(ay&&ay.buffered.length){this.immediateSwitch=false;if(this.isBuffered(ay.currentTime)){ay.currentTime-=0.0001}if(!this.previouslyPaused){ay.play()}}}},{key:"nextLevelSwitch",value:function ad(){var aD=this.media;if(aD&&aD.readyState){var aE=void 0,ay=void 0,aF=void 0;this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;ay=this.getBufferRange(aD.currentTime);if(ay&&ay.start>1){this.state=u.PAUSED;this.hls.trigger(r.__default.BUFFER_FLUSHING,{startOffset:0,endOffset:ay.start-1})}if(!aD.paused){var aA=this.hls.nextLoadLevel,aC=this.levels[aA],aB=this.fragLastKbps;if(aB&&this.fragCurrent){aE=this.fragCurrent.duration*aC.bitrate/(1000*aB)+1}else{aE=0}}else{aE=0}aF=this.getBufferRange(aD.currentTime+aE);if(aF){aF=this.followingBufferRange(aF);if(aF){var az=this.fragCurrent;if(az&&az.loader){az.loader.abort()}this.fragCurrent=null;this.state=u.PAUSED;this.hls.trigger(r.__default.BUFFER_FLUSHING,{startOffset:aF.start,endOffset:Number.POSITIVE_INFINITY})}}}}},{key:"onMediaAttached",value:function aa(az){var aA=this.media=this.mediaBuffer=az.media;this.onvseeking=this.onMediaSeeking.bind(this);this.onvseeked=this.onMediaSeeked.bind(this);this.onvended=this.onMediaEnded.bind(this);aA.addEventListener("seeking",this.onvseeking);aA.addEventListener("seeked",this.onvseeked);aA.addEventListener("ended",this.onvended);var ay=this.config;if(this.levels&&ay.autoStartLoad){this.hls.startLoad(ay.startPosition)}}},{key:"onMediaDetaching",value:function V(){var az=this.media;if(az&&az.ended){q.logger.log("MSE detaching and video ended, reset startPosition");this.startPosition=this.lastCurrentTime=0}var ay=this.levels;if(ay){ay.forEach(function(aA){if(aA.details){aA.details.fragments.forEach(function(aB){aB.loadCounter=undefined})}})}if(az){az.removeEventListener("seeking",this.onvseeking);az.removeEventListener("seeked",this.onvseeked);az.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvended=null}this.media=null;this.loadedmetadata=false;this.stopLoad()}},{key:"onMediaSeeking",value:function N(){var aD=this.media,aC=aD?aD.currentTime:undefined;q.logger.log("media seeking to "+aC);if(this.state===u.FRAG_LOADING){var aB=x.__default.bufferInfo(aD,aC,this.config.maxBufferHole),aA=this.fragCurrent;if(aB.len===0&&aA){var ay=this.config.maxFragLookUpTolerance,aE=aA.start-ay,az=aA.start+aA.duration+ay;if(aC<aE||aC>az){if(aA.loader){q.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load");aA.loader.abort()}this.fragCurrent=null;this.fragPrevious=null;this.state=u.IDLE}else{q.logger.log("seeking outside of buffer but within currently loaded fragment range")}}}else{if(this.state===u.ENDED){this.state=u.IDLE}}if(aD){this.lastCurrentTime=aC}if(this.state!==u.FRAG_LOADING&&this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}this.tick()}},{key:"onMediaSeeked",value:function ax(){q.logger.log("media seeked to "+this.media.currentTime);this.tick()}},{key:"onMediaEnded",value:function ac(){q.logger.log("media ended");this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function L(){q.logger.log("trigger BUFFER_RESET");this.hls.trigger(r.__default.BUFFER_RESET);this.bufferRange=[];this.stalled=false;this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function at(aC){var az=false,aA=false,aB;aC.levels.forEach(function(aD){aB=aD.audioCodec;if(aB){if(aB.indexOf("mp4a.40.2")!==-1){az=true}if(aB.indexOf("mp4a.40.5")!==-1){aA=true}}});this.audioCodecSwitch=az&&aA;if(this.audioCodecSwitch){q.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC")}this.levels=aC.levels;this.startLevelLoaded=false;this.startFragRequested=false;var ay=this.config;if(ay.autoStartLoad){this.hls.startLoad(ay.startPosition)}}},{key:"onLevelLoaded",value:function ai(aE){var aA=aE.details,az=aE.level,ay=this.levels[az],aF=aA.totalduration,aD=0;q.logger.log("level "+az+" loaded ["+aA.startSN+","+aA.endSN+"],duration:"+aF);this.levelLastLoaded=az;if(aA.live){var aC=ay.details;if(aC){B.__default.mergeDetails(aC,aA);aD=aA.fragments[0].start;this.liveSyncPosition=this.computeLivePosition(aD,aC);if(aA.PTSKnown){q.logger.log("live playlist sliding:"+aD.toFixed(3))}else{q.logger.log("live playlist - outdated PTS, unknown sliding")}}else{aA.PTSKnown=false;q.logger.log("live playlist - first load, unknown sliding")}}else{aA.PTSKnown=false}ay.details=aA;this.hls.trigger(r.__default.LEVEL_UPDATED,{details:aA,level:az});if(this.startFragRequested===false){if(this.startPosition===-1){var aB=aA.startTimeOffset;if(!isNaN(aB)){if(aB<0){q.logger.log("negative start time offset "+aB+", count from end of last fragment");aB=aD+aF+aB}q.logger.log("start time offset found in playlist, adjust startPosition to "+aB);this.startPosition=aB}else{if(aA.live){this.startPosition=this.computeLivePosition(aD,aA);q.logger.log("configure startPosition to "+this.startPosition)}else{this.startPosition=0}}}this.nextLoadPosition=this.startPosition}if(this.state===u.WAITING_LEVEL){this.state=u.IDLE}this.tick()}},{key:"onKeyLoaded",value:function Y(){if(this.state===u.KEY_LOADING){this.state=u.IDLE;this.tick()}}},{key:"onFragLoaded",value:function an(aF){var aG=this.fragCurrent;if(this.state===u.FRAG_LOADING&&aG&&aF.frag.type==="main"&&aF.frag.level===aG.level&&aF.frag.sn===aG.sn){q.logger.log("Loaded  "+aG.sn+" of level "+aG.level);if(this.fragBitrateTest===true){this.state=u.IDLE;this.fragBitrateTest=false;this.startFragRequested=false;aF.stats.tparsed=aF.stats.tbuffered=performance.now();this.hls.trigger(r.__default.FRAG_BUFFERED,{stats:aF.stats,frag:aG,id:"main"})}else{this.state=u.PARSING;this.stats=aF.stats;var aB=this.levels[this.level],ay=aB.details,aE=ay.totalduration,aA=aG.startDTS!==undefined?aG.startDTS:aG.start,az=aG.level,aD=aG.sn,aH=this.config.defaultAudioCodec||aB.audioCodec;if(this.audioCodecSwap){q.logger.log("swapping playlist audio codec");if(aH===undefined){aH=this.lastAudioCodec}if(aH){if(aH.indexOf("mp4a.40.5")!==-1){aH="mp4a.40.2"}else{aH="mp4a.40.5"}}}this.pendingAppending=0;q.logger.log("Demuxing "+aD+" of ["+ay.startSN+" ,"+ay.endSN+"],level "+az+", cc "+aG.cc);var aC=this.demuxer;if(!aC){aC=this.demuxer=new l.__default(this.hls,"main")}aC.push(aF.payload,aH,aB.videoCodec,aA,aG.cc,az,aD,aE,aG.decryptdata)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function ah(aB){var aF=this.fragCurrent;if(aF&&aB.id==="main"&&aB.sn===aF.sn&&aB.level===aF.level&&this.state===u.PARSING){var aD=aB.tracks,aE,az;if(aD.audio&&this.audioTrackType==="AUDIO"){delete aD.audio}az=aD.audio;if(az){var aG=this.levels[this.level].audioCodec,ay=navigator.userAgent.toLowerCase();if(aG&&this.audioCodecSwap){q.logger.log("swapping playlist audio codec");if(aG.indexOf("mp4a.40.5")!==-1){aG="mp4a.40.2"}else{aG="mp4a.40.5"}}if(this.audioCodecSwitch){if(az.metadata.channelCount!==1&&ay.indexOf("firefox")===-1){aG="mp4a.40.5"}}if(ay.indexOf("android")!==-1){aG="mp4a.40.2";q.logger.log("Android: force audio codec to"+aG)}az.levelCodec=aG;az.id=aB.id}az=aD.video;if(az){az.levelCodec=this.levels[this.level].videoCodec;az.id=aB.id}if(aB.unique){var aA={codec:"",levelCodec:""};for(aE in aB.tracks){az=aD[aE];aA.container=az.container;if(aA.codec){aA.codec+=",";aA.levelCodec+=","}if(az.codec){aA.codec+=az.codec}if(az.levelCodec){aA.levelCodec+=az.levelCodec}}aD={audiovideo:aA}}this.hls.trigger(r.__default.BUFFER_CODECS,aD);for(aE in aD){az=aD[aE];q.logger.log("main track:"+aE+",container:"+az.container+",codecs[level/parsed]=["+az.levelCodec+"/"+az.codec+"]");var aC=az.initSegment;if(aC){this.pendingAppending++;this.hls.trigger(r.__default.BUFFER_APPENDING,{type:aE,data:aC,parent:"main",content:"initSegment"})}}this.tick()}}},{key:"onFragParsingData",value:function au(aC){var aB=this;var aA=this.fragCurrent;if(aA&&aC.id==="main"&&aC.sn===aA.sn&&aC.level===aA.level&&(aC.type!=="audio"||this.audioTrackType!=="AUDIO")&&this.state===u.PARSING){var aE=this.levels[this.level],aD=this.fragCurrent;q.logger.log("parsed "+aC.type+",PTS:["+aC.startPTS.toFixed(3)+","+aC.endPTS.toFixed(3)+"],DTS:["+aC.startDTS.toFixed(3)+"/"+aC.endDTS.toFixed(3)+"],nb:"+aC.nb+",dropped:"+(aC.dropped||0));var ay=B.__default.updateFragPTSDTS(aE.details,aD.sn,aC.startPTS,aC.endPTS,aC.startDTS,aC.endDTS),az=this.hls;az.trigger(r.__default.LEVEL_PTS_UPDATED,{details:aE.details,level:this.level,drift:ay});if(aC.type==="video"){aD.dropped=aC.dropped}[aC.data1,aC.data2].forEach(function(aF){if(aF){aB.pendingAppending++;az.trigger(r.__default.BUFFER_APPENDING,{type:aC.type,data:aF,parent:"main",content:"data"})}});this.nextLoadPosition=aC.endPTS;this.bufferRange.push({type:aC.type,start:aC.startPTS,end:aC.endPTS,frag:aD});this.tick()}}},{key:"onFragParsed",value:function aw(az){var ay=this.fragCurrent;if(ay&&az.id==="main"&&az.sn===ay.sn&&az.level===ay.level&&this.state===u.PARSING){this.stats.tparsed=performance.now();this.state=u.PARSED;this._checkAppendedParsed()}}},{key:"onAudioTrackSwitch",value:function ar(aA){var az=aA.type;if(az==="main"){if(this.mediaBuffer!==this.media){q.logger.log("switching on main audio, use media.buffered to schedule main fragment loading");this.mediaBuffer=this.media;var ay=this.fragCurrent;if(ay.loader){q.logger.log("switching to main audio track, cancel main fragment load");ay.loader.abort()}this.fragCurrent=null;this.fragPrevious=null;if(this.demuxer){this.demuxer.destroy();this.demuxer=null}this.state=u.IDLE}}else{if(this.videoBuffer&&this.mediaBuffer!==this.videoBuffer){q.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading");this.mediaBuffer=this.videoBuffer}}this.audioTrackType=az}},{key:"onBufferCreated",value:function am(aD){var aB=aD.tracks,aA=void 0,az=void 0,aE=false;for(var aC in aB){var ay=aB[aC];if(ay.id==="main"){az=aC;aA=ay;if(aC==="video"){this.videoBuffer=aB[aC].buffer}}else{aE=true}}if(aE&&aA){q.logger.log("alternate track found, use "+az+".buffered to schedule main fragment loading");this.mediaBuffer=aA.buffer}else{this.mediaBuffer=this.media}}},{key:"onBufferAppended",value:function P(ay){if(ay.parent==="main"){switch(this.state){case u.PARSING:case u.PARSED:this.pendingAppending--;this._checkAppendedParsed();break;default:break}}}},{key:"_checkAppendedParsed",value:function U(){if(this.state===u.PARSED&&this.pendingAppending===0){var aA=this.fragCurrent,ay=this.stats;if(aA){this.fragPrevious=aA;ay.tbuffered=performance.now();this.fragLastKbps=Math.round(8*ay.total/(ay.tbuffered-ay.tfirst));this.hls.trigger(r.__default.FRAG_BUFFERED,{stats:ay,frag:aA,id:"main"});var az=this.mediaBuffer?this.mediaBuffer:this.media;q.logger.log("main buffered : "+i.__default.toString(az.buffered));this.state=u.IDLE}this.tick()}}},{key:"onError",value:function R(aA){var aB=aA.frag;if(aB&&aB.type!=="main"){return}switch(aA.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!aA.fatal){var az=this.fragLoadError;if(az){az++}else{az=1}if(az<=this.config.fragLoadingMaxRetry||this.media&&this.isBuffered(this.media.currentTime)){this.fragLoadError=az;aB.loadCounter=0;var ay=Math.min(Math.pow(2,az-1)*this.config.fragLoadingRetryDelay,64000);q.logger.warn("mediaController: frag loading failed, retry in "+ay+" ms");this.retryDate=performance.now()+ay;this.state=u.FRAG_LOADING_WAITING_RETRY}else{q.logger.error("mediaController: "+aA.details+" reaches max retry, redispatch as fatal ...");aA.fatal=true;this.hls.trigger(r.__default.ERROR,aA);this.state=u.ERROR}}break;case A.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:if(this.state!==u.ERROR){this.state=aA.fatal?u.ERROR:u.IDLE;q.logger.warn("mediaController: "+aA.details+" while loading frag,switch to "+this.state+" state ...")}break;case A.ErrorDetails.BUFFER_FULL_ERROR:if(this.state===u.PARSING||this.state===u.PARSED){this.config.maxMaxBufferLength/=2;q.logger.warn("reduce max buffer length to "+this.config.maxMaxBufferLength+"s and switch to IDLE state");this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.state=u.IDLE}break;default:break}}},{key:"_checkBuffer",value:function av(){var aA=this.media;if(aA&&aA.readyState){var az=aA.currentTime,aC=aA.buffered;if(!this.loadedmetadata&&aC.length){this.loadedmetadata=true;var aF=this.startPosition,aD=this.isBuffered(aF);if(az!==aF||!aD){q.logger.log("target start position:"+aF);if(!aD&&az!=0){aF=aC.start(0);q.logger.log("target start position not buffered, seek to buffered.start(0) "+aF);q.logger.log("adjust currentTime from "+az+" to "+aF);aA.currentTime=aF}}}else{if(this.immediateSwitch){this.immediateLevelSwitchEnd()}else{var aG=x.__default.bufferInfo(aA,az,0),aI=!(aA.paused||aA.ended||aA.buffered.length===0),aH=0.4,aE=az>aA.playbackRate*this.lastCurrentTime;if(this.stalled&&aE){this.stalled=false;q.logger.log("playback not stuck anymore @"+az)}if(aI&&aG.len<=aH){if(aE){aH=0;this.seekHoleNudgeDuration=0}else{if(!this.stalled){this.seekHoleNudgeDuration=0;q.logger.log("playback seems stuck @"+az);this.hls.trigger(r.__default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_STALLED_ERROR,fatal:false});this.stalled=true}else{this.seekHoleNudgeDuration+=this.config.seekHoleNudgeDuration}}if(aG.len<=aH){var aB=aG.nextStart,aJ=aB-az;if(aB&&aJ<this.config.maxSeekHole&&aJ>0){q.logger.log("adjust currentTime from "+aA.currentTime+" to next buffered @ "+aB+" + nudge "+this.seekHoleNudgeDuration);var ay=aB+this.seekHoleNudgeDuration-aA.currentTime;aA.currentTime=aB+this.seekHoleNudgeDuration;this.hls.trigger(r.__default.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:false,hole:ay})}}}}}}}},{key:"onFragLoadEmergencyAborted",value:function af(){this.state=u.IDLE;this.tick()}},{key:"onBufferFlushed",value:function M(){var az=[],ay,aA;for(aA=0;aA<this.bufferRange.length;aA++){ay=this.bufferRange[aA];if(this.isBuffered((ay.start+ay.end)/2)){az.push(ay)}}this.bufferRange=az;this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.state=u.IDLE;this.fragPrevious=null}},{key:"swapAudioCodec",value:function al(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function aj(az,ay){var aA=this.config.liveSyncDuration!==undefined?this.config.liveSyncDuration:this.config.liveSyncDurationCount*ay.targetduration;return az+Math.max(0,ay.totalduration-aA)}},{key:"state",set:function W(az){if(this.state!==az){var ay=this.state;this._state=az;q.logger.log("engine state transition from "+ay+" to "+az);this.hls.trigger(r.__default.STREAM_STATE_TRANSITION,{previousState:ay,nextState:az})}},get:function aq(){return this._state}},{key:"currentLevel",get:function aq(){if(this.media){var ay=this.getBufferRange(this.media.currentTime);if(ay){return ay.frag.level}}return -1}},{key:"nextBufferRange",get:function aq(){if(this.media){return this.followingBufferRange(this.getBufferRange(this.media.currentTime))}else{return null}}},{key:"nextLevel",get:function aq(){var ay=this.nextBufferRange;if(ay){return ay.frag.level}else{return -1}}},{key:"liveSyncPosition",get:function aq(){return this._liveSyncPosition},set:function W(ay){this._liveSyncPosition=ay}}]);return ag}(m.__default);E.__default=C},{"../demux/demuxer":20,"../errors":24,"../event-handler":25,"../events":26,"../helper/buffer-helper":28,"../helper/level-helper":29,"../utils/binary-search":39,"../utils/logger":43,"../utils/timeRanges":45}],12:[function(e,g,k){Object.defineProperty(k,"__esModule",{value:true});var j=function(){function u(y,w){for(var v=0;v<w.length;v++){var x=w[v];x.enumerable=x.enumerable||false;x.configurable=true;if("value" in x){x.writable=true}Object.defineProperty(y,x.key,x)}}return function(x,v,w){if(v){u(x.prototype,v)}if(w){u(x,w)}return x}}();var m=e("../events");var o=t(m);var i=e("../event-handler");var h=t(i);var n=e("../utils/cea-608-parser");var q=t(n);function t(u){return u&&u.__esModule?u:{__default:u}}function l(u,v){if(!(u instanceof v)){throw new TypeError("Cannot call a class as a function")}}function r(u,v){if(!u){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return v&&(typeof v==="object"||typeof v==="function")?v:u}function s(v,u){if(typeof u!=="function"&&u!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof u)}v.prototype=Object.create(u&&u.prototype,{constructor:{value:v,enumerable:false,writable:true,configurable:true}});if(u){Object.setPrototypeOf?Object.setPrototypeOf(v,u):v.__proto__=u}}var p=function(F){s(A,F);function A(I){l(this,A);var L=r(this,Object.getPrototypeOf(A).call(this,I,o.__default.MEDIA_ATTACHING,o.__default.MEDIA_DETACHING,o.__default.FRAG_PARSING_USERDATA,o.__default.MANIFEST_LOADING,o.__default.FRAG_LOADED,o.__default.LEVEL_SWITCH));L.hls=I;L.config=I.config;L.enabled=true;L.Cues=I.config.cueHandler;if(L.config.enableCEA708Captions){var H=L;var G={newCue:function J(O,N,M){if(!H.textTrack1){H.textTrack1=H.createTextTrack("captions","Unknown CC1","en")}H.Cues.newCue(H.textTrack1,O,N,M)}};var K={newCue:function J(O,N,M){if(!H.textTrack2){H.textTrack2=H.createTextTrack("captions","Unknown CC2","es")}H.Cues.newCue(H.textTrack2,O,N,M)}};L.cea608Parser=new q.__default(0,G,K)}return L}j(A,[{key:"clearCurrentCues",value:function C(G){if(G&&G.cues){while(G.cues.length>0){G.removeCue(G.cues[0])}}}},{key:"createTextTrack",value:function u(H,G,I){if(this.media){return this.media.addTextTrack(H,G,I)}}},{key:"destroy",value:function E(){h.__default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function v(G){this.media=G.media}},{key:"onMediaDetaching",value:function x(){}},{key:"onManifestLoading",value:function y(){this.lastPts=Number.NEGATIVE_INFINITY}},{key:"onLevelSwitch",value:function B(){if(this.hls.currentLevel.closedCaptions==="NONE"){this.enabled=false}else{this.enabled=true}}},{key:"onFragLoaded",value:function z(G){if(G.frag.type==="main"){var H=G.frag.start;if(H<=this.lastPts){this.clearCurrentCues(this.textTrack1);this.clearCurrentCues(this.textTrack2)}this.lastPts=H}}},{key:"onFragParsingUserdata",value:function w(I){if(this.enabled){for(var G=0;G<I.samples.length;G++){var H=this.extractCea608Data(I.samples[G].bytes);this.cea608Parser.addData(I.samples[G].pts,H)}}}},{key:"extractCea608Data",value:function D(G){var K=G[0]&31;var J=2;var P,O,N,M,L;var I=[];for(var H=0;H<K;H++){P=G[J++];O=127&G[J++];N=127&G[J++];M=(4&P)===0?false:true;L=3&P;if(O===0&&N===0){continue}if(M){if(L===0){I.push(O);I.push(N)}}}return I}}]);return A}(h.__default);k.__default=p},{"../event-handler":25,"../events":26,"../utils/cea-608-parser":40}],13:[function(j,i,e){Object.defineProperty(e,"__esModule",{value:true});var h=function(){function l(p,n){for(var m=0;m<n.length;m++){var o=n[m];o.enumerable=o.enumerable||false;o.configurable=true;if("value" in o){o.writable=true}Object.defineProperty(p,o.key,o)}}return function(o,m,n){if(m){l(o.prototype,m)}if(n){l(o,n)}return o}}();function k(l,m){if(!(l instanceof m)){throw new TypeError("Cannot call a class as a function")}}var g=function(){function n(v){k(this,n);this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]];this._precompute();var r,q,s,u,x,t=this._tables[0][4],w=this._tables[1],o=v.length,p=1;if(o!==4&&o!==6&&o!==8){throw new Error("Invalid aes key size="+o)}u=v.slice(0);x=[];this._key=[u,x];for(r=o;r<4*o+28;r++){s=u[r-1];if(r%o===0||o===8&&r%o===4){s=t[s>>>24]<<24^t[s>>16&255]<<16^t[s>>8&255]<<8^t[s&255];if(r%o===0){s=s<<8^s>>>24^p<<24;p=p<<1^(p>>7)*283}}u[r]=u[r-o]^s}for(q=0;r;q++,r--){s=u[q&3?r:r-4];if(r<=4||q<4){x[q]=s}else{x[q]=w[0][t[s>>>24]]^w[1][t[s>>16&255]]^w[2][t[s>>8&255]]^w[3][t[s&255]]}}}h(n,[{key:"_precompute",value:function l(){var w=this._tables[0],E=this._tables[1],v=w[4],B=E[4],u,z,t,y=[],q=[],p,D,A,C,r,o;for(u=0;u<256;u++){q[(y[u]=u<<1^(u>>7)*283)^u]=u}for(z=t=0;!v[z];z^=p||1,t=q[t]||1){C=t^t<<1^t<<2^t<<3^t<<4;C=C>>8^C&255^99;v[z]=C;B[C]=z;A=y[D=y[p=y[z]]];o=A*16843009^D*65537^p*257^z*16843008;r=y[C]*257^C*16843008;for(u=0;u<4;u++){w[u][z]=r=r<<24^r>>>8;E[u][C]=o=o<<24^o>>>8}}for(u=0;u<5;u++){w[u]=w[u].slice(0);E[u]=E[u].slice(0)}}},{key:"decrypt",value:function m(H,G,E,C,w,o){var K=this._key[1],F=H^K[0],D=C^K[1],B=E^K[2],A=G^K[3],I,p,r,J=K.length/4-2,v,s=4,z=this._tables[1],y=z[0],x=z[1],u=z[2],t=z[3],q=z[4];for(v=0;v<J;v++){I=y[F>>>24]^x[D>>16&255]^u[B>>8&255]^t[A&255]^K[s];p=y[D>>>24]^x[B>>16&255]^u[A>>8&255]^t[F&255]^K[s+1];r=y[B>>>24]^x[A>>16&255]^u[F>>8&255]^t[D&255]^K[s+2];A=y[A>>>24]^x[F>>16&255]^u[D>>8&255]^t[B&255]^K[s+3];s+=4;F=I;D=p;B=r}for(v=0;v<4;v++){w[(3&-v)+o]=q[F>>>24]<<24^q[D>>16&255]<<16^q[B>>8&255]<<8^q[A&255]^K[s++];I=F;F=D;D=B;B=A;A=I}}}]);return n}();e.__default=g},{}],14:[function(g,h,k){Object.defineProperty(k,"__esModule",{value:true});var j=function(){function o(s,q){for(var p=0;p<q.length;p++){var r=q[p];r.enumerable=r.enumerable||false;r.configurable=true;if("value" in r){r.writable=true}Object.defineProperty(s,r.key,r)}}return function(r,p,q){if(p){o(r.prototype,p)}if(q){o(r,q)}return r}}();var e=g("./aes");var i=n(e);function n(o){return o&&o.__esModule?o:{__default:o}}function m(o,p){if(!(o instanceof p)){throw new TypeError("Cannot call a class as a function")}}var l=function(){function o(u,t){m(this,o);this.key=u;this.iv=t}j(o,[{key:"ntoh",value:function r(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24}},{key:"doDecrypt",value:function p(E,G,v){var F=new Int32Array(E.buffer,E.byteOffset,E.byteLength>>2),A=new i.__default(Array.prototype.slice.call(G)),H=new Uint8Array(E.byteLength),I=new Int32Array(H.buffer),D,C,B,z,y,x,w,u,t;D=~~v[0];C=~~v[1];B=~~v[2];z=~~v[3];for(t=0;t<F.length;t+=4){y=~~this.ntoh(F[t]);x=~~this.ntoh(F[t+1]);w=~~this.ntoh(F[t+2]);u=~~this.ntoh(F[t+3]);A.decrypt(y,x,w,u,I,t);I[t]=this.ntoh(I[t]^D);I[t+1]=this.ntoh(I[t+1]^C);I[t+2]=this.ntoh(I[t+2]^B);I[t+3]=this.ntoh(I[t+3]^z);D=y;C=x;B=w;z=u}return H}},{key:"localDecrypt",value:function s(x,w,v,u){var t=this.doDecrypt(x,w,v);u.set(t,x.byteOffset)}},{key:"decrypt",value:function q(y){var x=4*8000,z=new Int32Array(y),t=new Uint8Array(y.byteLength),w=0;var v=this.key;var u=this.iv;this.localDecrypt(z.subarray(w,w+x),v,u,t);for(w=x;w<z.length;w+=x){u=new Uint32Array([this.ntoh(z[w-4]),this.ntoh(z[w-3]),this.ntoh(z[w-2]),this.ntoh(z[w-1])]);this.localDecrypt(z.subarray(w,w+x),v,u,t)}return t}}]);return o}();k.__default=l},{"./aes":13}],15:[function(e,g,l){Object.defineProperty(l,"__esModule",{value:true});var i=function(){function q(u,s){for(var r=0;r<s.length;r++){var t=s[r];t.enumerable=t.enumerable||false;t.configurable=true;if("value" in t){t.writable=true}Object.defineProperty(u,t.key,t)}}return function(t,r,s){if(r){q(t.prototype,r)}if(s){q(t,s)}return t}}();var o=e("./aes128-decrypter");var h=p(o);var j=e("../errors");var k=e("../utils/logger");function p(q){return q&&q.__esModule?q:{__default:q}}function n(q,r){if(!(q instanceof r)){throw new TypeError("Cannot call a class as a function")}}var m=function(){function v(x){n(this,v);this.hls=x;try{var w=window?window.crypto:crypto;this.subtle=w.subtle||w.webkitSubtle;this.disableWebCrypto=!this.subtle}catch(y){this.disableWebCrypto=true}}i(v,[{key:"destroy",value:function t(){}},{key:"decrypt",value:function r(y,x,w,z){if(this.disableWebCrypto&&this.hls.config.enableSoftwareAES){this.decryptBySoftware(y,x,w,z)}else{this.decryptByWebCrypto(y,x,w,z)}}},{key:"decryptByWebCrypto",value:function u(y,x,w,A){var z=this;k.logger.log("decrypting by WebCrypto API");this.subtle.importKey("raw",x,{name:"AES-CBC",length:128},false,["decrypt"]).then(function(B){z.subtle.decrypt({name:"AES-CBC",iv:w.buffer},B,y).then(A).__catch(function(C){z.onWebCryptoError(C,y,x,w,A)})}).__catch(function(B){z.onWebCryptoError(B,y,x,w,A)})}},{key:"decryptBySoftware",value:function s(A,D,x,C){k.logger.log("decrypting by JavaScript Implementation");var w=new DataView(D.buffer);var z=new Uint32Array([w.getUint32(0),w.getUint32(4),w.getUint32(8),w.getUint32(12)]);w=new DataView(x.buffer);var y=new Uint32Array([w.getUint32(0),w.getUint32(4),w.getUint32(8),w.getUint32(12)]);var B=new h.__default(z,y);C(B.decrypt(A).buffer)}},{key:"onWebCryptoError",value:function q(y,z,x,w,A){if(this.hls.config.enableSoftwareAES){k.logger.log("disabling to use WebCrypto API");this.disableWebCrypto=true;this.decryptBySoftware(z,x,w,A)}else{k.logger.error("decrypting error : "+y.message);this.hls.trigger(Event.ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:true,reason:y.message})}}}]);return v}();l.__default=m},{"../errors":24,"../utils/logger":43,"./aes128-decrypter":14}],16:[function(g,h,k){Object.defineProperty(k,"__esModule",{value:true});var i=function(){function r(v,t){for(var s=0;s<t.length;s++){var u=t[s];u.enumerable=u.enumerable||false;u.configurable=true;if("value" in u){u.writable=true}Object.defineProperty(v,u.key,u)}}return function(u,s,t){if(s){r(u.prototype,s)}if(t){r(u,t)}return u}}();var p=g("./adts");var m=q(p);var j=g("../utils/logger");var o=g("../demux/id3");var e=q(o);function q(r){return r&&r.__esModule?r:{__default:r}}function l(r,s){if(!(r instanceof s)){throw new TypeError("Cannot call a class as a function")}}var n=function(){function v(w,z,y,x){l(this,v);this.observer=w;this.id=z;this.remuxerClass=y;this.config=x;this.remuxer=new this.remuxerClass(w,z,x);this.insertDiscontinuity()}i(v,[{key:"insertDiscontinuity",value:function u(){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0}}},{key:"push",value:function s(O,A,J,F,G,y,L,w){var I,x=new e.__default(O),P=90*x.timeStamp,N,Q,z,E,B,C,H,K,D;var M=false;if(G!==this.lastCC){j.logger.log(this.id+" discontinuity detected");this.lastCC=G;this.insertDiscontinuity();this.remuxer.switchLevel();this.remuxer.insertDiscontinuity()}else{if(y!==this.lastLevel){j.logger.log("audio track switch detected");this.lastLevel=y;this.remuxer.switchLevel();this.insertDiscontinuity()}else{if(L===this.lastSN+1){M=true}}}I=this._aacTrack;this.lastSN=L;this.lastLevel=y;for(B=x.length,K=O.length;B<K-1;B++){if(O[B]===255&&(O[B+1]&240)===240){break}}if(!I.audiosamplerate){N=m.__default.getAudioConfig(this.observer,O,B,A);I.config=N.config;I.audiosamplerate=N.samplerate;I.channelCount=N.channelCount;I.codec=N.codec;I.duration=w;j.logger.log("parsed codec:"+I.codec+",rate:"+N.samplerate+",nb channel:"+N.channelCount)}E=0;z=1024*90000/I.audiosamplerate;while(B+5<K){C=!!(O[B+1]&1)?7:9;Q=(O[B+3]&3)<<11|O[B+4]<<3|(O[B+5]&224)>>>5;Q-=C;if(Q>0&&B+C+Q<=K){H=P+E*z;D={unit:O.subarray(B+C,B+C+Q),pts:H,dts:H};I.samples.push(D);I.len+=Q;B+=Q+C;E++;for(;B<K-1;B++){if(O[B]===255&&(O[B+1]&240)===240){break}}}else{break}}this.remuxer.remux(y,L,this._aacTrack,{samples:[]},{samples:[{pts:P,dts:P,unit:x.payload}]},{samples:[]},F,M)}},{key:"destroy",value:function t(){}}],[{key:"probe",value:function r(y){var x=new e.__default(y),z,w;if(x.hasTimeStamp){for(z=x.length,w=y.length;z<w-1;z++){if(y[z]===255&&(y[z+1]&240)===240){return true}}}return false}}]);return v}();k.__default=n},{"../demux/id3":22,"../utils/logger":43,"./adts":17}],17:[function(k,j,g){Object.defineProperty(g,"__esModule",{value:true});var i=function(){function n(r,p){for(var o=0;o<p.length;o++){var q=p[o];q.enumerable=q.enumerable||false;q.configurable=true;if("value" in q){q.writable=true}Object.defineProperty(r,q.key,q)}}return function(q,o,p){if(o){n(q.prototype,o)}if(p){n(q,p)}return q}}();var l=k("../utils/logger");var h=k("../errors");function m(n,o){if(!(n instanceof o)){throw new TypeError("Cannot call a class as a function")}}var e=function(){function n(){m(this,n)}i(n,null,[{key:"getAudioConfig",value:function o(v,s,r,z){var w,u,t,q,p,y=navigator.userAgent.toLowerCase(),x=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];w=((s[r+2]&192)>>>6)+1;u=(s[r+2]&60)>>>2;if(u>x.length-1){v.trigger(Event.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+u});return}q=(s[r+2]&1)<<2;q|=(s[r+3]&192)>>>6;l.logger.log("manifest codec:"+z+",ADTS data:type:"+w+",sampleingIndex:"+u+"["+x[u]+"Hz],channelConfig:"+q);if(y.indexOf("firefox")!==-1){if(u>=6){w=5;p=new Array(4);t=u-3}else{w=2;p=new Array(2);t=u}}else{if(y.indexOf("android")!==-1){w=2;p=new Array(2);t=u}else{w=5;p=new Array(4);if(z&&(z.indexOf("mp4a.40.29")!==-1||z.indexOf("mp4a.40.5")!==-1)||!z&&u>=6){t=u-3}else{if(z&&z.indexOf("mp4a.40.2")!==-1&&u>=6&&q===1||!z&&q===1){w=2;p=new Array(2)}t=u}}}p[0]=w<<3;p[0]|=(u&14)>>1;p[1]|=(u&1)<<7;p[1]|=q<<3;if(w===5){p[1]|=(t&14)>>1;p[2]=(t&1)<<7;p[2]|=2<<2;p[3]=0}return{config:p,samplerate:x[u],channelCount:q,codec:"mp4a.40."+w}}}]);return n}();g.__default=e},{"../errors":24,"../utils/logger":43}],18:[function(j,h,w){Object.defineProperty(w,"__esModule",{value:true});var t=function(){function x(B,z){for(var y=0;y<z.length;y++){var A=z[y];A.enumerable=A.enumerable||false;A.configurable=true;if("value" in A){A.writable=true}Object.defineProperty(B,A.key,A)}}return function(A,y,z){if(y){x(A.prototype,y)}if(z){x(A,z)}return A}}();var o=j("../events");var m=e(o);var u=j("../errors");var q=j("../demux/aacdemuxer");var v=e(q);var p=j("../demux/tsdemuxer");var r=e(p);var n=j("../remux/mp4-remuxer");var g=e(n);var l=j("../remux/passthrough-remuxer");var k=e(l);function e(x){return x&&x.__esModule?x:{__default:x}}function i(x,y){if(!(x instanceof y)){throw new TypeError("Cannot call a class as a function")}}var s=function(){function z(B,D,C){var A=arguments.length<=3||arguments[3]===undefined?null:arguments[3];i(this,z);this.hls=B;this.id=D;this.config=this.hls.config||A;this.typeSupported=C}t(z,[{key:"destroy",value:function y(){var A=this.demuxer;if(A){A.destroy()}}},{key:"push",value:function x(I,K,H,J,F,B,E,G){var D=this.demuxer;if(!D){var A=this.hls,C=this.id;if(r.__default.probe(I)){if(this.typeSupported.mp2t===true){D=new r.__default(A,C,k.__default,this.config)}else{D=new r.__default(A,C,g.__default,this.config)}}else{if(v.__default.probe(I)){D=new v.__default(A,C,g.__default,this.config)}else{A.trigger(m.__default.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,id:C,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"no demux matching with content found"});return}}this.demuxer=D}D.push(I,K,H,J,F,B,E,G)}}]);return z}();w.__default=s},{"../demux/aacdemuxer":16,"../demux/tsdemuxer":23,"../errors":24,"../events":26,"../remux/mp4-remuxer":36,"../remux/passthrough-remuxer":37}],19:[function(e,g,k){Object.defineProperty(k,"__esModule",{value:true});var i=e("../demux/demuxer-inline");var j=p(i);var m=e("../events");var o=p(m);var n=e("events");var l=p(n);function p(q){return q&&q.__esModule?q:{__default:q}}var h=function h(s){var r=new l.__default();r.trigger=function t(x){for(var v=arguments.length,y=Array(v>1?v-1:0),w=1;w<v;w++){y[w-1]=arguments[w]}r.emit.apply(r,[x,x].concat(y))};r.off=function u(x){for(var v=arguments.length,y=Array(v>1?v-1:0),w=1;w<v;w++){y[w-1]=arguments[w]}r.removeListener.apply(r,[x].concat(y))};s.addEventListener("message",function(v){var w=v.data;switch(w.cmd){case"init":s.demuxer=new j.__default(r,w.id,w.typeSupported,JSON.parse(w.config));break;case"demux":s.demuxer.push(new Uint8Array(w.data),w.audioCodec,w.videoCodec,w.timeOffset,w.cc,w.level,w.sn,w.duration);break;default:break}});var q=function q(v,w){s.postMessage({event:v,data:w})};r.on(o.__default.FRAG_PARSING_INIT_SEGMENT,q);r.on(o.__default.FRAG_PARSED,q);r.on(o.__default.ERROR,q);r.on(o.__default.FRAG_PARSING_METADATA,q);r.on(o.__default.FRAG_PARSING_USERDATA,q);r.on(o.__default.FRAG_PARSING_DATA,function(w,x){var v=x.data1.buffer,y=x.data2.buffer;delete x.data1;delete x.data2;s.postMessage({event:w,data:x,data1:v,data2:y},[v,y])})};k.__default=h},{"../demux/demuxer-inline":18,"../events":26,events:1}],20:[function(e,g,o){Object.defineProperty(o,"__esModule",{value:true});var l=function(){function w(A,y){for(var x=0;x<y.length;x++){var z=y[x];z.enumerable=z.enumerable||false;z.configurable=true;if("value" in z){z.writable=true}Object.defineProperty(A,z.key,z)}}return function(z,x,y){if(x){w(z.prototype,x)}if(y){w(z,y)}return z}}();var q=e("../events");var r=v(q);var i=e("../demux/demuxer-inline");var n=v(i);var t=e("../demux/demuxer-worker");var s=v(t);var m=e("../utils/logger");var h=e("../crypt/decrypter");var j=v(h);var k=e("../errors");function v(w){return w&&w.__esModule?w:{__default:w}}function p(w,x){if(!(w instanceof x)){throw new TypeError("Cannot call a class as a function")}}var u=function(){function x(D,G){p(this,x);this.hls=D;this.id=G;var F={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:D.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t")};if(D.config.enableWorker&&typeof Worker!=="undefined"){m.logger.log("demuxing in webworker");try{var C=e("webworkify");var B=this.w=C(s.__default);this.onwmsg=this.onWorkerMessage.bind(this);B.addEventListener("message",this.onwmsg);B.onerror=function(H){D.trigger(r.__default.ERROR,{type:k.ErrorTypes.OTHER_ERROR,details:k.ErrorDetails.INTERNAL_EXCEPTION,fatal:true,event:"demuxerWorker",err:{message:H.message+" ("+H.filename+":"+H.lineno+")"}})};B.postMessage({cmd:"init",typeSupported:F,id:G,config:JSON.stringify(D.config)})}catch(E){m.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline");this.demuxer=new n.__default(D,G,F)}}else{this.demuxer=new n.__default(D,G,F)}this.demuxInitialized=true}l(x,[{key:"destroy",value:function z(){var B=this.w;if(B){B.removeEventListener("message",this.onwmsg);B.terminate();this.w=null}else{var C=this.demuxer;if(C){C.destroy();this.demuxer=null}}var D=this.decrypter;if(D){D.destroy();this.decrypter=null}}},{key:"pushDecrypted",value:function A(H,K,G,J,E,B,D,F){var I=this.w;if(I){I.postMessage({cmd:"demux",data:H,audioCodec:K,videoCodec:G,timeOffset:J,cc:E,level:B,sn:D,duration:F},[H])}else{var C=this.demuxer;if(C){C.push(new Uint8Array(H),K,G,J,E,B,D,F)}}}},{key:"push",value:function w(G,K,F,I,D,B,C,E,J){if(G.byteLength>0&&J!=null&&J.key!=null&&J.method==="AES-128"){if(this.decrypter==null){this.decrypter=new j.__default(this.hls)}var H=this;this.decrypter.decrypt(G,J.key,J.iv,function(L){H.pushDecrypted(L,K,F,I,D,B,C,E)})}else{this.pushDecrypted(G,K,F,I,D,B,C,E)}}},{key:"onWorkerMessage",value:function y(C){var D=C.data,B=this.hls;switch(D.event){case r.__default.FRAG_PARSING_DATA:D.data.data1=new Uint8Array(D.data1);D.data.data2=new Uint8Array(D.data2);default:B.trigger(D.event,D.data);break}}}]);return x}();o.__default=u},{"../crypt/decrypter":15,"../demux/demuxer-inline":18,"../demux/demuxer-worker":19,"../errors":24,"../events":26,"../utils/logger":43,webworkify:2}],21:[function(j,h,e){Object.defineProperty(e,"__esModule",{value:true});var g=function(){function m(q,o){for(var n=0;n<o.length;n++){var p=o[n];p.enumerable=p.enumerable||false;p.configurable=true;if("value" in p){p.writable=true}Object.defineProperty(q,p.key,p)}}return function(p,n,o){if(n){m(p.prototype,n)}if(o){m(p,o)}return p}}();var k=j("../utils/logger");function l(m,n){if(!(m instanceof n)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function A(C){l(this,A);this.data=C;this.bytesAvailable=this.data.byteLength;this.word=0;this.bitsAvailable=0}g(A,[{key:"loadWord",value:function p(){var D=this.data.byteLength-this.bytesAvailable,C=new Uint8Array(4),E=Math.min(4,this.bytesAvailable);if(E===0){throw new Error("no bytes available")}C.set(this.data.subarray(D,D+E));this.word=new DataView(C.buffer).getUint32(0);this.bitsAvailable=E*8;this.bytesAvailable-=E}},{key:"skipBits",value:function B(C){var D;if(this.bitsAvailable>C){this.word<<=C;this.bitsAvailable-=C}else{C-=this.bitsAvailable;D=C>>3;C-=D>>3;this.bytesAvailable-=D;this.loadWord();this.word<<=C;this.bitsAvailable-=C}}},{key:"readBits",value:function v(C){var E=Math.min(this.bitsAvailable,C),D=this.word>>>32-E;if(C>32){k.logger.error("Cannot read more than 32 bits at a time")}this.bitsAvailable-=E;if(this.bitsAvailable>0){this.word<<=E}else{if(this.bytesAvailable>0){this.loadWord()}}E=C-E;if(E>0){return D<<E|this.readBits(E)}else{return D}}},{key:"skipLZ",value:function t(){var C;for(C=0;C<this.bitsAvailable;++C){if(0!==(this.word&2147483648>>>C)){this.word<<=C;this.bitsAvailable-=C;return C}}this.loadWord();return C+this.skipLZ()}},{key:"skipUEG",value:function o(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function y(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function w(){var C=this.skipLZ();return this.readBits(C+1)-1}},{key:"readEG",value:function s(){var C=this.readUEG();if(1&C){return 1+C>>>1}else{return -1*(C>>>1)}}},{key:"readBoolean",value:function m(){return 1===this.readBits(1)}},{key:"readUByte",value:function r(){return this.readBits(8)}},{key:"readUShort",value:function q(){return this.readBits(16)}},{key:"readUInt",value:function x(){return this.readBits(32)}},{key:"skipScalingList",value:function n(F){var D=8,E=8,C,G;for(C=0;C<F;C++){if(E!==0){G=this.readEG();E=(D+G+256)%256}D=E===0?D:E}}},{key:"readSPS",value:function z(){var M=0,N=0,I=0,O=0,E=1,R,C,L,G,D,H,T,J,P;this.readUByte();R=this.readUByte();C=this.readBits(5);this.skipBits(3);L=this.readUByte();this.skipUEG();if(R===100||R===110||R===122||R===244||R===44||R===83||R===86||R===118||R===128){var F=this.readUEG();if(F===3){this.skipBits(1)}this.skipUEG();this.skipUEG();this.skipBits(1);if(this.readBoolean()){J=F!==3?8:12;for(P=0;P<J;P++){if(this.readBoolean()){if(P<6){this.skipScalingList(16)}else{this.skipScalingList(64)}}}}}this.skipUEG();var S=this.readUEG();if(S===0){this.readUEG()}else{if(S===1){this.skipBits(1);this.skipEG();this.skipEG();G=this.readUEG();for(P=0;P<G;P++){this.skipEG()}}}this.skipUEG();this.skipBits(1);D=this.readUEG();H=this.readUEG();T=this.readBits(1);if(T===0){this.skipBits(1)}this.skipBits(1);if(this.readBoolean()){M=this.readUEG();N=this.readUEG();I=this.readUEG();O=this.readUEG()}if(this.readBoolean()){if(this.readBoolean()){var Q=void 0;var K=this.readUByte();switch(K){case 1:Q=[1,1];break;case 2:Q=[12,11];break;case 3:Q=[10,11];break;case 4:Q=[16,11];break;case 5:Q=[40,33];break;case 6:Q=[24,11];break;case 7:Q=[20,11];break;case 8:Q=[32,11];break;case 9:Q=[80,33];break;case 10:Q=[18,11];break;case 11:Q=[15,11];break;case 12:Q=[64,33];break;case 13:Q=[160,99];break;case 14:Q=[4,3];break;case 15:Q=[3,2];break;case 16:Q=[2,1];break;case 255:Q=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()];break}if(Q){E=Q[0]/Q[1]}}}return{width:Math.ceil(((D+1)*16-M*2-N*2)*E),height:(2-T)*(H+1)*16-(T?2:4)*(I+O)}}},{key:"readSliceType",value:function u(){this.readUByte();this.readUEG();return this.readUEG()}}]);return A}();e.__default=i},{"../utils/logger":43}],22:[function(j,i,g){Object.defineProperty(g,"__esModule",{value:true});var h=function(){function m(q,o){for(var n=0;n<o.length;n++){var p=o[n];p.enumerable=p.enumerable||false;p.configurable=true;if("value" in p){p.writable=true}Object.defineProperty(q,p.key,p)}}return function(p,n,o){if(n){m(p.prototype,n)}if(o){m(p,o)}return p}}();var k=j("../utils/logger");function l(m,n){if(!(m instanceof n)){throw new TypeError("Cannot call a class as a function")}}var e=function(){function m(t){l(this,m);this._hasTimeStamp=false;var s=0,z,y,x,w,q,r,u,v;do{u=this.readUTF(t,s,3);s+=3;if(u==="ID3"){s+=3;z=t[s++]&127;y=t[s++]&127;x=t[s++]&127;w=t[s++]&127;q=(z<<21)+(y<<14)+(x<<7)+w;r=s+q;this._parseID3Frames(t,s,r);s=r}else{if(u==="3DI"){s+=7;k.logger.log("3DI footer found, end: "+s)}else{s-=3;v=s;if(v){if(!this.hasTimeStamp){k.logger.warn("ID3 tag found, but no timestamp")}this._length=v;this._payload=t.subarray(0,v)}return}}}while(true)}h(m,[{key:"readUTF",value:function p(t,v,r){var q="",u=v,s=v+r;do{q+=String.fromCharCode(t[u++])}while(u<s);return q}},{key:"_parseID3Frames",value:function o(w,v,q){var s,y,t,u,x;while(v+8<=q){s=this.readUTF(w,v,4);v+=4;y=w[v++]<<24+w[v++]<<16+w[v++]<<8+w[v++];u=w[v++]<<8+w[v++];t=v;switch(s){case"PRIV":if(this.readUTF(w,v,44)==="com.apple.streaming.transportStreamTimestamp"){v+=44;v+=4;var r=w[v++]&1;this._hasTimeStamp=true;x=((w[v++]<<23)+(w[v++]<<15)+(w[v++]<<7)+w[v++])/45;if(r){x+=47721858.84}x=Math.round(x);k.logger.trace("ID3 timestamp found: "+x);this._timeStamp=x}break;default:break}}}},{key:"hasTimeStamp",get:function n(){return this._hasTimeStamp}},{key:"timeStamp",get:function n(){return this._timeStamp}},{key:"length",get:function n(){return this._length}},{key:"payload",get:function n(){return this._payload}}]);return m}();g.__default=e},{"../utils/logger":43}],23:[function(e,g,m){Object.defineProperty(m,"__esModule",{value:true});var j=function(){function u(y,w){for(var v=0;v<w.length;v++){var x=w[v];x.enumerable=x.enumerable||false;x.configurable=true;if("value" in x){x.writable=true}Object.defineProperty(y,x.key,x)}}return function(x,v,w){if(v){u(x.prototype,v)}if(w){u(x,w)}return x}}();var s=e("./adts");var r=t(s);var o=e("../events");var p=t(o);var q=e("./exp-golomb");var h=t(q);var l=e("../utils/logger");var i=e("../errors");function t(u){return u&&u.__esModule?u:{__default:u}}function n(u,v){if(!(u instanceof v)){throw new TypeError("Cannot call a class as a function")}}var k=function(){function z(K,N,M,L){n(this,z);this.observer=K;this.id=N;this.remuxerClass=M;this.config=L;this.lastCC=0;this.remuxer=new this.remuxerClass(K,N,L)}j(z,[{key:"switchLevel",value:function E(){this.pmtParsed=false;this._pmtId=-1;this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,nbNalu:0,dropped:0};this._aacTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0};this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0};this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0};this.aacOverFlow=null;this.aacLastPTS=null;this.avcNaluState=0;this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function F(){this.switchLevel();this.remuxer.insertDiscontinuity()}},{key:"push",value:function B(an,O,ag,V,X,L,aj,K){var U,al,aa,R,ai=an.length,ab,W,ao,S,ad=this.remuxer.passthrough,Z=false;this.audioCodec=O;this.videoCodec=ag;this.timeOffset=V;this._duration=K;this.contiguous=false;if(X!==this.lastCC){l.logger.log("discontinuity detected");this.insertDiscontinuity();this.lastCC=X}if(L!==this.lastLevel){l.logger.log("level switch detected");this.switchLevel();this.lastLevel=L}else{if(aj===this.lastSN+1){this.contiguous=true}}this.lastSN=aj;var ac=this.pmtParsed,am=this._avcTrack.id,ah=this._aacTrack.id,Y=this._id3Track.id,Q=this._pmtId;var af=this._parsePAT,ak=this._parsePMT,M=this._parsePES,N=this._parseAVCPES.bind(this),P=this._parseAACPES.bind(this),ae=this._parseID3PES.bind(this);ai-=ai%188;for(R=0;R<ai;R+=188){if(an[R]===71){ab=!!(an[R+1]&64);W=((an[R+1]&31)<<8)+an[R+2];ao=(an[R+3]&48)>>4;if(ao>1){S=R+5+an[R+4];if(S===R+188){continue}}else{S=R+4}switch(W){case am:if(ab){if(U){N(M(U));if(ad){if(this._avcTrack.codec&&(ah===-1||this._aacTrack.codec)){this.remux(L,aj,an);return}}}U={data:[],size:0}}if(U){U.data.push(an.subarray(S,R+188));U.size+=R+188-S}break;case ah:if(ab){if(al){P(M(al));if(ad){if(this._aacTrack.codec&&(am===-1||this._avcTrack.codec)){this.remux(L,aj,an);return}}}al={data:[],size:0}}if(al){al.data.push(an.subarray(S,R+188));al.size+=R+188-S}break;case Y:if(ab){if(aa){ae(M(aa))}aa={data:[],size:0}}if(aa){aa.data.push(an.subarray(S,R+188));aa.size+=R+188-S}break;case 0:if(ab){S+=an[S]+1}Q=this._pmtId=af(an,S);break;case Q:if(ab){S+=an[S]+1}var T=ak(an,S);am=this._avcTrack.id=T.avc;ah=this._aacTrack.id=T.aac;Y=this._id3Track.id=T.id3;if(Z&&!ac){l.logger.log("reparse from beginning");Z=false;R=-188}ac=this.pmtParsed=true;break;case 17:case 8191:break;default:Z=true;break}}else{this.observer.trigger(p.__default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,id:this.id,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"TS packet did not start with 0x47"})}}if(U){N(M(U))}if(al){P(M(al))}if(aa){ae(M(aa))}this.remux(L,aj,null)}},{key:"remux",value:function A(M,L,K){this.remuxer.remux(M,L,this._aacTrack,this._avcTrack,this._id3Track,this._txtTrack,this.timeOffset,this.contiguous,K)}},{key:"destroy",value:function G(){this.switchLevel();this._initPTS=this._initDTS=undefined;this._duration=0}},{key:"_parsePAT",value:function y(K,L){return(K[L+10]&31)<<8|K[L+11]}},{key:"_parsePMT",value:function w(P,Q){var L,O,N,M,K={aac:-1,avc:-1,id3:-1};L=(P[Q+1]&15)<<8|P[Q+2];O=Q+3+L-4;N=(P[Q+10]&15)<<8|P[Q+11];Q+=12+N;while(Q<O){M=(P[Q+1]&31)<<8|P[Q+2];switch(P[Q]){case 15:if(K.aac===-1){K.aac=M}break;case 21:if(K.id3===-1){K.id3=M}break;case 27:if(K.avc===-1){K.avc=M}break;case 36:l.logger.warn("HEVC stream type found, not supported for now");break;default:l.logger.log("unkown stream type:"+P[Q]);break}Q+=((P[Q+3]&15)<<8|P[Q+4])+5}return K}},{key:"_parsePES",value:function J(T){var O=0,U,K,N,L,X,P,R,W,S,M=T.data;while(M[0].length<19&&M.length>1){var V=new Uint8Array(M[0].length+M[1].length);V.set(M[0]);V.set(M[1],M[0].length);M[0]=V;M.splice(1,1)}U=M[0];N=(U[0]<<16)+(U[1]<<8)+U[2];if(N===1){L=(U[4]<<8)+U[5];K=U[7];if(K&192){R=(U[9]&14)*536870912+(U[10]&255)*4194304+(U[11]&254)*16384+(U[12]&255)*128+(U[13]&254)/2;if(R>4294967295){R-=8589934592}if(K&64){W=(U[14]&14)*536870912+(U[15]&255)*4194304+(U[16]&254)*16384+(U[17]&255)*128+(U[18]&254)/2;if(W>4294967295){W-=8589934592}}else{W=R}}X=U[8];S=X+9;T.size-=S;P=new Uint8Array(T.size);while(M.length){U=M.shift();var Q=U.byteLength;if(S){if(S>Q){S-=Q;continue}else{U=U.subarray(S);Q-=S;S=0}}P.set(U,O);O+=Q}return{data:P,pts:R,dts:W,len:L}}else{return null}}},{key:"_parseAVCPES",value:function H(Y){var U=this;var S=this._avcTrack,P=S.samples,T=this._parseAVCNALu(Y.data),K=[],Q=false,ab=false,M=0,R,W,O,V;if(T.length===0&&P.length>0){var N=P[P.length-1];var L=N.units.units[N.units.units.length-1];var X=new Uint8Array(L.data.byteLength+Y.data.byteLength);X.set(L.data,0);X.set(Y.data,L.data.byteLength);L.data=X;N.units.length+=Y.data.byteLength;S.len+=Y.data.byteLength}Y.data=null;var aa="";var Z=function(){if(K.length){if(!this.config.forceKeyFrameOnDiscontinuity||ab===true||S.sps&&(P.length||this.contiguous)){W={units:{units:K,length:M},pts:Y.pts,dts:Y.dts,key:ab};P.push(W);S.len+=M;S.nbNalu+=K.length}else{S.dropped++}K=[];M=0}}.bind(this);T.forEach(function(ao){switch(ao.type){case 1:O=true;if(Q){aa+="NDR "}break;case 5:O=true;if(Q){aa+="IDR "}ab=true;break;case 6:O=true;if(Q){aa+="SEI "}R=new h.__default(U.discardEPB(ao.data));R.readUByte();var ap=0;var ae=0;var at=false;var al=0;while(!at&&R.bytesAvailable>1){ap=0;do{al=R.readUByte();ap+=al}while(al===255);ae=0;do{al=R.readUByte();ae+=al}while(al===255);if(ap===4&&R.bytesAvailable!==0){at=true;var aj=R.readUByte();if(aj===181){var an=R.readUShort();if(an===49){var ag=R.readUInt();if(ag===1195456820){var ar=R.readUByte();if(ar===3){var am=R.readUByte();var aq=R.readUByte();var ak=31&am;var ac=[am,aq];for(V=0;V<ak;V++){ac.push(R.readUByte());ac.push(R.readUByte());ac.push(R.readUByte())}U._insertSampleInOrder(U._txtTrack.samples,{type:3,pts:Y.pts,bytes:ac})}}}}}else{if(ae<R.bytesAvailable){for(V=0;V<ae;V++){R.readUByte()}}}}break;case 7:O=true;if(Q){aa+="SPS "}if(!S.sps){R=new h.__default(ao.data);var af=R.readSPS();S.width=af.width;S.height=af.height;S.sps=[ao.data];S.duration=U._duration;var ah=ao.data.subarray(1,4);var ad="avc1.";for(V=0;V<3;V++){var ai=ah[V].toString(16);if(ai.length<2){ai="0"+ai}ad+=ai}S.codec=ad}break;case 8:O=true;if(Q){aa+="PPS "}if(!S.pps){S.pps=[ao.data]}break;case 9:O=false;if(Q){aa+="AUD "}Z();break;default:O=false;aa+="unknown NAL "+ao.type+" ";break}if(O){K.push(ao);M+=ao.data.byteLength}});if(Q||aa.length){l.logger.log(aa)}Z()}},{key:"_insertSampleInOrder",value:function I(L,M){var K=L.length;if(K>0){if(M.pts>=L[K-1].pts){L.push(M)}else{for(var N=K-1;N>=0;N--){if(M.pts<L[N].pts){L.splice(N,0,M);break}}}}else{L.push(M)}}},{key:"_parseAVCNALu",value:function x(S){var ab=0,ac=S.byteLength,W,X,P=this.avcNaluState;var Z=[],T,Y,M,ad;while(ab<ac){W=S[ab++];switch(P){case 0:if(W===0){P=1}break;case 1:if(W===0){P=2}else{P=0}break;case 2:case 3:if(W===0){P=3}else{if(W===1&&ab<ac){Y=S[ab]&31;if(M){T={data:S.subarray(M,ab-P-1),type:ad};Z.push(T)}else{var aa=this.avcNaluState;if(aa&&ab<=4-aa){var V=this._avcTrack,U=V.samples;if(U.length){var Q=U[U.length-1],N=Q.units.units,L=N[N.length-1];if(L.state){L.data=L.data.subarray(0,L.data.byteLength-aa);Q.units.length-=aa;V.len-=aa}}}X=ab-P-1;if(X>0){var O=this._avcTrack,ag=O.samples;if(ag.length){var af=ag[ag.length-1],K=af.units.units,R=K[K.length-1],ae=new Uint8Array(R.data.byteLength+X);ae.set(R.data,0);ae.set(S.subarray(0,X),R.data.byteLength);R.data=ae;af.units.length+=X;O.len+=X}}}M=ab;ad=Y;P=0}else{P=0}}break;default:break}}if(M){T={data:S.subarray(M,ac),type:ad,state:P};Z.push(T);this.avcNaluState=P}return Z}},{key:"discardEPB",value:function D(Q){var O=Q.byteLength,L=[],M=1,P,N;while(M<O-2){if(Q[M]===0&&Q[M+1]===0&&Q[M+2]===3){L.push(M+2);M+=2}else{M++}}if(L.length===0){return Q}P=O-L.length;N=new Uint8Array(P);var K=0;for(M=0;M<P;K++,M++){if(K===L[0]){K++;L.shift()}N[M]=Q[K]}return N}},{key:"_parseAACPES",value:function C(aa){var V=this._aacTrack,ac=aa.data,ad=aa.pts,W=0,K=this._duration,M=this.audioCodec,af=this.aacOverFlow,S=this.aacLastPTS,ab,ae,L,R,O,P,U,X,Q;if(af){var Z=new Uint8Array(af.byteLength+ac.byteLength);Z.set(af,0);Z.set(ac,af.byteLength);ac=Z}for(O=W,X=ac.length;O<X-1;O++){if(ac[O]===255&&(ac[O+1]&240)===240){break}}if(O){var Y,N;if(O<X-1){Y="AAC PES did not start with ADTS header,offset:"+O;N=false}else{Y="no ADTS header found in AAC PES";N=true}this.observer.trigger(p.__default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,id:this.id,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:N,reason:Y});if(N){return}}if(!V.audiosamplerate){ab=r.__default.getAudioConfig(this.observer,ac,O,M);V.config=ab.config;V.audiosamplerate=ab.samplerate;V.channelCount=ab.channelCount;V.codec=ab.codec;V.duration=K;l.logger.log("parsed codec:"+V.codec+",rate:"+ab.samplerate+",nb channel:"+ab.channelCount)}R=0;L=1024*90000/V.audiosamplerate;if(af&&S){var T=S+L;if(Math.abs(T-ad)>1){l.logger.log("AAC: align PTS for overlapping frames by "+Math.round((T-ad)/90));ad=T}}while(O+5<X){P=!!(ac[O+1]&1)?7:9;ae=(ac[O+3]&3)<<11|ac[O+4]<<3|(ac[O+5]&224)>>>5;ae-=P;if(ae>0&&O+P+ae<=X){U=ad+R*L;Q={unit:ac.subarray(O+P,O+P+ae),pts:U,dts:U};V.samples.push(Q);V.len+=ae;O+=ae+P;R++;for(;O<X-1;O++){if(ac[O]===255&&(ac[O+1]&240)===240){break}}}else{break}}if(O<X){af=ac.subarray(O,X)}else{af=null}this.aacOverFlow=af;this.aacLastPTS=U}},{key:"_parseID3PES",value:function u(K){this._id3Track.samples.push(K)}}],[{key:"probe",value:function v(K){if(K.length>=3*188&&K[0]===71&&K[188]===71&&K[2*188]===71){return true}else{return false}}}]);return z}();m.__default=k},{"../errors":24,"../events":26,"../utils/logger":43,"./adts":17,"./exp-golomb":21}],24:[function(j,i,g){Object.defineProperty(g,"__esModule",{value:true});var h=g.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"};var e=g.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",INTERNAL_EXCEPTION:"internalException"}},{}],25:[function(e,g,l){Object.defineProperty(l,"__esModule",{value:true});var h=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol?"symbol":typeof r};var i=function(){function r(v,t){for(var s=0;s<t.length;s++){var u=t[s];u.enumerable=u.enumerable||false;u.configurable=true;if("value" in u){u.writable=true}Object.defineProperty(v,u.key,u)}}return function(u,s,t){if(s){r(u.prototype,s)}if(t){r(u,t)}return u}}();var k=e("./utils/logger");var j=e("./errors");var n=e("./events");var o=q(n);function q(r){return r&&r.__esModule?r:{__default:r}}function m(r,s){if(!(r instanceof s)){throw new TypeError("Cannot call a class as a function")}}var p=function(){function u(z){m(this,u);this.hls=z;this.onEvent=this.onEvent.bind(this);for(var y=arguments.length,A=Array(y>1?y-1:0),B=1;B<y;B++){A[B-1]=arguments[B]}this.handledEvents=A;this.useGenericHandler=true;this.registerListeners()}i(u,[{key:"destroy",value:function t(){this.unregisterListeners()}},{key:"isEventHandler",value:function s(){return h(this.handledEvents)==="object"&&this.handledEvents.length&&typeof this.onEvent==="function"}},{key:"registerListeners",value:function w(){if(this.isEventHandler()){this.handledEvents.forEach(function(y){if(y==="hlsEventGeneric"){throw new Error("Forbidden event name: "+y)}this.hls.on(y,this.onEvent)}.bind(this))}}},{key:"unregisterListeners",value:function v(){if(this.isEventHandler()){this.handledEvents.forEach(function(y){this.hls.off(y,this.onEvent)}.bind(this))}}},{key:"onEvent",value:function x(y,z){this.onEventGeneric(y,z)}},{key:"onEventGeneric",value:function r(A,B){var y=function y(C,D){var E="on"+C.replace("hls","");if(typeof this[E]!=="function"){throw new Error("Event "+C+" has no generic handler in this "+this.constructor.name+" class (tried "+E+")")}return this[E].bind(this,D)};try{y.call(this,A,B).call()}catch(z){k.logger.error("internal error happened while processing "+A+":"+z.message);this.hls.trigger(o.__default.ERROR,{type:j.ErrorTypes.OTHER_ERROR,details:j.ErrorDetails.INTERNAL_EXCEPTION,fatal:false,event:A,err:z})}}}]);return u}();l.__default=p},{"./errors":24,"./events":26,"./utils/logger":43}],26:[function(h,g,e){g.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],27:[function(j,i,g){Object.defineProperty(g,"__esModule",{value:true});var h=function(){function l(p,n){for(var m=0;m<n.length;m++){var o=n[m];o.enumerable=o.enumerable||false;o.configurable=true;if("value" in o){o.writable=true}Object.defineProperty(p,o.key,o)}}return function(o,m,n){if(m){l(o.prototype,m)}if(n){l(o,n)}return o}}();function k(l,m){if(!(l instanceof m)){throw new TypeError("Cannot call a class as a function")}}var e=function(){function l(){k(this,l)}h(l,null,[{key:"getSilentFrame",value:function m(n){if(n===1){return new Uint8Array([0,200,0,128,35,128])}else{if(n===2){return new Uint8Array([33,0,73,144,2,25,0,35,128])}else{if(n===3){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142])}else{if(n===4){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56])}else{if(n===5){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56])}else{if(n===6){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}}}}}}return null}}]);return l}();g.__default=e},{}],28:[function(j,h,e){Object.defineProperty(e,"__esModule",{value:true});var g=function(){function l(p,n){for(var m=0;m<n.length;m++){var o=n[m];o.enumerable=o.enumerable||false;o.configurable=true;if("value" in o){o.writable=true}Object.defineProperty(p,o.key,o)}}return function(o,m,n){if(m){l(o.prototype,m)}if(n){l(o,n)}return o}}();function k(l,m){if(!(l instanceof m)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function n(){k(this,n)}g(n,null,[{key:"bufferInfo",value:function m(s,t,r){if(s){var o=s.buffered,q=[],p;for(p=0;p<o.length;p++){q.push({start:o.start(p),end:o.end(p)})}return this.bufferedInfo(q,t,r)}else{return{len:0,start:0,end:0,nextStart:undefined}}}},{key:"bufferedInfo",value:function l(q,x,v){var u=[],p,z,A,w,s;q.sort(function(C,B){var D=C.start-B.start;if(D){return D}else{return B.end-C.end}});for(s=0;s<q.length;s++){var y=u.length;if(y){var t=u[y-1].end;if(q[s].start-t<v){if(q[s].end>t){u[y-1].end=q[s].end}}else{u.push(q[s])}}else{u.push(q[s])}}for(s=0,p=0,z=A=x;s<u.length;s++){var o=u[s].start,r=u[s].end;if(x+v>=o&&x<r){z=o;A=r;p=A-x}else{if(x+v<o){w=o;break}}}return{len:p,start:z,end:A,nextStart:w}}}]);return n}();e.__default=i},{}],29:[function(i,h,e){Object.defineProperty(e,"__esModule",{value:true});var g=function(){function m(q,o){for(var n=0;n<o.length;n++){var p=o[n];p.enumerable=p.enumerable||false;p.configurable=true;if("value" in p){p.writable=true}Object.defineProperty(q,p.key,p)}}return function(p,n,o){if(n){m(p.prototype,n)}if(o){m(p,o)}return p}}();var j=i("../utils/logger");function k(m,n){if(!(m instanceof n)){throw new TypeError("Cannot call a class as a function")}}var l=function(){function o(){k(this,o)}g(o,null,[{key:"mergeDetails",value:function m(q,u){var r=Math.max(q.startSN,u.startSN)-u.startSN,t=Math.min(q.endSN,u.endSN)-u.startSN,B=u.startSN-q.startSN,A=q.fragments,w=u.fragments,z=0,s;if(t<r){u.PTSKnown=false;return}for(var v=r;v<=t;v++){var C=A[B+v],y=w[v];if(y&&C){z=C.cc-y.cc;if(!isNaN(C.startPTS)){y.start=y.startPTS=C.startPTS;y.endPTS=C.endPTS;y.duration=C.duration;s=y}}}if(z){j.logger.log("discontinuity sliding from playlist, take drift into account");for(v=0;v<w.length;v++){w[v].cc+=z}}if(s){o.updateFragPTSDTS(u,s.sn,s.startPTS,s.endPTS,s.startDTS,s.endDTS)}else{if(B>=0&&B<A.length){var x=A[B].start;for(v=0;v<w.length;v++){w[v].start+=x}}}u.PTSKnown=q.PTSKnown;return}},{key:"updateFragPTSDTS",value:function p(q,s,u,A,x,t){var y,w,B,v;if(s<q.startSN||s>q.endSN){return 0}y=s-q.startSN;w=q.fragments;B=w[y];if(!isNaN(B.startPTS)){var r=Math.abs(B.startPTS-u);if(isNaN(B.deltaPTS)){B.deltaPTS=r}else{B.deltaPTS=Math.max(r,B.deltaPTS)}u=Math.min(u,B.startPTS);A=Math.max(A,B.endPTS);x=Math.min(x,B.startDTS);t=Math.max(t,B.endDTS)}var z=u-B.start;B.start=B.startPTS=u;B.endPTS=A;B.startDTS=x;B.endDTS=t;B.duration=A-u;for(v=y;v>0;v--){o.updatePTS(w,v,v-1)}for(v=y;v<w.length-1;v++){o.updatePTS(w,v,v+1)}q.PTSKnown=true;return z}},{key:"updatePTS",value:function n(r,t,v){var q=r[t],s=r[v],u=s.startPTS;if(!isNaN(u)){if(v>t){q.duration=u-q.start;if(q.duration<0){j.logger.error("negative duration computed for frag "+q.sn+",level "+q.level+", there should be some duration drift between playlist and fragment!")}}else{s.duration=q.start-u;if(s.duration<0){j.logger.error("negative duration computed for frag "+s.sn+",level "+s.level+", there should be some duration drift between playlist and fragment!")}}}else{if(v>t){s.start=q.start+q.duration}else{s.start=q.start-s.duration}}}}]);return o}();e.__default=l},{"../utils/logger":43}],30:[function(w,h,N){Object.defineProperty(N,"__esModule",{value:true});var k=function(){function U(Y,W){for(var V=0;V<W.length;V++){var X=W[V];X.enumerable=X.enumerable||false;X.configurable=true;if("value" in X){X.writable=true}Object.defineProperty(Y,X.key,X)}}return function(X,V,W){if(V){U(X.prototype,V)}if(W){U(X,W)}return X}}();var J=w("./events");var E=S(J);var I=w("./errors");var T=w("./loader/playlist-loader");var s=S(T);var j=w("./loader/fragment-loader");var u=S(j);var i=w("./controller/abr-controller");var l=S(i);var Q=w("./controller/buffer-controller");var z=S(Q);var R=w("./controller/cap-level-controller");var t=S(R);var y=w("./controller/audio-stream-controller");var H=S(y);var v=w("./controller/stream-controller");var e=S(v);var A=w("./controller/level-controller");var F=S(A);var O=w("./controller/timeline-controller");var G=S(O);var B=w("./controller/fps-controller");var n=S(B);var g=w("./controller/audio-track-controller");var m=S(g);var M=w("./utils/logger");var o=w("./utils/xhr-loader");var p=S(o);var D=w("events");var C=S(D);var x=w("./loader/key-loader");var K=S(x);var P=w("./utils/cues");var r=S(P);function S(U){return U&&U.__esModule?U:{__default:U}}function L(U,V){if(!(U instanceof V)){throw new TypeError("Cannot call a class as a function")}}var q=function(){k(V,null,[{key:"isSupported",value:function W(){return window.MediaSource&&typeof window.MediaSource.isTypeSupported==="function"&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function X(){return"0.6.2-6"}},{key:"Events",get:function X(){return E.__default}},{key:"ErrorTypes",get:function X(){return I.ErrorTypes}},{key:"ErrorDetails",get:function X(){return I.ErrorDetails}},{key:"DefaultConfig",get:function X(){if(!V.defaultConfig){V.defaultConfig={autoStartLoad:true,startPosition:-1,debug:false,capLevelOnFPSDrop:false,capLevelToPlayerSize:false,maxBufferLength:30,maxBufferSize:60*1000*1000,maxBufferHole:0.5,maxSeekHole:2,seekHoleNudgeDuration:0.01,stalledInBufferedNudgeThreshold:10,maxFragLookUpTolerance:0.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,liveSyncDuration:undefined,liveMaxLatencyDuration:undefined,maxMaxBufferLength:600,enableWorker:true,enableSoftwareAES:true,manifestLoadingTimeOut:10000,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1000,manifestLoadingMaxRetryTimeout:64000,levelLoadingTimeOut:10000,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1000,levelLoadingMaxRetryTimeout:64000,fragLoadingTimeOut:20000,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1000,fragLoadingMaxRetryTimeout:64000,fragLoadingLoopThreshold:3,startFragPrefetch:false,fpsDroppedMonitoringPeriod:5000,fpsDroppedMonitoringThreshold:0.2,appendErrorMaxRetry:3,loader:p.__default,fLoader:undefined,pLoader:undefined,abrController:l.__default,bufferController:z.__default,capLevelController:t.__default,fpsController:n.__default,streamController:e.__default,audioStreamController:H.__default,timelineController:G.__default,cueHandler:r.__default,enableCEA708Captions:true,enableMP2TPassThrough:false,stretchShortVideoTrack:false,forceKeyFrameOnDiscontinuity:true,abrEwmaFastLive:5,abrEwmaSlowLive:9,abrEwmaFastVoD:4,abrEwmaSlowVoD:15,abrEwmaDefaultEstimate:500000,abrBandWidthFactor:0.8,abrBandWidthUpFactor:0.7}}return V.defaultConfig},set:function ae(ag){V.defaultConfig=ag}}]);function V(){var aj=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];L(this,V);var ag=V.DefaultConfig;if((aj.liveSyncDurationCount||aj.liveMaxLatencyDurationCount)&&(aj.liveSyncDuration||aj.liveMaxLatencyDuration)){throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration")}for(var al in ag){if(al in aj){continue}aj[al]=ag[al]}if(aj.liveMaxLatencyDurationCount!==undefined&&aj.liveMaxLatencyDurationCount<=aj.liveSyncDurationCount){throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"')}if(aj.liveMaxLatencyDuration!==undefined&&(aj.liveMaxLatencyDuration<=aj.liveSyncDuration||aj.liveSyncDuration===undefined)){throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"')}(0,M.enableLogs)(aj.debug);this.config=aj;var ah=this.observer=new C.__default();ah.trigger=function ai(ao){for(var am=arguments.length,ap=Array(am>1?am-1:0),an=1;an<am;an++){ap[an-1]=arguments[an]}ah.emit.apply(ah,[ao,ao].concat(ap))};ah.off=function ak(ao){for(var am=arguments.length,ap=Array(am>1?am-1:0),an=1;an<am;an++){ap[an-1]=arguments[an]}ah.removeListener.apply(ah,[ao].concat(ap))};this.on=ah.on.bind(ah);this.off=ah.off.bind(ah);this.trigger=ah.trigger.bind(ah);this.playlistLoader=new s.__default(this);this.fragmentLoader=new u.__default(this);this.levelController=new F.__default(this);this.abrController=new aj.abrController(this);this.bufferController=new aj.bufferController(this);this.capLevelController=new aj.capLevelController(this);this.fpsController=new aj.fpsController(this);this.streamController=new aj.streamController(this);this.audioStreamController=new aj.audioStreamController(this);this.timelineController=new aj.timelineController(this);this.audioTrackController=new m.__default(this);this.keyLoader=new K.__default(this)}k(V,[{key:"destroy",value:function af(){M.logger.log("destroy");this.trigger(E.__default.DESTROYING);this.detachMedia();this.playlistLoader.destroy();this.fragmentLoader.destroy();this.levelController.destroy();this.abrController.destroy();this.bufferController.destroy();this.capLevelController.destroy();this.fpsController.destroy();this.streamController.destroy();this.audioStreamController.destroy();this.timelineController.destroy();this.audioTrackController.destroy();this.keyLoader.destroy();this.url=null;this.observer.removeAllListeners()}},{key:"attachMedia",value:function aa(ag){M.logger.log("attachMedia");this.media=ag;this.trigger(E.__default.MEDIA_ATTACHING,{media:ag})}},{key:"detachMedia",value:function ab(){M.logger.log("detachMedia");this.trigger(E.__default.MEDIA_DETACHING);this.media=null}},{key:"loadSource",value:function Y(ag){M.logger.log("loadSource:"+ag);this.url=ag;this.trigger(E.__default.MANIFEST_LOADING,{url:ag})}},{key:"startLoad",value:function ad(){var ag=arguments.length<=0||arguments[0]===undefined?-1:arguments[0];M.logger.log("startLoad");this.levelController.startLoad();this.streamController.startLoad(ag);this.audioStreamController.startLoad(ag)}},{key:"stopLoad",value:function ac(){M.logger.log("stopLoad");this.levelController.stopLoad();this.streamController.stopLoad();this.audioStreamController.stopLoad()}},{key:"swapAudioCodec",value:function U(){M.logger.log("swapAudioCodec");this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function Z(){M.logger.log("recoverMediaError");var ag=this.media;this.detachMedia();this.attachMedia(ag)}},{key:"levels",get:function X(){return this.levelController.levels}},{key:"currentLevel",get:function X(){return this.streamController.currentLevel},set:function ae(ag){M.logger.log("set currentLevel:"+ag);this.loadLevel=ag;this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function X(){return this.streamController.nextLevel},set:function ae(ag){M.logger.log("set nextLevel:"+ag);this.levelController.manualLevel=ag;this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function X(){return this.levelController.level},set:function ae(ag){M.logger.log("set loadLevel:"+ag);this.levelController.manualLevel=ag}},{key:"nextLoadLevel",get:function X(){return this.levelController.nextLoadLevel},set:function ae(ag){this.levelController.nextLoadLevel=ag}},{key:"firstLevel",get:function X(){return this.levelController.firstLevel},set:function ae(ag){M.logger.log("set firstLevel:"+ag);this.levelController.firstLevel=ag}},{key:"startLevel",get:function X(){return this.levelController.startLevel},set:function ae(ag){M.logger.log("set startLevel:"+ag);this.levelController.startLevel=ag}},{key:"autoLevelCapping",get:function X(){return this.abrController.autoLevelCapping},set:function ae(ag){M.logger.log("set autoLevelCapping:"+ag);this.abrController.autoLevelCapping=ag}},{key:"autoLevelEnabled",get:function X(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function X(){return this.levelController.manualLevel}},{key:"audioTracks",get:function X(){return this.audioTrackController.audioTracks}},{key:"audioTrack",get:function X(){return this.audioTrackController.audioTrack},set:function ae(ag){this.audioTrackController.audioTrack=ag}},{key:"liveSyncPosition",get:function X(){return this.streamController.liveSyncPosition}}]);return V}();N.__default=q},{"./controller/abr-controller":3,"./controller/audio-stream-controller":4,"./controller/audio-track-controller":5,"./controller/buffer-controller":6,"./controller/cap-level-controller":7,"./controller/fps-controller":9,"./controller/level-controller":10,"./controller/stream-controller":11,"./controller/timeline-controller":12,"./errors":24,"./events":26,"./loader/fragment-loader":32,"./loader/key-loader":33,"./loader/playlist-loader":34,"./utils/cues":41,"./utils/logger":43,"./utils/xhr-loader":47,events:1}],31:[function(h,g,e){g.exports=h("./hls.js").__default},{"./hls.js":30}],32:[function(e,g,n){Object.defineProperty(n,"__esModule",{value:true});var k=function(){function u(y,w){for(var v=0;v<w.length;v++){var x=w[v];x.enumerable=x.enumerable||false;x.configurable=true;if("value" in x){x.writable=true}Object.defineProperty(y,x.key,x)}}return function(x,v,w){if(v){u(x.prototype,v)}if(w){u(x,w)}return x}}();var p=e("../events");var q=t(p);var j=e("../event-handler");var h=t(j);var i=e("../errors");var m=e("../utils/logger");function t(u){return u&&u.__esModule?u:{__default:u}}function o(u,v){if(!(u instanceof v)){throw new TypeError("Cannot call a class as a function")}}function r(u,v){if(!u){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return v&&(typeof v==="object"||typeof v==="function")?v:u}function s(v,u){if(typeof u!=="function"&&u!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof u)}v.prototype=Object.create(u&&u.prototype,{constructor:{value:v,enumerable:false,writable:true,configurable:true}});if(u){Object.setPrototypeOf?Object.setPrototypeOf(v,u):v.__proto__=u}}var l=function(y){s(B,y);function B(C){o(this,B);var D=r(this,Object.getPrototypeOf(B).call(this,C,q.__default.FRAG_LOADING));D.loaders={};return D}k(B,[{key:"destroy",value:function x(){for(var D in this.loaders){var C=this.loaders[D];if(C){C.destroy()}}this.loaders={};h.__default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function A(G){var L=G.frag,I=L.type,K=this.loaders[I],E=this.hls.config;L.loaded=0;if(K){m.logger.warn("abort previous fragment loader for type:"+I);K.abort()}K=this.loaders[I]=L.loader=typeof E.fLoader!=="undefined"?new E.fLoader(E):new E.loader(E);var J=void 0,H=void 0,D=void 0;J={url:L.url,frag:L,responseType:"arraybuffer",progressData:false};var C=L.byteRangeStartOffset,F=L.byteRangeEndOffset;if(!isNaN(C)&&!isNaN(F)){J.rangeStart=C;J.rangeEnd=F}H={timeout:E.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:E.fragLoadingMaxRetryTimeout};D={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)};K.load(J,H,D)}},{key:"loadsuccess",value:function v(C,E,D){var F=C.data,G=D.frag;G.loader=undefined;this.loaders[G.type]=undefined;this.hls.trigger(q.__default.FRAG_LOADED,{payload:F,frag:G,stats:E})}},{key:"loaderror",value:function z(D,E){var C=E.loader;if(C){C.abort()}this.loaders[E.type]=undefined;this.hls.trigger(q.__default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:false,frag:E.frag,response:D})}},{key:"loadtimeout",value:function u(E,D){var C=D.loader;if(C){C.abort()}this.loaders[D.type]=undefined;this.hls.trigger(q.__default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:false,frag:D.frag})}},{key:"loadprogress",value:function w(D,C,E){var F=C.frag;F.loaded=D.loaded;this.hls.trigger(q.__default.FRAG_LOAD_PROGRESS,{frag:F,stats:D})}}]);return B}(h.__default);n.__default=l},{"../errors":24,"../event-handler":25,"../events":26,"../utils/logger":43}],33:[function(e,g,m){Object.defineProperty(m,"__esModule",{value:true});var k=function(){function u(y,w){for(var v=0;v<w.length;v++){var x=w[v];x.enumerable=x.enumerable||false;x.configurable=true;if("value" in x){x.writable=true}Object.defineProperty(y,x.key,x)}}return function(x,v,w){if(v){u(x.prototype,v)}if(w){u(x,w)}return x}}();var o=e("../events");var p=t(o);var j=e("../event-handler");var h=t(j);var i=e("../errors");var l=e("../utils/logger");function t(u){return u&&u.__esModule?u:{__default:u}}function n(u,v){if(!(u instanceof v)){throw new TypeError("Cannot call a class as a function")}}function q(u,v){if(!u){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return v&&(typeof v==="object"||typeof v==="function")?v:u}function s(v,u){if(typeof u!=="function"&&u!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof u)}v.prototype=Object.create(u&&u.prototype,{constructor:{value:v,enumerable:false,writable:true,configurable:true}});if(u){Object.setPrototypeOf?Object.setPrototypeOf(v,u):v.__proto__=u}}var r=function(x){s(A,x);function A(B){n(this,A);var C=q(this,Object.getPrototypeOf(A).call(this,B,p.__default.KEY_LOADING));C.loaders={};C.decryptkey=null;C.decrypturl=null;return C}k(A,[{key:"destroy",value:function w(){for(var C in this.loaders){var B=this.loaders[C];if(B){B.destroy()}}this.loaders={};h.__default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function y(E){var J=E.frag,G=J.type,I=this.loaders[G],K=J.decryptdata,C=K.uri;if(C!==this.decrypturl||this.decryptkey===null){var D=this.hls.config;if(I){l.logger.warn("abort previous fragment loader for type:"+G);I.abort()}J.loader=this.loaders[G]=new D.loader(D);this.decrypturl=C;this.decryptkey=null;var H=void 0,F=void 0,B=void 0;H={url:C,frag:J,responseType:"arraybuffer"};F={timeout:D.fragLoadingTimeOut,maxRetry:D.fragLoadingMaxRetry,retryDelay:D.fragLoadingRetryDelay,maxRetryDelay:D.fragLoadingMaxRetryTimeout};B={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};J.loader.load(H,F,B)}else{if(this.decryptkey){K.key=this.decryptkey;this.hls.trigger(p.__default.KEY_LOADED,{frag:J})}}}},{key:"loadsuccess",value:function v(B,D,C){var E=C.frag;this.decryptkey=E.decryptdata.key=new Uint8Array(B.data);E.loader=undefined;this.loaders[C.type]=undefined;this.hls.trigger(p.__default.KEY_LOADED,{frag:E})}},{key:"loaderror",value:function z(C,D){var E=D.frag,B=E.loader;if(B){B.abort()}this.loaders[D.type]=undefined;this.hls.trigger(p.__default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_ERROR,fatal:false,frag:E,response:C})}},{key:"loadtimeout",value:function u(D,C){var E=C.frag,B=E.loader;if(B){B.abort()}this.loaders[C.type]=undefined;this.hls.trigger(p.__default.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:false,frag:E})}}]);return A}(h.__default);m.__default=r},{"../errors":24,"../event-handler":25,"../events":26,"../utils/logger":43}],34:[function(m,h,x){Object.defineProperty(x,"__esModule",{value:true});var t=function(){function y(C,A){for(var z=0;z<A.length;z++){var B=A[z];B.enumerable=B.enumerable||false;B.configurable=true;if("value" in B){B.writable=true}Object.defineProperty(C,B.key,B)}}return function(B,z,A){if(z){y(B.prototype,z)}if(A){y(B,A)}return B}}();var r=m("../events");var n=g(r);var j=m("../event-handler");var k=g(j);var u=m("../errors");var p=m("../utils/url");var w=g(p);var v=m("../utils/attr-list");var e=g(v);var o=m("../utils/logger");function g(y){return y&&y.__esModule?y:{__default:y}}function l(y,z){if(!(y instanceof z)){throw new TypeError("Cannot call a class as a function")}}function q(y,z){if(!y){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return z&&(typeof z==="object"||typeof z==="function")?z:y}function s(z,y){if(typeof y!=="function"&&y!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof y)}z.prototype=Object.create(y&&y.prototype,{constructor:{value:z,enumerable:false,writable:true,configurable:true}});if(y){Object.setPrototypeOf?Object.setPrototypeOf(z,y):z.__proto__=y}}var i=function(J){s(A,J);function A(Q){l(this,A);var R=q(this,Object.getPrototypeOf(A).call(this,Q,n.__default.MANIFEST_LOADING,n.__default.LEVEL_LOADING,n.__default.AUDIO_TRACK_LOADING));R.loaders={};return R}t(A,[{key:"destroy",value:function L(){for(var R in this.loaders){var Q=this.loaders[R];if(Q){Q.destroy()}}this.loaders={};k.__default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function M(Q){this.load(Q.url,{type:"manifest"})}},{key:"onLevelLoading",value:function P(S){var R=document.createElement("a");R.href=this.hls.url;var Q=R.href;R=null;if(/^https:/i.test(Q)&&/^http:/i.test(S.url)){S.url=S.url.replace(/^http:/i,"https:")}this.load(S.url,{type:"level",level:S.level,id:S.id})}},{key:"onAudioTrackLoading",value:function C(Q){this.load(Q.url,{type:"audioTrack",id:Q.id})}},{key:"load",value:function D(R,T){var U=this.hls.config,Q,X,aa,V;if(T.type==="manifest"){Q=U.manifestLoadingMaxRetry;X=U.manifestLoadingTimeOut;aa=U.manifestLoadingRetryDelay;V=U.manifestLoadingMaxRetryTimeOut}else{Q=U.levelLoadingMaxRetry;X=U.levelLoadingTimeOut;aa=U.levelLoadingRetryDelay;V=U.levelLoadingMaxRetryTimeOut}var Z=this.loaders[T.type];if(Z){var Y=Z.context;if(Y&&Y.url===R){o.logger.warn("playlist request ongoing");return}else{o.logger.warn("abort previous loader for type:"+T.type);Z.abort()}}Z=this.loaders[T.type]=T.loader=typeof U.pLoader!=="undefined"?new U.pLoader(U):new U.loader(U);T.url=R;T.responseType="";var W=void 0,S=void 0;W={timeout:X,maxRetry:Q,retryDelay:aa,maxRetryDelay:V};S={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};Z.load(T,W,S)}},{key:"resolve",value:function I(Q,R){return w.__default.buildAbsoluteURL(R,Q)}},{key:"parseMasterPlaylist",value:function G(U,V){var Y=[],aa=void 0;var Z=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g;while((aa=Z.exec(U))!=null){var Q={};var X=Q.attrs=new e.__default(aa[1]);Q.url=this.resolve(aa[2],V);var S=X.decimalResolution("RESOLUTION");if(S){Q.width=S.width;Q.height=S.height}Q.bitrate=X.decimalInteger("AVERAGE-BANDWIDTH")||X.decimalInteger("BANDWIDTH");Q.name=X.NAME;var R=X.CODECS;if(R){R=R.split(",");for(var T=0;T<R.length;T++){var W=R[T];if(W.indexOf("avc1")!==-1){Q.videoCodec=this.avc1toavcoti(W)}else{Q.audioCodec=W}}}Y.push(Q)}return Y}},{key:"parseMasterPlaylistMedia",value:function E(T,X,V){var R=void 0,Q=[];var U=/#EXT-X-MEDIA:(.*)/g;while((R=U.exec(T))!=null){var W={};var S=new e.__default(R[1]);if(S.TYPE===V){W.groupId=S["GROUP-ID"];W.name=S.NAME;W.type=V;W.__default=S.DEFAULT==="YES";W.autoselect=S.AUTOSELECT==="YES";W.forced=S.FORCED==="YES";if(S.URI){W.url=this.resolve(S.URI,X)}W.lang=S.LANGUAGE;if(!W.name){W.name=W.lang}Q.push(W)}}return Q}},{key:"createInitializationVector",value:function O(S){var R=new Uint8Array(16);for(var Q=12;Q<16;Q++){R[Q]=S>>8*(15-Q)&255}return R}},{key:"fragmentDecryptdataFromLevelkey",value:function N(S,Q){var R=S;if(S&&S.method&&S.uri&&!S.iv){R=this.cloneObj(S);R.iv=this.createInitializationVector(Q)}return R}},{key:"avc1toavcoti",value:function F(S){var R,Q=S.split(".");if(Q.length>2){R=Q.shift()+".";R+=parseInt(Q.shift()).toString(16);R+=("000"+parseInt(Q.shift()).toString(16)).substr(-4)}else{R=S}return R}},{key:"cloneObj",value:function K(Q){return JSON.parse(JSON.stringify(Q))}},{key:"parseLevelPlaylist",value:function H(Q,aj,ae,W){var af=0,ai,ar=0,S={type:null,version:null,url:aj,fragments:[],live:true,startSN:0},Y={method:null,key:null,iv:null,uri:null},ad=0,ap=null,T=null,ab,au,R=null,at=null,aa=null,V=null,aq=[];au=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT(INF):(\d+(?:\.\d+)?)(?:,(.*))?)|(?:(?!#)()(\S.+))|(?:#EXT-X-(BYTERANGE):(\d+(?:@\d+(?:\.\d+)?)?)|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(PROGRAM-DATE-TIME):(.+))|(?:#EXT-X-(VERSION):(\d+))|(?:(#)(.*):(.*))|(?:(#)(.*)))(?:.*)\r?\n?/g;while((ab=au.exec(Q))!==null){ab.shift();ab=ab.filter(function(av){return av!==undefined});switch(ab[0]){case"PLAYLIST-TYPE":S.type=ab[1].toUpperCase();break;case"MEDIA-SEQUENCE":af=S.startSN=parseInt(ab[1]);break;case"TARGETDURATION":S.targetduration=parseFloat(ab[1]);break;case"VERSION":S.version=parseInt(ab[1]);break;case"EXTM3U":break;case"ENDLIST":S.live=false;break;case"DIS":ad++;aq.push(ab);break;case"BYTERANGE":var ao=ab[1].split("@");if(ao.length===1){V=aa}else{V=parseInt(ao[1])}aa=parseInt(ao[0])+V;break;case"INF":R=parseFloat(ab[1]);at=ab[2]?ab[2]:null;aq.push(ab);break;case"":if(!isNaN(R)){var ak=af++;ai=this.fragmentDecryptdataFromLevelkey(Y,ak);var X=ab[1]?this.resolve(ab[1],aj):null;T={url:X,type:W,duration:R,title:at,start:ar,sn:ak,level:ae,cc:ad,decryptdata:ai,programDateTime:ap,tagList:aq};if(V!==null){T.byteRangeStartOffset=V;T.byteRangeEndOffset=aa}S.fragments.push(T);ar+=R;R=null;at=null;V=null;ap=null;aq=[]}break;case"KEY":var an=ab[1];var ah=new e.__default(an);var U=ah.enumeratedString("METHOD"),ag=ah.URI,am=ah.hexadecimalInteger("IV");if(U){Y={method:null,key:null,iv:null,uri:null};if(ag&&U==="AES-128"){Y.method=U;Y.uri=this.resolve(ag,aj);Y.key=null;Y.iv=am}}break;case"START":var Z=ab[1];var ac=new e.__default(Z);var al=ac.decimalFloatingPoint("TIME-OFFSET");if(al){S.startTimeOffset=al}break;case"PROGRAM-DATE-TIME":ap=new Date(Date.parse(ab[1]));aq.push(ab);break;case"#":ab.shift();aq.push(ab);break;default:o.logger.warn("line parsed but not handled: "+ab);break}}if(T&&!T.url){S.fragments.pop();ar-=T.duration}S.totalduration=ar;S.averagetargetduration=ar/S.fragments.length;S.endSN=af-1;return S}},{key:"loadsuccess",value:function z(V,X,U){var Y=V.data,S=V.url,Z=U.type,T=U.id,R=U.level,Q=this.hls;this.loaders[Z]=undefined;if(S===undefined||S.indexOf("data:")===0){S=U.url}X.tload=performance.now();if(Y.indexOf("#EXTM3U")===0){if(Y.indexOf("#EXTINF:")>0){var ad=Z!=="audioTrack",aa=this.parseLevelPlaylist(Y,S,R||T||0,ad?"main":"audio");aa.tload=X.tload;if(Z==="manifest"){Q.trigger(n.__default.MANIFEST_LOADED,{levels:[{url:S,details:aa}],url:S,stats:X})}X.tparsed=performance.now();if(ad){Q.trigger(n.__default.LEVEL_LOADED,{details:aa,level:R||0,id:T||0,stats:X})}else{Q.trigger(n.__default.AUDIO_TRACK_LOADED,{details:aa,id:T,stats:X})}}else{var ac=this.parseMasterPlaylist(Y,S);if(ac.length){var ab=this.parseMasterPlaylistMedia(Y,S,"AUDIO");if(ab.length){var W=false;ab.forEach(function(ae){if(!ae.url){W=true}});if(W===false&&ac[0].audioCodec&&!ac[0].attrs.AUDIO){o.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one");ab.unshift({type:"main",name:"main"})}}Q.trigger(n.__default.MANIFEST_LOADED,{levels:ac,audioTracks:ab,url:S,stats:X})}else{Q.trigger(n.__default.ERROR,{type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:S,reason:"no level found in manifest"})}}}else{Q.trigger(n.__default.ERROR,{type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:S,reason:"no EXTM3U delimiter"})}}},{key:"loaderror",value:function y(R,T){var S,U,Q=T.loader;switch(T.type){case"manifest":S=u.ErrorDetails.MANIFEST_LOAD_ERROR;U=true;break;case"level":S=u.ErrorDetails.LEVEL_LOAD_ERROR;U=false;break;case"audioTrack":S=u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR;U=false;break}if(Q){Q.abort();this.loaders[T.type]=undefined}this.hls.trigger(n.__default.ERROR,{type:u.ErrorTypes.NETWORK_ERROR,details:S,fatal:U,url:Q.url,loader:Q,response:R,context:T})}},{key:"loadtimeout",value:function B(T,S){var R,U,Q=S.loader;switch(S.type){case"manifest":R=u.ErrorDetails.MANIFEST_LOAD_TIMEOUT;U=true;break;case"level":R=u.ErrorDetails.LEVEL_LOAD_TIMEOUT;U=false;break;case"audioTrack":R=u.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT;U=false;break}if(Q){Q.abort();this.loaders[S.type]=undefined}this.hls.trigger(n.__default.ERROR,{type:u.ErrorTypes.NETWORK_ERROR,details:R,fatal:U,url:Q.url,loader:Q,context:S})}}]);return A}(k.__default);x.__default=i},{"../errors":24,"../event-handler":25,"../events":26,"../utils/attr-list":38,"../utils/logger":43,"../utils/url":46}],35:[function(i,h,e){Object.defineProperty(e,"__esModule",{value:true});var g=function(){function l(p,n){for(var m=0;m<n.length;m++){var o=n[m];o.enumerable=o.enumerable||false;o.configurable=true;if("value" in o){o.writable=true}Object.defineProperty(p,o.key,o)}}return function(o,m,n){if(m){l(o.prototype,m)}if(n){l(o,n)}return o}}();function k(l,m){if(!(l instanceof m)){throw new TypeError("Cannot call a class as a function")}}var j=function(){function B(){k(this,B)}g(B,null,[{key:"init",value:function D(){B.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var P;for(P in B.types){if(B.types.hasOwnProperty(P)){B.types[P]=[P.charCodeAt(0),P.charCodeAt(1),P.charCodeAt(2),P.charCodeAt(3)]}}var Q=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);var K=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);B.HDLR_TYPES={video:Q,audio:K};var N=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);var M=new Uint8Array([0,0,0,0,0,0,0,0]);B.STTS=B.STSC=B.STCO=M;B.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);B.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);B.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);B.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var L=new Uint8Array([105,115,111,109]);var O=new Uint8Array([97,118,99,49]);var R=new Uint8Array([0,0,0,1]);B.FTYP=B.box(B.types.ftyp,L,R,L,O);B.DINF=B.box(B.types.dinf,B.box(B.types.dref,N))}},{key:"box",value:function y(O){var P=Array.prototype.slice.call(arguments,1),N=8,M=P.length,L=M,K;while(M--){N+=P[M].byteLength}K=new Uint8Array(N);K[0]=N>>24&255;K[1]=N>>16&255;K[2]=N>>8&255;K[3]=N&255;K.set(O,4);for(M=0,N=8;M<L;M++){K.set(P[M],N);N+=P[M].byteLength}return K}},{key:"hdlr",value:function n(K){return B.box(B.types.hdlr,B.HDLR_TYPES[K])}},{key:"mdat",value:function m(K){return B.box(B.types.mdat,K)}},{key:"mdhd",value:function H(K,L){L*=K;return B.box(B.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,K>>24&255,K>>16&255,K>>8&255,K&255,L>>24,L>>16&255,L>>8&255,L&255,85,196,0,0]))}},{key:"mdia",value:function q(K){return B.box(B.types.mdia,B.mdhd(K.timescale,K.duration),B.hdlr(K.type),B.minf(K))}},{key:"mfhd",value:function J(K){return B.box(B.types.mfhd,new Uint8Array([0,0,0,0,K>>24,K>>16&255,K>>8&255,K&255]))}},{key:"minf",value:function A(K){if(K.type==="audio"){return B.box(B.types.minf,B.box(B.types.smhd,B.SMHD),B.DINF,B.stbl(K))}else{return B.box(B.types.minf,B.box(B.types.vmhd,B.VMHD),B.DINF,B.stbl(K))}}},{key:"moof",value:function t(M,L,K){return B.box(B.types.moof,B.mfhd(M),B.traf(K,L))}},{key:"moov",value:function I(K){var M=K.length,L=[];while(M--){L[M]=B.trak(K[M])}return B.box.apply(null,[B.types.moov,B.mvhd(K[0].timescale,K[0].duration)].concat(L).concat(B.mvex(K)))}},{key:"mvex",value:function v(K){var M=K.length,L=[];while(M--){L[M]=B.trex(K[M])}return B.box.apply(null,[B.types.mvex].concat(L))}},{key:"mvhd",value:function E(L,M){M*=L;var K=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,L>>24&255,L>>16&255,L>>8&255,L&255,M>>24&255,M>>16&255,M>>8&255,M&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return B.box(B.types.mvhd,K)}},{key:"sdtp",value:function z(M){var N=M.samples||[],L=new Uint8Array(4+N.length),K,O;for(O=0;O<N.length;O++){K=N[O].flags;L[O+4]=K.dependsOn<<4|K.isDependedOn<<2|K.hasRedundancy}return B.box(B.types.sdtp,L)}},{key:"stbl",value:function w(K){return B.box(B.types.stbl,B.stsd(K),B.box(B.types.stts,B.STTS),B.box(B.types.stsc,B.STSC),B.box(B.types.stsz,B.STSZ),B.box(B.types.stco,B.STCO))}},{key:"avc1",value:function x(M){var K=[],N=[],P,O,Q;for(P=0;P<M.sps.length;P++){O=M.sps[P];Q=O.byteLength;K.push(Q>>>8&255);K.push(Q&255);K=K.concat(Array.prototype.slice.call(O))}for(P=0;P<M.pps.length;P++){O=M.pps[P];Q=O.byteLength;N.push(Q>>>8&255);N.push(Q&255);N=N.concat(Array.prototype.slice.call(O))}var R=B.box(B.types.avcC,new Uint8Array([1,K[3],K[4],K[5],252|3,224|M.sps.length].concat(K).concat([M.pps.length]).concat(N))),L=M.width,S=M.height;return B.box(B.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,L>>8&255,L&255,S>>8&255,S&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),R,B.box(B.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function s(K){var L=K.config.length;return new Uint8Array([0,0,0,0,3,23+L,0,1,0,4,15+L,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([L]).concat(K.config).concat([6,1,2]))}},{key:"mp4a",value:function G(K){var L=K.audiosamplerate;return B.box(B.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,K.channelCount,0,16,0,0,0,0,L>>8&255,L&255,0,0]),B.box(B.types.esds,B.esds(K)))}},{key:"stsd",value:function u(K){if(K.type==="audio"){return B.box(B.types.stsd,B.STSD,B.mp4a(K))}else{return B.box(B.types.stsd,B.STSD,B.avc1(K))}}},{key:"tkhd",value:function C(L){var O=L.id,N=L.duration*L.timescale,M=L.width,K=L.height;return B.box(B.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,O>>24&255,O>>16&255,O>>8&255,O&255,0,0,0,0,N>>24,N>>16&255,N>>8&255,N&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,M>>8&255,M&255,0,0,K>>8&255,K&255,0,0]))}},{key:"traf",value:function p(K,M){var L=B.sdtp(K),N=K.id;return B.box(B.types.traf,B.box(B.types.tfhd,new Uint8Array([0,0,0,0,N>>24,N>>16&255,N>>8&255,N&255])),B.box(B.types.tfdt,new Uint8Array([0,0,0,0,M>>24,M>>16&255,M>>8&255,M&255])),B.trun(K,L.length+16+16+8+16+8+8),L)}},{key:"trak",value:function l(K){K.duration=K.duration||4294967295;return B.box(B.types.trak,B.tkhd(K),B.mdia(K))}},{key:"trex",value:function o(K){var L=K.id;return B.box(B.types.trex,new Uint8Array([0,0,0,0,L>>24,L>>16&255,L>>8&255,L&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function F(L,O){var S=L.samples||[],Q=S.length,V=12+16*Q,R=new Uint8Array(V),P,T,N,U,M,K;O+=8+V;R.set([0,0,15,1,Q>>>24&255,Q>>>16&255,Q>>>8&255,Q&255,O>>>24&255,O>>>16&255,O>>>8&255,O&255],0);for(P=0;P<Q;P++){T=S[P];N=T.duration;U=T.size;M=T.flags;K=T.cts;R.set([N>>>24&255,N>>>16&255,N>>>8&255,N&255,U>>>24&255,U>>>16&255,U>>>8&255,U&255,M.isLeading<<2|M.dependsOn,M.isDependedOn<<6|M.hasRedundancy<<4|M.paddingValue<<1|M.isNonSync,M.degradPrio&240<<8,M.degradPrio&15,K>>>24&255,K>>>16&255,K>>>8&255,K&255],12+16*P)}return B.box(B.types.trun,R)}},{key:"initSegment",value:function r(M){if(!B.types){B.init()}var L=B.moov(M),K;K=new Uint8Array(B.FTYP.byteLength+L.byteLength);K.set(B.FTYP);K.set(L,B.FTYP.byteLength);return K}}]);return B}();e.__default=j},{}],36:[function(e,g,m){Object.defineProperty(m,"__esModule",{value:true});var j=function(){function u(y,w){for(var v=0;v<w.length;v++){var x=w[v];x.enumerable=x.enumerable||false;x.configurable=true;if("value" in x){x.writable=true}Object.defineProperty(y,x.key,x)}}return function(x,v,w){if(v){u(x.prototype,v)}if(w){u(x,w)}return x}}();var h=e("../helper/aac");var s=t(h);var o=e("../events");var q=t(o);var l=e("../utils/logger");var k=e("../remux/mp4-generator");var r=t(k);var i=e("../errors");e("../utils/polyfill");function t(u){return u&&u.__esModule?u:{__default:u}}function n(u,v){if(!(u instanceof v)){throw new TypeError("Cannot call a class as a function")}}var p=function(){function z(H,J,I){n(this,z);this.observer=H;this.id=J;this.config=I;this.ISGenerated=false;this.PES2MP4SCALEFACTOR=4;this.PES_TIMESCALE=90000;this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}j(z,[{key:"destroy",value:function F(){}},{key:"insertDiscontinuity",value:function E(){this._initPTS=this._initDTS=undefined}},{key:"switchLevel",value:function D(){this.ISGenerated=false}},{key:"remux",value:function A(H,J,K,P,R,N,Q,I){this.level=H;this.sn=J;if(!this.ISGenerated){this.generateIS(K,P,Q)}if(this.ISGenerated){if(K.samples.length){var M=this.remuxAudio(K,Q,I);if(P.samples.length){var O=void 0;if(M){O=M.endPTS-M.startPTS}this.remuxVideo(P,Q,I,O)}}else{var L=void 0;if(P.samples.length){L=this.remuxVideo(P,Q,I)}if(L&&K.codec){this.remuxEmptyAudio(K,Q,I,L)}}}if(R.samples.length){this.remuxID3(R,Q)}if(N.samples.length){this.remuxText(N,Q)}this.observer.trigger(q.__default.FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function y(L,R,S){var O=this.observer,J=L.samples,I=R.samples,M=this.PES_TIMESCALE,N={},K={id:this.id,level:this.level,sn:this.sn,tracks:N,unique:false},P=this._initPTS===undefined,Q,H;if(P){Q=H=Infinity}if(L.config&&J.length){L.timescale=L.audiosamplerate;if(L.timescale*L.duration>Math.pow(2,32)){(function(){var T=function T(V,U){if(!U){return V}return T(U,V%U)};L.timescale=L.audiosamplerate/T(L.audiosamplerate,1024)})()}l.logger.log("audio mp4 timescale :"+L.timescale);N.audio={container:"audio/mp4",codec:L.codec,initSegment:r.__default.initSegment([L]),metadata:{channelCount:L.channelCount}};if(P){Q=H=J[0].pts-M*S}}if(R.sps&&R.pps&&I.length){R.timescale=this.MP4_TIMESCALE;N.video={container:"video/mp4",codec:R.codec,initSegment:r.__default.initSegment([R]),metadata:{width:R.width,height:R.height}};if(P){Q=Math.min(Q,I[0].pts-M*S);H=Math.min(H,I[0].dts-M*S)}}if(Object.keys(N).length){O.trigger(q.__default.FRAG_PARSING_INIT_SEGMENT,K);this.ISGenerated=true;if(P){this._initPTS=Q;this._initDTS=H}}else{O.trigger(q.__default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,id:this.id,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"no audio/video samples found"})}}},{key:"remuxVideo",value:function w(Q,am,X,ae){var ai=8,L=this.PES_TIMESCALE,au=this.PES2MP4SCALEFACTOR,at,O,aa,ad,I,H,aq,P,W=Q.samples,S=[];var V=void 0;if(X){V=this.nextAvcDts}else{V=am*L}var N=W[0];I=Math.max(this._PTSNormalize(N.dts-this._initDTS,V),0);ad=Math.max(this._PTSNormalize(N.pts-this._initDTS,V),0);var ah=Math.round((I-V)/90);if(X){if(ah){if(ah>1){l.logger.log("AVC:"+ah+" ms hole between fragments detected,filling it")}else{if(ah<-1){l.logger.log("AVC:"+-ah+" ms overlapping between fragments detected")}}I=V;W[0].dts=I+this._initDTS;ad=Math.max(ad-ah,V);W[0].pts=ad+this._initDTS;l.logger.log("Video/PTS/DTS adjusted: "+ad+"/"+I+",delta:"+ah)}}H=I;N=W[W.length-1];P=Math.max(this._PTSNormalize(N.dts-this._initDTS,V),0);aq=Math.max(this._PTSNormalize(N.pts-this._initDTS,V),0);aq=Math.max(aq,P);var R=navigator.vendor,ab=navigator.userAgent,K=R&&R.indexOf("Apple")>-1&&ab&&!ab.match("CriOS");if(K){at=Math.round((P-I)/(au*(W.length-1)))}for(var ao=0;ao<W.length;ao++){var U=W[ao];if(K){U.dts=I+ao*au*at}else{U.dts=Math.max(this._PTSNormalize(U.dts-this._initDTS,V),I);U.dts=Math.round(U.dts/au)*au}U.pts=Math.max(this._PTSNormalize(U.pts-this._initDTS,V),U.dts);U.pts=Math.round(U.pts/au)*au}O=new Uint8Array(Q.len+4*Q.nbNalu+8);var J=new DataView(O.buffer);J.setUint32(0,O.byteLength);O.set(r.__default.types.mdat,4);for(var ap=0;ap<W.length;ap++){var Z=W[ap],al=0,Y=void 0;while(Z.units.units.length){var ak=Z.units.units.shift();J.setUint32(ai,ak.data.byteLength);ai+=4;O.set(ak.data,ai);ai+=ak.data.byteLength;al+=4+ak.data.byteLength}if(!K){if(ap<W.length-1){at=W[ap+1].dts-Z.dts}else{var ag=this.config,aj=Z.dts-W[ap>0?ap-1:ap].dts;if(ag.stretchShortVideoTrack){var M=ag.maxBufferHole,an=ag.maxSeekHole,T=Math.floor(Math.min(M,an)*L),ac=(ae?ad+ae*L:this.nextAacPts)-Z.pts;if(ac>T){at=ac-aj;if(at<0){at=aj}l.logger.log("It is approximately "+ac/90+" ms to the next segment; using duration "+at/90+" ms for the last video frame.")}else{at=aj}}else{at=aj}}at/=au;Y=Math.round((Z.pts-Z.dts)/au)}else{Y=Math.max(0,at*Math.round((Z.pts-Z.dts)/(au*at)))}S.push({size:al,duration:at,cts:Y,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:Z.key?2:1,isNonSync:Z.key?0:1}})}this.nextAvcDts=P+at*au;var af=Q.dropped;Q.len=0;Q.nbNalu=0;Q.dropped=0;Q.samples=S;aa=r.__default.moof(Q.sequenceNumber++,I/au,Q);Q.samples=[];var ar={id:this.id,level:this.level,sn:this.sn,data1:aa,data2:O,startPTS:ad/L,endPTS:(aq+au*at)/L,startDTS:I/L,endDTS:this.nextAvcDts/L,type:"video",nb:S.length,dropped:af};this.observer.trigger(q.__default.FRAG_PARSING_DATA,ar);return ar}},{key:"remuxAudio",value:function B(U,al,Y){var M=this.PES_TIMESCALE,am=U.timescale,au=M/am,H=U.timescale*1024/U.audiosamplerate;var K,ag=8,aq,L,ai,Q,aa,ad,I,R,at,S,ab,Z,aj=[],V=[],W,N;U.samples.sort(function(aw,av){return aw.pts-av.pts});V=U.samples;var an=Y?this.nextAacPts:al*M;var ah=H*au;var ac=an;for(var ap=0;ap<V.length;){var P=V[ap],X=this._PTSNormalize(P.pts-this._initDTS,an),ae=X-ac;if(ae<-0.5*ah){l.logger.log("Dropping frame due to "+Math.round(Math.abs(ae/90))+" ms overlap.");V.splice(ap,1);U.len-=P.unit.length}else{if(ae>0.5*ah){var J=Math.round(ae/ah);l.logger.log("Injecting "+J+" frame"+(J>1?"s":"")+" of missing audio due to "+Math.round(ae/90)+" ms gap.");for(var ao=0;ao<J;ao++){N=P.pts-(J-ao)*ah;N=Math.max(N,this._initDTS);W=s.__default.getSilentFrame(U.channelCount);if(!W){l.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead.");W=P.unit.slice(0)}V.splice(ap,0,{unit:W,pts:N,dts:N});U.len+=W.length;ap+=1}P.pts=V[ap-1].pts+ah;ac=this._PTSNormalize(P.pts+ah-this._initDTS,an);ap+=1}else{if(Math.abs(ae)>0.1*ah){l.logger.log("Invalid frame delta "+Math.round(X-ac+ah)+" at PTS "+Math.round(X/90)+" (should be "+Math.round(ah)+").")}ac+=ah;if(ap===0){P.pts=this._initDTS+an}else{P.pts=V[ap-1].pts+ah}ap+=1}}}while(V.length){aq=V.shift();ai=aq.unit;at=aq.pts-this._initDTS;S=aq.dts-this._initDTS;if(R!==undefined){ab=this._PTSNormalize(at,R);Z=this._PTSNormalize(S,R);L.duration=Math.round((Z-R)/au)}else{ab=this._PTSNormalize(at,an);Z=this._PTSNormalize(S,an);var af=Math.round(1000*(ab-an)/M),ar=0;if(Y){if(af){if(af>0){ar=Math.round((ab-an)/ah);l.logger.log(af+" ms hole between AAC samples detected,filling it");if(ar>0){W=s.__default.getSilentFrame(U.channelCount);if(!W){W=ai.slice(0)}U.len+=ar*W.length}}else{if(af<-12){l.logger.log(-af+" ms overlapping between AAC samples detected, drop frame");U.len-=ai.byteLength;continue}}ab=Z=an}}ad=Math.max(0,ab);I=Math.max(0,Z);if(U.len>0){Q=new Uint8Array(U.len+8);K=new DataView(Q.buffer);K.setUint32(0,Q.byteLength);Q.set(r.__default.types.mdat,4)}else{return}for(ap=0;ap<ar;ap++){N=ab-(ar-ap)*ah;W=s.__default.getSilentFrame(U.channelCount);if(!W){l.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead.");W=ai.slice(0)}Q.set(W,ag);ag+=W.byteLength;L={size:W.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};aj.push(L)}}Q.set(ai,ag);ag+=ai.byteLength;L={size:ai.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};aj.push(L);R=Z}var ak=0;var O=aj.length;if(O>=2){ak=aj[O-2].duration;L.duration=ak}if(O){this.nextAacPts=ab+au*ak;U.len=0;U.samples=aj;aa=r.__default.moof(U.sequenceNumber++,I/au,U);U.samples=[];var T={id:this.id,level:this.level,sn:this.sn,data1:aa,data2:Q,startPTS:ad/M,endPTS:this.nextAacPts/M,startDTS:I/M,endDTS:(Z+au*ak)/M,type:"audio",nb:O};this.observer.trigger(q.__default.FRAG_PARSING_DATA,T);return T}return null}},{key:"remuxEmptyAudio",value:function C(N,W,L,R){var S=this.PES_TIMESCALE,M=N.timescale?N.timescale:N.audiosamplerate,K=S/M,U=R.startDTS*S+this._initDTS,O=R.endDTS*S+this._initDTS,J=1024,I=K*J,P=Math.ceil((O-U)/I),V=s.__default.getSilentFrame(N.channelCount);if(!V){l.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");return}var T=[];for(var Q=0;Q<P;Q++){var H=U+Q*I;T.push({unit:V.slice(0),pts:H,dts:H});N.len+=V.length}N.samples=T;this.remuxAudio(N,W,L)}},{key:"remuxID3",value:function v(I,H){var L=I.samples.length,K;if(L){for(var J=0;J<L;J++){K=I.samples[J];K.pts=(K.pts-this._initPTS)/this.PES_TIMESCALE;K.dts=(K.dts-this._initDTS)/this.PES_TIMESCALE}this.observer.trigger(q.__default.FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:I.samples})}I.samples=[];H=H}},{key:"remuxText",value:function G(I,H){I.samples.sort(function(N,M){return N.pts-M.pts});var L=I.samples.length,K;if(L){for(var J=0;J<L;J++){K=I.samples[J];K.pts=(K.pts-this._initPTS)/this.PES_TIMESCALE}this.observer.trigger(q.__default.FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:I.samples})}I.samples=[];H=H}},{key:"_PTSNormalize",value:function x(I,H){var J;if(H===undefined){return I}if(H<I){J=-8589934592}else{J=8589934592}while(Math.abs(I-H)>4294967296){I+=J}return I}},{key:"passthrough",get:function u(){return false}}]);return z}();m.__default=p},{"../errors":24,"../events":26,"../helper/aac":27,"../remux/mp4-generator":35,"../utils/logger":43,"../utils/polyfill":44}],37:[function(e,g,j){Object.defineProperty(j,"__esModule",{value:true});var h=function(){function o(s,q){for(var p=0;p<q.length;p++){var r=q[p];r.enumerable=r.enumerable||false;r.configurable=true;if("value" in r){r.writable=true}Object.defineProperty(s,r.key,r)}}return function(r,p,q){if(p){o(r.prototype,p)}if(q){o(r,q)}return r}}();var k=e("../events");var m=n(k);function n(o){return o&&o.__esModule?o:{__default:o}}function l(o,p){if(!(o instanceof p)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function q(u,v){l(this,q);this.observer=u;this.id=v;this.ISGenerated=false}h(q,[{key:"destroy",value:function r(){}},{key:"insertDiscontinuity",value:function s(){}},{key:"switchLevel",value:function t(){this.ISGenerated=false}},{key:"remux",value:function p(x,C,E,A,D,u){var z=this.observer;if(!this.ISGenerated){var y={},w={id:this.id,tracks:y,unique:true},v=C,B=v.codec;if(B){w.tracks.video={container:v.container,codec:B,metadata:{width:v.width,height:v.height}}}v=x;B=v.codec;if(B){w.tracks.audio={container:v.container,codec:B,metadata:{channelCount:v.channelCount}}}this.ISGenerated=true;z.trigger(m.__default.FRAG_PARSING_INIT_SEGMENT,w)}z.trigger(m.__default.FRAG_PARSING_DATA,{id:this.id,data1:u,startPTS:D,startDTS:D,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function o(){return true}}]);return q}();j.__default=i},{"../events":26}],38:[function(i,h,e){Object.defineProperty(e,"__esModule",{value:true});var g=function(){function l(p,n){for(var m=0;m<n.length;m++){var o=n[m];o.enumerable=o.enumerable||false;o.configurable=true;if("value" in o){o.writable=true}Object.defineProperty(p,o.key,o)}}return function(o,m,n){if(m){l(o.prototype,m)}if(n){l(o,n)}return o}}();function j(l,m){if(!(l instanceof m)){throw new TypeError("Cannot call a class as a function")}}var k=function(){function s(u){j(this,s);if(typeof u==="string"){u=s.parseAttrList(u)}for(var t in u){if(u.hasOwnProperty(t)){this[t]=u[t]}}}g(s,[{key:"decimalInteger",value:function r(t){var u=parseInt(this[t],10);if(u>Number.MAX_SAFE_INTEGER){return Infinity}return u}},{key:"hexadecimalInteger",value:function m(v){if(this[v]){var t=(this[v]||"0x").slice(2);t=(t.length&1?"0":"")+t;var w=new Uint8Array(t.length/2);for(var u=0;u<t.length/2;u++){w[u]=parseInt(t.slice(u*2,u*2+2),16)}return w}else{return null}}},{key:"hexadecimalIntegerAsNumber",value:function p(t){var u=parseInt(this[t],16);if(u>Number.MAX_SAFE_INTEGER){return Infinity}return u}},{key:"decimalFloatingPoint",value:function l(t){return parseFloat(this[t])}},{key:"enumeratedString",value:function q(t){return this[t]}},{key:"decimalResolution",value:function o(u){var t=/^(\d+)x(\d+)$/.exec(this[u]);if(t===null){return undefined}return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function n(u){var x=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g;var w,v={};while((w=x.exec(u))!==null){var y=w[2],t='"';if(y.indexOf(t)===0&&y.lastIndexOf(t)===y.length-1){y=y.slice(1,-1)}v[w[1]]=y}return v}}]);return s}();e.__default=k},{}],39:[function(j,i,g){var e={search:function h(q,m){var o=0;var p=q.length-1;var l=null;var n=null;while(o<=p){l=(o+p)/2|0;n=q[l];var k=m(n);if(k>0){o=l+1}else{if(k<0){p=l-1}else{return n}}}return null}};i.exports=e},{}],40:[function(j,g,B){Object.defineProperty(B,"__esModule",{value:true});var v=function(){function D(H,F){for(var E=0;E<F.length;E++){var G=F[E];G.enumerable=G.enumerable||false;G.configurable=true;if("value" in G){G.writable=true}Object.defineProperty(H,G.key,G)}}return function(G,E,F){if(E){D(G.prototype,E)}if(F){D(G,F)}return G}}();function i(D,E){if(!(D instanceof E)){throw new TypeError("Cannot call a class as a function")}}var A={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499};var q=function q(E){var D=E;if(A.hasOwnProperty(E)){D=A[E]}return String.fromCharCode(D)};var l=15,m=32;var x={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14};var h={17:2,18:4,21:6,22:8,23:10,19:13,20:15};var w={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14};var e={25:2,26:4,29:6,30:8,31:10,27:13,28:15};var y=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];var C={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function s(D){this.time=D},log:function o(D,E){var F=this.verboseFilter[D];if(this.verboseLevel>=F){console.log(this.time+" ["+D+"] "+E)}}};var r=function r(E){var D=[];for(var F=0;F<E.length;F++){D.push(E[F].toString(16))}return D};var z=function(){function H(N,O,L,M,K){i(this,H);this.foreground=N||"white";this.underline=O||false;this.italics=L||false;this.background=M||"black";this.flash=K||false}v(H,[{key:"reset",value:function E(){this.foreground="white";this.underline=false;this.italics=false;this.background="black";this.flash=false}},{key:"setStyles",value:function G(M){var N=["foreground","underline","italics","background","flash"];for(var K=0;K<N.length;K++){var L=N[K];if(M.hasOwnProperty(L)){this[L]=M[L]}}}},{key:"isDefault",value:function F(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}},{key:"equals",value:function D(K){return this.foreground===K.foreground&&this.underline===K.underline&&this.italics===K.italics&&this.background===K.background&&this.flash===K.flash}},{key:"copy",value:function J(K){this.foreground=K.foreground;this.underline=K.underline;this.italics=K.italics;this.background=K.background;this.flash=K.flash}},{key:"toString",value:function I(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]);return H}();var n=function(){function D(K,O,P,M,N,L){i(this,D);this.uchar=K||" ";this.penState=new z(O,P,M,N,L)}v(D,[{key:"reset",value:function F(){this.uchar=" ";this.penState.reset()}},{key:"setChar",value:function I(K,L){this.uchar=K;this.penState.copy(L)}},{key:"setPenState",value:function G(K){this.penState.copy(K)}},{key:"equals",value:function E(K){return this.uchar===K.uchar&&this.penState.equals(K.penState)}},{key:"copy",value:function J(K){this.uchar=K.uchar;this.penState.copy(K.penState)}},{key:"isEmpty",value:function H(){return this.uchar===" "&&this.penState.isDefault()}}]);return D}();var t=function(){function E(){i(this,E);this.chars=[];for(var Q=0;Q<m;Q++){this.chars.push(new n())}this.pos=0;this.currPenState=new z()}v(E,[{key:"equals",value:function G(Q){var S=true;for(var R=0;R<m;R++){if(!this.chars[R].equals(Q.chars[R])){S=false;break}}return S}},{key:"copy",value:function F(Q){for(var R=0;R<m;R++){this.chars[R].copy(Q.chars[R])}}},{key:"isEmpty",value:function K(){var R=true;for(var Q=0;Q<m;Q++){if(!this.chars[Q].isEmpty()){R=false;break}}return R}},{key:"setCursor",value:function N(Q){if(this.pos!==Q){this.pos=Q}if(this.pos<0){C.log("ERROR","Negative cursor position "+this.pos);this.pos=0}else{if(this.pos>m){C.log("ERROR","Too large cursor position "+this.pos);this.pos=m}}}},{key:"moveCursor",value:function M(Q){var S=this.pos+Q;if(Q>1){for(var R=this.pos+1;R<S+1;R++){this.chars[R].setPenState(this.currPenState)}}this.setCursor(S)}},{key:"backSpace",value:function I(){this.moveCursor(-1);this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function H(Q){if(Q>=144){this.backSpace()}var R=q(Q);if(this.pos>=m){C.log("ERROR","Cannot insert "+Q.toString(16)+" ("+R+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(R,this.currPenState);this.moveCursor(1)}},{key:"clearFromPos",value:function P(Q){var R;for(R=Q;R<m;R++){this.chars[R].reset()}}},{key:"clear",value:function L(){this.clearFromPos(0);this.pos=0;this.currPenState.reset()}},{key:"clearToEndOfRow",value:function D(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function O(){var R=[];var S=true;for(var Q=0;Q<m;Q++){var T=this.chars[Q].uchar;if(T!==" "){S=false}R.push(T)}if(S){return""}else{return R.join("")}}},{key:"setPenStyles",value:function J(Q){this.currPenState.setStyles(Q);var R=this.chars[this.pos];R.setPenState(this.currPenState)}}]);return E}();var p=function(){function G(){i(this,G);this.rows=[];for(var U=0;U<l;U++){this.rows.push(new t())}this.currRow=l-1;this.nrRollUpRows=null;this.reset()}v(G,[{key:"reset",value:function P(){for(var U=0;U<l;U++){this.rows[U].clear()}this.currRow=l-1}},{key:"equals",value:function J(U){var W=true;for(var V=0;V<l;V++){if(!this.rows[V].equals(U.rows[V])){W=false;break}}return W}},{key:"copy",value:function F(U){for(var V=0;V<l;V++){this.rows[V].copy(U.rows[V])}}},{key:"isEmpty",value:function N(){var V=true;for(var U=0;U<l;U++){if(!this.rows[U].isEmpty()){V=false;break}}return V}},{key:"backSpace",value:function L(){var U=this.rows[this.currRow];U.backSpace()}},{key:"clearToEndOfRow",value:function D(){var U=this.rows[this.currRow];U.clearToEndOfRow()}},{key:"insertChar",value:function K(U){var V=this.rows[this.currRow];V.insertChar(U)}},{key:"setPen",value:function S(U){var V=this.rows[this.currRow];V.setPenStyles(U)}},{key:"moveCursor",value:function O(U){var V=this.rows[this.currRow];V.moveCursor(U)}},{key:"setCursor",value:function R(U){C.log("INFO","setCursor: "+U);var V=this.rows[this.currRow];V.setCursor(U)}},{key:"setPAC",value:function E(X){C.log("INFO","pacData = "+JSON.stringify(X));var W=X.row-1;if(this.nrRollUpRows&&W<this.nrRollUpRows-1){W=this.nrRollUpRows-1}this.currRow=W;var Z=this.rows[this.currRow];if(X.indent!==null){var V=X.indent;var U=Math.max(V-1,0);Z.setCursor(X.indent);X.color=Z.chars[U].penState.foreground}var Y={foreground:X.color,underline:X.underline,italics:X.italics,background:"black",flash:false};this.setPen(Y)}},{key:"setBkgData",value:function Q(U){C.log("INFO","bkgData = "+JSON.stringify(U));this.backSpace();this.setPen(U);this.insertChar(32)}},{key:"setRollUpRows",value:function M(U){this.nrRollUpRows=U}},{key:"rollUp",value:function I(){if(this.nrRollUpRows===null){C.log("DEBUG","roll_up but nrRollUpRows not set yet");return}C.log("TEXT",this.getDisplayText());var V=this.currRow+1-this.nrRollUpRows;var U=this.rows.splice(V,1)[0];U.clear();this.rows.splice(this.currRow,0,U);C.log("INFO","Rolling up")}},{key:"getDisplayText",value:function T(U){U=U||false;var X=[];var Z="";var W=-1;for(var V=0;V<l;V++){var Y=this.rows[V].getTextString();if(Y){W=V+1;if(U){X.push("Row "+W+": '"+Y+"'")}else{X.push(Y.trim())}}}if(X.length>0){if(U){Z="["+X.join(" | ")+"]"}else{Z=X.join("\n")}}return Z}},{key:"getTextAndFormat",value:function H(){return this.rows}}]);return G}();var k=function(){function J(ae,ad){i(this,J);this.chNr=ae;this.outputFilter=ad;this.mode=null;this.verbose=0;this.displayedMemory=new p();this.nonDisplayedMemory=new p();this.lastOutputScreen=new p();this.currRollUpRow=this.displayedMemory.rows[l-1];this.writeScreen=this.displayedMemory;this.mode=null;this.cueStartTime=null}v(J,[{key:"reset",value:function ac(){this.mode=null;this.displayedMemory.reset();this.nonDisplayedMemory.reset();this.lastOutputScreen.reset();this.currRollUpRow=this.displayedMemory.rows[l-1];this.writeScreen=this.displayedMemory;this.mode=null;this.cueStartTime=null;this.lastCueEndTime=null}},{key:"getHandler",value:function K(){return this.outputFilter}},{key:"setHandler",value:function W(ad){this.outputFilter=ad}},{key:"setPAC",value:function V(ad){this.writeScreen.setPAC(ad)}},{key:"setBkgData",value:function U(ad){this.writeScreen.setBkgData(ad)}},{key:"setMode",value:function Y(ad){if(ad===this.mode){return}this.mode=ad;C.log("INFO","MODE="+ad);if(this.mode==="MODE_POP-ON"){this.writeScreen=this.nonDisplayedMemory}else{this.writeScreen=this.displayedMemory;this.writeScreen.reset()}if(this.mode!=="MODE_ROLL-UP"){this.displayedMemory.nrRollUpRows=null;this.nonDisplayedMemory.nrRollUpRows=null}this.mode=ad}},{key:"insertChars",value:function H(af){for(var ae=0;ae<af.length;ae++){this.writeScreen.insertChar(af[ae])}var ad=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";C.log("INFO",ad+": "+this.writeScreen.getDisplayText(true));if(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP"){C.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(true));this.outputDataUpdate()}}},{key:"ccRCL",value:function N(){C.log("INFO","RCL - Resume Caption Loading");this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function I(){C.log("INFO","BS - BackSpace");if(this.mode==="MODE_TEXT"){return}this.writeScreen.backSpace();if(this.writeScreen===this.displayedMemory){this.outputDataUpdate()}}},{key:"ccAOF",value:function G(){return}},{key:"ccAON",value:function D(){return}},{key:"ccDER",value:function F(){C.log("INFO","DER- Delete to End of Row");this.writeScreen.clearToEndOfRow();this.outputDataUpdate()}},{key:"ccRU",value:function T(ad){C.log("INFO","RU("+ad+") - Roll Up");this.writeScreen=this.displayedMemory;this.setMode("MODE_ROLL-UP");this.writeScreen.setRollUpRows(ad)}},{key:"ccFON",value:function X(){C.log("INFO","FON - Flash On");this.writeScreen.setPen({flash:true})}},{key:"ccRDC",value:function ab(){C.log("INFO","RDC - Resume Direct Captioning");this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function M(){C.log("INFO","TR");this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function L(){C.log("INFO","RTD");this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function Q(){C.log("INFO","EDM - Erase Displayed Memory");this.displayedMemory.reset();this.outputDataUpdate()}},{key:"ccCR",value:function R(){C.log("CR - Carriage Return");this.writeScreen.rollUp();this.outputDataUpdate()}},{key:"ccENM",value:function aa(){C.log("INFO","ENM - Erase Non-displayed Memory");this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function P(){C.log("INFO","EOC - End Of Caption");if(this.mode==="MODE_POP-ON"){var ad=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory;this.nonDisplayedMemory=ad;this.writeScreen=this.nonDisplayedMemory;C.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function O(ad){C.log("INFO","TO("+ad+") - Tab Offset");this.writeScreen.moveCursor(ad)}},{key:"ccMIDROW",value:function Z(ad){var af={flash:false};af.underline=ad%2===1;af.italics=ad>=46;if(!af.italics){var ag=Math.floor(ad/2)-16;var ae=["white","green","blue","cyan","red","yellow","magenta"];af.foreground=ae[ag]}else{af.foreground="white"}C.log("INFO","MIDROW: "+JSON.stringify(af));this.writeScreen.setPen(af)}},{key:"outputDataUpdate",value:function E(){var ad=C.time;if(ad===null){return}if(this.outputFilter){if(this.outputFilter.updateData){this.outputFilter.updateData(ad,this.displayedMemory)}if(this.cueStartTime===null&&!this.displayedMemory.isEmpty()){this.cueStartTime=ad}else{if(!this.displayedMemory.equals(this.lastOutputScreen)){if(this.outputFilter.newCue){this.outputFilter.newCue(this.cueStartTime,ad,this.lastOutputScreen)}this.cueStartTime=this.displayedMemory.isEmpty()?null:ad}}this.lastOutputScreen.copy(this.displayedMemory)}}},{key:"cueSplitAtTime",value:function S(ad){if(this.outputFilter){if(!this.displayedMemory.isEmpty()){if(this.outputFilter.newCue){this.outputFilter.newCue(this.cueStartTime,ad,this.displayedMemory)}this.cueStartTime=ad}}}}]);return J}();var u=function(){function D(R,Q,P){i(this,D);this.field=R||1;this.outputs=[Q,P];this.channels=[new k(1,Q),new k(2,P)];this.currChNr=-1;this.lastCmdA=null;this.lastCmdB=null;this.bufferedData=[];this.startTime=null;this.lastTime=null;this.dataCounters={padding:0,__char:0,cmd:0,other:0}}v(D,[{key:"getHandler",value:function M(P){return this.channels[P].getHandler()}},{key:"setHandler",value:function L(Q,P){this.channels[Q].setHandler(P)}},{key:"addData",value:function H(S,W){var V,Q,P,U=false;this.lastTime=S;C.setTime(S);for(var R=0;R<W.length;R+=2){Q=W[R]&127;P=W[R+1]&127;if(Q===0&&P===0){this.dataCounters.padding+=2;continue}else{C.log("DATA","["+r([W[R],W[R+1]])+"] -> ("+r([Q,P])+")")}V=this.parseCmd(Q,P);if(!V){V=this.parseMidrow(Q,P)}if(!V){V=this.parsePAC(Q,P)}if(!V){V=this.parseBackgroundAttributes(Q,P)}if(!V){U=this.parseChars(Q,P);if(U){if(this.currChNr&&this.currChNr>=0){var T=this.channels[this.currChNr-1];T.insertChars(U)}else{C.log("WARNING","No channel found yet. TEXT-MODE?")}}}if(V){this.dataCounters.cmd+=2}else{if(U){this.dataCounters.__char+=2}else{this.dataCounters.other+=2;C.log("WARNING","Couldn't parse cleaned data "+r([Q,P])+" orig: "+r([W[R],W[R+1]]))}}}}},{key:"parseCmd",value:function I(Q,P){var U=null;var S=(Q===20||Q===28)&&32<=P&&P<=47;var R=(Q===23||Q===31)&&33<=P&&P<=35;if(!(S||R)){return false}if(Q===this.lastCmdA&&P===this.lastCmdB){this.lastCmdA=null;this.lastCmdB=null;C.log("DEBUG","Repeated command ("+r([Q,P])+") is dropped");return true}if(Q===20||Q===23){U=1}else{U=2}var T=this.channels[U-1];if(Q===20||Q===28){if(P===32){T.ccRCL()}else{if(P===33){T.ccBS()}else{if(P===34){T.ccAOF()}else{if(P===35){T.ccAON()}else{if(P===36){T.ccDER()}else{if(P===37){T.ccRU(2)}else{if(P===38){T.ccRU(3)}else{if(P===39){T.ccRU(4)}else{if(P===40){T.ccFON()}else{if(P===41){T.ccRDC()}else{if(P===42){T.ccTR()}else{if(P===43){T.ccRTD()}else{if(P===44){T.ccEDM()}else{if(P===45){T.ccCR()}else{if(P===46){T.ccENM()}else{if(P===47){T.ccEOC()}}}}}}}}}}}}}}}}}else{T.ccTO(P-32)}this.lastCmdA=Q;this.lastCmdB=P;this.currChNr=U;return true}},{key:"parseMidrow",value:function G(Q,P){var S=null;if((Q===17||Q===25)&&32<=P&&P<=47){if(Q===17){S=1}else{S=2}if(S!==this.currChNr){C.log("ERROR","Mismatch channel in midrow parsing");return false}var R=this.channels[S-1];R.ccMIDROW(P);C.log("DEBUG","MIDROW ("+r([Q,P])+")");return true}return false}},{key:"parsePAC",value:function O(Q,P){var W=null;var V=null;var U=(17<=Q&&Q<=23||25<=Q&&Q<=31)&&64<=P&&P<=127;var S=(Q===16||Q===24)&&64<=P&&P<=95;if(!(U||S)){return false}if(Q===this.lastCmdA&&P===this.lastCmdB){this.lastCmdA=null;this.lastCmdB=null;return true}W=Q<=23?1:2;if(64<=P&&P<=95){V=W===1?x[Q]:w[Q]}else{V=W===1?h[Q]:e[Q]}var R=this.interpretPAC(V,P);var T=this.channels[W-1];T.setPAC(R);this.lastCmdA=Q;this.lastCmdB=P;this.currChNr=W;return true}},{key:"interpretPAC",value:function N(S,R){var P=R;var Q={color:null,italics:false,indent:null,underline:false,row:S};if(R>95){P=R-96}else{P=R-64}Q.underline=(P&1)===1;if(P<=13){Q.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(P/2)]}else{if(P<=15){Q.italics=true;Q.color="white"}else{Q.indent=Math.floor((P-16)/2)*4}}return Q}},{key:"parseChars",value:function F(R,P){var S=null,V=null,U=null;if(R>=25){S=2;U=R-8}else{S=1;U=R}if(17<=U&&U<=19){var Q=P;if(U===17){Q=P+80}else{if(U===18){Q=P+112}else{Q=P+144}}C.log("INFO","Special char '"+q(Q)+"' in channel "+S);V=[Q]}else{if(32<=R&&R<=127){V=P===0?[R]:[R,P]}}if(V){var T=r(V);C.log("DEBUG","Char codes =  "+T.join(","));this.lastCmdA=null;this.lastCmdB=null}return V}},{key:"parseBackgroundAttributes",value:function K(R,P){var Q,S,W,V;var U=(R===16||R===24)&&32<=P&&P<=47;var T=(R===23||R===31)&&45<=P&&P<=47;if(!(U||T)){return false}Q={};if(R===16||R===24){S=Math.floor((P-32)/2);Q.background=y[S];if(P%2===1){Q.background=Q.background+"_semi"}}else{if(P===45){Q.background="transparent"}else{Q.foreground="black";if(P===47){Q.underline=true}}}W=R<24?1:2;V=this.channels[W-1];V.setBkgData(Q);this.lastCmdA=null;this.lastCmdB=null;return true}},{key:"reset",value:function J(){for(var P=0;P<this.channels.length;P++){if(this.channels[P]){this.channels[P].reset()}}this.lastCmdA=null;this.lastCmdB=null}},{key:"cueSplitAtTime",value:function E(Q){for(var P=0;P<this.channels.length;P++){if(this.channels[P]){this.channels[P].cueSplitAtTime(Q)}}}}]);return D}();B.__default=u},{}],41:[function(j,h,g){var e={newCue:function i(n,m,s,p){var w;var q;var l;var o;var v;var u=window.VTTCue||window.TextTrackCue;for(var k=0;k<p.rows.length;k++){w=p.rows[k];l=true;o=0;v="";if(!w.isEmpty()){for(var t=0;t<w.chars.length;t++){if(w.chars[t].uchar.match(/\s/)&&l){o++}else{v+=w.chars[t].uchar;l=false}}q=new u(m,s,v.trim());if(o>=16){o--}else{o++}if(navigator.userAgent.match(/Firefox\//)){q.line=k+1}else{q.line=k>7?k-2:k+1}q.align="left";q.position=100*(o/32)+(navigator.userAgent.match(/Firefox\//)?50:0);n.addCue(q)}}}};h.exports=e},{}],42:[function(j,h,e){Object.defineProperty(e,"__esModule",{value:true});var g=function(){function l(p,n){for(var m=0;m<n.length;m++){var o=n[m];o.enumerable=o.enumerable||false;o.configurable=true;if("value" in o){o.writable=true}Object.defineProperty(p,o.key,o)}}return function(o,m,n){if(m){l(o.prototype,m)}if(n){l(o,n)}return o}}();function k(l,m){if(!(l instanceof m)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function o(p){k(this,o);this.alpha_=p?Math.exp(Math.log(0.5)/p):0;this.estimate_=0;this.totalWeight_=0}g(o,[{key:"sample",value:function n(r,q){var p=Math.pow(this.alpha_,r);this.estimate_=q*(1-p)+p*this.estimate_;this.totalWeight_+=r}},{key:"getTotalWeight",value:function l(){return this.totalWeight_}},{key:"getEstimate",value:function m(){if(this.alpha_){var p=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/p}else{return this.estimate_}}}]);return o}();e.__default=i},{}],43:[function(g,h,j){Object.defineProperty(j,"__esModule",{value:true});var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol?"symbol":typeof r};function p(){}var k={trace:p,debug:p,log:p,warn:p,info:p,error:p};var e=k;function q(r,s){s="["+r+"] > "+s;return s}function n(r){var s=window.console[r];if(s){return function(){for(var t=arguments.length,u=Array(t),v=0;v<t;v++){u[v]=arguments[v]}if(u[0]){u[0]=q(r,u[0])}s.apply(window.console,u)}}return p}function m(t){for(var r=arguments.length,u=Array(r>1?r-1:0),s=1;s<r;s++){u[s-1]=arguments[s]}u.forEach(function(v){e[v]=t[v]?t[v].bind(t):n(v)})}var l=j.enableLogs=function l(r){if(r===true||(typeof r==="undefined"?"undefined":i(r))==="object"){m(r,"debug","log","info","warn","error");try{e.log()}catch(s){e=k}}else{e=k}};var o=j.logger=e},{}],44:[function(h,g,e){if(typeof ArrayBuffer!=="undefined"&&!ArrayBuffer.prototype.slice){ArrayBuffer.prototype.slice=function(o,k){var m=new Uint8Array(this);if(k===undefined){k=m.length}var j=new ArrayBuffer(k-o);var n=new Uint8Array(j);for(var l=0;l<n.length;l++){n[l]=m[l+o]}return j}}},{}],45:[function(i,h,e){Object.defineProperty(e,"__esModule",{value:true});var g=function(){function l(p,n){for(var m=0;m<n.length;m++){var o=n[m];o.enumerable=o.enumerable||false;o.configurable=true;if("value" in o){o.writable=true}Object.defineProperty(p,o.key,o)}}return function(o,m,n){if(m){l(o.prototype,m)}if(n){l(o,n)}return o}}();function j(l,m){if(!(l instanceof m)){throw new TypeError("Cannot call a class as a function")}}var k=function(){function m(){j(this,m)}g(m,null,[{key:"toString",value:function l(q){var p="",n=q.length;for(var o=0;o<n;o++){p+="["+q.start(o)+","+q.end(o)+"]"}return p}}]);return m}();e.__default=k},{}],46:[function(i,h,e){var k={buildAbsoluteURL:function j(n,o){o=o.trim();if(/^[a-z]+:/i.test(o)){return o}var l=null;var p=null;var t=/^([^#]*)(.*)$/.exec(o);if(t){p=t[2];o=t[1]}var w=/^([^\?]*)(.*)$/.exec(o);if(w){l=w[2];o=w[1]}var r=/^([^#]*)(.*)$/.exec(n);if(r){n=r[1]}var x=/^([^\?]*)(.*)$/.exec(n);if(x){n=x[1]}var s=/^(([a-z]+:)?\/\/[a-z0-9\.\-_~]+(:[0-9]+)?)?(\/.*)$/i.exec(n);if(!s){throw new Error("Error trying to parse base URL.")}var q=s[2]||"";var v=s[1]||"";var u=s[4];var m=null;if(/^\/\//.test(o)){m=q+"//"+k.buildAbsolutePath("",o.substring(2))}else{if(/^\//.test(o)){m=v+"/"+k.buildAbsolutePath("",o.substring(1))}else{m=k.buildAbsolutePath(v+u,o)}}if(l){m+=l}if(p){m+=p}return m},buildAbsolutePath:function g(s,m){var n=m;var r,o="",l=s.replace(/[^\/]*$/,n.replace(/(\/|^)(?:\.?\/+)+/g,"$1"));for(var q,p=0;q=l.indexOf("/../",p),q>-1;p=q+r){r=/^\/(?:\.\.\/)*/.exec(l.slice(q))[0].length;o=(o+l.substring(p,q)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(r-1)/3+"}$"),"/")}return o+l.substr(p)}};h.exports=k},{}],47:[function(j,i,g){Object.defineProperty(g,"__esModule",{value:true});var h=function(){function m(q,o){for(var n=0;n<o.length;n++){var p=o[n];p.enumerable=p.enumerable||false;p.configurable=true;if("value" in p){p.writable=true}Object.defineProperty(q,p.key,p)}}return function(p,n,o){if(n){m(p.prototype,n)}if(o){m(p,o)}return p}}();var k=j("../utils/logger");function l(m,n){if(!(m instanceof n)){throw new TypeError("Cannot call a class as a function")}}var e=function(){function o(u){l(this,o);if(u&&u.xhrSetup){this.xhrSetup=u.xhrSetup}}h(o,[{key:"destroy",value:function q(){this.abort();this.loader=null}},{key:"abort",value:function t(){var u=this.loader;if(u&&u.readyState!==4){this.stats.aborted=true;u.abort()}window.clearTimeout(this.requestTimeout);this.requestTimeout=null;window.clearTimeout(this.retryTimeout);this.retryTimeout=null}},{key:"load",value:function s(v,u,w){this.context=v;this.config=u;this.callbacks=w;this.stats={trequest:performance.now(),retry:0};this.retryDelay=u.retryDelay;this.loadInternal()}},{key:"loadInternal",value:function n(){var w,v=this.context;if(typeof XDomainRequest!=="undefined"){w=this.loader=new XDomainRequest()}else{w=this.loader=new XMLHttpRequest()}w.onloadend=this.loadend.bind(this);w.onprogress=this.loadprogress.bind(this);w.open("GET",v.url,true);if(v.rangeEnd){w.setRequestHeader("Range","bytes="+v.rangeStart+"-"+(v.rangeEnd-1))}w.responseType=v.responseType;var u=this.stats;u.tfirst=0;u.loaded=0;if(this.xhrSetup){this.xhrSetup(w,v.url)}this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout);w.send()}},{key:"loadend",value:function r(u){var C=u.currentTarget,y=C.status,A=this.stats,v=this.context,w=this.config;if(A.aborted){return}window.clearTimeout(this.requestTimeout);if(y>=200&&y<300){A.tload=Math.max(A.tfirst,performance.now());var z=void 0,B=void 0;if(v.responseType==="arraybuffer"){z=C.response;B=z.byteLength}else{z=C.responseText;B=z.length}A.loaded=A.total=B;var x={url:C.responseURL,data:z};this.callbacks.onSuccess(x,A,v)}else{if(A.retry>=w.maxRetry||y>=400&&y<499){k.logger.error(y+" while loading "+v.url);this.callbacks.onError({code:y,text:C.statusText},v)}else{k.logger.warn(y+" while loading "+v.url+", retrying in "+this.retryDelay+"...");this.destroy();this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay);this.retryDelay=Math.min(2*this.retryDelay,w.maxRetryDelay);A.retry++}}}},{key:"loadtimeout",value:function m(){k.logger.warn("timeout while loading "+this.context.url);this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function p(v){var u=this.stats;if(u.tfirst===0){u.tfirst=Math.max(performance.now(),u.trequest)}u.loaded=v.loaded;if(v.lengthComputable){u.total=v.total}var w=this.callbacks.onProgress;if(w){w(u,this.context,null)}}}]);return o}();g.__default=e},{"../utils/logger":43}]},{},[31])(31)})})(s7getCurrentNameSpace());