/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2016 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(c){c.pkg("s7sdk.search");c.Util.require("s7sdk.event.Event");if(!c.search.SearchManagerControl){c.search.SearchManagerControl=function(f){arguments.callee.superclass.apply(this,[f,c.search.SearchManagerControl.NS,f.constructor,c.search.SearchManager.RESTRICTED_STYLES])};c.search.SearchManagerControl.NS="s7sdk.search.SearchManagerControl";c.search.SearchManagerControl.prototype.setModifier=function(f){var g="";var n=this.component.getModifiers();var o={};for(var l in f){var p=l.toLowerCase();o[p]=f[l]}for(var j in n){var h=j.toLowerCase();var m;if(o[h]){if(h=="serverurl"){c.Logger.log(c.Logger.INFO,"s7sdk.search.SearchManager setModifier - unsupported modifier: %0",j);continue}m=o[h];if(h=="searchserverurl"&&m){g=this.component.searchServerUrl;this.component.searchServerUrl=m}this.dispatchEvent(new c.event.ControlComponentEvent(c.event.ControlComponentEvent.NOTF_CONTROLCOMPONENT_MODIFIERUPDATED,{id:this.component.getId(),oldvalue:g,newvalue:m,property:h},false))}}};c.search.SearchManagerControl.prototype.unload=function(){}}c.Class.inherits(c.search.SearchManagerControl.NS,"s7sdk.ControlComponent");if(!c.search.SearchManager){c.search.SearchManager=function SearchManager(f,h,g){var i=!!arguments[3];c.Logger.log(c.Logger.CONFIG,"s7sdk.search.SearchManager constructor - containerId: %0, settings: %1 , compId: %2",f,h,g);arguments.callee.superclass.apply(this,[g,f,"div","s7searchmanager",h,!i]);this.locale=this.getParam("locale","");if(this.serverUrl.lastIndexOf("/")!=(this.serverUrl.length-1)){this.serverUrl+="/"}if(this.searchServerUrl.lastIndexOf("/")!=(this.searchServerUrl.length-1)){this.searchServerUrl+="/"}this.mediaSet=null;this.msName=null;this.searchText="";this.arrResponses=[];this.createElement();if(!i){return new c.search.SearchManagerControl(this)}else{return this}};c.Class.inherits("s7sdk.search.SearchManager","s7sdk.UIComponent");c.search.SearchManager.prototype.symbols={};c.search.SearchManager.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},searchServerUrl:{params:["searchpath"],defaults:["/s7search/"]}};c.search.SearchManager.prototype.addEventListener=function(h,g,f){c.Logger.log(c.Logger.FINE,"s7sdk.search.SearchManager.addEventListener - type: %0, handler: %1, useCapture: %2",h,g.toString().substring(0,g.toString().indexOf("(")),f);this.superproto.addEventListener.apply(this,[h,g,f])};c.search.SearchManager.prototype.setMediaSet=function(f){this.mediaSet=f;this.msName=this.mediaSet.name;this.currentSearchResultsDesc=null;this.searchText="";this.arrResponses=[]};c.search.SearchManager.prototype.getMediaSet=function(){return this.mediaSet};c.search.SearchManager.prototype.getResults=function(f){if(!this.arrResponses[f]||!this.arrResponses[f].completed){return null}else{return this.arrResponses[f]}return null};c.search.SearchManager.prototype.getResultsForFrame=function(j,h){var g=this.getResults(j);if(g){for(var f=0;f<g.frameList.length;f++){if(h==g.frameList[f].idx){return g.frameList[f]}}}return null};c.search.SearchManager.prototype.getResultsForPage=function(k,j,h){var g=this.getResultsForFrame(k,j);if(g){for(var f=0;f<g.pageList.length;f++){if(h==g.pageList[f].idx){return g.pageList[f]}}}return null};c.search.SearchManager.prototype.getSearchQuery=function(m){if((m==null)||(m.trim()=="")){return null}var l=m.split('"');if(l.length%2==0){c.Logger.log(c.Logger.FINE,"getSearchQuery: wrong number of quotes ["+(l.length-1)+"] in search string ["+m+"], ignoring last quote.");l[l.length-2]+=l[l.length-1];l.pop()}var h=false;for(var g in l){if(l[g].trim()!=""){h=true;break}}if(!h){c.Logger.log(c.Logger.FINE,"getSearchQuery: all search tokens are empty, ignoring search.");return null}var k=new c.search.SearchResultsQuery(m);var n=false;for(var g=0;g<l.length;g++){if(n){if(l[g].trim()!=""){k.phraseList.push(l[g])}}else{var o=l[g].split(" ");for(var f=0;f<o.length;f++){if(o[f].trim()!=""){k.keywordList.push(o[f])}}}n=!n}return k};c.search.SearchManager.prototype.search=function(n){var m=this.getSearchQuery(n);if(n!=""&&this.searchServerUrl!=""){this.searchText=n}else{return}if(!this.arrResponses[this.searchText]||!this.arrResponses[this.searchText].completed){this.currentSearchResultsDesc=new c.search.SearchResultsDesc(n);this.arrResponses[this.searchText]=this.currentSearchResultsDesc}else{this.currentSearchResultsDesc=this.arrResponses[this.searchText];var k=new c.event.SearchEvent(c.event.SearchEvent.SEARCH_COMPLETED,null,this.currentSearchResultsDesc,true);c.Event.dispatch(this.obj,k,false);return}var h=this.searchServerUrl+"search?";if(c.Util.isNonEmptyString(this.locale)){h+="&locale="+this.locale}h+="&name="+this.msName;var l="";for(var g=0;g<m.keywordList.length;g++){m.keywordList[g]=encodeURIComponent(m.keywordList[g])}l=m.keywordList.join();h+="&keywords="+l;var o="";for(var f=0;f<m.phraseList.length;f++){m.phraseList[f]=encodeURIComponent(m.phraseList[f])}o=m.phraseList.join("|");h+="&phrases="+o;h+="&v=3";if(this.isReq){this.isReq.cancelHttpReq()}this.isReq=new c.IS();this.isReq.getHttpReq(h,this.searchCompleted,this.searchFailed,this)};c.search.SearchManager.prototype.searchCompleted=function(p,n){var q=[];for(var l in p){if(!p.hasOwnProperty(l)){continue}var f=new c.search.SearchResultsFrameDesc(parseInt(l));for(var g in p[l]){var m=new c.search.SearchResultsPageDesc(parseInt(g));for(var h=0;h<p[l][g].length;h++){m.objList.push(p[l][g][h])}f.pageList.push(m)}q.push(f)}n.currentSearchResultsDesc.frameList=q;n.currentSearchResultsDesc.completed=true;n.currentSearchResultsDesc.rsp=p;var o=new c.event.SearchEvent(c.event.SearchEvent.SEARCH_COMPLETED,null,n.currentSearchResultsDesc,true);c.Event.dispatch(n.obj,o,false)};c.search.SearchManager.prototype.searchFailed=function(f,h){c.Logger.log(c.Logger.WARNING,"s7sdk.search.SearchManager.searchFailed - response: %0",f);var g=new c.event.SearchEvent(c.event.SearchEvent.SEARCH_FAILED,null,null,true);c.Event.dispatch(h.obj,g,false)};c.search.SearchManager.prototype.setModifier=function(f){throw new Error("Trying to use setModifier on the Core class (SearchManager) is unsupported! Please refer to SDK documentation on using setModifier.")};c.search.SearchManager.prototype.cleanUp=function(){this.currentSearchResultsDesc=null;this.searchText="";this.arrResponses=[]};c.search.SearchManager.prototype.dispose=function(){this.cleanUp();if(this.isReq){this.isReq.cancelHttpReq();this.isReq=null}if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}}if(!c.search.SearchResultsQuery){c.search.SearchResultsQuery=function e(f){this.searchText=f;this.keywordList=[];this.phraseList=[];this.excludeWordList=[]}}if(!c.search.SearchResultsDesc){c.search.SearchResultsDesc=function a(f){this.searchText=f;this.frameList=[];this.completed=false};c.search.SearchResultsDesc.prototype.getHitCount=function(){var f=0;for(var h=0;h<this.frameList.length;h++){for(var g=0;g<this.frameList[h].pageList.length;g++){f+=this.frameList[h].pageList[g].objList.length}}return f}}if(!c.search.SearchResultsFrameDesc){c.search.SearchResultsFrameDesc=function d(f){this.idx=f;this.pageList=[]}}if(!c.search.SearchResultsPageDesc){c.search.SearchResultsPageDesc=function b(f){this.idx=f;this.objList=[];this.resolved=false}}})(s7getCurrentNameSpace());