/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(s7sdk){s7sdk.pkg("s7sdk.set");if(s7sdk.browser.name==="ie"&&(s7sdk.browser.version.major<9)){s7sdk.Util.require("s7sdk.image.rgn.View")}else{s7sdk.Util.require("s7sdk.image.View")}s7sdk.Util.require("s7sdk.event.InputController2");s7sdk.Util.require("s7sdk.common.Enumeration");s7sdk.Util.require("s7sdk.common.IS");s7sdk.Util.require("s7sdk.common.IconEffect");s7sdk.Util.require("s7sdk.event.Event");s7sdk.Util.require("s7sdk.common.ItemDesc");s7sdk.Util.require("s7sdk.set.SlideAnimation");if(!s7sdk.set.PageViewControl){s7sdk.set.PageViewControl=function(component){arguments.callee.superclass.apply(this,[component,s7sdk.set.PageViewControl.NS,component.constructor,s7sdk.set.PageView.RESTRICTED_STYLES])};s7sdk.set.PageViewControl.NS="s7sdk.set.PageViewControl";s7sdk.set.PageViewControl.prototype.rebuild=function(mods){var idx=this.component.getCurrentFrameIndex();this.superproto.rebuild.apply(this,[mods]);this.component.setCurrentFrameIndex(idx)}}s7sdk.Class.inherits(s7sdk.set.PageViewControl.NS,"s7sdk.ControlComponent");if(!s7sdk.set.PageView){s7sdk.set.PageView=function PageView(container,settings,compId){var useCore=!!arguments[3];s7sdk.Logger.log(s7sdk.Logger.CONFIG,"s7sdk.set.PageView constructor - container: %0, settings: %1 , compId: %2",container,settings,compId);compId=(typeof compId=="string"&&compId.length)?compId:"PageView_"+s7sdk.Util.createUniqueId();arguments.callee.superclass.apply(this,[compId,container,"div","s7pageview",settings]);this.container=this.getParent();this.assetIsChanged=false;this.test=this.getParam("test","");if(this.serverUrl.lastIndexOf("/")!=(this.serverUrl.length-1)){this.serverUrl+="/"}this.wid=this.stagesize.width;this.hei=this.stagesize.height;if(this.wid==0||this.hei==0){this.wid=this.size.width;this.hei=this.size.height}if(this.frametransition.transition=="auto"){this.frametransition.transition=s7sdk.browser.device.name=="desktop"?"turn":"slide"}this.startupFrame=0;if(this.wid==0||this.hei==0){this.wid=parseInt(s7sdk.Util.css.getCss("s7pageview","width",compId,null,this.container));this.hei=parseInt(s7sdk.Util.css.getCss("s7pageview","height",compId,null,this.container));if(!s7sdk.Util.isNumber(this.wid)||!s7sdk.Util.isNumber(this.hei)||this.wid<=0||this.hei<=0){if("clientHeight" in this.container&&"clientWidth" in this.container){this.wid=this.container.clientWidth;this.hei=this.container.clientHeight}if(this.wid==0||this.hei==0){this.wid=400;this.hei=400}}}if(this.iscommand==""){this.iscommand=this.modifier}this.locale=this.getParam("locale","");this.dir=this.direction=="auto"?this.locale=="ja":this.direction!="left";this.bgColor=s7sdk.Util.css.getCss("s7pageview","background-color",this.id,null,this.container);this.bgColor=s7sdk.Util.convertColor(this.bgColor,"flash");this.clickToZoom=0;if((/reset/i).test(this.singleclick)){this.clickToZoom|=s7sdk.Enum.CLICK_STATE.CLICK_TO_RESET}if((/zoom/i).test(this.singleclick)){this.clickToZoom|=s7sdk.Enum.CLICK_STATE.CLICK_TO_ZOOM}if((/reset/i).test(this.doubleclick)){this.clickToZoom|=s7sdk.Enum.CLICK_STATE.DOUBLE_CLICK_TO_RESET}if((/zoom/i).test(this.doubleclick)){this.clickToZoom|=s7sdk.Enum.CLICK_STATE.DOUBLE_CLICK_TO_ZOOM}if(this.enableHD.enable.toLowerCase()=="always"){this.enableHD.maxHdPixels=-1}else{if(this.enableHD.enable.toLowerCase()=="never"){this.enableHD.maxHdPixels=0}else{if(this.enableHD.enable.toLowerCase()=="limit"){if(NaN==this.enableHD.maxHdPixels){this.enableHD.maxHdPixels=2250000}else{this.enableHD.maxHdPixels=this.enableHD.maxHdPixels*this.enableHD.maxHdPixels}}else{this.enableHD.maxHdPixels=2250000}}}this.devicePixelRatio=s7sdk.Util.adjustDevicePixelRatio(this.enableHD.maxHdPixels,this.hei,this.wid);this.viewProps=new Object();this.viewProps.fmt=this.fmt;this.viewProps.outHeight=this.hei*this.devicePixelRatio;this.viewProps.outWidth=this.wid*this.devicePixelRatio;this.viewProps.resetHeight=this.hei*this.devicePixelRatio;this.viewProps.resetWidth=this.wid*this.devicePixelRatio;this.viewProps.zoomStep=this.zoomStep.step;this.viewProps.limit=this.zoomStep.limit;this.viewProps.transitionTime=this.transition.time;this.viewProps.transitionEasing=this.transition.easing;this.viewProps.bgColor=this.bgColor;this.viewProps.elasticZoom=this.elasticZoom;this.viewProps.clickToZoom=this.clickToZoom;this.totalWidth_=this.wid;this.totalHeight_=this.hei;this.pageFrames=null;this.createElement();if(this.container.tagName=="DIV"&&(!this.container.style.position||this.container.style.position=="static")){this.container.style.position="relative"}this.uid=s7sdk.Util.createUniqueId();this.container3=this.prepareDiv();this.container3.id="container3_"+this.uid;this.container3.setWidth(this.totalWidth_*3);this.container3.setHeight(this.totalHeight_);this.container3.style.zIndex=0;this.container3.style.position="absolute";this.container3.style.left=-this.totalWidth_+"px";this.container3.style.top=0+"px";this.obj.appendChild(this.container3);this.spacing=0;this.tempDisplay=new s7sdk.set.PVViewWrapper(this,1,1,0,this.hei,0,this.spacing,900,this.devicePixelRatio);this.dLeft=new s7sdk.set.PVViewWrapper(this,this.wid,this.hei,this.wid,this.hei,0,this.spacing,900,this.devicePixelRatio);this.dCenter=new s7sdk.set.PVViewWrapper(this,this.wid,this.hei,this.wid,this.hei,1,this.spacing,910,this.devicePixelRatio);this.dRight=new s7sdk.set.PVViewWrapper(this,this.wid,this.hei,this.wid,this.hei,2,this.spacing,920,this.devicePixelRatio);this.dLeft.obj.id="left"+this.uid;this.dCenter.obj.id="center"+this.uid;this.dRight.obj.id="right"+this.uid;this.container3.appendChild(this.tempDisplay.obj);this.container3.appendChild(this.dLeft.obj);this.container3.appendChild(this.dCenter.obj);this.container3.appendChild(this.dRight.obj);this.maxload=parseInt(this.maxloadradius);switch(this.frametransition.transition){case"fade":this.dLeft.obj.style.left=this.totalWidth_+"px";break;case"slide":this.maxload=this.maxload==0?1:this.maxload;break;case"turn":if(s7sdk.browser.name==="ie"&&(s7sdk.browser.version.major<9)){this.frametransition.transition="slide"}else{if(/xoom/i.test(navigator.userAgent.toLowerCase())){this.frametransition.transition="slide"}else{if(s7sdk.browser.device.name=="android"&&s7sdk.browser.device.version=="2"){this.frametransition.transition="slide"}else{this.maxload=this.maxload==0?1:this.maxload;this.prevd={}}}}break;case"default":}this.attachToContainer();this.addIE78overlay();if(this.frametransition.transition=="turn"){this.pageturnstyle.transition="turn";this.pageturnstyle.borderColor=s7sdk.Util.convertColor("#"+this.pageturnstyle.borderColor,"rgb");this.pageturnstyle.fillColor=s7sdk.Util.convertColor("#"+this.pageturnstyle.fillColor,"rgb");this.pageTurn=new s7sdk.set.RotFn(this.ovrl,this.obj,this.devicePixelRatio,this.dCenter,this.pageturnstyle);this.pageTurn.bindImages(this.dLeft.displayElement,this.dCenter.displayElement,this.dRight.displayElement)}this.loader=new s7sdk.set.PageFrameLoader(this);this.mediaSet_=null;this.isReq_=null;this.frame_=0;this.added=false;this.prevFrameIdx_=-1;this.currentFrame=null;this.iconEffectObj=new s7sdk.IconEffect(this,this.iconEffect.enabled,this.iconEffect.count,this.iconEffect.fade,this.iconEffect.autoHide);this.iconEffectObj.iconEffectDiv_.style.zIndex=1000;this.iconEffectVisible=true;this.iconEffectVisibility={show:function(){self.iconEffectVisible=true;self.checkIconEffect()},hide:function(){self.iconEffectVisible=false;self.checkIconEffect()}};this.isNewLayout=true;this.splitFrames={orientation:false};this.setAsset(this.asset);this.isFirst=true;this.createPageFramesTimeoutId=null;if(!useCore){return new s7sdk.set.PageViewControl(this)}else{return this}};s7sdk.Class.inherits("s7sdk.set.PageView","s7sdk.UIComponent");s7sdk.set.PageView.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},asset:{params:["asset"],defaults:[""],parseParams:false},aemmode:{params:["value"],defaults:[false],ranges:[[true,false]]},direction:{params:["direction"],defaults:["auto"],ranges:[["auto","left","right"]]},maxloadradius:{params:["value"],defaults:[1],ranges:["-1:"]},iscommand:{params:["value"],defaults:[""],parseParams:false},zoomStep:{params:["step","limit"],defaults:[1,1]},transition:{params:["time","easing"],defaults:[0.5,0],ranges:["0:","0:5"]},singleclick:{params:["singleclick"],defaults:["none"],ranges:[["none","zoom","reset","zoomReset"]]},doubleclick:{params:["doubleclick"],defaults:["zoomReset"],ranges:[["none","zoom","reset","zoomReset"]]},iconEffect:{params:["enabled","count","fade","autoHide"],defaults:[true,1,0.3,3],ranges:[,"-1:","0:","0:"]},enableHD:{params:["enable","maxHdPixels"],defaults:["limit",1500],ranges:[["always","never","limit"],"0:"]},frametransition:{params:["transition","duration"],defaults:["slide",0.3],ranges:[["slide","fade","turn","none","auto"],"0:"]},pageturnstyle:{params:["dividerWidth","dividerColor","dividerOpacity","borderOnOff","borderColor","fillColor"],defaults:[40,"909090",1,true,"909090","ffffff"]},stagesize:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"],deprecated:true},size:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"],deprecated:true},modifier:{params:["modifier"],defaults:[""],deprecated:true},elasticZoom:{params:["elasticzoom"],defaults:[0],ranges:["0.0:1.0"],deprecated:true},fmt:{params:["fmt"],defaults:["jpg"],ranges:[["jpg","jpeg","png","png-alpha","gif","gif-alpha"]]},highResTileLimit:{params:["highResTileLimit"],defaults:[-1],deprecated:true}};s7sdk.set.PageView.RESTRICTED_STYLES={s7pageview:["width","height"],"s7pageview s7iconeffect":["width","height"]};s7sdk.set.PageView.prototype.addIE78overlay=function(){var ovrl=document.createElement("div");ovrl.className="s7pageview";ovrl.style.position="absolute";ovrl.style.border="none";ovrl.style.padding="0px";ovrl.style.margine="0px";ovrl.style.left="0px";ovrl.style.top="0px";ovrl.style.left="0px";ovrl.style.width=this.wid+"px";ovrl.style.height=this.hei+"px";ovrl.style.backgroundColor="rgb(0,0,0)";ovrl.style.filter="alpha(opacity =0)";ovrl.style.zIndex=915;ovrl.style.opacity=0;this.ovrl=ovrl;this.obj.appendChild(ovrl);if(this.frametransition.transition=="turn"){this.leftTurn=this.createTurnHitArea(true);this.rightTurn=this.createTurnHitArea(false);this.rightTurn.style.zIndex=this.leftTurn.style.zIndex=ovrl.style.zIndex+1}};s7sdk.set.PageView.prototype.createTurnHitArea=function(isLeft){this.sensArea=40;var turn=document.createElement("div");turn.style.position="absolute";turn.style.width=this.sensArea+"px";turn.style.height="100%";turn.isLeft=isLeft;this.obj.appendChild(turn);var self=this;this.onMouseoverHandlerLeft=function(event){if(self.currentFrame&&self.currentFrame.view&&self.currentFrame.idx!=0){self.onMouseover(event)}};this.onMouseoverHandlerNotLeft=function(event){if(self.currentFrame&&self.currentFrame.view&&self.currentFrame.idx!=(self.pageFrames.length-1)){self.onMouseover(event)}};this.onMouseoutHandler=function(event){if(self.currentFrame&&self.currentFrame.view){self.onMouseout(event)}};this.onMousemoveTurnHandler=function(event){if(self.currentFrame&&self.currentFrame.view){self.onMousemoveTurn(event)}};if(isLeft){turn.style.left="0px";s7sdk.Event.addDOMListener(turn,"mouseover",this.onMouseoverHandlerLeft,true);s7sdk.Event.addDOMListener(turn,"touchstart",this.onMouseoverHandlerLeft,true)}else{turn.style.right="0px";s7sdk.Event.addDOMListener(turn,"mouseover",this.onMouseoverHandlerNotLeft,true);s7sdk.Event.addDOMListener(turn,"touchstart",this.onMouseoverHandlerNotLeft,true)}s7sdk.Event.addDOMListener(turn,"mouseout",this.onMouseoutHandler,true);s7sdk.Event.addDOMListener(turn,"mousemove",this.onMousemoveTurnHandler,true);return turn};s7sdk.set.PageView.prototype.checkIconEffect=function(){if(this.iconEffectObj&&this.iconEffectObj.enabled){if(!this.iconEffectVisible||(this.currentFrame&&this.currentFrame.view&&(this.currentFrame.view.state&4))){this.iconEffectObj.hide()}else{if(this.iconEffectVisible){this.iconEffectObj.show(this.wid,this.hei)}}}};s7sdk.set.PageView.prototype.setupInputController=function(){var self=this;this.handler=new s7sdk.event.InputController2(this.obj);this.handler.singleTapCallback=function(event,x,y){if(self.frametransition.transition=="turn"&&self.animate&&self.animate.inTransition){return}if(event.targetNode==self.leftTurn||event.targetNode==self.rightTurn){var pos=s7sdk.Util.getObjPos(event.targetNode);var dx=x-pos.x;var dy=y-pos.y;if(dy<self.pageTurn.sensativeRadius||dy>(event.targetNode.offsetHeight-self.pageTurn.sensativeRadius)){if(event.targetNode==self.leftTurn){self.prevPage()}else{self.nextPage()}}else{event.stopPropagation=event.preventDefault=null;self.mouseIsDownTurn=false;self.pageTurn.prev={};if(!event.touches[0]||typeof(event.touches[0].pageX)=="undefined"){event.touches[0]={pageX:x,pageY:y}}self.onMouseover(event)}return}self.doTapAction(x,y,event.shiftKey,false);s7sdk.Event.dispatch(self.obj,s7sdk.Event.CLICK,false)};this.handler.doubleTapCallback=function(event,x,y){if(event.targetNode==self.leftTurn||event.targetNode==self.rightTurn){return}self.doTapAction(x,y,event.shiftKey,true)};this.handler.startTouchCallback=function(event,x,y){var view=self.getCurrentView();if(view){self.dragStarted=false;self.startX=x;self.startY=y;self.detectEventOwner=true;self.componentOwnsEvent=true;self.startScrollX=window.scrollX;self.startScrollY=window.scrollY;var state=view.state;self.isStartLeft=!(state&16);self.isStartRight=!(state&32);if(self.frametransition.transition=="turn"&&self.animate&&self.animate.inTransition){return}self.mouseDown(x,y)}};this.handler.endTouchCallback=function(event,x,y){self.mouseUp(x,y,new Date().getTime())};this.handler.swipeCallback=function(swipeDir){var view=self.getCurrentView();if(view){if(!(view.state&4)){}else{view.inPan=false;view.doPan(0,0,false);self.invalidate();var userEvent=new s7sdk.UserEvent(s7sdk.UserEvent.PAN,[],true);s7sdk.Event.dispatch(self.obj,userEvent,false)}self.setInPan(false)}};this.handler.dragCallback=function(event,x,y,diffX,diffY){var view=self.getCurrentView();if(self.pageTurn&&self.pageTurn.obj.style.display!="none"&&(view.state&4)!=4){event.preventDefault();self.mouseMove(x,y,new Date().getTime());view.inPan=false;return}if(self.detectEventOwner&&(self.startScrollX!=window.scrollX||self.startScrollY!=window.scrollY)){self.componentOwnsEvent=false;self.detectEventOwner=false}if(view){if(view.state&4){var state=view.state;var absXgtY=Math.abs(diffX)>Math.abs(diffY);if((!(state&128)&&diffY<=0&&!absXgtY)||(!(state&64)&&diffY>=0&&!absXgtY)){if(self.detectEventOwner){self.componentOwnsEvent=false;self.detectEventOwner=false}}else{if(self.detectEventOwner){if(self.isStartLeft){if(!(state&16)){if(diffX>0&&absXgtY){self.dragStarted=true}else{self.isStartLeft=false}}}if(self.isStartRight){if(!(state&32)){if(diffX<0&&absXgtY){self.dragStarted=true}else{self.isStartRight=false}}}}if(self.componentOwnsEvent){if(self.dragStarted){self.detectEventOwner=false;if(!(self.frametransition.transition!="slide"&&(self.isStartLeft||self.isStartRight))){event.preventDefault();self.mouseMove(x,y,new Date().getTime())}view.inPan=false;self.setInPan(self.frametransition.transition=="slide"?true:false)}else{if(!self.isStartLeft&&!self.isStartRight){self.detectEventOwner=false;event.preventDefault();view.inPan=true;view.doPan(diffX,diffY,true);self.setInPan(true)}}}}}else{if(self.detectEventOwner){var dx=Math.abs(self.startX-x);var dy=Math.abs(self.startY-y);var cancheck=(dx>0)||(dy>0);self.blockIfEdgeL=false;self.blockIfEdgeR=false;if(cancheck){self.componentOwnsEvent=!((view.idx==0&&(self.startX-x)<0)||(view.idx==(self.items.length-1)&&(self.startX-x)>0));if(self.frametransition.transition=="slide"){self.componentOwnsEvent=(dx>dy)&&self.componentOwnsEvent}else{if(self.frametransition.transition=="turn"){self.detectEventOwner=false;if(event.targetNode==self.leftTurn){if(view.idx==0){self.blockIfEdgeL=true;self.componentOwnsEvent=dx>dy&&(self.startX-x)>0}else{self.componentOwnsEvent=true}}else{if(event.targetNode==self.rightTurn){if(view.idx==(self.items.length-1)){self.blockIfEdgeR=true;self.componentOwnsEvent=dx>dy&&(self.startX-x)<0}else{self.componentOwnsEvent=true}}else{if(view.idx==0){self.componentOwnsEvent=dx>dy&&(self.startX-x)>0}else{if(view.idx==(self.items.length-1)){self.componentOwnsEvent=dx>dy&&(self.startX-x)<0}else{self.componentOwnsEvent=dx>dy}}}}}else{self.componentOwnsEvent=true;self.detectEventOwner=false}}}else{return}}if(self.frametransition.transition=="turn"){if(self.blockIfEdgeL){if(self.componentOwnsEvent){event.preventDefault()}return}else{if(self.blockIfEdgeR){if(self.componentOwnsEvent){event.preventDefault()}return}}}if(self.componentOwnsEvent){self.detectEventOwner=false;if(self.frametransition.transition=="turn"){event.preventDefault()}else{if(self.frametransition.transition!="slide"){if(self.animate&&self.animate.inTransition){event.preventDefault();return}else{if(self.mouseIsDownTurn){event.preventDefault()}else{return}}}else{event.preventDefault()}}self.mouseMove(x,y,new Date().getTime());view.inPan=false;self.setInPan(self.frametransition.transition=="slide"?true:false)}}}};this.handler.endDragCallback=function(event,x,y,diffX,diffY){var view=self.getCurrentView();if(view&&view.inPan){view.inPan=false;view.doPan(0,0,false);self.invalidate();var userEvent=new s7sdk.UserEvent(s7sdk.UserEvent.PAN,[],true);s7sdk.Event.dispatch(self.obj,userEvent,false);self.setInPan(false)}};this.handler.pinchCallback=function(event,x,y,scale){var view=self.getCurrentView();if(view){x-=s7sdk.Util.getObjPos(self.obj).x;y-=s7sdk.Util.getObjPos(self.obj).y;view.inPinch=true;view.pinchZoom(x,y,scale,view.viewToImage)}};this.handler.endPinchCallback=function(event,x,y,scale){var view=self.getCurrentView();if(view){view.inPinch=false;view.invalidate(false);self.invalidate();self.sendZoomEvent()}};if(this.leftTurn){this.handler.attach(this.leftTurn);this.handler.attach(this.rightTurn)}};s7sdk.set.PageView.prototype.doTapAction=function(x,y,shiftKey,isDoubleTap){var view=this.getCurrentView();if(view){var canZoom=isDoubleTap?s7sdk.Enum.CLICK_STATE.DOUBLE_CLICK_TO_ZOOM:s7sdk.Enum.CLICK_STATE.CLICK_TO_ZOOM;var canReset=isDoubleTap?s7sdk.Enum.CLICK_STATE.DOUBLE_CLICK_TO_RESET:s7sdk.Enum.CLICK_STATE.CLICK_TO_RESET;x-=s7sdk.Util.getObjPos(this.obj).x;y-=s7sdk.Util.getObjPos(this.obj).y;if(this.clickToZoom&canZoom){if(this.clickToZoom&canReset&&!(view.state&1)){view.zoomReset()}else{view.zoomClick(x,y,shiftKey)}}else{if(this.clickToZoom&canReset){view.zoomReset()}}}this.mouseIsDownTurn=false};s7sdk.set.PageView.prototype.onMouseover=function(event){if(this.animate&&this.animate.inTransition){return}this.mouseIsOver=false;var view=this.getCurrentView();if(view){if(!(view.state&4)){if(!this.mouseIsDownTurn){this.pageTurn.clearDivider();var dxy=this.getPos(event);dxy=this.pageTurn.getFixedPointer(dxy);dxy.x=dxy.x*this.devicePixelRatio;dxy.y=dxy.y*this.devicePixelRatio;this.pageTurn.divPrepare(dxy);if(this.container3.style.display!="none"){this.obj.style.overflow="";this.pageTurn.obj.style.display="";this.container3.style.display="none";this.mouseIsOver=true;this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_START)}}}}};s7sdk.set.PageView.prototype.onMousemoveTurn=function(event){var view=this.getCurrentView();if(view){if(!(view.state&4)){if(this.mouseIsOver||this.mouseIsDownTurn){var dxy=this.getPos(event);var flipMode=this.pageTurn.flipMode;dxy=this.pageTurn.getFixedPointer(dxy);if((dxy.flipMode&1)!=(flipMode&1)){this.pageTurn.flipMode=flipMode}dxy.x=dxy.x*this.devicePixelRatio;dxy.y=dxy.y*this.devicePixelRatio;this.pageTurn.setCurrentPosition(dxy)}}}};s7sdk.set.PageView.prototype.getPos=function(e){s7sdk.Event.preventDefault(e);s7sdk.Event.stopPropagation(e);var ofs=s7sdk.Util.getScrollXY();var fullscreenElement=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement;if(fullscreenElement){ofs.x=0;ofs.y=0}var dxy={};if(e.touches){dxy.x=e.touches[0].pageX;dxy.y=e.touches[0].pageY}else{dxy.x=e.clientX+ofs.x;dxy.y=e.clientY+ofs.y}this.pageTurn.translateToAnchor(dxy);return dxy};s7sdk.set.PageView.prototype.onMouseout=function(event){this.mouseIsOver=false;if(this.animate&&this.animate.inTransition){return}var view=this.getCurrentView();if(view){if(!(view.state&4)){if(!this.mouseIsDownTurn){this.obj.style.overflow="hidden";this.pageTurn.obj.style.display="none";this.container3.style.display="";this.pageTurn.finalStep(true,true,true);this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_END)}}}};s7sdk.set.PageView.prototype.mouseMove=function(x,y,timeStamp){if(this.frametransition.transition=="slide"){var nxtX=(-this.totalWidth_+x-this.lastX);if((this.currentFrame.idx==(this.pageFrames.length-1))&&(x-this.lastX)<0){nxtX=-this.totalWidth_}else{if(this.currentFrame.idx==0&&(x-this.lastX)>0){nxtX=-this.totalWidth_}else{if(Math.abs(x-this.lastX)>this.totalWidth_){nxtX=nxtX>0?0:-2*this.totalWidth_}}}this.containerMove(nxtX)}else{if(this.frametransition.transition=="turn"){if(this.animate&&this.animate.inTransition||!this.mouseIsDownTurn){return}this.prevd.x=x;this.prevd.y=y;var fullscreenElement=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement;var dxy={x:x,y:y};var ofs=s7sdk.Util.getScrollXY();if(!fullscreenElement){this.pageTurn.translateToAnchor(dxy)}else{dxy.x-=ofs.x;dxy.y-=ofs.y}dxy.x=dxy.x*this.devicePixelRatio;dxy.y=dxy.y*this.devicePixelRatio;if(this.mouseIsDownTurn){this.pageTurn.setCurrentPosition(dxy)}}}this.mouseInmove=true};s7sdk.set.PageView.prototype.mouseDown=function(x,y){var instance=this;this.__mouseUp=function(e){instance.onDocumentClicked(e)};this.__mouseTouchend=function(e){instance.onDocumentClicked(e)};s7sdk.Event.removeDOMListener(document,"mouseup",this.__mouseUp,true);s7sdk.Event.removeDOMListener(document,"touchend",this.__mouseTouchend,true);s7sdk.Event.addDOMListener(document,"mouseup",this.__mouseUp,true);s7sdk.Event.addDOMListener(document,"touchend",this.__mouseTouchend,true);var dt=new Date();this.startTimeChk=dt.getTime();this.mouseInmove=false;this.lastX=x;this.lastY=y;s7sdk.Logger.log(s7sdk.Logger.FINEST,"s7sdk.set.PageView.mouseDown - x: %0, y: %1",x,y);this.mouseIsDown=true;if(this.mouseIsOver){this.mouseIsDownTurn=true;this.mouseInmove=s7sdk.browser.device.name=="desktop"}return false};s7sdk.set.PageView.prototype.onDocumentClicked=function(e){var inst=this;this.timerMouseUpCheck=setTimeout(function(){inst.mouseUpCheck()},0)};s7sdk.set.PageView.prototype.mouseUpCheck=function(){if(this.mouseIsDown){this.mouseUp(this.lastX,this.lastY,new Date().getTime());this.handler.stop(this.dCenter.displayElement);this.currentFrame.view.inPan=false;this.currentFrame.invalidate()}else{}};s7sdk.set.PageView.prototype.mouseUp=function(x,y,timeStamp){s7sdk.Event.removeDOMListener(document,"mouseup",this.__mouseUp,true);s7sdk.Event.removeDOMListener(document,"touchend",this.__mouseTouchend,true);if(this.mouseInmove){var newfr;if(this.frametransition.transition=="slide"){if(typeof(this.animate)=="undefined"){this.animate=new s7sdk.set.SlideAnimation(this,this.frametransition.duration)}var pos=parseFloat(this.container3.style.left.replace("px",""));var step;var frameToLoad;var chkpos=pos+this.totalWidth_;var dx=this.lastX-x;var switchPage=(timeStamp-this.startTimeChk)<150&&this.mouseInmove&&Math.abs(dx)>1;if(Math.abs(chkpos)>(this.totalWidth_/2+10)||switchPage){if(switchPage){chkpos=-dx}if(chkpos<0){step=pos/this.totalWidth_+1;newfr=this.getFrameByIdx(this.currentFrame.idx+1)}else{step=-(pos+this.totalWidth_)/this.totalWidth_;newfr=this.getFrameByIdx(this.currentFrame.idx-1)}if((!(this.currentFrame.idx==0&&(newfr.idx==this.pageFrames.length-1))&&!(this.currentFrame.idx==(this.pageFrames.length-1)&&newfr.idx==0))||(this.pageFrames.length==2)){this.nextFrame=newfr;this.loader.processed.idx=this.nextFrame.idx;this.animate.startTransition(this.nextFrame.idx<this.currentFrame.idx,Math.abs(step),false);this.animate.custom=true}}else{if(chkpos>0){step=pos/this.totalWidth_+1;this.animate.startTransition(false,1-Math.abs(step),true);this.animate.custom=true}else{step=-(pos+this.totalWidth_)/this.totalWidth_;this.animate.startTransition(true,1-Math.abs(step),true);this.animate.custom=true}}}else{if(this.frametransition.transition=="turn"){if(this.mouseIsDownTurn){this.mouseIsOver=false;this.mouseInmove=false;if(typeof(this.animate)=="undefined"){this.animate=new s7sdk.set.SlideAnimation(this,this.frametransition.duration)}var dest=this.pageTurn.calcAutoAngel();this.pageTurn.flipMode=dest.flipMode;this.animate.startTransition((dest.flipMode&1)==0,dest.step,dest.reverse);if(!dest.reverse){newfr=this.getFrameByIdx(this.currentFrame.idx+(dest.flipMode&1?1:-1));this.nextFrame=newfr;this.loader.processed.idx=this.nextFrame.idx;this.animate.custom=true}}this.mouseIsDownTurn=false}}}this.mouseInmove=false;this.mouseIsDown=false};s7sdk.set.PageView.prototype.getCurrentView=function(){return this.currentFrame&&this.currentFrame.view};s7sdk.set.PageView.prototype.createCanvas=function(idObj){var displayElement=s7sdk.browser.name==="ie"&&(s7sdk.browser.version.major<9)?s7sdk.rgn.View.createDisplay():s7sdk.View.createDisplay();displayElement.id=idObj;displayElement.width=this.wid*this.devicePixelRatio;displayElement.height=this.hei*this.devicePixelRatio;displayElement.style.position="absolute";displayElement.style.width=this.wid+"px";displayElement.style.height=this.hei+"px";displayElement.onselectstart=function(){return false};this.obj.appendChild(displayElement);return displayElement};s7sdk.set.PageView.prototype.loadAsset=function(){s7sdk.Logger.log(s7sdk.Logger.INFO,"s7sdk.set.PageView.loadAsset");var tReq=s7sdk.MediaSetParser.parseAssetForSetReq(this.assetName_);this.imageModifier=tReq.mod;var req=this.serverUrl+"/"+tReq.req;if(s7sdk.Util.isNonEmptyString(this.locale_)){req+="&locale="+this.locale_}if(this.isReq){this.isReq.cancelHttpReq()}this.isReq_=new s7sdk.IS(this.serverUrl,this.assetName_);this.isReq_.getHttpReq(req,function(rsp,viewObj){s7sdk.set.PageView.prototype.setRequestComplete.apply(viewObj,[rsp])},function(rsp,viewObj){s7sdk.set.PageView.prototype.setRequestError.apply(viewObj,[rsp])},this)};s7sdk.set.PageView.prototype.setRequestError=function(rsp){s7sdk.Logger.log(s7sdk.Logger.WARNING,"s7sdk.set.PageView.setRequestError %0",rsp)};s7sdk.set.PageView.prototype.setRequestComplete=function(rsp){var jsonSet=rsp.set;if(jsonSet==null){return}var mediaSet=s7sdk.MediaSetParser.parse(jsonSet,this.imageModifier,this.aemmode,this.dir);this.updateLandscapeLabels(mediaSet," - ");this.setMediaSetInternal(mediaSet)};s7sdk.set.PageView.prototype.updateLandscapeLabels=function(mediaSetDesc,delimiter){var items=mediaSetDesc.items;var onePage=mediaSetDesc.type!==s7sdk.ItemDescType.ECAT_SET;delimiter=delimiter?delimiter:" : ";for(var i=0;i<items.length;i++){var item=items[i];var label0=item.label;var label1=undefined;if(item.images){if(item.images[0].label){label0=item.images[0].label}if(item.images[1]&&item.images[1].label){label1=item.images[1].label}}item.label=label0;if(item.np||onePage){if(!item.label){item.label=label1?label1:""}}else{if(item.label){item.label+=label1?delimiter+label1:""}else{item.label=label1?label1:""}}if(!item.label){item.label=""}}};s7sdk.set.PageView.prototype.createPageFrames=function(){function appendUrlArgument(url,argname,value){url+=((url.indexOf("?")==-1)?"?":"&")+argname;url+=(typeof value=="undefined")?"":"="+value;return url}var image;var i=0;this.pageFrames=[];for(var idx=0;idx<this.items.length;idx++){var item=this.items[idx];if(typeof(item)=="undefined"){s7sdk.Logger.log(s7sdk.Logger.WARNING,"s7sdk.set.PageView - Malformed data in MediaSetDesc %0",this.mediaSet_.landscape.name);continue}image=item.name||"";image=image.trim();if(this.iscommand!=null&&this.iscommand.length>0){image=appendUrlArgument(image,"layer","comp");image=appendUrlArgument(image,this.iscommand)}if(s7sdk.Util.isNonEmptyString(this.locale)){image=appendUrlArgument(image,"locale",this.locale)}if(s7sdk.Util.isNonEmptyString(item.version)){image=appendUrlArgument(image,"id",item.version)}var frixx=this.dir?(this.items.length-1-i):i;this.pageFrames[frixx]=new s7sdk.set.PageFrame(this,this.serverUrl,image,frixx,this.viewProps,item.width,item.height,this.splitFrames.orientation?0:(item.np?(this.dir?(i==0?1:2):(i==0?2:1)):0),item.label);i++}this.settings.trackLoad(this);this.isstartFrame=true;this.startupFrame=this.startupFrame>=this.pageFrames.length?0:(this.startupFrame<=0?0:this.startupFrame);this.loadFrames(this.startupFrame,true);this.assetIsChanged=true;this.isNewLayout=true};s7sdk.set.PageView.prototype.notifyAssetChanded=function(){if(this.currentFrame&&this.currentFrame.view){this.cursorChange(this.currentFrame.view.state)}if(!this.assetIsChanged){return}this.assetIsChanged=false;var inst=this;setTimeout(function(){var evset=inst.splitFrames.orientation?inst.mediaSet_.portrait:inst.mediaSet_.landscape;var frameidx=0;if(inst.currentFrame){frameidx=inst.dir?inst.items.length-1-inst.currentFrame.idx:inst.currentFrame.idx}var ev=new s7sdk.event.AssetEvent(s7sdk.event.AssetEvent.ASSET_CHANGED,evset,frameidx,true);s7sdk.Event.dispatch(inst.obj,ev,false)},0)};s7sdk.set.PageView.prototype.loadFrames=function(frm,transition){this.frame_=frm;if(this.inprogress){return}var cIdx=this.getFrameIdx(this.frame_);this.nextFrame=this.getFrameByIdx(cIdx);this.nextFrame.transition=transition;if(this.frametransition.transition=="slide"||this.frametransition.transition=="turn"){this.inprogress=this.loader.load([this.getFrameByIdx((cIdx-1)<0?0:(cIdx-1)),this.nextFrame,this.getFrameByIdx(((cIdx+1)>=this.pageFrames.length)?cIdx:cIdx+1)],cIdx,this.maxload==1)}else{this.inprogress=this.loader.load([this.nextFrame],cIdx)}};s7sdk.set.PageView.prototype.getFrameByIdx=function(idx){return this.pageFrames[this.getFrameIdx(idx)]};s7sdk.set.PageView.prototype.getFrameIdx=function(idx){if(idx<0){idx=this.pageFrames.length+idx%this.pageFrames.length}return idx%this.pageFrames.length};s7sdk.set.PageView.prototype.invalidate=function(){if(this.currentFrame!=null&&this.frameInvalidated==false){this.currentFrame.setTileRender(true);this.currentFrame.setDelayTileLoad(false);this.currentFrame.invalidate();this.frameInvalidated=true}};s7sdk.set.PageView.prototype.onResetImageLoaded=function(opResult,idx){if(this.loader.toLoad!=0){return}if(!opResult){this.inprogress=false;return}if(typeof(this.currentFrame)!="undefined"&&this.currentFrame!=null){if(this.pageFrames.length<2){return}this.dCenter.obj.style.display="block";this.setOpacity(this.dCenter.obj,1);switch(this.frametransition.transition){case"fade":this.attachView(this.dLeft,this.nextFrame);this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_START);var view=this.currentFrame.view;view.targetViewToImage=view.resetView();view.viewToImage=view.targetViewToImage.clone();view.calcRes();view.invalidate(false);this.centerDivider.obj.style.display="block";this.centerDivider.obj.style.visibility="inherit";if(typeof(this.animate)=="undefined"){this.animate=new s7sdk.set.SlideAnimation(this,this.frametransition.duration)}this.animate.startTransition(true,0,false);break;case"turn":case"slide":if(typeof(this.animate)=="undefined"){this.animate=new s7sdk.set.SlideAnimation(this,this.frametransition.duration)}if(this.nextFrame.idx<this.currentFrame.idx){this.attachView(this.dLeft,this.nextFrame)}else{this.attachView(this.dRight,this.nextFrame)}if(this.pageTurn){this.pageTurn.isAuto=true;this.pageTurn.divBgPrepare();this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_START)}this.animate.startTransition(this.nextFrame.idx<this.currentFrame.idx,0,false);this.nextFrame.transtion=false;break;default:this.attachView(this.dLeft,this.nextFrame);this.replaceFrame(true)}}else{this.currentFrame=this.nextFrame;this.notifyAssetChanded();switch(this.frametransition.transition){case"fade":this.centerDivider.obj.style.display="block";this.attachView(this.dLeft,this.currentFrame);this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_START);if(typeof(this.animate)=="undefined"){this.animate=new s7sdk.set.SlideAnimation(this,this.frametransition.duration)}this.animate.startTransition(true,0,false);break;case"turn":case"slide":this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_START);this.attachView(this.dCenter,this.currentFrame);this.prevFrameIdx_=this.currentFrame.idx;this.replaceFrame(true);break;default:this.prevFrameIdx_=this.currentFrame.idx;this.attachView(this.dCenter,this.currentFrame);this.replaceFrame(true)}}};s7sdk.set.PageView.prototype.dispatchTransitionEvent=function(evType){if(this.isFirst){if(evType==s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_END){this.isFirst=false}return}var frmev=this.dir?this.items.length-1-this.currentFrame.idx:this.currentFrame.idx;var itemDesc=this.items[this.currentFrame.idx];var ev=new s7sdk.event.FrameEvent(evType,itemDesc.name,frmev,false);s7sdk.Event.dispatch(this.obj,ev,false)};s7sdk.set.PageView.prototype.attachView=function(cnv,dst){dst.view.detach();dst.view.attach(cnv)};s7sdk.set.PageView.prototype.setOpacity=function(obj,value){if(s7sdk.browser.name=="ie"){if((s7sdk.browser.version.minor>5.5)&&(s7sdk.browser.version.minor<=8)&&(document.body.filters)){if(obj.id=="left"||obj.id=="center"){obj.style.filter="alpha(opacity ="+(value*100)+")";return}}else{obj.style.opacity=value}}else{obj.style.opacity=value}};s7sdk.set.PageView.prototype.animationFinalStep=function(){if(this.frametransition.transition=="turn"){this.mouseIsDownTurn=false;this.pageTurn.finalStep(this.animate.direction,this.animate.reverse,this.animate.custom);return}if(this.animate.reverse||this.frametransition.transition!="slide"){return}if(this.animate.direction){this.container3.style.left=0+"px"}else{this.container3.style.left=-2*this.totalWidth_+"px"}};s7sdk.set.PageView.prototype.animationStop=function(){this.isstartFrame=false;if(this.frametransition.transition=="turn"){if(!this.animate.custom){this.replaceFrame(true)}else{this.animate.custom=false;this.replaceFrame(false)}this.pageTurn.isAuto=false;this.obj.style.overflow="hidden";this.container3.style.display="";this.pageTurn.obj.style.display="none"}else{if(this.frametransition.transition=="slide"){if(this.animate.reverse){this.animate.reverse=false;this.animate.custom=false;this.container3.style.left=-this.totalWidth_+"px";this.moved=false;this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_END);return}if(!this.animate.custom){this.container3.style.left=-this.totalWidth_+"px";this.replaceFrame(true)}else{this.animate.custom=false;this.replaceFrame(false)}}else{if(!this.animate.custom){this.replaceFrame(true)}else{this.animate.custom=false;this.replaceFrame(false)}}}this.checkIconEffect()};s7sdk.set.PageView.prototype.containerMove=function(pos){this.container3.style.left=pos+"px";if(pos!=-this.totalWidth_&&!this.moved){this.moved=true;this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_START)}};s7sdk.set.PageView.prototype.replaceFrame=function(checkForDelayed){this.inprogress=false;if(this.pageFrames.length>1){if(this.currentFrame!=null&&this.currentFrame.view!=null){this.currentFrame.view.zoomReset();this.currentFrame.view.writeOverlay(null);this.currentFrame.unload(1);if(this.currentFrame.view.getDisplayElement()!=null){this.currentFrame.view.getDisplayElement().s7pageView=null;this.currentFrame.view.detach()}}}this.currentFrame=this.nextFrame;this.notifyAssetChanded();this.frameInvalidated=false;this.attachView(this.dCenter,this.currentFrame);this.currentFrame.view.invalidated=true;this.currentFrame.view.isClearted=false;if(this.frametransition.transition=="slide"){this.container3.style.left=-this.totalWidth_+"px"}if(this.centerDivider.obj.style.display=="none"){this.centerDivider.obj.style.display="block"}var inst=this;var delay=0;if(s7sdk.browser.device.name=="android"&&s7sdk.browser.device.version=="4"){delay=60}this.replaseFrameTimeOut=setTimeout(function(){inst.replaceFrameDelayed(checkForDelayed)},delay);this.currentFrame.view.draw()};s7sdk.set.PageView.prototype.replaceFrameDelayed=function(checkForDelayed){this.inprogress=false;if(this.pageFrames.length>1){var fr=this.getFrameByIdx(this.nextFrame.idx+1);var pos;if(fr.view){this.attachView(this.dRight,fr);pos=this.getDividerPosition(this.dRight.displayElement.view);this.rightDivider.obj.style.top=pos.top+"px";this.rightDivider.setHeight(pos.height);this.rightDivider.obj.style.visibility="inherit";fr.view.invalidated=true;fr.view.isClearted=false;fr.view.draw()}fr=this.getFrameByIdx(this.nextFrame.idx-1);if(fr.view){this.attachView(this.dLeft,fr);pos=this.getDividerPosition(this.dLeft.displayElement.view);this.leftDivider.obj.style.top=pos.top+"px";this.leftDivider.setHeight(pos.height);if(this.frametransition.transition!="fade"){this.leftDivider.obj.style.visibility="inherit"}else{this.setOpacity(this.dLeft.obj,0)}fr.view.isClearted=false;fr.view.invalidated=true;fr.view.draw()}}if(this.frametransition.transition=="fade"){this.centerDivider.obj.style.visibility="inherit"}this.setOpacity(this.dCenter.obj,1);this.dCenter.obj.style.display="block";this.frame=this.currentFrame.idx;this.invalidate();if(this.prevFrameIdx_!=this.currentFrame.idx||this.currentFrame.idx==0||this.isNewLayout){var frmev=this.dir?this.items.length-1-this.currentFrame.idx:this.currentFrame.idx;this.viewStateChange(this.getCapabilityState());var itemDesc=this.items[this.currentFrame.idx];if(!this.orientationChanged||this.isAssetChanged){var assetEvent=new s7sdk.event.AssetEvent(s7sdk.event.AssetEvent.ITEM_SELECTED_EVENT,itemDesc,frmev,true);assetEvent.orientation=this.splitFrames.orientation;this.dispatchEvent(assetEvent);this.isAssetChanged=false}this.orientationChanged=false;this.dispatchEvent(new s7sdk.event.UserEvent(s7sdk.event.UserEvent.PAGE,[frmev,typeof(itemDesc.label)!="undefined"?itemDesc.label:""]));this.isNewLayout=false;this.prevFrameIdx_=this.currentFrame.idx}if(checkForDelayed){var inst=this;if(this.frame_!=this.currentFrame.idx){setTimeout(function(){inst.loadFrames(inst.frame_,true)},0)}}else{this.frame_=this.currentFrame.idx}this.moved=false;this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_END)};s7sdk.set.PageView.prototype.animationStart=function(){if(this.frametransition.transition=="turn"){this.obj.style.overflow="";this.pageTurn.obj.style.display="";this.container3.style.display="none"}};s7sdk.set.PageView.prototype.animationStep=function(step,slideDirection,reverse){if(this.frametransition.transition=="turn"){var s;if(this.pageTurn.isAuto){this.pageTurn.flipMode=slideDirection?2:3;s=this.pageTurn.calcAutoPoint(slideDirection?step:1-step)}else{s=this.pageTurn.calcPoint(step,slideDirection,reverse)}this.pageTurn.setCurrentPosition(s)}else{if(this.frametransition.transition=="slide"){this.containerMove((reverse?(slideDirection?-this.totalWidth_:this.totalWidth_):0)-this.totalWidth_*(1+((slideDirection)?-1:1)*step))}else{this.setOpacity(this.dCenter.obj,1-step);this.setOpacity(this.dLeft.obj,step);if(s7sdk.browser.device.name=="android"&&s7sdk.browser.device.version=="4"){this.container3.style.display="none";var abc=this.container3.offsetWidth;this.container3.style.display="block"}}}};s7sdk.set.PageView.prototype.drawChild=function(){this.setDividerPosition()};s7sdk.set.PageView.prototype.viewInvalidate=function(viewPort){if(this.currentFrame==null){return}var view=this.currentFrame.view;var rgn=new s7sdk.Rectangle(Math.round(viewPort.x*view.imageWidth),Math.round(viewPort.y*view.imageHeight),Math.round(viewPort.width*view.imageWidth),Math.round(viewPort.height*view.imageHeight));var viewTL=this.imagePixelsToViewPoint(rgn.topLeft());var viewBR=this.imagePixelsToViewPoint(rgn.bottomRight());var scale=(viewBR.y-viewTL.y)/(viewPort.height*view.imageHeight);scale=Math.round((scale+0.00005)*10000)/100;if(!this.lastViewPort||this.lastViewPort.isEmpty()){this.lastViewPort=viewPort}else{if(viewPort.equals(this.lastViewPort)&&!this.pvResized){if(this.prevScale!=scale){this.prevScale=scale;s7sdk.Event.dispatch(this.obj,new s7sdk.ZoomRgnEvent(s7sdk.ZoomRgnEvent.NOTF_ZOOM_NRGN,viewPort),false);s7sdk.Event.dispatch(this.obj,new s7sdk.ZoomRgnEvent(s7sdk.ZoomRgnEvent.NOTF_ZOOM_RGN,rgn),false)}return}}this.pvResized=false;this.lastViewPort=viewPort;s7sdk.Event.dispatch(this.obj,new s7sdk.ZoomRgnEvent(s7sdk.ZoomRgnEvent.NOTF_ZOOM_NRGN,viewPort),false);s7sdk.Event.dispatch(this.obj,new s7sdk.ZoomRgnEvent(s7sdk.ZoomRgnEvent.NOTF_ZOOM_RGN,rgn),false);if(scale!=this.lastScale){if(!view.inTransition){}this.lastScale=scale}else{var lastTL=this.imagePixelsToViewPoint(new s7sdk.Point2D(Math.round(this.lastViewPort.x*view.imageWidth),Math.round(this.lastViewPort.y*view.imageHeight)));var dx=Math.round(lastTL.x-viewTL.x);var dy=Math.round(lastTL.y-viewTL.y);if(dx!=0||dy!=0){var e=new s7sdk.event.ZoomPanEvent(s7sdk.event.ZoomPanEvent.NOTF_ZOOM_NPAN,this.lastViewPort.x-viewPort.x,this.lastViewPort.y-viewPort.y);s7sdk.Event.dispatch(this.obj,e,false);e=new s7sdk.event.ZoomPanEvent(s7sdk.event.ZoomPanEvent.NOTF_ZOOM_PAN,dx,dy);s7sdk.Event.dispatch(this.obj,e,false)}}this.lastViewPort=viewPort};s7sdk.set.PageView.prototype.getDividerPosition=function(view){var result={};var imageToView=view.viewToImage.clone();imageToView.invert();var tL=imageToView.transformPoint(new s7sdk.Point2D(0,0));var bR=imageToView.transformPoint(new s7sdk.Point2D(1,1));var imgRect=new s7sdk.Rectangle(tL.x,tL.y,bR.x-tL.x,bR.y-tL.y);if(typeof(imgRect)!="undefined"){result.left=imgRect.x+(view.align!=0?(view.align!=1?0:2):1)*imgRect.width/2}var viewRect=new s7sdk.Rectangle(0,0,view.w,view.h);var imgRect_v=imgRect.intersection(viewRect);var rectS=imgRect_v.intersection(viewRect);if(typeof(rectS)!="undefined"){result.top=rectS.y;result.height=rectS.height}result.top/=this.devicePixelRatio;result.left/=this.devicePixelRatio;result.height/=this.devicePixelRatio;return result};s7sdk.set.PageView.prototype.setDividerPosition=function(){if(this.currentFrame==null||this.currentFrame.view==null){return}var pos=this.getDividerPosition(this.currentFrame.view);this.centerDivider.obj.style.left=(pos.left+this.totalWidth_-this.dividerW)+"px";this.centerDivider.obj.style.top=pos.top+"px";this.centerDivider.setHeight(pos.height);this.centerDivider.obj.style.visibility="inherit";if(typeof(this.dLeft.displayElement.view)!="undefined"&&this.dLeft.displayElement.view!=null&&this.frametransition.transition=="slide"){pos=this.getDividerPosition(this.dLeft.displayElement.view);this.leftDivider.obj.style.left=pos.left-this.dividerW+"px";this.leftDivider.obj.style.top=pos.top+"px";this.leftDivider.setHeight(pos.height);this.leftDivider.obj.style.visibility="inherit"}else{this.leftDivider.obj.style.visibility="hidden"}if(typeof(this.dRight.displayElement.view)!="undefined"&&this.dRight.displayElement.view!=null&&this.frametransition.transition=="slide"){pos=this.getDividerPosition(this.dRight.displayElement.view);this.rightDivider.obj.style.left=(pos.left+2*this.totalWidth_-this.dividerW)+"px";this.rightDivider.obj.style.top=pos.top+"px";this.rightDivider.setHeight(pos.height);this.rightDivider.obj.style.visibility="inherit"}else{this.rightDivider.obj.style.visibility="hidden"}};s7sdk.set.PageView.prototype.imagePixelsToViewPoint=function(inPt){if(this.currentFrame==null||this.currentFrame.view==null){return new s7sdk.Point2D(Number.POSITIVEINFINITY,Number.POSITIVEINFINITY)}var viewPoint=this.currentFrame.view.imagePixelsToViewPoint(inPt);return viewPoint};s7sdk.set.PageView.prototype.viewPointToImagePixels=function(inPt){if(this.currentFrame==null||this.currentFrame.view==null){return new s7sdk.Point2D(Number.POSITIVEINFINITY,Number.POSITIVEINFINITY)}var padding=new s7sdk.Point2D(0,0);var imgPoint=new s7sdk.Point2D(inPt.x-padding.x,inPt.y-padding.y);return this.currentFrame.view.viewPointToImagePixels(imgPoint)};s7sdk.set.PageView.prototype.viewTransitionStop=function(){this.sendZoomEvent()};s7sdk.set.PageView.prototype.sendZoomEvent=function(){if(this.lastSended==this.lastScale){return}this.lastSended=this.lastScale;var userEvent=new s7sdk.event.UserEvent(s7sdk.event.UserEvent.ZOOM,[Math.round(this.lastScale)],true);s7sdk.Event.dispatch(this.obj,userEvent,false)};s7sdk.set.PageView.prototype.setInPan=function(newPanState){if(this.viewState&4){if(this.inPan!=(newPanState&&(this.viewState&4))){this.inPan=newPanState&&(this.viewState&4);this.cursorChange(this.currentFrame.view.state)}}else{if(this.frametransition.transition=="slide"){this.inPan=newPanState;this.cursorChange(this.currentFrame.view.state|(newPanState?2048:0))}}};s7sdk.set.PageView.prototype.cursorChange=function(state){var cursortypes=["default","zoomin","reset","drag","slide"];var sid=state==0?0:(this.inPan?((state&2048)?4:3):(state&8?1:2));if(this.prevCur==sid){return}this.prevCur=sid;s7sdk.Util.css.setCSSAttributeSelector(this.obj,"cursortype",cursortypes[sid]);var abc=this.obj.offsetWidth};s7sdk.set.PageView.prototype.viewStateChange=function(state){var newState=state;if(typeof(state)=="number"){newState=this.getStateInternal(state)}if(this.viewState==newState.state){return}this.viewState=newState.state;this.cursorChange(this.viewState);var ev=new s7sdk.event.CapabilityStateEvent(s7sdk.event.CapabilityStateEvent.NOTF_PAGEVIEW_CAPABILITY_STATE,newState);s7sdk.Event.dispatch(this.obj,ev,false);this.checkIconEffect()};s7sdk.set.PageView.prototype.getCapabilityState=function(){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.getCapabilityState");return this.getStateInternal(this.viewState)};s7sdk.set.PageView.prototype.getStateInternal=function(newState){var pageviewState=new s7sdk.PageViewCapabilityState(typeof(newState)=="undefined"?(this.currentFrame?this.currentFrame.view.state:0):newState);pageviewState.removeCapability(s7sdk.PageViewCapabilityState.FIRST_PAGE|s7sdk.PageViewCapabilityState.LAST_PAGE);if(this.currentFrame==null||this.currentFrame.idx==0){pageviewState.setCapability(s7sdk.PageViewCapabilityState.FIRST_PAGE)}else{if(this.currentFrame.idx==(this.pageFrames.length-1)){pageviewState.setCapability(s7sdk.PageViewCapabilityState.LAST_PAGE)}}return pageviewState};s7sdk.set.PageView.prototype.build=function(){if(!this.added){this.attachToContainer();this.setupInputController();this.leftDivider=new s7sdk.set.PageDivider(this.container3.id,940,this.pageturnstyle);this.dividerW=parseInt(s7sdk.Util.getStyle(this.leftDivider.obj,"width"))/2;this.leftDivider.obj.style.visibility="hidden";this.leftDivider.obj.style.left=(this.frametransition.transition=="fade"?this.totalWidth_:0)+"px";this.centerDivider=new s7sdk.set.PageDivider(this.container3.id,940,this.pageturnstyle);this.centerDivider.obj.style.visibility="hidden";this.rightDivider=new s7sdk.set.PageDivider(this.container3.id,940,this.pageturnstyle);this.rightDivider.obj.style.visibility="hidden";this.added=true}if(this.splitFrames.orientation||(this.mediaSet_.landscape.type!=s7sdk.ItemDescType.ECAT_SET)){this.leftDivider.obj.style.width="0px";this.centerDivider.obj.style.width="0px";this.rightDivider.obj.style.width="0px";if(this.frametransition.transition=="turn"){this.leftDivider.hide();this.centerDivider.hide();this.rightDivider.hide()}}else{this.leftDivider.obj.style.width=this.dividerW*2+"px";this.centerDivider.obj.style.width=this.dividerW*2+"px";this.rightDivider.obj.style.width=this.dividerW*2+"px";if(this.frametransition.transition=="turn"){this.leftDivider.show();this.centerDivider.show();this.rightDivider.show()}}};s7sdk.set.PageView.prototype.cleanUp=function(){if(this.replaseFrameTimeOut){clearTimeout(this.replaseFrameTimeOut);this.replaseFrameTimeOut=null}if(this.loader.timer){clearInterval(this.loader.timer);this.loader.timer=null}this.cleanUp_();delete this.loader;if(this.animate){this.animate.cleanUp();delete this.animate;this.animate=null}if(this.timerMouseUpCheck){clearTimeout(this.timerMouseUpCheck);this.timerMouseUpCheck=null}if(this.leftTurn){s7sdk.Event.removeDOMListener(this.leftTurn,"mouseover",this.onMouseoverHandlerLeft,true);s7sdk.Event.removeDOMListener(this.leftTurn,"touchstart",this.onMouseoverHandlerLeft,true);s7sdk.Event.removeDOMListener(this.leftTurn,"mouseout",this.onMouseoutHandler,true);s7sdk.Event.removeDOMListener(this.leftTurn,"mousemove",this.onMousemoveTurnHandler,true)}if(this.rightTurn){s7sdk.Event.removeDOMListener(this.rightTurn,"mouseover",this.onMouseoverHandlerNotLeft,true);s7sdk.Event.removeDOMListener(this.rightTurn,"touchstart",this.onMouseoverHandlerNotLeft,true);s7sdk.Event.removeDOMListener(this.rightTurn,"mouseout",this.onMouseoutHandler,true);s7sdk.Event.removeDOMListener(this.rightTurn,"mousemove",this.onMousemoveTurnHandler,true)}if(this.handler){if(this.leftTurn){this.handler.detach(this.leftTurn);this.handler.detach(this.rightTurn)}this.handler.detach(this.obj)}if(this.iconEffectObj){this.iconEffectObj.dispose();this.iconEffectObj=null}if(this.pageTurn){this.pageTurn.dispose();delete this.pageTurn}if(this.dLeft){if(this.dLeft.view){this.dLeft.view.detach();this.dLeft.view.unload(8)}}if(this.dRight){if(this.dRight.view){this.dRight.view.detach();this.dRight.view.unload(8)}}if(this.dCenter){if(this.dCenter.view){this.dCenter.view.detach();this.dCenter.view.unload(8)}}if(this.tempDisplay){if(this.tempDisplay.view){this.tempDisplay.view.detach();this.tempDisplay.view.unload(8)}}if(this.leftDivider){this.leftDivider.dispose()}if(this.rightDivider){this.rightDivider.dispose()}if(this.centerDivider){this.centerDivider.dispose()}this.container3.removeChild(this.tempDisplay.obj);this.container3.removeChild(this.dLeft.obj);this.container3.removeChild(this.dCenter.obj);this.container3.removeChild(this.dRight.obj);delete this.tempDisplay;delete this.dLeft;delete this.dCenter;delete this.dRight;delete this.leftDivider;delete this.centerDivider;delete this.rightDivider;if(this.viewport&&this.obj){this.obj.removeChild(this.viewport)}s7sdk.Util.removeTags(this.obj);this.obj.style.cssText=""};s7sdk.set.PageView.prototype.cleanUp_=function(){if(this.isReq_){this.isReq_.cancelHttpReq();this.isReq_=null}this.currentFrame=null;this.nextFrame=null;this.inprogress=false;this.loader.processed=[];this.loader.queue=[];this.loader.frameToLoad=null;this.toLoad=0;if(this.createPageFramesTimeoutId){clearTimeout(this.createPageFramesTimeoutId);this.createPageFramesTimeoutId=null}if(this.pageFrames!=null&&this.pageFrames.length!=0){for(var i=0;i<this.pageFrames.length;i++){if(this.pageFrames[i].view!=null){this.pageFrames[i].view.onResetImageLoaded=s7sdk.Callback.noop}this.pageFrames[i].unload(8);delete this.pageFrames[i]}}};s7sdk.set.PageView.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};s7sdk.set.PageView.prototype.getContainer=function(){return this.container};s7sdk.set.PageView.prototype.createElement=function(){s7sdk.UIComponent.prototype.createElement.apply(this,[]);this.obj=this.prepareDiv(this.obj);this.obj.setWidth(this.totalWidth_);this.obj.setHeight(this.totalHeight_);this.obj.className="s7pageview";if(this.test==""){this.obj.style.overflow="hidden"}};s7sdk.set.PageView.prototype.prepareDiv=function(using){var div=(using&&typeof using!="undefined")?using:document.createElement("div");div.getX=function(){return div.x_};div.getY=function(){return div.y_};div.setX=function(value){div.x_=value;div.style.left=value+"px"};div.setY=function(value){div.y_=value;div.style.top=value+"px"};div.getWidth=function(){return div.width_};div.getHeight=function(){return div.height_};div.setWidth=function(value){div.width_=value;div.style.width=value+"px"};div.setHeight=function(value){div.height_=value;div.style.height=value+"px"};return div};s7sdk.set.PageView.prototype.getWidth=function(){return this.wid};s7sdk.set.PageView.prototype.getHeight=function(){return this.hei};s7sdk.set.PageView.prototype.resize=function(w,h){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.resize - w: %0, h: %1",w,h);if(w==this.wid&&h==this.hei){return}this.pvResized=true;this.wid=w>0?w:1;this.hei=h>0?h:1;this.devicePixelRatio=s7sdk.Util.adjustDevicePixelRatio(this.enableHD.maxHdPixels,this.hei,this.wid);if(this.currentFrame&&this.currentFrame.view){this.currentFrame.view.devicePixelRatio=this.devicePixelRatio}this.viewProps.outWidth=this.wid*this.devicePixelRatio;this.viewProps.outHeight=this.hei*this.devicePixelRatio;this.totalWidth_=this.wid;this.totalHeight_=this.hei;this.container3.setWidth(this.totalWidth_*3);this.container3.setHeight(this.totalHeight_);this.container3.style.left=-this.totalWidth_+"px";this.ovrl.style.width=this.totalWidth_+"px";this.ovrl.style.height=this.totalHeight_+"px";if(this.rightDivider){this.rightDivider.obj.style.visibility="hidden"}if(this.centerDivider){this.centerDivider.obj.style.visibility="hidden"}if(this.leftDivider){this.leftDivider.obj.style.visibility="hidden"}this.obj.setWidth(this.totalWidth_);this.obj.setHeight(this.totalHeight_);this.dLeft.resize(this.viewProps.outWidth,this.viewProps.outHeight,this.wid,this.hei,this.devicePixelRatio);this.dCenter.resize(this.viewProps.outWidth,this.viewProps.outHeight,this.wid,this.hei,this.devicePixelRatio);this.dRight.resize(this.viewProps.outWidth,this.viewProps.outHeight,this.wid,this.hei,this.devicePixelRatio);switch(this.frametransition.transition){case"fade":this.dLeft.obj.style.left=this.totalWidth_+"px";break;case"slide":break;case"default":}if(this.pageTurn){this.pageTurn.devicePixelRatio=this.devicePixelRatio;this.pageTurn.resize()}if(this.currentFrame!=null){this.currentFrame.resize();if(this.currentFrame.view){this.currentFrame.view.draw()}}var frm;if(this.pageFrames){for(var i=0;i<this.pageFrames.length;i++){frm=this.pageFrames[i];if(frm!=this.currentFrame){if(frm!=null&&frm.view!=null){frm.view.devicePixelRatio=this.devicePixelRatio}frm.resize()}}}if(this.iconEffectObj.enabled){this.iconEffectObj.centerOverlay(w,h)}};s7sdk.set.PageView.prototype.adjustDevicePixelRatio=function(){this.devicePixelRatio=1;this.viewProps.outWidth=this.wid;this.viewProps.outHeight=this.hei;this.totalWidth_=this.wid;this.totalHeight_=this.hei;this.container3.setWidth(this.totalWidth_*3);this.container3.setHeight(this.totalHeight_);this.container3.style.left=-this.totalWidth_+"px";this.ovrl.style.width=this.totalWidth_+"px";this.ovrl.style.height=this.totalHeight_+"px";if(this.rightDivider){this.rightDivider.obj.style.visibility="hidden"}if(this.centerDivider){this.centerDivider.obj.style.visibility="hidden"}if(this.leftDivider){this.leftDivider.obj.style.visibility="hidden"}this.obj.setWidth(this.totalWidth_);this.obj.setHeight(this.totalHeight_);this.dLeft.resize(this.viewProps.outWidth,this.viewProps.outHeight,this.wid,this.hei,this.devicePixelRatio);this.dCenter.resize(this.viewProps.outWidth,this.viewProps.outHeight,this.wid,this.hei,this.devicePixelRatio);this.dRight.resize(this.viewProps.outWidth,this.viewProps.outHeight,this.wid,this.hei,this.devicePixelRatio);if(this.pageTurn){this.pageTurn.resize()}var frm;if(this.pageFrames){for(var i=0;i<this.pageFrames.length;i++){frm=this.pageFrames[i];frm.viewProps=this.viewProps;frm.resize()}}if(this.iconEffectObj.enabled){this.iconEffectObj.centerOverlay(this.wid,this.hei)}};s7sdk.set.PageView.prototype.addEventListener=function(type,handler,useCapture){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.addEventListener - type: %0, handler: %1, useCapture: %2",type,handler.toString().substring(0,handler.toString().indexOf("(")),useCapture);s7sdk.Base.prototype.addEventListener.apply(this,[type,handler,useCapture])};s7sdk.set.PageView.prototype.sendStatusEvent=function(view){if(view.viewReady){if(!this.hiresIsReadySent){var statusEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_HIGHRES_VIEW_READY,true);s7sdk.Event.dispatch(this.obj,statusEvent,false);this.hiresIsReadySent=true}}if(!view.viewReady){if(!this.viewIsReadySent){var statusEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_VIEW_READY,true);s7sdk.Event.dispatch(this.obj,statusEvent,false);this.viewIsReadySent=true}view.viewReady=true}};s7sdk.set.PageView.prototype.setAsset=function(assetName){if(this.chk&&this.chk.started&&!this.chk.complete){var userEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);s7sdk.Event.dispatch(this.obj,userEvent,false)}this.chk=null;this.viewIsMetadataSent=false;this.viewIsReadySent=false;this.hiresIsReadySent=false;this.isAssetChanged=true;this.setAssetInternal(assetName)};s7sdk.set.PageView.prototype.setAssetInternal=function(assetName){if(typeof assetName!="string"){throw new Error("Asset name must be represented by a string!")}if(assetName==""){return}this.currentAsset=assetName;s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.setAsset - assetName: %0",assetName);var newAsset=unescape(assetName);if(this.assetName_!=null&&newAsset!=this.assetName_){var userEvent=new s7sdk.UserEvent(s7sdk.UserEvent.SWAP,[0,assetName],true);s7sdk.Event.dispatch(this.obj,userEvent,false)}this.itemIndex_=-1;this.filteredSet_=[];this.assetName_=newAsset;this.loadAsset()};s7sdk.set.PageView.prototype.setMediaSet=function(mediaSet){if(this.chk&&this.chk.started&&!this.chk.complete){var userEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);s7sdk.Event.dispatch(this.obj,userEvent,false)}this.isAssetChanged=true;this.chk=null;this.viewIsMetadataSent=false;this.viewIsReadySent=false;this.hiresIsReadySent=false;this.setMediaSetInternal(mediaSet)};s7sdk.set.PageView.prototype.setMediaSetInternal=function(mediaSet){var mset=mediaSet;s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.setMediaSet - mediaSet: %0",mediaSet);if(!(mediaSet instanceof s7sdk.OrientationSetDesc)){mset=new s7sdk.OrientationSetDesc(mset,null)}if(mset.landscape==null||typeof(mset.landscape.items[0])=="undefined"){return}this.mediaSet_=mset;this.items=this.splitFrames.orientation?this.mediaSet_.portrait.items:this.mediaSet_.landscape.items;if(parseInt(this.maxloadradius)==-1){this.maxload=this.items.length}this.currentAsset=mset;this.refresh();if(!this.viewIsMetadataSent){var userEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_ASSET_METADATA_READY,true);s7sdk.Event.dispatch(this.obj,userEvent,false);this.viewIsMetadataSent=true}};s7sdk.set.PageView.prototype.refresh=function(){this.cleanUp_();this.startupFrame=this.dir?(this.items.length-1):0;var inst=this;this.createPageFramesTimeoutId=setTimeout(function(){inst.createPageFrames();inst.build()},0)};s7sdk.set.PageView.prototype.setFrameTransition=function(frmTransition,duration){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.setFrameTransition - frmTransition: %0, duration: %1",frmTransition,duration);if(this.frametransition.transition=="turn"||frmTransition=="turn"){return}this.frametransition.transition=frmTransition=="slide"||frmTransition=="fade"?frmTransition:"none";if(frmTransition=="fade"){this.dLeft.obj.style.left=this.totalWidth_+"px";this.setOpacity(this.dLeft.obj,0)}else{this.dLeft.obj.style.left=0+"px";this.setOpacity(this.dLeft.obj,1)}if(typeof(duration)!="undefined"&&s7sdk.Util.isNumber(duration)){this.frametransition.duration=duration}};s7sdk.set.PageView.prototype.nextPage=function(){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.nextPage");if(this.dir){this.prev_Page()}else{this.next_Page()}};s7sdk.set.PageView.prototype.next_Page=function(){if(this.pageFrames==null||this.frame_+1==this.pageFrames.length){return}this.loadFrames(this.frame_+1,true)};s7sdk.set.PageView.prototype.prevPage=function(){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.prevPage");if(this.dir){this.next_Page()}else{this.prev_Page()}};s7sdk.set.PageView.prototype.prev_Page=function(){if(this.pageFrames==null||this.frame_==0){return}this.loadFrames(this.getFrameIdx(this.frame_-1),true)};s7sdk.set.PageView.prototype.getCurrentFrameIndex=function(){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.getCurrentFrameIndex");return this.currentFrame!=null?(this.dir?this.items.length-1-this.currentFrame.idx:this.currentFrame.idx):-1};s7sdk.set.PageView.prototype.setCurrentFrameIndex=function(idx){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.setCurrentFrameIndex - idx: %0",idx);if(idx>=0&&this.mediaSet_){var neidx=this.dir?this.items.length-1-idx:idx;if(!this.currentFrame){this.startupFrame=neidx}else{if(neidx!=this.currentFrame.idx){this.loadFrames(this.getFrameIdx(neidx),true)}}}};s7sdk.set.PageView.prototype.zoomIn=function(){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.zoomIn");if(this.currentFrame.view){this.currentFrame.view.zoomIn()}};s7sdk.set.PageView.prototype.zoomOut=function(){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.zoomOut");if(this.currentFrame.view){this.currentFrame.view.zoomOut()}};s7sdk.set.PageView.prototype.zoomReset=function(){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.PageView.zoomReset");if(this.currentFrame.view){this.currentFrame.view.zoomReset()}};s7sdk.set.PageView.prototype.getFromRadius=function(cidx){if(typeof(cidx)=="undefined"||(this.chk&&this.chk.tilesLoaded)){return null}if(!this.chk){this.chk={};this.chk.tilesLoaded=false;this.chk.started=false;this.chk.complete=false}if(this.chk.currentFrameChk!=cidx){this.chk.currentFrameChk=cidx;if(this.chk.started){if(this.chk.complete){this.chk.started=false;this.chk.complete=false;this.chk.tilesLoaded=true;for(var i=0;i<this.pageFrames.length;i++){var chkframe=this.getFrameByIdx(i);if(chkframe&&chkframe.loaded){this.chk.tilesLoaded=false;break}}}}}var frameToLoad=null;this.inprogress=false;for(var i=0;i<this.maxload;i++){if((cidx+1+i)<this.pageFrames.length){frameToLoad=this.getFrameByIdx(cidx+1+i);if(frameToLoad&&!frameToLoad.loaded&&(cidx+1+i)<this.pageFrames.length){break}}if((cidx-1-i)>=0){frameToLoad=this.getFrameByIdx(cidx-1-i);if(frameToLoad&&!frameToLoad.loaded&&(cidx-1-i)>=0){break}else{frameToLoad=null}}else{frameToLoad=null}}if(frameToLoad){if(!this.chk.started){this.chk.started=true;var userEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_PRELOAD_START,true);s7sdk.Event.dispatch(this.obj,userEvent,false)}}else{if(this.chk.started){if(!this.chk.complete){this.chk.complete=true;var userEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);s7sdk.Event.dispatch(this.obj,userEvent,false)}}else{}}return frameToLoad};s7sdk.set.PageView.prototype.setPortrait=function(){this.setSplitFrames(true)};s7sdk.set.PageView.prototype.setLandscape=function(){this.setSplitFrames(false)};s7sdk.set.PageView.prototype.setSplitFrames=function(value){if(this.splitFrames.orientation==value){return value}if(this.mediaSet_.portrait==null){this.splitFrames.orientation=false;return false}this.splitFrames.orientation=value;if(this.mediaSet_){this.orientationChanged=true;var idx=this.getCurrentFrameIndex();this.items=value?this.mediaSet_.portrait.items:this.mediaSet_.landscape.items;var idxDecoded=value?this.mediaSet_.getPortraitIndex(idx):this.mediaSet_.getLandscapeIndex(idx);this.refresh();this.setCurrentFrameIndex(idxDecoded)}return value};s7sdk.set.PageView.prototype.getCurrentAsset=function(){return typeof this.currentAsset=="undefined"?null:this.currentAsset};s7sdk.set.PageView.prototype.setCurrentAsset=function(assetInfo){this.viewIsMetadataSent=true;this.viewIsReadySent=true;this.hiresIsReadySent=true;if(typeof(assetInfo)=="string"){this.setAssetInternal(assetInfo)}else{this.setMediaSetInternal(assetInfo)}};s7sdk.set.PageView.prototype.setModifier=function(modObj){throw new Error("Trying to use setModifier on the Core class (PageView) is unsupported! Please refer to SDK documentation on using setModifier.")};s7sdk.set.PageView.prototype.setCSS=function(classname,property,value){if(this.isRestrictedCSSProperty(s7sdk.set.PageView.RESTRICTED_STYLES,property)){throw new Error("You cannot set "+classname+" : "+property+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[classname,property,value])}};(function addDefaultCSS(){var createRule=s7sdk.Util.css.createCssRuleText;var createImgUrl=s7sdk.Util.css.createCssImgUrlText;var isTouchActionIE=s7sdk.browser&&s7sdk.browser.name=="ie"&&s7sdk.browser.version.major>=10;var cssText=createRule(".s7pageview",{"background-color":"#ffffff",position:"absolute",width:"400px",height:"400px","z-index":"0","-ms-touch-action":isTouchActionIE?"none":"","touch-action":isTouchActionIE?"none":"","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)"})+createRule(".s7pageview [state='turn']",{"background-color":"#ffffff","border-color":"#dddddd"})+createRule(".s7pageview img",{"max-width":"none","max-height":"none"})+createRule(".s7pageview[cursortype='default']",{cursor:"default"})+createRule(".s7pageview[cursortype='zoomin']",{cursor:"default"})+createRule(".s7pageview[cursortype='reset']",{cursor:"default"})+createRule(".s7pageview[cursortype='drag']",{cursor:"default"})+createRule(".s7pageview[cursortype='slide']",{cursor:"default"})+createRule(".s7pageview .s7iconeffect",{width:"120px",height:"120px","-webkit-transform":"translateZ(0px)","background-repeat":"no-repeat","background-position":"center"})+createRule(".s7pageview .s7iconeffect[media-type='standard']",{"background-image":createImgUrl("doubletapicon.png")})+createRule(".s7pageview .s7iconeffect[media-type='multitouch']",{"background-image":createImgUrl("zoomicon.png")});cssText+=createRule(".s7pageview .s7pagedivider",{width:"40px","background-image":s7sdk.Util.css.createCssImgUrlText("divider.png")});s7sdk.Util.css.addDefaultCSS(cssText,"PageView")})()}if(!s7sdk.set.PageDivider){s7sdk.set.PageDivider=function(container,zIndex,pageturnstyle){arguments.callee.superclass.apply(this,[undefined,container,"div","s7pagedivider",undefined]);this.createElement();var container=this.getParent();container.appendChild(this.obj);this.obj.style.position="absolute";this.obj.style.zIndex=zIndex;if(pageturnstyle.transition!="turn"){return}this.obj.className="";this.obj.style.width=pageturnstyle.dividerWidth+"px";this.pageturnstyle=pageturnstyle;var dividerBuffer=document.createElement("canvas");dividerBuffer.style.position="absolute";dividerBuffer.width=pageturnstyle.dividerWidth;dividerBuffer.style.width=pageturnstyle.dividerWidth+"px";this.obj.appendChild(dividerBuffer);var parsed=pageturnstyle.dividerColor.match(/.{1,2}/g);this.partrgba="rgba("+parseInt(parsed[0],16)+","+parseInt(parsed[1],16)+","+parseInt(parsed[2],16);this.dividerBuffer=dividerBuffer};s7sdk.set.PageDivider.prototype.setHeight=function(h){this.obj.style.height=h+"px";if(typeof(this.dividerBuffer)=="undefined"){return}this.dividerBuffer.height=h;this.dividerBuffer.style.height=h+"px";var ctxDividerBuffer=this.dividerBuffer.getContext("2d");var divgradient=ctxDividerBuffer.createLinearGradient(0,0,this.dividerBuffer.width,0);divgradient.addColorStop(0,this.partrgba+", 0)");divgradient.addColorStop(0.5,this.partrgba+","+this.pageturnstyle.dividerOpacity+")");divgradient.addColorStop(1,this.partrgba+", 0)");ctxDividerBuffer.fillStyle=divgradient;ctxDividerBuffer.fillRect(0,0,this.dividerBuffer.width,h)};s7sdk.set.PageDivider.prototype.show=function(){this.dividerBuffer.style.visibility=""};s7sdk.set.PageDivider.prototype.hide=function(){this.dividerBuffer.style.visibility="hidden"};s7sdk.set.PageDivider.prototype.cleanUp=function(deep){if(this.obj){s7sdk.Util.removeTags(this.obj)}};s7sdk.set.PageDivider.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};s7sdk.Class.inherits("s7sdk.set.PageDivider","s7sdk.UIComponent");(function addDefaultCSS(){var createRule=s7sdk.Util.css.createCssRuleText;var cssText=createRule(".s7pagedivider",{width:"40px","background-image":s7sdk.Util.css.createCssImgUrlText("divider.png")});s7sdk.Util.css.addDefaultCSS(cssText,"PageDivider")})()}if(!s7sdk.set.PageFrame){s7sdk.set.PageFrame=function(container,serverUrl,imageName,idx,viewProps,initWidth,initHeight,pgalign,label){this.container=container;this.idx=idx;this.imageName=imageName;this.serverUrl=serverUrl;this.viewProps=viewProps;this.initWidth=initWidth;this.initHeight=initHeight;this.view=null;this.viewPort=null;this.notify=true;this.dragToPan=true;this.invalidated=false;this.tileRender=false;this.delayTileLoad=true;this.priority=0;this.loaded=false;this.align=pgalign;this.label=label;this.isReq=null;this.image=new Image();this.image.imageFrame=this};s7sdk.set.PageFrame.MAX_PRIORITY=100;s7sdk.set.PageFrame.prototype.loadFrame=function(){if(this.view!=null){return}if(!this.loaded){this.viewProps.width=this.initWidth;this.viewProps.height=this.initHeight;this.initView();s7sdk.Event.dispatch(this.image,s7sdk.Event.VIEW_LOADED,true);s7sdk.Event.addDOMListener(this.image,s7sdk.Event.RENDER,this.renderHandler,true);this.loaded=true}};s7sdk.set.PageFrame.prototype.initView=function(){with(this){s7sdk.Logger.log(s7sdk.Logger.FINER,"PageFrame.initView - imageName: %0",imageName);if(s7sdk.browser.name==="ie"&&(s7sdk.browser.version.major<9)){this.view=new s7sdk.rgn.View(serverUrl+"/"+imageName,viewProps.width,viewProps.height,viewProps.resetWidth,viewProps.resetHeight,this.container.devicePixelRatio,viewProps.zoomStep,viewProps.limit,viewProps.transitionTime,viewProps.transitionEasing,viewPort,viewProps.elasticZoom,viewProps.clickToZoom,viewProps.fmt,0,true,this.idx,this.align)}else{this.view=new s7sdk.View(serverUrl+"/"+imageName,viewProps.width,viewProps.height,viewProps.resetWidth,viewProps.resetHeight,this.container.devicePixelRatio,viewProps.zoomStep,viewProps.limit,viewProps.transitionTime,viewProps.transitionEasing,viewPort,viewProps.elasticZoom,viewProps.clickToZoom,viewProps.fmt,0,true,this.idx,this.align)}view.dragToPan=dragToPan;view.tileRender=tileRender;view.delayTileLoad=delayTileLoad;view.viewParent=this.container;if(this.container.devicePixelRatio!=this.view.devicePixelRatio){this.container.adjustDevicePixelRatio()}this.container.viewStateChange(this.view.state);if(viewProps.resetHeight!=viewProps.outHeight||viewProps.resetWidth!=viewProps.outWidth){view.resize(viewProps.outWidth,viewProps.outHeight)}if(invalidated){view.loadImage();view.invalidate();invalidated=false}}};s7sdk.set.PageFrame.prototype.resize=function(){if(this.view!=null){this.view.resize(this.viewProps.outWidth,this.viewProps.outHeight)}};s7sdk.set.PageFrame.prototype.renderHandler=function(event){if(this.imageFrame.view!=null){this.imageFrame.view.draw()}};s7sdk.set.PageFrame.prototype.invalidate=function(delayed){if(this.view!=null){this.view.tileRender=this.tileRender;this.view.loadImage();this.view.invalidate()}else{this.invalidated=true}};s7sdk.set.PageFrame.prototype.setDragToPan=function(value){this.dragToPan=value;if(this.view!=null){this.view.dragToPan=value}};s7sdk.set.PageFrame.prototype.setDelayTileLoad=function(value){if(this.view!=null){this.view.delayTileLoad=value}this.delayTileLoad=value};s7sdk.set.PageFrame.prototype.unload=function(mask){if(this.view!=null){this.view.unload(mask)}};s7sdk.set.PageFrame.prototype.setTileRender=function(value){if(this.view!=null){this.view.tileRender=value}this.tileRender=value};s7sdk.set.PageFrame.prototype.setPriority=function(p){this.priority=(p<1)?1:(p>s7sdk.set.PageFrame.MAX_PRIORITY)?s7sdk.set.PageFrame.MAX_PRIORITY:p};s7sdk.set.PageFrame.prototype.getView=function(){return this.view};s7sdk.set.PageFrame.prototype.resetImageLoaded=function(){return this.view!=null&&this.view.resetImageLoaded}}if(!s7sdk.set.PageFrameLoader){s7sdk.set.PageFrameLoader=function(container,delay){this.container=container;this.delay=(null==delay)?100:delay;this.timer=setInterval(s7sdk.Util.wrapContext(this.onProcess,this),this.delay);this.queue=[];this.processed=[];this.toLoad=0;this.frameToLoad=null};s7sdk.set.PageFrameLoader.prototype.load=function(frames,idx,noWait){frames.idx=idx;frames.noWait=noWait;this.queue.push(frames);return true};s7sdk.set.PageFrameLoader.prototype.onProcess=function(){if(this.processed.length==0){if(this.queue.length!=0){this.processed=this.queue.pop();this.toLoad=0;this.queue=[]}else{if(!this.frameToLoad){this.frameToLoad=this.container.getFromRadius(this.processed.idx);if(this.frameToLoad&&!this.frameToLoad.loaded){this.frameToLoad.loadFrame();this.frameToLoad.setTileRender(false);this.frameToLoad.setDelayTileLoad(true)}else{this.frameToLoad=null}}else{if(this.frameToLoad&&this.frameToLoad.loaded){this.frameToLoad=null}}}}var alreadyLoaded=[];while(this.processed.length!=0){var frame=this.processed.pop();if(!frame.loaded){frame.loadFrame();if(frame.view.resetImageLoaded){alreadyLoaded.push(frame)}else{if(this.processed.noWait){if(this.processed.idx==frame.idx||frame.idx==0){frame.view.onResetImageLoaded=s7sdk.Util.wrapContext(this.onResetImageLoaded,this)}else{this.toLoad--}}else{frame.view.onResetImageLoaded=s7sdk.Util.wrapContext(this.onResetImageLoaded,this)}}frame.setTileRender(false);frame.setDelayTileLoad(true);this.toLoad++}else{if(frame.view.resetImageLoaded){alreadyLoaded.push(frame);this.toLoad++}}}while(alreadyLoaded.length!=0){var frame=alreadyLoaded.pop();this.onResetImageLoaded(true,frame.idx)}};s7sdk.set.PageFrameLoader.prototype.onResetImageLoaded=function(opResult,idx){this.toLoad--;this.container.onResetImageLoaded(opResult,idx)}}if(!s7sdk.set.PVViewWrapper){s7sdk.set.PVViewWrapper=function PVViewWrapper(parentObj,ow,oh,w,h,leftPos,spacing,zIndex,devicePixelRatio){this.parentObj=parentObj;this.leftPos=leftPos;this.spacing=spacing;this.obj=s7sdk.Util.createObj(null,"div",null,null);this.obj.style.zIndex=zIndex;this.displayElement=s7sdk.browser.name==="ie"&&(s7sdk.browser.version.major<9)?s7sdk.rgn.View.createDisplay():s7sdk.View.createDisplay();this.displayElement.width=ow*devicePixelRatio;this.displayElement.height=oh*devicePixelRatio;this.obj.style.position="absolute";this.displayElement.style.width=this.obj.style.width=w+"px";this.displayElement.style.height=this.obj.style.height=h+"px";this.obj.style.left=leftPos*(w+spacing)+"px";this.obj.style.width=(w+spacing)+"px";this.obj.appendChild(this.displayElement);this.loresIsloaded=false};s7sdk.set.PVViewWrapper.prototype.drawChild=function(){this.parentObj.drawChild()};s7sdk.set.PVViewWrapper.prototype.viewStateChange=function(state){};s7sdk.set.PVViewWrapper.prototype.viewInvalidate=function(viewPort){};s7sdk.set.PVViewWrapper.prototype.onReadyToDislpay=function(){this.loresIsloaded=true;if(this.parentObj&&this.parentObj.doInitialSlide){this.parentObj.doInitialSlide()}};s7sdk.set.PVViewWrapper.prototype.resize=function(ow,oh,w,h,devicePixelRatio){this.displayElement.width=ow;this.displayElement.height=oh;this.displayElement.style.width=this.obj.style.width=w+"px";this.displayElement.style.height=this.obj.style.height=h+"px";this.obj.style.left=this.leftPos*(w+this.spacing)+"px";this.obj.style.width=(w+this.spacing)+"px";if(this.view){this.view.resize(w*devicePixelRatio,h*devicePixelRatio)}}}if(!s7sdk.set.RotFn){s7sdk.set.RotFn=function RotFn(anchorObj,container,devicePixelRatio,dCenter,pageturnstyle){this.pageturnstyle=pageturnstyle;this.dCenter=dCenter;this.dividerWid=parseInt(pageturnstyle.dividerWidth/2);this.sensativeRadius=40;this.upDist=90;this.refreshInterval=30;this.devicePixelRatio=devicePixelRatio;this.anchorObj=anchorObj;this.container=container;this.obj=document.createElement("div");this.obj.className="s7turn";this.obj.style.position="absolute";this.obj.style.zIndex=914;this.obj.style.display="none";this.container.insertBefore(this.obj,anchorObj);this.dividerBuffer=document.createElement("canvas");this.dividerBuffer.style.position="absolute";this.dividerBuffer.style.visibility="hidden";this.obj.appendChild(this.dividerBuffer);this.ctxDividerBuffer=this.dividerBuffer.getContext("2d");this.viewportColor=document.createElement("canvas");this.viewportColor.style.position="absolute";this.viewportColor.style.visibility="hidden";this.obj.appendChild(this.viewportColor);this.ctxColor=this.viewportColor.getContext("2d");this.viewportBg=document.createElement("canvas");this.viewportBg.style.position="absolute";this.obj.appendChild(this.viewportBg);this.ctxBg=this.viewportBg.getContext("2d");this.viewport=document.createElement("canvas");this.viewport.style.position="absolute";this.obj.appendChild(this.viewport);this.ctx=this.viewport.getContext("2d");this.divider=document.createElement("canvas");this.divider.style.position="absolute";this.obj.appendChild(this.divider);this.ctxDivider=this.divider.getContext("2d");this.prev={x:0,y:0};this.dxy_={x:0,y:0};var inst=this;this.interv=setInterval(function(){inst.onInterval_()},this.refreshInterval);this.resize()};s7sdk.set.RotFn.prototype.translateToAnchor=function(dxy){var mouseAnchor=s7sdk.Util.getObjPos(this.anchorObj);dxy.x-=mouseAnchor.x;dxy.y-=mouseAnchor.y};s7sdk.set.RotFn.prototype.resize=function(){this.widA=this.wid_=Math.floor(parseFloat(this.dCenter.displayElement.style.width.replace("px","")));this.heiA=this.hei_=Math.floor(parseFloat(this.dCenter.displayElement.style.height.replace("px","")));this.extX_=0;this.extY_=Math.sqrt(Math.pow(this.wid_/2,2)+Math.pow(this.hei_,2))-this.hei_;this.extY_=Math.floor(this.extY_);this.obj.style.top=-this.extY_+"px";this.obj.style.left="0px";this.autoRadius=(Math.pow(this.wid_/2,2)+Math.pow(this.upDist,2))/(2*this.upDist);var maxDividerHei=parseInt(Math.sqrt(Math.pow(this.wid_/2,2)+Math.pow(this.hei_,2))+40);this.dividerBuffer.width=2*this.dividerWid*this.devicePixelRatio;this.dividerBuffer.height=maxDividerHei*this.devicePixelRatio;this.dividerBuffer.style.width=2*this.dividerWid+"px";this.dividerBuffer.style.height=maxDividerHei+"px";var divgradient=this.ctxDividerBuffer.createLinearGradient(0,0,this.dividerBuffer.width,0);var parsed=this.pageturnstyle.dividerColor.match(/.{1,2}/g);var partrgba="rgba("+parseInt(parsed[0],16)+","+parseInt(parsed[1],16)+","+parseInt(parsed[2],16);divgradient.addColorStop(0,partrgba+", 0)");divgradient.addColorStop(0.5,partrgba+","+this.pageturnstyle.dividerOpacity+")");divgradient.addColorStop(1,partrgba+", 0)");this.ctxDividerBuffer.fillStyle=divgradient;this.ctxDividerBuffer.fillRect(0,0,this.dividerBuffer.width,this.dividerBuffer.height);this.viewportColor.width=this.wid_*this.devicePixelRatio;this.viewportColor.height=this.hei_*this.devicePixelRatio;this.viewportColor.style.width=this.wid_+"px";this.viewportColor.style.height=this.hei_+"px";this.ctxColor.rect(0,0,this.wid_*this.devicePixelRatio,this.hei_*this.devicePixelRatio);this.ctxColor.fillStyle=this.pageturnstyle.fillColor;this.ctxColor.fill();this.viewportBg.width=this.viewport.width=this.wid_*this.devicePixelRatio;this.viewportBg.height=this.viewport.height=(this.hei_+2*this.extY_)*this.devicePixelRatio;this.viewportBg.style.width=this.viewport.style.width=this.wid_+"px";this.viewportBg.style.height=this.viewport.style.height=(this.hei_+2*this.extY_)+"px";this.divider.width=Math.floor(this.wid_*this.devicePixelRatio);this.divider.height=Math.floor((this.hei_+2*this.extY_)*this.devicePixelRatio);this.divider.style.width=this.wid_+"px";this.divider.style.height=(this.hei_+2*this.extY_)+"px";this.ctxwid_=this.wid_+10;this.ctxhei_=this.hei_+2*this.extY_+10;this.wid_=Math.floor(this.wid_*this.devicePixelRatio);this.hei_=Math.floor(this.hei_*this.devicePixelRatio);this.extY_=Math.floor(this.extY_*this.devicePixelRatio);this.ctxwid_=Math.floor(this.ctxwid_*this.devicePixelRatio);this.ctxhei_=Math.floor(this.ctxhei_*this.devicePixelRatio);this.dividerWid=Math.floor(this.dividerWid*this.devicePixelRatio);this.autoRadius=Math.floor(this.autoRadius*this.devicePixelRatio)};s7sdk.set.RotFn.prototype.bindImages=function(leftImg,centerImg,rightImg){this.leftImg=leftImg;this.centerImg=centerImg;this.rightImg=rightImg};s7sdk.set.RotFn.prototype.getNormalPointer=function(dxy){dxy.flipMode=(dxy.y>this.heiA/2?2:0)|(dxy.x>this.widA/2?1:0);if(dxy.flipMode&1){dxy.x=this.widA-dxy.x}if(dxy.flipMode&2){dxy.y=this.heiA-dxy.y}return dxy};s7sdk.set.RotFn.prototype.getFixedPointer=function(dxy){dxy=this.getNormalPointer(dxy);var cr=Math.sqrt(Math.pow(dxy.x,2)+Math.pow(dxy.y,2));if(cr>this.sensativeRadius){dxy.x=dxy.x*this.sensativeRadius/cr;dxy.y=dxy.y*this.sensativeRadius/cr}if(dxy.flipMode&1){dxy.x=this.widA-dxy.x}if(dxy.flipMode&2){dxy.y=this.heiA-dxy.y}this.flipMode=dxy.flipMode;return dxy};s7sdk.set.RotFn.prototype.setCurrentPosition=function(dxy_){this.dxy_=dxy_};s7sdk.set.RotFn.prototype.getCurrentPosition=function(){return this.dxy_};s7sdk.set.RotFn.prototype.divPrepare=function(dxy_){this.flipMode=(dxy_.y>this.hei_/2?2:0)|(dxy_.x>this.wid_/2?1:0);this.divBgPrepare()};s7sdk.set.RotFn.prototype.finalStep=function(dir,reverse,custom){this.ctx.clearRect(0,0,this.ctxwid_,this.ctxhei_);this.ctx.drawImage(this.viewportColor,0,0,this.wid_,this.hei_,this.extX_,this.extY_,this.wid_,this.hei_);if(reverse){this.ctx.drawImage(this.centerImg,0,0,this.wid_,this.hei_,this.extX_,this.extY_,this.wid_,this.hei_)}else{this.ctx.drawImage(dir?this.leftImg:this.rightImg,0,0,this.wid_,this.hei_,this.extX_,this.extY_,this.wid_,this.hei_)}this.ctxDivider.clearRect(0,0,this.ctxwid_,this.ctxhei_)};s7sdk.set.RotFn.prototype.divBgPrepare=function(){this.ctx.drawImage(this.centerImg,0,0,this.wid_,this.hei_,this.extX_,this.extY_,this.wid_,this.hei_);this.ctxBg.save();this.ctxBg.clearRect(0,0,this.ctxwid_,this.ctxhei_);this.ctxBg.drawImage(this.viewportColor,0,0,this.wid_,this.hei_,this.extX_,this.extY_,this.wid_,this.hei_);this.ctxBg.drawImage(this.leftImg,0,0,this.wid_/2,this.hei_,this.extX_,this.extY_,this.wid_/2,this.hei_);this.ctxBg.drawImage(this.rightImg,this.wid_/2,0,this.wid_/2,this.hei_,this.extX_+this.wid_/2,this.extY_,this.wid_/2,this.hei_);this.ctxBg.restore()};s7sdk.set.RotFn.prototype.calcAutoPoint=function(step){var res={};var relx=this.wid_*(step>0.5?1-step:step)/2;res.y=Math.sqrt(Math.pow(this.autoRadius,2)-Math.pow(relx+this.wid_/2,2))-(this.autoRadius-this.upDist);if(this.flipMode&2){res.y+=this.hei_}res.x=this.wid_*step;return res};s7sdk.set.RotFn.prototype.calcPoint=function(step,direction,reverse){var res={};if(reverse){res.x=(this.flipMode&1?step:1-step)*this.wid_;res.y=(this.flipMode&1?this.wid_-res.x:res.x)*this.angel}else{res.x=(this.flipMode&1?1-step:step)*this.wid_;res.y=(this.flipMode&1?res.x:this.wid_-res.x)*this.angel}if(this.flipMode&2){res.y=this.hei_-res.y}return res};s7sdk.set.RotFn.prototype.calcAutoAngel=function(){var dxy=this.calcDest(this.dxy_);dxy.destY-=this.extY_;var dest={};dest.reverse=(dxy.flipMode&1)==(this.flipMode&1);dest.flipMode=this.flipMode;var relX=dxy.destX/this.wid_;if(dest.reverse){dest.step=dest.flipMode&1?relX:1-relX;this.angel=(dest.flipMode&2?this.hei_-dxy.destY:dxy.destY)/(dest.flipMode&1?this.wid_-dxy.destX:dxy.destX)}else{dest.step=dest.flipMode&1?1-relX:relX;this.angel=(dest.flipMode&2?this.hei_-dxy.destY:dxy.destY)/(dest.flipMode&1?dxy.destX:this.wid_-dxy.destX)}return dest};s7sdk.set.RotFn.prototype.calcDest=function(dxy_s){var dxy={x:dxy_s.x-this.wid_/2,y:dxy_s.y-this.hei_*(this.flipMode>1?1:0),flipMode:(dxy_s.y>this.hei_/2?2:0)|(dxy_s.x>this.wid_/2?1:0)};if(Math.sqrt(Math.pow(dxy.x,2)+Math.pow(dxy.y,2))<=this.wid_/2){dxy.destX=dxy.x;dxy.destY=this.hei_*(this.flipMode>1?1:0)+dxy.y}else{dxy.destX=(dxy.x<0?-1:1)*this.wid_/2*(Math.cos(Math.atan(dxy.y/dxy.x)));dxy.destY=this.hei_*(this.flipMode>1?1:0)+(dxy.y<0?-1:1)*this.wid_/2*Math.abs((Math.sin(Math.atan(dxy.y/dxy.x))))}var directionAngle=Math.atan((Math.abs(dxy.destX))/(this.flipMode>1?dxy.destY:this.hei_-dxy.destY));var outerRadius=Math.sqrt(Math.pow(this.wid_/2,2)+Math.pow(this.hei_,2));var maxX=(dxy.x<0?-1:1)*Math.sin(directionAngle)*outerRadius;var maxY=Math.cos(directionAngle)*outerRadius;var currentRadius=Math.sqrt(Math.pow(dxy.x,2)+Math.pow(this.hei_+dxy.y*(this.flipMode>1?1:-1),2));if(this.flipMode>1){if((currentRadius>outerRadius)&&(dxy.y>0)){dxy.destX=maxX;dxy.destY=maxY}}else{if((currentRadius>outerRadius)&&(dxy.y<0)){dxy.destX=maxX;dxy.destY=this.hei_-maxY}}var crossX=(this.wid_+2*this.extX_+dxy.destX+(this.flipMode&1?1:-1)*this.wid_/2)/2;var crossToCorner=Math.sqrt(Math.pow(this.extX_+this.wid_*(this.flipMode&1)-crossX,2)+Math.pow((this.hei_*(this.flipMode>1?1:0)-dxy.destY)/2,2));var angleToCorner=Math.atan((this.hei_*(this.flipMode>1?1:0)-dxy.destY)/((this.flipMode&1?1:-1)*this.wid_/2-dxy.destX));dxy.maskX=(this.wid_/2-crossToCorner/Math.cos(angleToCorner))*(this.flipMode&1?1:-1);var difX=dxy.maskX-dxy.destX;var difY=this.flipMode>1?this.hei_-dxy.destY:this.hei_*0-dxy.destY;if((this.hei_+(this.flipMode>1?0:1)*this.hei_-dxy.destY>=0)&&(difY!=0)){dxy.imgAngle=Math.PI/2-Math.atan(difX/difY)}else{if(difY!=0){dxy.imgAngle=-Math.PI/2-Math.atan(difX/difY)}else{if((this.flipMode&1)==1){dxy.imgAngle=0}else{dxy.imgAngle=Math.PI}}}dxy.maskY=this.flipMode>1?this.hei_+this.extY_:this.extY_;var normalY=this.flipMode>1?(this.hei_-dxy.destY)/2:(this.hei_*0-dxy.destY)/2;dxy.maskX=dxy.maskX+this.wid_/2+this.extX_;dxy.maskAngle=normalY!=0?Math.atan((crossX-dxy.maskX)/normalY):0;dxy.destX=dxy.destX+this.wid_/2+this.extX_;dxy.destY=dxy.destY+this.extY_;return dxy};s7sdk.set.RotFn.prototype.clearDivider=function(){this.ctxDivider.clearRect(0,0,this.ctxwid_,this.ctxhei_)};s7sdk.set.RotFn.prototype.drawDivider=function(dxy){this.ctxDivider.clearRect(0,0,this.ctxwid_,this.ctxhei_);this.ctxDivider.save();var yy=Math.sqrt(Math.pow(this.wid_,2)+Math.pow(this.hei_+2*this.extY_,2))/2;var sin=Math.sin(dxy.maskAngle);var xpos=this.flipMode&1?this.wid_-dxy.maskX:dxy.maskX;var diag;var maskAngle=dxy.maskAngle*(this.flipMode==0||this.flipMode==3?1:-1);if(maskAngle<0){diag=Math.abs(this.hei_/Math.cos(maskAngle))}else{if(sin==0){diag=this.hei_}else{var ypos=Math.abs(xpos/Math.tan(maskAngle));if(ypos>=this.hei_){diag=Math.abs(this.hei_/Math.cos(maskAngle))}else{diag=Math.abs(xpos/Math.sin(maskAngle))}}}this.ctxDivider.translate(dxy.maskX,dxy.maskY);this.ctxDivider.rotate(dxy.maskAngle);this.ctxDivider.translate(0,-yy-(this.flipMode&2?diag:0));this.ctxDivider.drawImage(this.dividerBuffer,0,0,2*this.dividerWid,diag,-this.dividerWid,yy,2*this.dividerWid,diag);this.ctxDivider.restore();xpos=xpos==0?2:xpos;this.ctxDivider.save();this.ctxDivider.translate(dxy.maskX,dxy.maskY);var xShift=this.hei_*Math.tan(maskAngle);switch(this.flipMode){case 0:if(dxy.y>0){this.ctxDivider.clearRect(-xpos,-this.dividerWid,xpos,this.dividerWid);this.ctxDivider.rotate(dxy.imgAngle);this.ctxDivider.clearRect(0,-this.dividerWid,xpos,this.dividerWid);this.ctxDivider.clearRect(xpos,-this.dividerWid,this.dividerWid,this.hei_+this.dividerWid)}else{if(dxy.y!=0){this.ctxDivider.clearRect(-xpos,this.hei_,xpos+Math.abs(xShift),this.dividerWid);this.ctxDivider.rotate(dxy.imgAngle);this.ctxDivider.clearRect(-xpos,-this.hei_-this.dividerWid,xpos+Math.abs(xShift),this.dividerWid);this.ctxDivider.clearRect(-xpos-this.dividerWid,-this.hei_,this.dividerWid,this.hei_)}}break;case 1:if(dxy.y>0){this.ctxDivider.clearRect(0,-this.dividerWid,xpos,this.dividerWid);this.ctxDivider.rotate(dxy.imgAngle);this.ctxDivider.clearRect(0,0,xpos,this.dividerWid);this.ctxDivider.clearRect(xpos,-this.hei_,this.dividerWid,this.hei_+this.dividerWid)}else{if(dxy.y!=0){this.ctxDivider.clearRect(xShift,this.hei_,xpos+Math.abs(xShift),this.dividerWid);this.ctxDivider.rotate(dxy.imgAngle);this.ctxDivider.clearRect(-xpos,this.hei_,xpos+Math.abs(xShift),this.dividerWid);this.ctxDivider.clearRect(-xpos-this.dividerWid,0,this.dividerWid,this.hei_)}}break;case 2:if(dxy.y>0){this.ctxDivider.clearRect(-xpos,-this.hei_-this.dividerWid,xpos+Math.abs(xShift),this.dividerWid);this.ctxDivider.rotate(dxy.imgAngle);this.ctxDivider.clearRect(-xpos,this.hei_,xpos+Math.abs(xShift),this.dividerWid);this.ctxDivider.clearRect(-xpos-this.dividerWid,0,this.dividerWid,this.hei_)}else{if(dxy.y!=0){this.ctxDivider.clearRect(-xpos-Math.abs(xShift),0,xpos+Math.abs(xShift),this.dividerWid);this.ctxDivider.rotate(dxy.imgAngle);this.ctxDivider.clearRect(-xpos,-this.dividerWid,xpos,this.dividerWid);this.ctxDivider.clearRect(-xpos-this.dividerWid,-this.dividerWid,this.dividerWid,this.hei_+this.dividerWid)}}break;case 3:if(dxy.y>0){this.ctxDivider.clearRect(-Math.abs(xShift),-this.hei_-this.dividerWid,xpos+Math.abs(xShift),this.dividerWid);this.ctxDivider.rotate(dxy.imgAngle);this.ctxDivider.clearRect(-xpos,-this.hei_-this.dividerWid,xpos+Math.abs(xShift),this.dividerWid);this.ctxDivider.clearRect(-xpos-this.dividerWid,-this.hei_,this.dividerWid,this.hei_)}else{if(dxy.y!=0){this.ctxDivider.clearRect(0,0,xpos+Math.abs(xShift),this.dividerWid);this.ctxDivider.rotate(dxy.imgAngle);this.ctxDivider.clearRect(-xpos,0,xpos,this.dividerWid);this.ctxDivider.clearRect(-xpos-this.dividerWid,-this.hei_,this.dividerWid,this.hei_+this.dividerWid)}}break}this.ctxDivider.restore()};s7sdk.set.RotFn.prototype.divRotate=function(dxy_s){var dxy=this.calcDest(dxy_s);this.ctx.clearRect(0,0,this.ctxwid_,this.ctxhei_);this.ctx.drawImage(this.viewportColor,0,0,this.wid_,this.hei_,this.extX_,this.extY_,this.wid_,this.hei_);this.ctx.save();this.ctx.drawImage(this.viewportColor,this.extX_,this.extY_,this.wid_,this.hei_);this.ctx.drawImage(this.centerImg,this.extX_,this.extY_,this.wid_,this.hei_);this.ctx.save();this.ctx.translate(dxy.destX,dxy.destY);switch(this.flipMode){case 0:this.ctx.rotate(dxy.imgAngle+Math.PI*(dxy.y<=0?1:0));if(this.pageturnstyle.borderOnOff){this.ctx.strokeStyle=this.pageturnstyle.borderColor;this.ctx.strokeRect(-this.wid_,0,this.wid_,this.hei_)}this.ctx.translate(-this.wid_,0);this.ctx.drawImage(this.viewportColor,0,0);this.ctx.drawImage(this.leftImg,0,0);break;case 1:this.ctx.rotate(dxy.imgAngle+Math.PI*(dxy.y>0?1:0));if(this.pageturnstyle.borderOnOff){this.ctx.strokeStyle=this.pageturnstyle.borderColor;this.ctx.strokeRect(0,0,this.wid_,this.hei_)}this.ctx.translate(0,0);this.ctx.drawImage(this.viewportColor,0,0);this.ctx.drawImage(this.rightImg,0,0);this.ctx.restore();this.ctx.save();this.ctx.translate(dxy.destX,dxy.destY);this.ctx.rotate(dxy.imgAngle);break;case 2:this.ctx.rotate(dxy.imgAngle+Math.PI);if(this.pageturnstyle.borderOnOff){this.ctx.strokeStyle=this.pageturnstyle.borderColor;this.ctx.strokeRect(-this.wid_,-this.hei_,this.wid_,this.hei_)}this.ctx.translate(-this.wid_,-this.hei_);this.ctx.drawImage(this.viewportColor,0,0);this.ctx.drawImage(this.leftImg,0,0);break;case 3:this.ctx.rotate(dxy.imgAngle);if(this.pageturnstyle.borderOnOff){this.ctx.strokeStyle=this.pageturnstyle.borderColor;this.ctx.strokeRect(0,-this.hei_,this.wid_,this.hei_)}this.ctx.translate(0,-this.hei_);this.ctx.drawImage(this.viewportColor,0,0);this.ctx.drawImage(this.rightImg,0,0);this.ctx.restore();this.ctx.save();this.ctx.translate(dxy.destX,dxy.destY);this.ctx.rotate(dxy.imgAngle);break}this.ctx.restore();this.ctx.translate(dxy.maskX,dxy.maskY);this.ctx.rotate(dxy.maskAngle);var yy=Math.max(this.wid_,this.hei_+2*this.extY_);var xx=Math.sqrt(Math.pow(this.wid_,2)+Math.pow(this.hei_+2*this.extY_,2))/2;this.ctx.translate(this.flipMode&1==1?0:-xx,0);if(s7sdk.browser.name==="ie"&&(s7sdk.browser.version.major==9)){this.ctx.clearRect(0,-yy,xx,yy);this.ctx.clearRect(0,-5,xx,yy)}else{this.ctx.clearRect(0,-yy,xx,2*yy)}this.ctx.restore();this.drawDivider(dxy);if(s7sdk.browser.device.name=="android"&&s7sdk.browser.device.version=="4"){this.viewport.style.opacity=0.99;var inst=this;setTimeout(function(){inst.viewport.style.opacity=1},0)}};s7sdk.set.RotFn.prototype.onInterval_=function(){if(this.prev.x==this.dxy_.x&&this.prev.y==this.dxy_.y){return}this.prev.x=this.dxy_.x;this.prev.y=this.dxy_.y;this.divRotate(this.dxy_)};s7sdk.set.RotFn.prototype.cleanUp=function(deep){clearInterval(this.interv);if(this.obj){s7sdk.Util.removeTags(this.obj)}};s7sdk.set.RotFn.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}}}})(s7getCurrentNameSpace());