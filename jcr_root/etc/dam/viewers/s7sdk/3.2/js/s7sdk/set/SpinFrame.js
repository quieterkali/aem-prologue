/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(s7sdk){s7sdk.Util.require("s7sdk.set.SpinView");s7sdk.Util.require("s7sdk.set.SpinFrameLoader");if(!s7sdk.SpinFrame){s7sdk.SpinFrame=function(container,serverUrl,imageName,idx,viewProps,initWidth,initHeight){this.container=container;this.idx=idx;this.imageName=imageName;this.serverUrl=serverUrl;this.viewProps=viewProps;this.initWidth=initWidth;this.initHeight=initHeight;this.view=null;this.viewPort=null;this.notify=true;this.dragToPan=true;this.invalidated=false;this.tileRender=false;this.delayTileLoad=true;this.priority=0;this.loaded=false;this.isReq=null;this.image=new Image();this.image.imageFrame=this;this.isDisposed=false};s7sdk.SpinFrame.MAX_PRIORITY=100;s7sdk.SpinFrame.prototype.loadFrame=function(){if(this.view!=null){return}if(this.isDisposed){return}if(!this.loaded){this.viewProps.width=this.initWidth;this.viewProps.height=this.initHeight;this.initView();s7sdk.Event.dispatch(this.image,s7sdk.Event.VIEW_LOADED,true);s7sdk.Event.addDOMListener(this.image,s7sdk.Event.RENDER,this.renderHandler,true);this.loaded=true}};s7sdk.SpinFrame.prototype.initView=function(){with(this){s7sdk.Logger.log(s7sdk.Logger.FINER,"s7sdk.SpinFrame.initView - imageName: %0",imageName);if(s7sdk.browser.name==="ie"&&(s7sdk.browser.version.major<11)){this.view=new s7sdk.rgn.View(serverUrl+"/"+imageName,viewProps.width,viewProps.height,viewProps.resetWidth,viewProps.resetHeight,this.container.devicePixelRatio,viewProps.zoomStep,viewProps.limit,viewProps.transitionTime,viewProps.transitionEasing,viewPort,viewProps.elasticZoom,viewProps.clickToZoom,viewProps.fmt,0,false)}else{this.view=new s7sdk.View(serverUrl+"/"+imageName,viewProps.width,viewProps.height,viewProps.resetWidth,viewProps.resetHeight,this.container.devicePixelRatio,viewProps.zoomStep,viewProps.limit,viewProps.transitionTime,viewProps.transitionEasing,viewPort,viewProps.elasticZoom,viewProps.clickToZoom,viewProps.fmt,0,false)}view.dragToPan=dragToPan;view.tileRender=tileRender;view.delayTileLoad=delayTileLoad;view.viewParent=this.container;if(this.container.devicePixelRatio!=this.view.devicePixelRatio){this.container.adjustDevicePixelRatio()}this.container.viewStateChange(this.view.state);if(viewProps.resetHeight!=viewProps.outHeight||viewProps.resetWidth!=viewProps.outWidth){view.resize(viewProps.outWidth,viewProps.outHeight)}if(invalidated){view.loadImage();view.invalidate();invalidated=false}}};s7sdk.SpinFrame.prototype.resize=function(){if(this.view!=null){this.view.resize(this.viewProps.outWidth,this.viewProps.outHeight);this.view.draw()}};s7sdk.SpinFrame.prototype.renderHandler=function(event){if(this.imageFrame.view!=null){this.imageFrame.view.draw()}};s7sdk.SpinFrame.prototype.invalidate=function(){if(this.view!=null){this.view.tileRender=this.tileRender;this.view.loadImage();this.view.invalidate()}else{this.invalidated=true}};s7sdk.SpinFrame.prototype.setDragToPan=function(value){this.dragToPan=value;if(this.view!=null){this.view.dragToPan=value}};s7sdk.SpinFrame.prototype.setDelayTileLoad=function(value){if(this.view!=null){this.view.delayTileLoad=value}this.delayTileLoad=value};s7sdk.SpinFrame.prototype.unload=function(mask){if(this.view!=null){this.view.unload(mask)}};s7sdk.SpinFrame.prototype.setTileRender=function(value){if(this.view!=null){this.view.tileRender=value}this.tileRender=value};s7sdk.SpinFrame.prototype.setPriority=function(p){this.priority=(p<1)?1:(p>s7sdk.SpinFrame.MAX_PRIORITY)?s7sdk.SpinFrame.MAX_PRIORITY:p};s7sdk.SpinFrame.prototype.getView=function(){return this.view};s7sdk.SpinFrame.prototype.dispose=function(){if(this.image){s7sdk.Event.removeDOMListener(this.image,s7sdk.Event.RENDER,this.renderHandler,true)}if(this.view){this.view.onResetImageLoaded=null;this.view.onTileLoad=null;this.view.unload(1|8);this.view.detach();this.view.viewParent=null;delete this.view}this.container=null;this.viewProps=null;this.viewPort=null;this.isReq=null;this.image=null;this.isDisposed=true}}})(s7getCurrentNameSpace());