/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.info");b.Util.require("s7sdk.common.Button");b.Util.require("s7sdk.common.IS");if(!b.info.InfoPopupPanelControl){b.info.InfoPopupPanelControl=function(e){arguments.callee.superclass.apply(this,[e,b.info.InfoPopupPanelControl.NS,e.constructor,b.info.InfoPanelPopup.RESTRICTED_STYLES])};b.info.InfoPopupPanelControl.prototype.rebuild=function(g){if(this.component){var e=this.component.isVisible;var h="";var f=null;if(e){h=this.component.content.innerHTML;f=this.component.rolloverKey}this.superclass.prototype.rebuild.apply(this,[g]);if(e&&f&&f!=""){this.component.activateRollover(f)}}};b.info.InfoPopupPanelControl.NS="s7sdk.info.InfoPopupPanelControl"}b.Class.inherits(b.info.InfoPopupPanelControl.NS,"s7sdk.ControlComponent");if(!b.info.InfoPanelPopup){b.info.InfoPanelPopup=function InfoPanelPopup(e,g,f){var i=!!arguments[3];b.Logger.log(b.Logger.CONFIG,"s7sdk.info.InfoPanelPopup constructor - container: %0, settings: %1 , compId: %2",e,g,f);arguments.callee.superclass.apply(this,[f,e,"div","s7infopanelpopup",g,i]);this.isVisible=false;this.compId=(b.Util.isNull(f)?"":f);this.container=this.getParent();this.responseTemplateInfo=this.parseResponseTemplate(this.template);this.infoServerConnector=new b.InfoServerConnector(this.infoServerUrl);this.rolloverKey=null;var j=this;this.infoServerConnector.onLoad=function(l,m){j.onInfoServerResponse(l,m)};this.infoServerConnector.onFail=function(l,m){b.Logger.log(b.Logger.WARNING,"InfoPanelPopup.infoServerConnector.onFail failed loading info server response for rollvoer key [%0]",l)};b.Logger.log(b.Logger.INFO,"InfoPanelPopup.CTOR response template info [%0]",this.responseTemplateInfo);this.totalWidth=0;this.totalHeight=0;this.baseOpacity_=1;this.currentOpacity_=0;this.createPanelElements(g);var h=parseInt(b.Util.css.getCss("s7infopanelpopup","width",f,null,this.container));var k=parseInt(b.Util.css.getCss("s7infopanelpopup","height",f,null,this.container));this.setupDefaults(h,k);if(!i){return new b.info.InfoPopupPanelControl(this)}else{return this}};b.Class.inherits("s7sdk.info.InfoPanelPopup","s7sdk.UIComponent");b.info.InfoPanelPopup.prototype.symbols={TOOLTIP_CLOSE:"Close"};b.info.InfoPanelPopup.prototype.modifiers={infoServerUrl:{params:["infoServerTemplate"],defaults:[""],parseParams:false},template:{params:["content_template"],defaults:[""],parseParams:false},showhidetransition:{params:["transition","duration"],defaults:["fade",0.3],ranges:[["none","fade"],"0:"]},size:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"],deprecated:true}};b.info.InfoPanelPopup.RESTRICTED_STYLES={s7infopanelpopup:["width","height"]};b.info.InfoPanelPopup.prototype.activateRollover=function(e){if(!this.isProperlySetup()){return}if(this.isVisible){return}b.Logger.log(b.Logger.FINE,"s7sdk.info.InfoPanelPopup.activateRollover - rolloverKey: %0",e);this.infoServerConnector.requestData(e)};b.info.InfoPanelPopup.prototype.deactivateRollover=function(){b.Logger.log(b.Logger.FINE,"s7sdk.info.InfoPanelPopup.deactivateRollover");this.infoServerConnector.cancelRequest();this.hidePanel(false)};b.info.InfoPanelPopup.prototype.setItem=function(g){if(g instanceof b.ItemDesc==false){throw new Error("Item must be a descendant of ItemDesc!")}if(g.parent==null){throw new Error("ItemDesc must be part of a parent set!")}if(!g.parent.items||!g.parent.items.length){throw new Error("Parent set does not contain items!")}b.Logger.log(b.Logger.FINE,"s7sdk.info.InfoPanelPopup.setItem - item: %0",g);this.currentAsset=g;var f=-1;for(var e=0;e<g.parent.items.length;e++){if(g.parent.items[e].name==g.name){f=e;break}}if(f==-1){throw new Error("Could not determine item index from immediate parent set!")}var h=g.parent;while(h.parent instanceof b.ItemDesc){h=h.parent}this.infoServerConnector.setAsset(h.name);this.infoServerConnector.setFrame(f)};b.info.InfoPanelPopup.prototype.resize=function(h,f){b.Logger.log(b.Logger.FINE,"s7sdk.info.InfoPanelPopup.resize - width: %0, height: %1",h,f);var j=this.getWidth();var g=this.getHeight();if(j==h&&g==f){return}var i="";var e=this.isVisible;if(e){i=this.content.innerHTML}this.setupDefaults(h,f);h=this.getWidth();f=this.getHeight();b.UIComponent.prototype.resize.apply(this,[h,f]);if(e){this.showPanel();this.content.innerHTML=i}this.dispatchEvent(new b.event.ResizeEvent(b.event.ResizeEvent.COMPONENT_RESIZE,h,f,false))};b.info.InfoPanelPopup.prototype.getWidth=function(){return this.totalWidth};b.info.InfoPanelPopup.prototype.getHeight=function(){return this.totalHeight};b.info.InfoPanelPopup.prototype.createPanelElements=function(e){this.createElement();this.obj.style.visibility="hidden";this.attachToContainer();this.backOverlay=document.createElement("div");this.backOverlay.className="s7backoverlay";this.backOverlay.setAttribute("id","s7backoverlay"+b.Util.createUniqueId());this.backOverlay.style.position="absolute";this.backOverlay.style.width="100%";this.backOverlay.style.height="100%";this.obj.appendChild(this.backOverlay);this.overlay=document.createElement("div");this.overlay.className="s7overlay";this.overlay.setAttribute("id","s7overlay"+b.Util.createUniqueId());this.overlay.style.position="absolute";this.obj.appendChild(this.overlay);this.closebutton=new b.InfoPanelCloseButton(this.overlay.id,e,"closeButton"+b.Util.createUniqueId(),true);this.closebutton.hint=this.getLocalizedText("TOOLTIP_CLOSE");this.closebutton.toolTip_.setContent(this.closebutton.hint);var f=this;b.Event.addDOMListener(this.closebutton,"click",function(g){g=g||window.event;if(!(b.browser.name=="ie"&&b.browser.version.major>=11)){f.closebutton.getObj().blur()}f.onClose(g)},true);this.content=document.createElement("div");this.content.style.width="100%";this.content.style.height="100%";this.overlay.appendChild(this.content)};b.info.InfoPanelPopup.prototype.setupDefaults=function(f,g){var e=0,i=0;if(f){e=f}else{e=this.size.width}if(g){i=g}else{i=this.size.height}if(!b.Util.isNumber(e)||(e==0)){e=parseInt(b.Util.css.getCss("s7infopanelpopup","width",this.compId,null,this.container));if(!b.Util.isNumber(e)||(e==0)){if("clientWidth" in this.container){e=this.container.clientWidth}if(e==0){e=300}}}if(!b.Util.isNumber(i)||(i==0)){i=parseInt(b.Util.css.getCss("s7infopanelpopup","height",this.compId,null,this.container));if(!b.Util.isNumber(i)||(i==0)){if("clientHeight" in this.container){i=this.container.clientHeight}if(i==0){i=300}}}this.setSize(e,i)};b.info.InfoPanelPopup.prototype.setSize=function(e,h){this.totalWidth=e;this.totalHeight=h;this.obj.style.width=e+"px";this.obj.style.height=h+"px";var f=parseInt(b.Util.css.getCss("s7overlay","width",this.compId,"s7infopanelpopup",this.container));var j=parseInt(b.Util.css.getCss("s7overlay","height",this.compId,"s7infopanelpopup",this.container));if(!b.Util.isNumber(f)||!b.Util.isNumber(j)||(f==0)||(j==0)){var i=this.overlay.offsetLeft;var g=this.overlay.offsetTop;this.overlay.style.width=(e-2*i)+"px";this.overlay.style.height=(h-2*g)+"px"}};b.info.InfoPanelPopup.prototype.isProperlySetup=function(){return(this.responseTemplateInfo!=null)&&this.infoServerConnector.isProperlySetup()};b.info.InfoPanelPopup.prototype.onInfoServerResponse=function(e,f){this.rolloverKey=e;this.showPanel();var g=this.processResponse(e,f);this.content.innerHTML=g};b.info.InfoPanelPopup.prototype.onClose=function(){this.hidePanel();this.dispatchEvent(new b.event.PopupEvent(b.event.PopupEvent.POPUP_CLOSED,false))};b.info.InfoPanelPopup.prototype.showPanel=function(){if(this.isVisible){return}this.isVisible=true;this.obj.style.visibility="inherit";var f=this;function e(){if(f.currentOpacity_<1&&f.isVisible){f.currentOpacity_+=0.05/f.showhidetransition.duration;b.Util.setOpacity(f.obj,f.baseOpacity_*f.currentOpacity_);b.Util.setOpacity(f.overlay,f.baseOpacity_*f.currentOpacity_);setTimeout(e,50)}else{if(f.currentOpacity_>=1){if(f.obj.style.removeProperty){f.obj.style.removeProperty("filter");f.overlay.style.removeProperty("filter")}else{f.obj.style.removeAttribute("filter");f.overlay.style.removeAttribute("filter")}}}}if(this.showhidetransition.transition=="fade"&&this.showhidetransition.duration>0){e()}else{if(this.currentOpacity_<=0){b.Util.setOpacity(this.obj,this.baseOpacity_*1)}}};b.info.InfoPanelPopup.prototype.hidePanel=function(){if(!this.isVisible){return}this.isVisible=false;var e=this;function f(){if(!e.isVisible){if(e.currentOpacity_>0){e.currentOpacity_-=0.05/e.showhidetransition.duration;b.Util.setOpacity(e.obj,e.baseOpacity_*e.currentOpacity_);b.Util.setOpacity(e.overlay,e.baseOpacity_*e.currentOpacity_);setTimeout(f,50)}else{e.obj.style.visibility="hidden";if(e.obj.style.removeProperty){e.obj.style.removeProperty("filter");e.overlay.style.removeProperty("filter")}else{e.obj.style.removeAttribute("filter");e.overlay.style.removeAttribute("filter")}}}}if(this.showhidetransition.transition=="fade"&&this.showhidetransition.duration>0){f()}else{this.obj.style.visibility="hidden"}};b.info.InfoPanelPopup.prototype.parseResponseTemplate=function(e){if(!e){return}var u=null;var g=new Object();var i=new Object();var v=/\s*<info>(.*)<\/info>\s*/gi;var f=v.exec(e);if(f!=null){var r=f[1];var l=/<var([^>]+)>([^>]*>)<\/var>/gi;var n;while((n=l.exec(r))!=null){if(n.length==3){var o=n[1];var p=/.*name=[\'\"](\w+)[\'\"].*/gi;var s=p.exec(o);if((s!=null)&&(s.length==2)){var h=s[1];var w=/.*rollover=[\'\"]([^\'\"]+)[\'\"].*/gi;var m=w.exec(o);var k;if((m!=null)&&(m.length==2)){k=m[1]}else{k=null}var t=this.stripCDATA(n[2]);if(k!=null){if(i[k]==null){i[k]=new Object()}i[k][h]=t}else{g[h]=t}b.Logger.log(b.Logger.FINE,"InfoPanelPopup.parseResponseTemplate found default variable [%0]=[%1], rollover key [%2]",h,t,k)}else{b.Logger.log(b.Logger.WARNING,"InfoPanelPopup.parseResponseTemplate cannot find var name in [%0]",o)}}else{b.Logger.log(b.Logger.WARNING,"InfoPanelPopup.parseResponseTemplate bad var definition [%0]",n[0])}}var q=/.*(?:<\/var>\s*)*(<!.*)$/i;var j=q.exec(r);if(j!=null){u=this.stripCDATA(j[1])}else{b.Logger.log(b.Logger.WARNING,"InfoPanelPopup.parseResponseTemplate unable to locate response template content")}}else{b.Logger.log(b.Logger.WARNING,"InfoPanelPopup.parseResponseTemplate bad response template, missing <info>...</info> tags")}if(u!=null){return new b.ResponseTemplateInfo(u,g,i)}else{return null}};b.info.InfoPanelPopup.prototype.stripCDATA=function(g){var f=/^<\!\[CDATA\[(.*)\]\]>$/i;var e=f.exec(g);if(e!=null){return f.exec(g)[1]}else{return g}};b.info.InfoPanelPopup.prototype.processResponse=function(n,m){var e=this.responseTemplateInfo.getVars(n);var g=new Object();for(var k in e){g[k]=e[k]}for(var h=0;h<m.length;h++){var l=m[h];g[l.name]=l.$t;b.Logger.log(b.Logger.FINE,"InfoPanelPopup.processResponse variable [%0]=[%1] found in response",l.name,l.$t)}var j=this.responseTemplateInfo.template;for(var f in g){j=j.replace(new RegExp("\\$"+f+"\\$","g"),g[f])}return j};b.info.InfoPanelPopup.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};b.info.InfoPanelPopup.prototype.cleanUp=function(e){this.isVisible=false;if(this.obj){b.Util.removeTags(this.obj);this.obj.style.cssText=""}};b.info.InfoPanelPopup.prototype.setCSS=function(g,f,e){if(this.isRestrictedCSSProperty(b.info.InfoPanelPopup.RESTRICTED_STYLES,f)){throw new Error("You cannot set "+g+" : "+f+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[g,f,e])}};b.info.InfoPanelPopup.prototype.setModifier=function(e){throw new Error("Trying to use setModifier on the Core class (InfoPanelPopup) is unsupported! Please refer to SDK documentation on using setModifier.")};b.info.InfoPanelPopup.prototype.getCurrentAsset=function(){return typeof this.currentAsset=="undefined"?null:this.currentAsset};b.info.InfoPanelPopup.prototype.setCurrentAsset=function(e){if(typeof(e)=="string"){this.setAsset(e)}else{this.setItem(e)}};b.InfoPanelPopup=b.info.InfoPanelPopup;(function a(){var h=b.Util.css.createCssRuleText;var g=b.Util.css.createCssImgUrlText;var f=b.browser&&b.browser.name=="ie"&&b.browser.version.major>=10;var e=h(".s7infopanelpopup",{position:"absolute",left:"0px",top:"0px",width:"300px",height:"300px","z-index":"10000","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-ms-touch-action":f?"none":"","touch-action":f?"none":""})+h(".s7infopanelpopup .s7backoverlay",{filter:"alpha(opacity = 70)",opacity:"0.7","background-color":"#0f0f0f"})+h(".s7infopanelpopup .s7overlay",{"margin-left":"-150px","margin-top":"-100px",left:"50%",top:"50%",width:"300px",height:"200px",padding:"20px","background-color":"#FFFFFF"})+h(".s7infopanelpopup .s7closebutton",{position:"absolute",top:"-15px",right:"-15px",padding:"8px",width:"30px",height:"30px"})+h(".s7infopanelpopup .s7closebutton[state='up']",{"background-image":g("close_up.png")})+h(".s7infopanelpopup .s7closebutton[state='over']",{"background-image":g("close_over.png")})+h(".s7infopanelpopup .s7closebutton[state='down']",{"background-image":g("close_down.png")})+h(".s7infopanelpopup .s7closebutton[state='disabled']",{"background-image":g("close_disabled.png")});b.Util.css.addDefaultCSS(e,"InfoPanelPopup")})()}if(!b.ResponseTemplateInfo){b.ResponseTemplateInfo=function c(g,e,f){this.template=g;this.globalVars=e;this.rolloverKeyVars=f};b.ResponseTemplateInfo.prototype.getVars=function(f){var h=new Object();for(var e in this.globalVars){h[e]=this.globalVars[e]}if(f!=null){var g=this.rolloverKeyVars[f];if(g!=null){for(var e in g){h[e]=g[e]}}}return h}}if(!b.InfoServerConnector){b.InfoServerConnector=function d(e){this.infoServerUrl=e;this.asset=null;this.frame=null;this.isReq=new b.IS("","");b.Logger.log(b.Logger.INFO,"InfoServerConnector.CTOR info server URL template [%0]",this.infoServerUrl)};b.InfoServerConnector.prototype.setAsset=function(e){this.asset=e;this.currentAsset=e};b.InfoServerConnector.prototype.setFrame=function(e){this.frame=e};b.InfoServerConnector.prototype.requestData=function(f){if((this.infoServerUrl!=null)&&(this.infoServerUrl!="")){this.isReq.cancelHttpReq();var e=this.createInfoServerUrl(f);b.Logger.log(b.Logger.FINE,"InfoServerConnector.requestData loading info server resopnse from [%0]",e);var g=this;this.isReq.getHttpReq(e,function(h){g.onLoad(f,h)},function(h){g.onFail(f,h)})}else{this.onLoad(f,{})}};b.InfoServerConnector.prototype.cancelRequest=function(){this.isReq.cancelHttpReq()};b.InfoServerConnector.prototype.isProperlySetup=function(){return(this.infoServerUrl==null)||(this.infoServerUrl=="")||((this.asset!=null)&&(this.frame!=null))};b.InfoServerConnector.prototype.onLoad=function(e){};b.InfoServerConnector.prototype.onFail=function(e){};b.InfoServerConnector.prototype.createInfoServerUrl=function(e){var g=this.getCompanyName(this.asset);var h=this.getCatalogId(this.asset);var f=this.infoServerUrl.replace("$1$",e).replace("$2$",this.frame).replace("$3$",g).replace("$4$",h);f+=(f.indexOf("?")==-1?"?":"&")+"fmt=2,json";return f};b.InfoServerConnector.prototype.getCompanyName=function(f){var e=f.split("?")[0].split(",")[0].split(";")[0].split(":")[0];return e.split("/")[0]};b.InfoServerConnector.prototype.getCatalogId=function(f){var e=f.split("?")[0].split(",")[0].split(";")[0].split(":")[0];if(e.indexOf("/")!=-1){return e.substring(e.indexOf("/")+1)}else{return e}}}})(s7getCurrentNameSpace());