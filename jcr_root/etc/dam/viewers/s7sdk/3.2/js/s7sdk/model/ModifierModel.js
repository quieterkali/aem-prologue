/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(c){c.pkg("s7sdk.model");c.Util.require("s7sdk.modifier.Modifier");if(!c.model.EventDispatcher){c.model.EventDispatcher=function e(){this.listeners={}};c.model.EventDispatcher.prototype.addEventListener=function(h,i){(this.listeners[h]=this.listeners[h]||[]).push(i)};c.model.EventDispatcher.prototype.dispatchEvent=function(k){var h=this.listeners[k.type];k.target=this;if(h){for(var j=0;j<h.length;j++){h[j](k)}}};c.model.EventDispatcher.prototype.dispatchEventAsync=function(h){setTimeout(function(){this.dispatchEvent(h)}.bind(this),0)}}if(!c.model.SupplementalModifierDescriptors){c.model.SupplementalModifierDescriptors={container:{stagesize:{symbol:"CONTAINER_STAGESIZE",dictionary:{width:"CONTAINER_STAGESIZE_WIDTH",height:"CONTAINER_STAGESIZE_HEIGHT"},error:[{ranges:[["0","1:"],["1:","0"]],message:"CONTAINER_STAGESIZE_ERROR_A"}],info:[{ranges:[["4000:",],[,"4000:"]],message:"CONTAINER_STAGESIZE_INFO_A"}]},aspect:{info:[{ranges:["10:"],message:"CONTAINER_ASPECT_INFO_A"}]}},zoomview:{iscommand:{symbol:"ZOOMVIEW_ISCOMMAND"},zoomstep:{symbol:"ZOOMVIEW_ZOOMSTEP",dictionary:{step:"ZOOMVIEW_ZOOMSTEP_STEP",limit:"ZOOMVIEW_ZOOMSTEP_LIMIT"}},iconeffect:{symbol:"ZOOMVIEW_ICONEFFECT",info:[{ranges:[,"0",,],message:"ZOOMVIEW_ICONEFFECT_INFO_A"}]}},swatches:{enablescrollbuttons:{symbol:"SWATCHES_ENABLESCROLLBUTTONS",info:[{ranges:[false],linkId:"noScrollCmb",message:"SWATCHES_ENABLESCROLLBUTTONS_INFO_A"}]},enabledragging:{symbol:"SWATCHES_ENABLEDRAGGING",info:[{ranges:[false],linkId:"noScrollCmb"}]},tmblayout:{symbol:"SWATCHES_TMBLAYOUT",info:[{ranges:["1:","1:"],message:"SWATCHES_TMBLAYOUT_INFO_A"}]}}};c.model.SupplementalModifierDescriptors.symbols={};c.model.SupplementalModifierDescriptors.parse=function(l,h,i){var j=c.model.SupplementalModifierDescriptors[l],m=[];if(j){var o=j[h.toLowerCase()];if(o){var k=o.info||[];var p=o.error||[];function n(q){return function(r){var s=new c.model.ModifierConstraint(r,q);if(i&&r.linkId){(i[r.linkId]=i[r.linkId]||[]).push(s)}m.push(s)}}k.forEach(n(c.model.ModifierConstraint.INFO_CONSTRAINT));p.forEach(n(c.model.ModifierConstraint.ERROR_CONSTRAINT))}}return m}}if(!c.model.ModifierModel){c.model.ModifierModel=function d(h,l,o,n){arguments.callee.superclass.apply(this,[]);if(!h||!(h instanceof c.Observable)){throw new Error("s7sdk.model.ModifierModel: Invalid input arguments")}var k=0,j=l.length,m;this.componentModel=h;this.properties[o]=n.clone();this.tipsNotifier=new c.model.TipsNotifier();if(l){for(k=0;k<j;k+=1){m=l[k].createWidget(this,o,n);if(m&&typeof m.addPropertyListeners!==undefined){m.addPropertyListener(o,this.propertyChangeListener.bind(this))}}}};c.Class.inherits("s7sdk.model.ModifierModel","s7sdk.Observable");c.model.ModifierModel.EXCLUDE=["asset","serverurl","aspect","infoserverurl"];c.model.ModifierModel.isExcluded=function(h){return Boolean(c.model.ModifierModel.EXCLUDE.indexOf(h.toLowerCase())!==-1)};c.model.ModifierModel.parseModifiers=function(m){var n=m.getModifiers(),j=m.getClassName(),l={},o,h,p;function i(r,q){for(var s in r){if(r.hasOwnProperty(s)){q[s]=r[s]}}}for(o in n){if(n.hasOwnProperty(o)==false){continue}if(c.model.ModifierModel.isExcluded(o)==false){p={};var k=c.model.SupplementalModifierDescriptors[j.toLowerCase()];if(k&&k[o.toLowerCase()]){h=k[o.toLowerCase()].symbol||"";i(k[o.toLowerCase()],p)}else{h=""}i(n[o],p);l[o]=c.modifier.Modifier.parse(m.id?m.id:j,o,p,m.getParam(o,""),j.toUpperCase()+"_"+o.toUpperCase());if(l[o].isDeprecated()){delete l[o]}}}return l};c.model.ModifierModel.prototype.propertyChangeListener=function(i,h,j){if(j&&!(j instanceof c.modifier.Modifier)){return}this.notifyPropertyChanged(i,h,j)}}if(!c.model.ComponentModifierModel){c.model.ComponentModifierModel=function f(i,m,k){arguments.callee.superclass.apply(this,[]);var n=c.model.ModifierModel.parseModifiers(m),q,h,j,p,o,l;this.modifierConstraintLinkIdDictionary={};this.component=m.getOwner()?m.getOwner():m;this.symbolResolver=k;this.models={};for(q in n){h=n[q];j=h.getQualifier();this.properties[[q,j]]=h}for(p in this.properties){if(this.properties.hasOwnProperty(p)==false){continue}h=this.properties[p];l=c.model.SupplementalModifierDescriptors.parse(m.getClassName().toLowerCase(),h.name,this.modifierConstraintLinkIdDictionary);o=new c.model.ModifierModel(this,i,p,this.properties[p]);l.forEach(function(r){r.verify(h);o.addPropertyListener(p,r.propertyChangeListener.bind(r));r.addEventListener(c.model.ModifierConstraint.TRIGGERED_EVENT,this.createConstraintHandler(o));r.addEventListener(c.model.ModifierConstraint.CLEARED_EVENT,this.createConstraintHandler(o));r.addEventListener(c.model.ModifierConstraint.EVALUATE_EVENT,this.createConstraintHandler(o));r.dispatchEventAsync(new c.model.Event(c.model.ModifierConstraint.EVALUATE_EVENT))}.bind(this));o.addPropertyListener(p,this.propertyChangeListener.bind(this));this.models[p.split(",")[0]]=o}};c.model.ComponentModifierModel.prototype.createConstraintHandler=function(h){var i=c.model.ModifierConstraint;return function(l){var n=l.target,m;if(l.type==c.model.ModifierConstraint.CLEARED_EVENT){h.tipsNotifier.notify({action:"clear"});if(n.linkId){m=this.modifierConstraintLinkIdDictionary[n.linkId];m.forEach(function(o){if(o.triggered){o.dispatchEvent(new c.model.Event(c.model.ModifierConstraint.EVALUATE_EVENT))}})}return}if(n.linkId){m=this.modifierConstraintLinkIdDictionary[n.linkId];var j=m.reduce(function(p,o){if(!n.message){n.message=o.message}return p&&o.triggered},true);if(!j){h.tipsNotifier.notify({action:"clear"});return}}if(n.triggered){var k=this.symbolResolver.getLocalizedText(n.message);if(n.type==i.INFO_CONSTRAINT){h.tipsNotifier.notify({action:"show",message:k,type:"info"})}else{if(n.type==i.ERROR_CONSTRAINT){h.tipsNotifier.notify({action:"show",message:k,type:"error"});throw new Error(n.message)}}}}.bind(this)};c.model.ComponentModifierModel.prototype.propertyChangeListener=function(j,h,k){var i={};if(k){if(this.component.setModifier){i[k.getModifierName()]=k.toStringValue();this.component.setModifier(i)}}this.notifyPropertyChanged(j,h,k)};c.Class.inherits("s7sdk.model.ComponentModifierModel","s7sdk.Observable")}if(!c.model.ModifierConstraint){c.model.ModifierConstraint=function g(i,h){arguments.callee.superclass.apply(this,[]);var j=c.model.ModifierConstraint;this.rangeSets=j.getRangeSets(i.ranges);this.message=i.message;this.linkId=i.linkId;this.type=h;this.triggered=false};c.Class.inherits("s7sdk.model.ModifierConstraint","s7sdk.model.EventDispatcher");c.model.ModifierConstraint.INFO_CONSTRAINT="infoConstraint";c.model.ModifierConstraint.ERROR_CONSTRAINT="errorConstraint";c.model.ModifierConstraint.TRIGGERED_EVENT="triggeredEvent";c.model.ModifierConstraint.CLEARED_EVENT="clearedEvent";c.model.ModifierConstraint.EVALUATE_EVENT="evaluateEvent";c.model.ModifierConstraint.getRangeSets=function(h){var j,k=[];for(j=0;j<h.length;j++){if(h[j] instanceof Array){k.push(h[j])}else{k.push(h);break}}return k};c.model.ModifierConstraint.checkRangeSets=function(n,j){var h=false,l,k;for(k=0;k<n.length;k++){l=n[k];if(m(l)==true){h=true;break}}function m(r){var q,s,p,o=true;for(q=0;q<r.length;q++){s=j.values[q];p=r[q];if(p==null){continue}if(s instanceof c.modifier.NumberParam){if(c.Modifier.numericRangeValidator(s.value,p)==false){o=false;break}}if(s instanceof c.modifier.BooleanParam){if(s.value!=Boolean(p)){o=false;break}}if(s instanceof c.modifier.EnumParam||s instanceof c.modifier.StringParam){if(s.value!=p){o=false;break}}}return o}return h};c.model.ModifierConstraint.prototype.verify=function(h){var l=c.model.ModifierConstraint,k=this.triggered;this.triggered=l.checkRangeSets(this.rangeSets,h);var j=this.triggered?c.model.ModifierConstraint.TRIGGERED_EVENT:c.model.ModifierConstraint.CLEARED_EVENT;var i=new c.model.Event(j);this.dispatchEvent(i);return this.triggered};c.model.ModifierConstraint.prototype.propertyChangeListener=function(i,h,j){if(j&&!(j instanceof c.modifier.Modifier)){return}this.verify(j)}}if(!c.model.TipsNotifier){c.model.TipsNotifier=function a(){this.observers=[]};c.model.TipsNotifier.prototype.addObserver=function(h){this.observers.push(h)};c.model.TipsNotifier.prototype.notify=function(j){for(var h=0;h<this.observers.length;h++){this.observers[h](j)}}}if(!c.model.Event){c.model.Event=function b(h){this.type=h;this.target=null}}})(s7getCurrentNameSpace());