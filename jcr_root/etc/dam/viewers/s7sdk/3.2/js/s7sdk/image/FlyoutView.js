/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2012 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(a){a.Util.require("s7sdk.common.IS");a.Util.require("s7sdk.image.TileFxScl");if(!a.FlyoutView){a.FlyoutView=function FlyoutView(d){this.container=d;this.highlightFrame=a.Util.createObj(null,"div");this.highlightFrame.className="s7highlight";this.highlightFrame.style.position="absolute";this.highlightCursor=a.Util.createObj(null,"div");this.highlightCursor.className="s7cursor";this.highlightCursor.style.position="absolute";if(this.container.highlightMode.type=="cursor"){this.highlightFrame.style.display="none";this.highlightCursor.style.display="block";if(a.browser.supportsTouch()){a.Util.css.setCSSAttributeSelector(this.highlightCursor,"input","touch")}else{a.Util.css.setCSSAttributeSelector(this.highlightCursor,"input","mouse")}}else{this.highlightFrame.style.display="block";this.highlightCursor.style.display="none"}this.imageDiv=a.Util.createObj(null,"div");this.imageDiv.className="s7staticimage";this.imageDiv.style.position="absolute";if(this.container.highlightMode.position=="onimage"){this.imageDiv.style.overflow="hidden"}else{this.imageDiv.style.overflow="visible"}this.firstImage=new Image();this.firstImage.style.pointerEvents="none";this.firstImage.style.position="absolute";this.secondImage=new Image();this.secondImage.style.pointerEvents="none";this.secondImage.style.position="absolute";this.imageDiv.appendChild(this.firstImage);this.imageDiv.appendChild(this.secondImage);if(this.container.overlay){this.overlay=document.createElement("div");this.overlay.style.position="absolute";this.overlayTop=document.createElement("div");this.overlayLeft=document.createElement("div");this.overlayRight=document.createElement("div");this.overlayBottom=document.createElement("div");this.overlay.appendChild(this.overlayTop);this.overlay.appendChild(this.overlayLeft);this.overlay.appendChild(this.overlayRight);this.overlay.appendChild(this.overlayBottom);this.overlayTop.className="s7overlay";this.overlayLeft.className="s7overlay";this.overlayRight.className="s7overlay";this.overlayBottom.className="s7overlay";this.overlayTop.style.position="absolute";this.overlayLeft.style.position="absolute";this.overlayRight.style.position="absolute";this.overlayBottom.style.position="absolute";this.overlayTop.style.display="block";this.overlayLeft.style.display="block";this.overlayRight.style.display="block";this.overlayBottom.style.display="block";this.highlightFrame.style.display="none"}this.flyoutDiv=a.Util.createObj(null,"div");this.flyoutDiv.className="s7flyoutzoom";this.flyoutDiv.style.overflow="hidden";this.flyoutDiv.style.pointerEvents="none";this.flyoutDiv.style.display="none";this.flyoutDisplay=a.Util.createObj(null,"div",null,null);this.flyoutDisplay.parentView=this;this.flyoutDisplay.style.position="relative";this.flyoutDisplayImg=a.Util.createObj(null,"img",null,null);this.flyoutDisplayImg.style.position="absolute";this.flyoutDisplay.appendChild(this.flyoutDisplayImg);this.flyoutDiv.appendChild(this.flyoutDisplay);this.container.obj.appendChild(this.imageDiv);this.container.obj.appendChild(this.flyoutDiv);if(a.browser.name=="ie"&&a.browser.version.major==9){this.ieOverlay()}this.animation=null;this.inputHandlersLoaded=false;this.loaded=false;this.infoMessage=null;this.firstInit=true;this.firstPicture=true;this.flyoutActive=false;this.flyoutActivating=false;this.needSendPanEvent=true;this.preloadInProgress=false;this.delay=50;this.queue=new Array();this.timer=setInterval(a.Util.wrapContext(this.onPreloadProcess,this),this.delay);this.activationPos=null};a.FlyoutView.prototype.ieOverlay=function(){var d=document.createElement("div");d.style.position="absolute";d.style.left="0px";d.style.top="0px";d.style.width="100%";d.style.height="100%";d.style.background="url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)";d.overHandler=function(f){a.Event.preventDefault(f);a.Event.stopPropagation(f)};a.Event.addDOMListener(d,"mouseover",d.overHandler,false);this.displayOverlay=d;this.flyoutDiv.appendChild(this.displayOverlay)};a.FlyoutView.prototype.onPreloadProcess=function(){if(!this.preloadtiles){return}this.preloadComplete=function(){if(this.tiles){for(var h=0;h<this.tiles.length;h++){if(this.tiles[h]&&(this.tiles[h].image.loaded==false)){return false}}}return true};if(this.preloadComplete()&&this.preloadInProgress){this.preloadInProgress=false;var d=new a.event.StatusEvent(a.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);a.Event.dispatch(this.container,d,false)}if(!this.preloadInProgress){var f=new Array();for(var e=0;e<3;e++){var g=this.queue[e];if(g!=null&&!g.tile.image.loaded){g.tile.loadTile(g.url);f.push(g)}}this.queue=f}};a.FlyoutView.prototype.loadImage=function(n,D,C,z,m,y,e,j,g,h,r){this.oldimageUrl=this.imageUrl;this.imageUrl=D+n;this.mainViewPos=C;this.flyoutPos=z;this.duration=e;this.preloadtiles=j;this.fmt=g;this.transparent=((this.fmt.indexOf("png")!=-1||this.fmt.indexOf("gif")!=-1)&&(this.fmt.indexOf("-alpha")>0))?true:false;this.imageModifiers=h;this.staticBreakpoints=this.container.breakpoints;this.tiles=[];this.tileSwap=[];this.fullImageSize=null;this.lastCursorPoint=null;this.imageOffsetLeft=null;this.imageOffsetTop=null;if(a.browser.supportsTouch()){this.cursorWidth=parseInt(a.Util.css.getCss("s7cursor","width",null,"s7flyoutzoomview",this.container.obj,{input:"touch"}));this.cursorHeight=parseInt(a.Util.css.getCss("s7cursor","height",null,"s7flyoutzoomview",this.container.obj,{input:"touch"}));this.cursorFadeTime=this.container.highlightMode.showtime}else{this.cursorWidth=parseInt(a.Util.css.getCss("s7cursor","width",null,"s7flyoutzoomview",this.container.obj,{input:"mouse"}));this.cursorHeight=parseInt(a.Util.css.getCss("s7cursor","height",null,"s7flyoutzoomview",this.container.obj,{input:"mouse"}));this.cursorFadeTime=0}if(!a.Util.isNumber(this.cursorWidth)||!a.Util.isNumber(this.cursorHeight)||this.cursorWidth<=0||this.cursorHeight<=0){}if((this.container.zoomfactor.upscale==0)&&((C.height>this.container.item.height)&&(C.width>this.container.item.width))){this.realHeight=this.container.item.height;this.realWidth=this.container.item.width}else{this.realHeight=C.height;this.realWidth=Math.round(this.container.item.width*this.realHeight/this.container.item.height);if(this.realWidth>C.width){this.realWidth=C.width;this.realHeight=Math.round(this.container.item.height*this.realWidth/this.container.item.width)}}this.primaryFactor=m;this.secondaryFactor=r;this.zoomFactor=this.primaryFactor;var d=0;var v=0;this.calckWidth=this.realWidth;this.calckHeight=this.realHeight;var x=this.realWidth;var l=this.realHeight;for(var u=0;u<this.staticBreakpoints.length;u++){if(this.staticBreakpoints[u]>=d){d=this.staticBreakpoints[u]}if(this.staticBreakpoints[u]<=v){v=this.staticBreakpoints[u]}}for(var u=0;u<this.staticBreakpoints.length;u++){if(x<=this.staticBreakpoints[u]&&x<=d){x=this.staticBreakpoints[u];break}else{if(x>=d){x=d;break}}}l=Math.round(this.container.item.height*x/this.container.item.width);this.calckWidth=x;this.calckHeight=l;var t={width:x*this.zoomFactor,height:l*this.zoomFactor};var s={width:x*this.secondaryFactor,height:l*this.secondaryFactor};var A=this.container.item.height/t.height;var w=this.container.item.height/s.height;if(this.container.zoomfactor.upscale!=0){var B={x:this.flyoutPos.x,y:this.flyoutPos.y,width:this.flyoutPos.width,height:this.flyoutPos.height};var p={x:this.flyoutPos.x,y:this.flyoutPos.y,width:this.flyoutPos.width,height:this.flyoutPos.height};if(this.container.item.width/A<this.flyoutPos.width){var k=B.width;B.width=this.container.item.width/A;B.x=B.x+(k-B.width)/2}if(this.container.item.height/A<this.flyoutPos.height){var q=B.height;B.height=this.container.item.height/A;B.y=B.y+(q-B.height)/2}this.flyoutPos=B;if(this.container.item.width/w<this.flyoutPos.width){p.width=this.container.item.width/w}if(this.container.item.height/w<this.flyoutPos.height){p.height=this.container.item.height/w}this.flyoutPosSec=p}this.zoomFactor=this.container.item.height/A/this.realHeight;this.primaryFactor=this.zoomFactor;if(this.secondaryFactor!=-1){this.secondaryFactor=this.container.item.height/w/this.realHeight}else{this.secondaryFactor=this.primaryFactor}if(this.firstInit){a.Util.setObjSize(this.flyoutDiv,this.flyoutPos.width,this.flyoutPos.height);a.Util.setObjPos(this.flyoutDiv,this.flyoutPos.x,this.flyoutPos.y);this.flyoutDiv.width=this.flyoutPos.width;this.flyoutDiv.height=this.flyoutPos.height;a.Util.setObjSize(this.flyoutDisplay,this.flyoutPos.width,this.flyoutPos.height);this.flyoutDisplay.width=this.flyoutPos.width;this.flyoutDisplay.height=this.flyoutPos.height}if(!this.animation){switch(y){case a.image.FlyoutZoomView.ANIM_SLIDE:this.animation=new a.FlyoutView.Slide(this.flyoutDiv,this.duration,true,this);break;case a.image.FlyoutZoomView.ANIM_FADE:this.animation=new a.FlyoutView.Fade(this.flyoutDiv,this.duration,true,this);break;case a.image.FlyoutZoomView.ANIM_NONE:this.animation=new a.FlyoutView.Fade(this.flyoutDiv,this.duration,true,this);break}}var f=new String(this.imageUrl);f+=(f.indexOf("?")==-1)?"?":"&";f+="fmt=";f+=this.fmt;f+="&fit=constrain,1&wid="+Math.round(this.calckWidth)+"&hei="+Math.round(this.calckHeight);f+=(this.imageModifiers!=null&&this.imageModifiers!="")?"&"+this.imageModifiers:"";var o=this;if(this.image){this.image.onload=null}this.changingAsset=true;this.waitActivation=false;this.image=new Image();this.image.style.pointerEvents="none";this.image.onload=function(i){var i=i||window.event;if(o.firstPicture){o.firstImage.src=this.src;a.Util.setObjSize(o.firstImage,o.realWidth,o.realHeight);o.firstPicture=false}else{o.secondImage.src=this.src;a.Util.setObjSize(o.secondImage,o.realWidth,o.realHeight);o.firstPicture=true}o.flyoutDisplayImg.src=this.src;o.completeHandler(i)};this.image.onerror=function(i){var i=i||window.event;o.errorHandler(i)};this.imageOffsetLeft=Math.round((this.mainViewPos.width-this.realWidth)/2);this.imageOffsetTop=Math.round((this.mainViewPos.height-this.realHeight)/2);this.image.src=f;this.currentZoomRect=null};a.FlyoutView.prototype.completeHandler=function(e){var e=e||window.event;a.Util.setObjSize(this.container.obj,this.mainViewPos.width,this.mainViewPos.height);a.Util.setObjPos(this.imageDiv,this.imageOffsetLeft,this.imageOffsetTop);a.Util.setObjSize(this.imageDiv,this.realWidth,this.realHeight);if(this.animation){this.animation.reset()}var g=this;function f(){g.changingAsset=false;if(g.waitActivation){g.flyoutActive=false;g.waitActivation=false;g.highlightState(true);g.activateFlyout();g.moveZoomViewPort(g.activationPos.clientX,g.activationPos.clientY)}}if(this.container.frameTransition.transition=="fade"){this.swapImage(true,this.container.frameTransition.duration,f)}else{this.swapImage(false,this.container.frameTransition.duration,f)}if(this.infoMessage){if((this.infoMessage.tip.duration!=-1)&&(this.oldimageUrl!=this.imageUrl)){this.infoMessage.hide()}if(this.infoMessage.hiddenState){this.infoMessage.show(this.mainViewPos.width,this.mainViewPos.height)}else{this.infoMessage.centerOverlay(this.mainViewPos.width,this.mainViewPos.height)}var h=this.infoMessage;if(h.tip.duration!=-1){if(this.infoMessage.displayTimeoutId){clearTimeout(this.infoMessage.displayTimeoutId);this.infoMessage.displayTimeoutId=null}this.infoMessage.displayTimeoutId=setTimeout(function(){h.hide()},h.tip.duration*1000)}}this.refImageSize=new a.Rectangle(0,0,this.realWidth,this.realHeight);this.processZoomFactor();if(this.preloadtiles){this.copyTiles(new a.Rectangle(0,0,this.fullImageSize.width,this.fullImageSize.height));this.preloadInProgress=true;var d=new a.event.StatusEvent(a.event.StatusEvent.NOTF_PRELOAD_START,true);a.Event.dispatch(this.container,d,false)}if(!this.inputHandlersLoaded){this.loadHandlers();this.inputHandlersLoaded=true}if(!this.loaded){var d=new a.event.StatusEvent(a.event.StatusEvent.NOTF_VIEW_READY,true);this.container.dispatchEvent(d,false)}this.firstInit=false;this.loaded=true};a.FlyoutView.prototype.loadHandlers=function(){var d=this;a.Event.addDOMListener(this.container.obj,"mouseover",function(f){d.mouseOverHandler(f,d.container.obj)},false);a.Event.addDOMListener(this.container.obj,"mouseout",function(f){d.mouseOutHandler(f,d.container.obj)},false);a.Event.addDOMListener(this.container.obj,"mousemove",function(f){d.mouseMoveHandler(f,d.container.obj)},false);a.Event.addDOMListener(this.container.obj,"click",function(f){d.mouseClickHandler(f)},false);a.Event.addDOMListener(this.container.obj,"touchstart",function(f){d.touchStartHandler(f)},false);a.Event.addDOMListener(this.container.obj,"touchend",function(f){d.touchEndHandler(f)},false);a.Event.addDOMListener(this.container.obj,"touchcancel",function(f){d.touchEndHandler(f)},false);a.Event.addDOMListener(this.container.obj,"touchmove",function(f){d.touchMoveHandler(f)},false)};a.FlyoutView.prototype.unloadHandlers=function(){var d=this;a.Event.removeDOMListener(this.container.obj,"mouseover",function(f){d.mouseOverHandler(f,d.container.obj)},false);a.Event.removeDOMListener(this.container.obj,"mouseout",function(f){d.mouseOutHandler(f,d.container.obj)},false);a.Event.removeDOMListener(this.container.obj,"mousemove",function(f){d.mouseMoveHandler(f,d.container.obj)},false);a.Event.removeDOMListener(this.container.obj,"click",function(f){d.mouseClickHandler(f)},false);a.Event.removeDOMListener(this.container.obj,"touchstart",function(f){d.touchStartHandler(f)},false);a.Event.removeDOMListener(this.container.obj,"touchend",function(f){d.touchEndHandler(f)},false);a.Event.removeDOMListener(this.container.obj,"touchcancel",function(f){d.touchEndHandler(f)},false);a.Event.removeDOMListener(this.container.obj,"touchmove",function(f){d.touchMoveHandler(f)},false)};a.FlyoutView.prototype.processZoomFactor=function(){this.highlightSize=this.calcHighlightRect();a.Util.setObjSize(this.highlightFrame,this.highlightSize.width,this.highlightSize.height);if(this.container.overlay){if(this.container.highlightMode.type=="highlight"){this.layoutOverlay(this.highlightSize)}else{var d=new a.Rectangle(0,0,this.cursorWidth,this.cursorHeight);this.layoutOverlay(d)}}this.fullImageSize=new a.Rectangle(0,0,Math.round(this.refImageSize.width*this.zoomFactor),Math.round(this.refImageSize.height*this.zoomFactor))};a.FlyoutView.prototype.toggleZoomFactor=function(g,f){if(!this.secondImage||!this.firstImage||!this.loaded){return}var e=this.zoomFactor;this.zoomFactor=(this.zoomFactor==this.primaryFactor)?this.secondaryFactor:this.primaryFactor;if(this.zoomFactor!=e){var h=new a.event.UserEvent(a.event.UserEvent.ZOOM,[this.zoomFactor],true);this.container.dispatchEvent(h,false);this.needSendPanEvent=true}var d=this.tiles;this.tiles=this.tileSwap;this.tileSwap=d;this.processZoomFactor();this.lastCursorPoint=null;this.moveZoomViewPort(g,f);if(this.preloadtiles){this.copyTiles(new a.Rectangle(0,0,this.fullImageSize.width,this.fullImageSize.height))}this.invalidate()};a.FlyoutView.prototype.getTileUrl=function(){var e,d;d=new String(this.imageUrl);d+=(d.indexOf("?")==-1)?"?":"&";if(!this.refImageSize){return null}e=this.container.item.height/(this.refImageSize.height*this.zoomFactor);d+="scl="+e.toFixed(7);return d+=(this.imageModifiers!=null&&this.imageModifiers!="")?"&"+this.imageModifiers:""};a.FlyoutView.prototype.highlightState=function(d){if(d&&!this.highlightActive){if(this.container.overlay){this.imageDiv.appendChild(this.overlay)}if(this.container.highlightMode.type=="cursor"){this.imageDiv.appendChild(this.highlightCursor)}else{if(this.container.highlightMode.type=="highlight"){this.imageDiv.appendChild(this.highlightFrame)}}this.highlightActive=true}else{if(!d&&this.highlightActive){if(this.container.overlay){this.imageDiv.removeChild(this.overlay)}if(this.container.highlightMode.type=="cursor"){this.imageDiv.removeChild(this.highlightCursor)}else{if(this.container.highlightMode.type=="highlight"){this.imageDiv.removeChild(this.highlightFrame)}}this.highlightActive=false}}};a.FlyoutView.prototype.draw=function(){if(this.fullImageSize==null||!this.invalid){return}var i=new a.Point2D(this.highlightX+this.highlightSize.width/2,this.highlightY+this.highlightSize.height/2);var h=new a.Point2D(this.refImageSize.width/2,this.refImageSize.height/2);var j=new a.Point2D((this.highlightSize.width-this.flyoutPos.width/this.zoomFactor)/2,(this.highlightSize.height-this.flyoutPos.height/this.zoomFactor)/2);if(j.x>0||j.y>0){var d=i.subtract(h);var g=(this.refImageSize.width-this.highlightSize.width)/2;var e=(this.refImageSize.height-this.highlightSize.height)/2;if(j.x>0&&g>1){i.x+=(d.x/g)*j.x}if(j.y>0&&e>1){i.y+=(d.y/e)*j.y}}var f=new a.Rectangle(Math.round(i.x*this.zoomFactor-this.flyoutPos.width/2),Math.round(i.y*this.zoomFactor-this.flyoutPos.height/2),this.flyoutPos.width,this.flyoutPos.height);this.copyTiles(f);this.invalid=false};a.FlyoutView.prototype.copyTiles=function(s){var m=!this.invalid;var d,r;var g=Math.max(0,Math.floor(s.x/a.TileFxScl.TILE_SIZE)*a.TileFxScl.TILE_SIZE);var f=Math.max(0,Math.floor(s.y/a.TileFxScl.TILE_SIZE)*a.TileFxScl.TILE_SIZE);var i=g;var h=Math.ceil(this.fullImageSize.width/a.TileFxScl.TILE_SIZE);var k=new a.Point2D(0,0);var q=new a.Point2D(s.x<0?-s.x:0,s.y<0?-s.y:0);while(this.flyoutDisplay.lastChild){this.flyoutDisplay.removeChild(this.flyoutDisplay.lastChild)}this.flyoutDisplayImg.style.left=-s.x+"px";this.flyoutDisplayImg.style.top=-s.y+"px";this.flyoutDisplayImg.style.width=this.fullImageSize.width+"px";this.flyoutDisplayImg.style.height=this.fullImageSize.height+"px";this.flyoutDisplay.appendChild(this.flyoutDisplayImg);var j,o,e,n;while(f<s.getBottom()&&f<this.fullImageSize.height){var l=new a.Rectangle(0,0,0,0);r=f/a.TileFxScl.TILE_SIZE;while(g<s.getRight()&&g<this.fullImageSize.width){e=Math.min(this.fullImageSize.width-g,a.TileFxScl.TILE_SIZE);n=Math.min(this.fullImageSize.height-f,a.TileFxScl.TILE_SIZE);d=g/a.TileFxScl.TILE_SIZE;o=r*h+d;j=this.tiles[o];if(j==null){j=new a.TileFxScl(new a.TileAddress(e,n,o,d,r),this.getTileUrl(),this.fmt);j.idx=o;this.tiles[o]=j;this.queue[o]={tile:j,url:this.getTileUrl()}}var p=new a.Rectangle(s.x-g,s.y-f,s.width,s.height);l=p.intersection(new a.Rectangle(0,0,e,n));if(m==false&&l.width>0&&l.height>0){j.image.style.position="absolute";if(a.browser.device.name=="android"&&a.browser.device.version==4){j.image.style.border="1px solid transparent"}j.image.style.zoom=1;j.image.style.filter="inherit";j.image.style.filter=this.flyoutDiv.style.filter;j.image.style.left=-l.x+k.x+q.x+"px";j.image.style.top=-l.y+k.y+q.y+"px";this.flyoutDisplay.appendChild(j.image)}k.x+=l.width;g+=a.TileFxScl.TILE_SIZE}k.x=0;k.y+=l.height;g=i;f+=a.TileFxScl.TILE_SIZE}this.currentZoomRect=s};a.FlyoutView.prototype.moveZoomViewPort=function(e,j){if(!this.lastCursorPoint){this.lastCursorPoint=new a.Point2D(e,j)}else{if(this.lastCursorPoint.x==e&&this.lastCursorPoint.y==j){return}this.lastCursorPoint.x=e;this.lastCursorPoint.y=j}var h=e-Math.round(this.highlightSize.width/2);var g=j-Math.round(this.highlightSize.height/2);if(this.container.highlightMode.position=="onimage"){h=Math.min(h,Math.round(this.refImageSize.width-this.highlightSize.width-1));g=Math.min(g,Math.round(this.refImageSize.height-this.highlightSize.height-1));h=Math.max(h,0);g=Math.max(g,0)}else{h=Math.min(h,Math.round(this.refImageSize.width-(this.refImageSize.width-this.mainViewPos.width)/2-this.highlightSize.width-1));g=Math.min(g,Math.round(this.refImageSize.height-(this.refImageSize.height-this.mainViewPos.height)/2-this.highlightSize.height-1));h=Math.max(h,(this.refImageSize.width-this.mainViewPos.width)/2);g=Math.max(g,(this.refImageSize.height-this.mainViewPos.height)/2)}this.highlightX=h;this.highlightY=g;a.Util.setObjPos(this.highlightFrame,this.highlightX,this.highlightY);var f=0;var d=0;if(this.container.highlightMode.position=="onimage"){if(a.browser.supportsTouch()){f=Math.max(Math.min(e-Math.round(this.cursorWidth/2),Math.round(this.refImageSize.width-this.cursorWidth-1)),0);d=Math.max(Math.min(j-Math.round(this.cursorHeight),Math.round(this.refImageSize.height-this.cursorHeight-1)),0)}else{f=Math.max(Math.min(e-Math.round(this.cursorWidth/2),Math.round(this.refImageSize.width-this.cursorWidth-1)),0);d=Math.max(Math.min(j-Math.round(this.cursorHeight/2),Math.round(this.refImageSize.height-this.cursorHeight-1)),0)}}else{if(a.browser.supportsTouch()){f=Math.max(Math.min(e-Math.round(this.cursorWidth/2),Math.round(this.refImageSize.width-(this.refImageSize.width-this.mainViewPos.width)/2-this.cursorWidth-1)),(this.refImageSize.width-this.mainViewPos.width)/2);d=Math.max(Math.min(j-Math.round(this.cursorHeight),Math.round(this.refImageSize.height-(this.refImageSize.height-this.mainViewPos.height)/2-this.cursorHeight-1)),(this.refImageSize.height-this.mainViewPos.height)/2)}else{f=Math.max(Math.min(e-Math.round(this.cursorWidth/2),Math.round(this.refImageSize.width-(this.refImageSize.width-this.mainViewPos.width)/2-this.cursorWidth-1)),(this.refImageSize.width-this.mainViewPos.width)/2);d=Math.max(Math.min(j-Math.round(this.cursorHeight/2),Math.round(this.refImageSize.height-(this.refImageSize.height-this.mainViewPos.height)/2-this.cursorHeight-1)),(this.refImageSize.height-this.mainViewPos.height)/2)}}a.Util.setObjPos(this.highlightCursor,f,d);if(this.container.overlay){if(this.container.highlightMode.type=="highlight"){var i=new a.Rectangle(this.highlightX,this.highlightY,this.highlightSize.width,this.highlightSize.height);this.layoutOverlay(i);a.Util.setObjPos(this.overlay,this.highlightX,this.highlightY)}else{var i=new a.Rectangle(f,d,this.cursorWidth,this.cursorHeight);this.layoutOverlay(i);a.Util.setObjPos(this.overlay,f,d)}this.overlay.style.display="none";this.overlay.offsetWidth;this.overlay.style.display="block"}this.invalidate()};a.FlyoutView.checkTarget=function(d,e){while(d&&d.parentNode){if(d==e){return true}d=d.parentNode}return false};a.FlyoutView.getScrollXYCorr=function(){var e=0,d=0;if(a.browser.device.name=="iphone"&&a.browser.device.version>3){if(typeof(window.pageYOffset)=="number"){d=window.pageYOffset;e=window.pageXOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){d=document.body.scrollTop;e=document.body.scrollLeft}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){d=document.documentElement.scrollTop;e=document.documentElement.scrollLeft}}}}return{x:e,y:d}};a.FlyoutView.prototype.mouseOverHandler=function(h,g){a.Event.preventDefault(h);var d=h.relatedTarget||h.fromElement;if(a.FlyoutView.checkTarget(d,g)){return}if(this.infoMessage){if(this.infoMessage.tip.duration!=-1){this.infoMessage.hide()}}var f=a.Util.getEventPos(h).x-a.Util.getObjPos(this.imageDiv).x-a.FlyoutView.getScrollXYCorr().x;var e=a.Util.getEventPos(h).y-a.Util.getObjPos(this.imageDiv).y-a.FlyoutView.getScrollXYCorr().y;if(this.changingAsset){this.waitActivation=true}if(this.changingAsset&&this.waitActivation){this.activationPos={clientX:f,clientY:e};return}this.highlightState(true);this.activateFlyout();this.moveZoomViewPort(f,e);this.needSendPanEvent=true};a.FlyoutView.prototype.mouseMoveHandler=function(g,f){a.Event.preventDefault(g);var e=a.Util.getEventPos(g).x-a.Util.getObjPos(this.imageDiv).x-a.FlyoutView.getScrollXYCorr().x;var d=a.Util.getEventPos(g).y-a.Util.getObjPos(this.imageDiv).y-a.FlyoutView.getScrollXYCorr().y;var j=a.Util.getEventPos(g).x-a.Util.getObjPos(this.container.obj).x-a.FlyoutView.getScrollXYCorr().x;var h=a.Util.getEventPos(g).y-a.Util.getObjPos(this.container.obj).y-a.FlyoutView.getScrollXYCorr().y;if((j>this.mainViewPos.width)||(h>this.mainViewPos.height)||(j<0)||(h<0)){this.waitActivation=false;this.highlightState(false);this.stopHandler(g);return}if(this.changingAsset){this.waitActivation=true}if(this.changingAsset&&this.waitActivation){this.activationPos={clientX:e,clientY:d};return}this.highlightState(true);this.activateFlyout();this.moveZoomViewPort(e,d);if(this.needSendPanEvent){var i=new a.event.UserEvent(a.event.UserEvent.PAN,[],true);this.container.dispatchEvent(i,false)}this.needSendPanEvent=false};a.FlyoutView.prototype.mouseOutHandler=function(h,g){a.Event.preventDefault(h);var d=h.relatedTarget||h.toElement;if(a.FlyoutView.checkTarget(d,g)){return}var f=a.Util.getEventPos(h).x-a.Util.getObjPos(this.imageDiv).x-a.FlyoutView.getScrollXYCorr().x;var e=a.Util.getEventPos(h).y-a.Util.getObjPos(this.imageDiv).y-a.FlyoutView.getScrollXYCorr().y;this.waitActivation=false;this.highlightState(false);this.stopHandler(h)};a.FlyoutView.prototype.stopHandler=function(d){this.deactivateFlyout()};a.FlyoutView.prototype.touchStartHandler=function(f){a.Event.preventDefault(f);this.highlightState(true);var e,d;if(this.infoMessage){if(this.infoMessage.tip.duration!=-1){this.infoMessage.hide()}}this.startHandlerTime=f.timeStamp;this.activateFlyout();if(f.touches.length>0){e=a.Util.getEventPos(f).x-a.Util.getObjPos(this.imageDiv).x-a.FlyoutView.getScrollXYCorr().x;d=a.Util.getEventPos(f).y-a.Util.getObjPos(this.imageDiv).y-a.FlyoutView.getScrollXYCorr().y;this.moveZoomViewPort(e,d);this.needSendPanEvent=true}};a.FlyoutView.prototype.touchMoveHandler=function(f){a.Event.preventDefault(f);var e=a.Util.getEventPos(f).x-a.Util.getObjPos(this.imageDiv).x-a.FlyoutView.getScrollXYCorr().x;var d=a.Util.getEventPos(f).y-a.Util.getObjPos(this.imageDiv).y-a.FlyoutView.getScrollXYCorr().y;var i=a.Util.getEventPos(f).x-a.Util.getObjPos(this.container.obj).x-a.FlyoutView.getScrollXYCorr().x;var g=a.Util.getEventPos(f).y-a.Util.getObjPos(this.container.obj).y-a.FlyoutView.getScrollXYCorr().y;if((i>this.mainViewPos.width)||(g>this.mainViewPos.height)||(i<0)||(g<0)){this.highlightState(false);this.stopHandler(f);return}this.highlightState(true);this.activateFlyout();this.moveZoomViewPort(e,d);if(this.needSendPanEvent){var h=new a.event.UserEvent(a.event.UserEvent.PAN,[],true);this.container.dispatchEvent(h,false)}this.needSendPanEvent=false};a.FlyoutView.prototype.touchEndHandler=function(f){a.Event.preventDefault(f);var e,d;this.stopHandler(f);if(f.timeStamp-this.startHandlerTime<250){this.startHandlerTime=0;if(f.hasOwnProperty("touches")&&f.touches.length>0){e=a.Util.getEventPos(f).x-a.Util.getObjPos(this.imageDiv).x-a.FlyoutView.getScrollXYCorr().x;d=a.Util.getEventPos(f).y-a.Util.getObjPos(this.imageDiv).y-a.FlyoutView.getScrollXYCorr().y}else{e=this.lastCursorPoint.x;d=this.lastCursorPoint.y}this.click(e,d)}this.highlightState(false)};a.FlyoutView.prototype.mouseClickHandler=function(f){a.Event.preventDefault(f);var e=a.Util.getEventPos(f).x-a.Util.getObjPos(this.imageDiv).x-a.FlyoutView.getScrollXYCorr().x;var d=a.Util.getEventPos(f).y-a.Util.getObjPos(this.imageDiv).y-a.FlyoutView.getScrollXYCorr().y;this.click(e,d)};a.FlyoutView.prototype.click=function(e,d){if(this.secondaryFactor!=-1){this.toggleZoomFactor(e,d)}a.Event.dispatch(this.container,a.Event.CLICK,false)};a.FlyoutView.prototype.onTileLoaded=function(d){this.invalidate()};a.FlyoutView.prototype.errorHandler=function(d){var d=d||window.event;a.Logger.log(a.Logger.SEVERE,"FlyoutView.errorHandler %0",d.message)};a.FlyoutView.prototype.calcHighlightRect=function(){var d=new a.Rectangle(0,0,this.flyoutPos.width,this.flyoutPos.height);if(this.zoomFactor>1){d.width/=this.zoomFactor;d.height/=this.zoomFactor}else{d.width=this.realWidth;d.height=this.realHeight}if(this.container.zoomfactor.upscale==0){if(this.container.highlightMode.position=="onimage"){d.width=Math.min(this.realWidth,d.width);d.height=Math.min(this.realHeight,d.height)}else{d.width=Math.min(this.mainViewPos.width,d.width);d.height=Math.min(this.mainViewPos.height,d.height)}}return d};a.FlyoutView.prototype.layoutOverlay=function(d){if(this.container.highlightMode.position=="onimage"){this.overlayTop.style.top=-(this.realHeight-d.height)+"px";this.overlayTop.style.left=-(this.realWidth-d.width)+"px";this.overlayTop.style.width=(2*this.realWidth-d.width)+"px";this.overlayTop.style.height=(this.realHeight-d.height)+"px";this.overlayLeft.style.top=0+"px";this.overlayLeft.style.left=-(this.realWidth-d.width)+"px";this.overlayLeft.style.width=(this.realWidth-d.width)+"px";this.overlayLeft.style.height=d.height+"px";this.overlayRight.style.top=0+"px";this.overlayRight.style.left=d.width+"px";this.overlayRight.style.width=(this.realWidth-d.width)+"px";this.overlayRight.style.height=d.height+"px";this.overlayBottom.style.top=d.height+"px";this.overlayBottom.style.left=-(this.realWidth-d.width)+"px";this.overlayBottom.style.width=(2*this.realWidth-d.width)+"px";this.overlayBottom.style.height=(this.realHeight-d.height)+"px"}else{this.overlayTop.style.top=-d.y-this.imageOffsetTop+"px";this.overlayTop.style.left=-d.x-this.imageOffsetLeft+"px";this.overlayTop.style.width=this.mainViewPos.width+"px";this.overlayTop.style.height=d.y+this.imageOffsetTop+"px";this.overlayLeft.style.top=0+"px";this.overlayLeft.style.left=-d.x-this.imageOffsetLeft+"px";this.overlayLeft.style.width=d.x+this.imageOffsetLeft+"px";this.overlayLeft.style.height=d.height+"px";this.overlayRight.style.top=0+"px";this.overlayRight.style.left=d.width+"px";this.overlayRight.style.width=(this.mainViewPos.width-d.width)-d.x-this.imageOffsetLeft+"px";this.overlayRight.style.height=d.height+"px";this.overlayBottom.style.top=d.height+"px";this.overlayBottom.style.left=-d.x-this.imageOffsetLeft+"px";this.overlayBottom.style.width=this.mainViewPos.width+"px";this.overlayBottom.style.height=(this.mainViewPos.height-d.height)-d.y-this.imageOffsetTop+"px"}};a.FlyoutView.prototype.activateFlyout=function(){if(!this.flyoutActive){this.flyoutActive=true;var i=this;function f(){if(i.flyoutActive){if(i.animation){i.animation.show(function(){if(!i.flyoutActivating){a.Logger.log(a.Logger.FINER,"FlyoutView.animationStart");var k=new a.event.FlyoutEvent(a.event.FlyoutEvent.NOTF_FLYOUT_SHOW_START,true);i.container.dispatchEvent(k,false);k=new a.event.UserEvent(a.event.UserEvent.ZOOM,[i.zoomFactor],true);i.container.dispatchEvent(k,false)}},function(){})}else{i.flyoutDiv.style.display="block";userEvent=new a.event.UserEvent(a.event.UserEvent.ZOOM,[i.zoomFactor],true);i.container.dispatchEvent(userEvent,false)}}}function e(r,o,n,q,p,k){var m=(new Date()).getTime();var l=q+(p-q)*(m-n)/(o*1000);if((m-n)>=(o*1000)){if(l>=1){if(r.filters){r.style.filter=""}}a.Util.setOpacity(r,p);window.clearTimeout(r.timerOpacity);r.timerOpacity=null;if(typeof k=="function"){k(arguments.callee)}return}else{a.Util.setOpacity(r,l);r.timerOpacity=window.setTimeout(function(){e(r,o,n,q,p,k)},10)}}if(a.browser.supportsTouch()){if(this.container.overlay){var h=a.Util.css.getCss("s7overlay","opacity",null,"s7flyoutzoomview",this.container.obj);if(this.overlay.timerOpacity){window.clearTimeout(this.overlay.timerOpacity);this.overlay.timerOpacity=null}var j=(new Date()).getTime();e(this.overlay,this.cursorFadeTime,j,0,h)}if(this.container.highlightMode.type=="cursor"){var g=a.Util.css.getCss("s7cursor","opacity",null,"s7flyoutzoomview",this.container.obj,{input:"touch"});if(this.highlightCursor.timerOpacity){window.clearTimeout(this.highlightCursor.timerOpacity);this.highlightCursor.timerOpacity=null}var j=(new Date()).getTime();a.Util.setOpacity(this.highlightCursor,0);this.highlightCursor.style.display="block";e(this.highlightCursor,this.cursorFadeTime,j,0,g,f)}else{if(this.container.highlightMode.type=="highlight"){var d=a.Util.css.getCss("s7highlight","opacity",null,"s7flyoutzoomview",this.container.obj);if(this.highlightFrame.timerOpacity){window.clearTimeout(this.highlightFrame.timerOpacity);this.highlightFrame.timerOpacity=null}var j=(new Date()).getTime();a.Util.setOpacity(this.highlightFrame,0);this.highlightFrame.style.display="block";e(this.highlightFrame,this.cursorFadeTime,j,0,d,f)}}}else{f()}this.flyoutActivating=true;this.invalidate()}};a.FlyoutView.prototype.deactivateFlyout=function(){if(this.flyoutActive){this.flyoutActive=false;if(this.animation){this.animation.hide(function(){},function(){if(!this.flyoutActive){this.flyoutDiv.style.display="none"}this.flyoutActivating=false;a.Logger.log(a.Logger.FINER,"FlyoutView.animationComplete");var d=new a.event.FlyoutEvent(a.event.FlyoutEvent.NOTF_FLYOUT_HIDE_END,true);this.container.dispatchEvent(d,false)})}else{this.flyoutDiv.style.display="none"}}};a.FlyoutView.prototype.invalidate=function(){this.invalid=true;this.draw()};a.FlyoutView.prototype.dispose=function(){if(this.timer){clearInterval(this.timer);this.timer=null}this.unloadHandlers();a.Util.removeTags(this.container.obj)};a.FlyoutView.Fade=function c(e,f,g,d){this.element=e;this.currentState=g?0:1;this.duration=f;this.hiddenState=g;this.currentCallback=null;this.callbackContext=d;this.start=null;this.timer=null};a.FlyoutView.Fade.prototype.show=function(f,g){this.start=new Date().getTime()+this.duration.showDelay*1000;var e=this;var h=this.currentCallback=d;if(!this.hiddenState){return}this.hiddenState=false;if(typeof this.timer!="undefined"){clearTimeout(this.timer);this.timer=null}function d(){if(h!==this.currentCallback){return}var j=(new Date().getTime()-this.start)/(this.duration.showTime*1000+1);var m=(j<1)?(1-this.currentState)*j*(1/this.duration.showTime+0.001)+this.currentState:1;if(j>=0){this.element.style.display="block";this.currentState=m}else{m=this.currentState}this.element.style.opacity=m;this.element.style.zoom=1;var n=a.browser&&a.browser.name=="ie"&&a.browser.version.major<=8;if(n&&this.callbackContext.transparent){this.element.style.visibility="hidden"}else{this.element.style.filter="alpha(opacity ="+(m*100)+")";var l=this.element.getElementsByTagName("*");for(var k=0;k<l.length;k++){l[k].style.filter="alpha(opacity ="+(m*100)+")"}}this.currentState=m;if((j<1)&&!this.hiddenState){this.currentCallback=d;this.timer=setTimeout(function(){d.apply(e,[])},25)}else{if(n&&this.callbackContext.transparent){this.element.style.visibility=""}if(g){g.apply(this.callbackContext,[])}}}if(f){f.apply(this.callbackContext,[])}d.apply(e,[])};a.FlyoutView.Fade.prototype.hide=function(e,g){this.start=new Date().getTime()+this.duration.hideDelay*1000;var d=this;var h=this.currentCallback=f;if(this.hiddenState){return}this.hiddenState=true;if(typeof this.timer!="undefined"){clearTimeout(this.timer);this.timer=null}function f(){if(h!==this.currentCallback){return}var j=(new Date().getTime()-this.start)/(this.duration.hideTime*1000+1);var m=(j<1)?(0-this.currentState)*j*(1/this.duration.showTime+0.001)+this.currentState:0;if(j>=0){this.element.style.display="block";this.currentState=m}else{m=this.currentState}this.element.style.opacity=m;this.element.style.zoom=1;var n=a.browser&&a.browser.name=="ie"&&a.browser.version.major<=8;if(n&&this.callbackContext.transparent){this.element.style.visibility=""}else{this.element.style.filter="alpha(opacity ="+(m*100)+")";var l=this.element.getElementsByTagName("*");for(var k=0;k<l.length;k++){l[k].style.filter="alpha(opacity ="+(m*100)+")"}}this.currentState=m;if((j<1)&&this.hiddenState){this.currentCallback=f;this.timer=setTimeout(function(){f.apply(d,[])},25)}else{if(n&&this.callbackContext.transparent){this.element.style.visibility="hidden"}if(g){g.apply(this.callbackContext,[])}}}if(e){e.apply(this.callbackContext,[])}f.apply(d,[])};a.FlyoutView.Fade.prototype.reset=function(f){this.hiddenState=true;if(typeof this.timer!="undefined"){clearTimeout(this.timer);this.timer=null}this.element.style.opacity=0;this.currentState=0;var g=a.browser&&a.browser.name=="ie"&&a.browser.version.major<=8;if(g&&this.callbackContext.transparent){this.element.style.visibility="hidden"}else{this.element.style.filter="alpha(opacity ="+0+")";var e=this.element.getElementsByTagName("*");for(var d=0;d<e.length;d++){e[d].style.filter="alpha(opacity ="+0+")"}}};a.FlyoutView.Slide=function b(e,f,g,d){this.element=e;this.currentState=g?0:1;this.elementWidth=parseFloat(e.width);this.duration=f;this.hiddenState=g;this.currentCallback=null;this.callbackContext=d;this.start=null;this.timer=null};a.FlyoutView.Slide.prototype.show=function(e,g){this.start=new Date().getTime()+this.duration.showDelay*1000;var d=this;var h=this.currentCallback=f;if(!this.hiddenState){return}this.hiddenState=false;if(typeof this.timer!="undefined"){clearTimeout(this.timer);this.timer=null}function f(){if(h!==this.currentCallback){return}var j=(new Date().getTime()-this.start)/(this.duration.showTime*1000+1);var l=(j<1)?(this.elementWidth-this.currentState)*j*(1/this.duration.showTime+0.001)+this.currentState:this.elementWidth;if(j>=0){this.element.style.display="block";this.currentState=l}else{l=this.currentState}this.element.style.width=Math.max(0,l)+"px";for(var k=0;k<this.element.childNodes.length;k++){this.element.childNodes[k].style.marginLeft=(-this.elementWidth+l)+"px"}this.currentState=l;if((j<1)&&!this.hiddenState){this.currentCallback=f;this.timer=setTimeout(function(){f.apply(d,[])},25)}else{if(g){g.apply(this.callbackContext,[])}}}if(e){e.apply(this.callbackContext,[])}f.apply(d,[])};a.FlyoutView.Slide.prototype.hide=function(e,g){this.start=new Date().getTime()+this.duration.hideDelay*1000;var d=this;var h=this.currentCallback=f;if(this.hiddenState){return}this.hiddenState=true;if(typeof this.timer!="undefined"){clearTimeout(this.timer);this.timer=null}function f(){if(h!==this.currentCallback){return}var j=(new Date().getTime()-this.start)/(this.duration.hideTime*1000+1);var l=(j<1)?(0-this.currentState)*j*(1/this.duration.showTime+0.001)+this.currentState:0;if(j>=0){this.element.style.display="block";this.currentState=l}else{l=this.currentState}this.element.style.width=Math.max(0,l)+"px";for(var k=0;k<this.element.childNodes.length;k++){this.element.childNodes[k].style.marginLeft=(-this.elementWidth+l)+"px"}this.currentState=l;if((j<1)&&this.hiddenState){this.currentCallback=f;this.timer=setTimeout(function(){f.apply(d,[])},25)}else{if(g){g.apply(this.callbackContext,[])}}}if(e){e.apply(this.callbackContext,[])}f.apply(d,[])};a.FlyoutView.Slide.prototype.reset=function(e){this.hiddenState=true;if(typeof this.timer!="undefined"){clearTimeout(this.timer);this.timer=null}this.element.style.width=0+"px";this.currentState=0;this.element.style.display="none";for(var d=0;d<this.element.childNodes.length;d++){this.element.childNodes[d].style.marginLeft=-this.elementWidth+"px"}if(e){e.apply(this.callbackContext,[])}};a.FlyoutView.Slide.prototype.cubicEase=function(d){return --d*d*d+1};a.FlyoutView.Slide.prototype.linear=function(d){return d};a.FlyoutView.Slide.prototype.quad=function(d){return Math.pow(d,2)};a.FlyoutView.Slide.prototype.root=function(d){return Math.pow(d,0.5)};a.FlyoutView.Slide.prototype.sine=function(d){return 1-Math.sin((1-d)*Math.PI/2)};a.FlyoutView.prototype.swapImage=function(e,f,d){if(this.swapTimer){window.clearTimeout(this.swapTimer);this.swapTimer=null}var h=(new Date()).getTime();function g(r,o,i,l,k,p,q,m){var j=(new Date()).getTime();var n=p+(q-p)*(j-k)/(l*1000);if((j-k)>=(l*1000)){a.Util.setOpacity(o,q);a.Util.setOpacity(i,p);if(q>0.99){if(o.filters){o.style.filter=""}}window.clearTimeout(r.swapTimer);r.swapTimer=null;if(typeof m=="function"){m(arguments.callee)}return}else{a.Util.setOpacity(o,n);a.Util.setOpacity(i,1-n);r.swapTimer=window.setTimeout(function(){g(r,o,i,l,k,p,q,m)},10)}}if(!e){if(!this.firstPicture){this.firstImage.style.visibility="";this.secondImage.style.visibility="hidden"}else{this.firstImage.style.visibility="hidden";this.secondImage.style.visibility=""}d()}else{if(!this.firstPicture){a.Util.setObjPos(this.secondImage,(this.firstImage.width-this.secondImage.width)/2,(this.firstImage.height-this.secondImage.height)/2);a.Util.setObjPos(this.firstImage,0,0);g(this,this.firstImage,this.secondImage,f,h,0,1,d)}else{a.Util.setObjPos(this.firstImage,(this.secondImage.width-this.firstImage.width)/2,(this.secondImage.height-this.firstImage.height)/2);a.Util.setObjPos(this.secondImage,0,0);g(this,this.secondImage,this.firstImage,f,h,0,1,d)}}}}})(s7getCurrentNameSpace());