/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2016 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.search");if(!b.search.SearchEffectControl){b.search.SearchEffectControl=function(c){arguments.callee.superclass.apply(this,[c,b.search.SearchEffectControl.NS,c.constructor,b.search.SearchEffect.RESTRICTED_STYLES])};b.search.SearchEffectControl.NS="s7sdk.search.SearchEffectControl";b.search.SearchEffectControl.prototype.rebuild=function(h){var c=this.component.mediaSet;var d=this.component.searchResults;var f=this.component.resolvedImageMaps;var e=this.component.itemIndex;var g=this.getOverlaysVisible();this.superproto.rebuild.apply(this,[h]);this.component.mediaSet=c;this.component.setSearchResults(d);this.component.resolvedImageMaps=f;if(c.items&&c.items[e]){this.component.setCurrentIndex(e)}this.setOverlaysVisible(g)}}b.Class.inherits(b.search.SearchEffectControl.NS,"s7sdk.ControlComponent");if(!b.search.SearchEffect){b.search.SearchEffect=function SearchEffect(c,e,d){var f=!!arguments[3];b.Logger.log(b.Logger.CONFIG,"s7sdk.search.SearchEffect constructor - containerId: %0, settings: %1 , compId: %2",c,e,d);d=(typeof d=="string"&&d.length)?d:"SearchEffect_"+b.Util.createUniqueId();arguments.callee.superclass.apply(this,[d,c,"div","s7searcheffect",e,!f]);if(this.serverUrl.lastIndexOf("/")!=(this.serverUrl.length-1)){this.serverUrl+="/"}this.container=this.getParent();var g=this.container?this.container.s7base:null;this.searchResults=null;this.resolvedImageMaps=[];this.locale=this.getParam("locale","");this.dir=this.direction=="auto"?this.locale=="ja":this.direction!="left";this.create(g,this.serverUrl);this.fadeTimer=null;if(!f){return new b.search.SearchEffectControl(this)}else{return this}};b.Class.inherits("s7sdk.search.SearchEffect","s7sdk.UIComponent");b.search.SearchEffect.RESTRICTED_STYLES={"s7searcheffect s7region":["border"],};b.search.SearchEffect.prototype.setCSS=function(e,d,c){if(this.isRestrictedCSSProperty(b.search.SearchEffect.RESTRICTED_STYLES,d)){throw new Error("You cannot set "+e+" : "+d+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[e,d,c])}};b.search.SearchEffect.prototype.setModifier=function(c){throw new Error("Trying to use setModifier on the Core class (SearchEffect) is unsupported! Please refer to SDK documentation on using setModifier.")};b.search.SearchEffect.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};b.search.SearchEffect.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},direction:{params:["direction"],defaults:["auto"],ranges:[["auto","left","right"]]}};b.search.SearchEffect.prototype.create=function(e,c){this.targetView=null;this.serverUrl=c;this.currentAsset=null;this.mediaSet=null;this.searchAreaOverlays=null;this.overlayContainer=null;this.overlaysVisible=true;this.itemIndex=-1;this.destroyed=false;this.createElement();this.obj.style.position="absolute";this.obj.style.top="0px";this.obj.style.left="0px";var d=this;this.__targetZoomRegion=function(f){d.targetZoomRegion(f)};this.__targetAssetChanged=function(f){d.targetAssetChanged(f)};this.__targetItemSelected=function(f){d.targetAssetChanged(f)};this.__transitionStart=function(f){d.transitionStart(f)};this.__transitionEnd=function(f){d.transitionEnd(f)};if(e!=null){this.attachToView(e)}};b.search.SearchEffect.prototype.addEventListener=function(e,d,c){b.Logger.log(b.Logger.FINE,"s7sdk.search.SearchEffect.addEventListener - type: %0, handler: %1, useCapture: %2",e,d.toString().substring(0,d.toString().indexOf("(")),c);b.Base.prototype.addEventListener.apply(this,[e,d,c])};b.search.SearchEffect.prototype.attachToView=function(c){if(c!==this.targetView){if(this.targetView){this.detachFromView(this.targetView)}this.targetView=c;if(c){this.targetView.addEventListener(b.event.ZoomRgnEvent.NOTF_ZOOM_RGN,this.__targetZoomRegion,false);this.targetView.addEventListener(b.event.AssetEvent.ASSET_CHANGED,this.__targetAssetChanged,false);this.targetView.addEventListener(b.event.AssetEvent.ITEM_SELECTED_EVENT,this.__targetItemSelected,false);this.targetView.addEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_START,this.__transitionStart,false);this.targetView.addEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_END,this.__transitionEnd,false);this.targetView.obj.appendChild(this.obj)}}};b.search.SearchEffect.prototype.targetZoomRegion=function(c){this.updateOverlayCoverage()};b.search.SearchEffect.prototype.targetAssetChanged=function(d){var c=d.s7event.asset instanceof b.MediaSetDesc?d.s7event.asset.items[d.s7event.frame]:d.s7event.asset;if(typeof c=="string"){throw new Error("AssetEvent should not be providing a string as the asset, it should be an ItemDesc!")}if(c.parent==null){throw new Error("ItemDesc must be part of a parent set!")}this.currentAsset=c;this.mediaSet=c.parent;if(this.mediaSet.items&&this.mediaSet.items[d.s7event.frame]){this.itemIndex=d.s7event.frame;this.currentAsset=this.mediaSet.items[d.s7event.frame]}if(this.getOverlaysVisible()){this.setCurrentIndex(d.s7event.frame)}};b.search.SearchEffect.prototype.hide=function(){if(this.overlayContainer){this.overlayContainer.style.display="none"}};b.search.SearchEffect.prototype.show=function(){if(this.overlayContainer){this.overlayContainer.style.diplay=""}};b.search.SearchEffect.prototype.transitionStart=function(c){if(this.overlayContainer){this.overlayContainer.style.visibility="hidden"}};b.search.SearchEffect.prototype.transitionEnd=function(c){if(this.overlayContainer){this.overlayContainer.style.visibility="inherit"}};b.search.SearchEffect.prototype.stopRequest=function(){if(this.isReq){this.isReq.cancelHttpReq()}};b.search.SearchEffect.prototype.resolveImageMaps=function(l){var o=l;var p=this.targetView.splitFrames.orientation?this.targetView.mediaSet_.getLandscapeIndex(o):o;var r=this.targetView.splitFrames.orientation&&(this.targetView.mediaSet_.getPortraitIndex(p)<o);var c=null;for(var h=0;h<this.searchResults.frameList.length;h++){if(p==this.searchResults.frameList[h].idx){c=this.searchResults.frameList[h];break}}if(c){var n=this.serverUrl;var d=[];if(this.mediaSet.items[l].images!=null){for(var h=0;h<this.mediaSet.items[l].images.length;h++){d.push(this.mediaSet.items[l].images[h].name)}}else{d.push(this.mediaSet.items[l].name)}var m=[];for(var f=0;f<d.length;f++){m[f]="&mapA="}if(this.targetView.splitFrames.orientation){var q="";var e=null;if(r){for(var h=0;h<c.pageList.length;h++){if(c.pageList[h].idx==1){e=c.pageList[h];break}}}else{for(var h=0;h<c.pageList.length;h++){if(c.pageList[h].idx==0){e=c.pageList[h];break}}}if(e){for(var g=0;g<e.objList.length;g++){q+=encodeURIComponent('<area shape="rect" coords="'+e.objList[g]+'">')}}m[0]="&mapA="+q}else{for(var h=0;h<c.pageList.length;h++){var q="";var e=c.pageList[h];for(var g=0;g<e.objList.length;g++){q+=encodeURIComponent('<area shape="rect" coords="'+e.objList[g]+'">')}m[e.idx]="&mapA="+q}}frName=b.SwatchesParser.combinedImageName(d,this.dir,m);n=this.serverUrl+frName;if(b.Util.isNonEmptyString(this.locale)){n+="&locale="+this.locale}if(n.indexOf("?")==-1){n+="?req=map"}else{n+="&req=map"}n+=",json,utf-8&scl=1";if(this.isReq){this.isReq.cancelHttpReq()}this.isReq=new b.IS();this.isReq.getHttpReq(n,this.resolveCompleted,this.resolveFailed,this)}};b.search.SearchEffect.prototype.resolveCompleted=function(d,g){if(this.destroyed){return}var c=new Array();for(var f=0;f<d.length;f++){var h=d[f];for(var e=0;e<h.coords.length;e++){h.coords[e]=parseInt(h.coords[e])}c.push(new b.MapDesc(h.shape,h.coords,h.alt,h.href,h.rollover_key,h.target))}g.resolvedImageMaps[encodeURIComponent(g.currentAsset+"_"+g.searchResults.searchText)]=c;g.createSearchOverlays(c);return d};b.search.SearchEffect.prototype.resolveFailed=function(c,d){};b.search.SearchEffect.prototype.setCurrentIndex=function(d){this.stopRequest();if(this.mediaSet&&this.searchResults){var c=[];this.itemIndex=d;this.currentAsset=this.mediaSet.items[d];this.removeOverlaysFromView(true);if(this.resolvedImageMaps&&this.resolvedImageMaps[encodeURIComponent(this.currentAsset+"_"+this.searchResults.searchText)]){c=this.resolvedImageMaps[encodeURIComponent(this.currentAsset+"_"+this.searchResults.searchText)];this.createSearchOverlays(c)}else{this.resolveImageMaps(d)}}};b.search.SearchEffect.prototype.getOverlaysVisible=function(){b.Logger.log(b.Logger.FINE,"s7sdk.search.SearchEffect.getOverlaysVisible");return this.overlaysVisible};b.search.SearchEffect.prototype.setOverlaysVisible=function(c){b.Logger.log(b.Logger.FINE,"s7sdk.search.SearchEffect.setOverlaysVisible - value: %0",c);this.overlaysVisible=c;if(c){this.updateOverlayCoverage(true)}else{this.removeOverlaysFromView(false)}};b.search.SearchEffect.prototype.updateOverlayCoverage=function(c){c=(typeof c=="undefined")?false:c;if(this.targetView&&this.searchAreaOverlays&&this.searchAreaOverlays.length&&this.overlaysVisible){if(!this.overlayContainer){this.overlayContainer=document.createElement("div")}this.overlayContainer.id=this.id+"_overlayContainer";this.overlayContainer.style.overflow="hidden";this.overlayContainer.style.position="absolute";this.overlayContainer.style.pointerEvents="none";this.overlayContainer.style.left=0+"px";this.overlayContainer.style.top=0+"px";this.overlayContainer.style.width=this.targetView.getWidth()+"px";this.overlayContainer.style.height=this.targetView.getHeight()+"px";this.obj.appendChild(this.overlayContainer);for(var e=0;e<this.searchAreaOverlays.length;e++){var d=this.searchAreaOverlays[e];if(d.areaDesc.shape==b.MapDescShape.SHAPE_POLY&&d.shape){d.updateOverlay()}if(!d.element.parentNode||d.element.parentNode.nodeType!=1){this.overlayContainer.appendChild(d.element)}}if(c){this.fadeInOverlays_()}}};b.search.SearchEffect.prototype.fadeInOverlays_=function(){var e=this.overlayContainer;var c=0;function d(){if(!e.currentOpacity_){e.currentOpacity_=0}if(e.currentOpacity_<c){e.currentOpacity_+=0.05/0.5;for(var f=0;f<e.childNodes.length;f++){b.Util.setOpacity(e.childNodes[f],e.currentOpacity_)}this.fadeTimer=setTimeout(d,50)}else{for(var f=0;f<e.childNodes.length;f++){if(b.browser.name==="ie"&&b.browser.version.major<=8){e.childNodes[f].style.removeAttribute("filter")}else{e.childNodes[f].style.opacity=""}}}if(b.browser.device.name=="android"&&b.browser.device.version=="4"){e.style.display="none";var g=e.offsetWidth;e.style.display="block"}}d()};b.search.SearchEffect.prototype.removeOverlaysFromView=function(e){var e=(typeof e=="undefined")?false:e;if(this.overlayContainer&&this.overlayContainer.parentNode){this.overlayContainer.parentNode.removeChild(this.overlayContainer)}if(e){this.overlayContainer=null;if(this.searchAreaOverlays){for(var d=0;d<this.searchAreaOverlays.length;d++){var c=this.searchAreaOverlays[d];c.cleanUp()}this.searchAreaOverlays=null}}};b.search.SearchEffect.prototype.detachFromView=function(c){c.removeEventListener(b.event.ZoomRgnEvent.NOTF_ZOOM_RGN,this.__targetZoomRegion,false);c.removeEventListener(b.event.AssetEvent.ASSET_CHANGED,this.__targetAssetChanged,false);c.removeEventListener(b.event.AssetEvent.ITEM_SELECTED_EVENT,this.__targetItemSelected,false);c.removeEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_START,this.__transitionStart,false);c.removeEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_END,this.__transitionEnd,false);if(this.obj.parentElement===c.obj){this.obj.parentElement.removeChild(this.obj)}};b.search.SearchEffect.prototype.cleanUp=function(){if(this.isReq){this.isReq.cancelHttpReq();this.isReq=null}if(this.fadeTimer){clearTimeout(this.fadeTimer);this.fadeTimer=null}if(this.targetView){this.detachFromView(this.targetView);this.targetView=null}this.container=null;b.Logger.log(b.Logger.FINE,"s7sdk.search.SearchEffect.cleanUp");this.removeOverlaysFromView(true);this.destroyed=true;if(this.obj){b.Util.removeTags(this.obj);this.obj.style.cssText=""}};b.search.SearchEffect.prototype.createSearchOverlays=function(d){this.removeOverlaysFromView(true);this.searchAreaOverlays=[];for(var f=0;f<d.length;f++){var c=d[f];var e=new b.SearchAreaOverlay(this,c);this.searchAreaOverlays.push(e)}if(this.overlaysVisible){this.updateOverlayCoverage(true)}};b.search.SearchEffect.prototype.transformPoint=function(c){return this.targetView.imagePixelsToViewPoint(c)};b.search.SearchEffect.prototype.reverseTransformPoint=function(c){return this.targetView.viewPointToImagePixels(c)};b.search.SearchEffect.prototype.getTargetId=function(){return this.targetView.obj.id};b.search.SearchEffect.prototype.getTargetClassName=function(){return this.targetView.obj.className};b.search.SearchEffect.prototype.getModifiers=function(){return this.modifiers};b.search.SearchEffect.prototype.getSearchResults=function(){return this.searchResults};b.search.SearchEffect.prototype.setSearchResults=function(c){if(this.searchResults===c){return}if(c){this.searchResults=c;this.resolveImageMaps(this.itemIndex)}};(function a(){var f=b.Util.css.createCssRuleText;var e=b.Util.css.createCssImgUrlText;var d=b.browser&&b.browser.name=="ie"&&b.browser.version.major>=10;var c=f(".s7searcheffect",{"z-index":"999","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-ms-touch-action":d?"none":"","touch-action":d?"none":""})+f(".s7searcheffect .s7region",{background:"rgba(255,255,0, 0.5)"});b.Util.css.addDefaultCSS(c,"SearchEffect")})()}if(!b.SearchAreaOverlay){b.SearchAreaOverlay=function SearchAreaOverlay(e,d){this.overlayManager=e;this.areaDesc=d;this.active=false;this.targetClassName=this.overlayManager.cl;this.targetId=this.overlayManager.id;this.element=document.createElement("div");this.element.style.position="absolute";this.element.className="s7region";if(this.areaDesc.shape==b.MapDescShape.SHAPE_POLY){var c=this.getPoints(this.areaDesc.coords,false);this.createShape(c)}this.setActive(true)};b.SearchAreaOverlay.prototype.getActive=function(){return this.active};b.SearchAreaOverlay.prototype.setActive=function(c){if(this.active!=c){this.active=c;this.updateOverlay()}};b.SearchAreaOverlay.prototype.getAreaDesc=function(){return this.areaDesc};b.SearchAreaOverlay.prototype.cleanUp=function(){};b.SearchAreaOverlay.prototype.updateOverlay=function(){if(this.areaDesc.shape==b.MapDescShape.SHAPE_POLY&&this.shape){var n=this.shape.left;var l=this.shape.top;var d=this.shape.right;var m=this.shape.bottom;var f=new b.Point2D(n,l);var i=new b.Point2D(d,m);var c=this.overlayManager.transformPoint(f);var g=this.overlayManager.transformPoint(i);var j=c.x;var e=c.y;var o=g.x-c.x;var k=g.y-c.y;this.element.style.left=j+"px";this.element.style.top=e+"px";this.element.style.width=o+"px";this.element.style.height=k+"px";if(this.active){b.Util.setOpacity(this.element,1)}else{b.Util.setOpacity(0)}}};b.SearchAreaOverlay.prototype.getPoints=function(h,f){var f=(typeof f=="undefined")?false:f;var e=[];if(h.length%2){b.Logger.log(b.Logger.WARNING,"s7sdk.search.SearchEffect - s7sdk.SearchAreaOverlay.getPoints - There are an odd number of coordinates!")}var d=Math.floor(h.length/2);for(var g=0;g<d;g++){var c=new b.Point2D(h[g*2],h[g*2+1]);if(f){c=this.overlayManager.transformPoint(c)}e.push(c)}return e};b.SearchAreaOverlay.prototype.createShape=function(d){var c={};var f;c.left=c.right=d[0].x;c.top=c.bottom=d[0].y;c.points=[];for(var e=0;e<d.length;e++){var g={x:d[e].x,y:d[e].y};if(f){if(c.left>g.x){c.left=g.x}if(c.right<g.x){c.right=g.x}if(c.top>g.y){c.top=g.y}if(c.bottom<g.y){c.bottom=g.y}g.box={L:g.x>f.x?f.x:g.x,R:g.x>f.x?g.x:f.x,T:g.y>f.y?f.y:g.y,B:g.y>f.y?g.y:f.y};g.px=f.x;g.py=f.y}c.points[e]=g;f=g}c.width=c.right-c.left;c.height=c.bottom-c.top;this.shape=c}}})(s7getCurrentNameSpace());