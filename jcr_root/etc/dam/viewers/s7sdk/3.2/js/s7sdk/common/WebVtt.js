/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(a){a.pkg("s7sdk.common");if(!a.common.WebVtt){a.common.WebVtt=function WebVtt(d,c){a.Logger.log("s7sdk.Logger.FINE s7sdk.common.WebVtt type=%0, items=%1",d,c);this.type=d;this.items=c};a.common.WebVtt.parse=function b(e,d){a.Logger.log(a.Logger.FINE,"s7sdk.common.WebVtt.parse type=%0, content=\n%1",d,e);var c=new a.common.WebVttParser(d).parseData(e);return new a.common.WebVtt(d,c)};a.common.WebVtt.TYPE_UNKNOWN="unknown";a.common.WebVtt.TYPE_CAPTION="caption";a.common.WebVtt.TYPE_NAVIGATION="navigation";a.common.WebVtt.TYPE_METADATA="metadata";a.common.WebVtt.prototype.getType=function(){return this.type};a.common.WebVtt.prototype.getItems=function(){return this.items};a.common.WebVttParser=function WebVttParser(c){this.items=null;this.parseTextFcn=null;this.type=c;if(c==a.common.WebVtt.TYPE_CAPTION){this.parseTextFcn=this.parseCueText}else{if(c==a.common.WebVtt.TYPE_NAVIGATION){this.parseTextFcn=this.parseCueText}else{if(c==a.common.WebVtt.TYPE_METADATA){this.parseTextFcn=this.parseJSON}else{throw new Error("s7sdk.common.WebVtt cannot handle unsupported content type: "+c)}}}};a.common.WebVttParser.prototype.parseData=function(h){a.Logger.log(a.Logger.FINE,"WebVttParser.parseData: %0",h);this.items=[];var m=h.split("\n");var f=0;var j=0;var e=true;var d="",c="",i="";var k=false;for(var g in m){if(!m.hasOwnProperty(g)){continue}var l=m[g].toString().trim();if(e){if(g==0){continue}else{if(l.length==0){continue}}e=false}if(l.length==0){if(j>1){if(d.length>0){this.addData(d,c,i)}else{}}f+=1;j=0;d=c=i=""}else{if(j<2&&d.length==0){if(/(\d\d\:\d\d[.,]\d\d\d)\s+--\>/.test(l)){k=true;d=l;c=""}else{i=l;if(!k){if(c.length>0){c+="\n"}c+=l}}}else{if(c.length>0){c+="\n"}c+=l}j+=1}}if(j>1){this.addData(d,c,i)}return this.items};a.common.WebVttParser.prototype.parseCueSettings=function(g){var f={lineSize:"100%",textPosition:"50%",textAlign:"middle",vertical:""};var c=d(g);if(c.hasOwnProperty("region")){}if(c.hasOwnProperty("D")){if(c.D=="vertical-lr"){f.vertical="lr"}else{if(c.D=="vertical-rl"){f.vertical="rl"}}}if(c.hasOwnProperty("L")){if(/-?\d*%?/.test(c.L)){f.linePosition=c.L}}if(c.hasOwnProperty("T")){if(/\d%/.test(c.T)){var e=parseInt(c.T);if(e>=0&&e<=100){f.textPosition=c.T}}}if(c.hasOwnProperty("S")){f.lineSize=c.S}if(c.hasOwnProperty("A")){if(/(left)|(right)/.test(c.A)){f.textAlign=c.A}else{if(c.A=="end"){f.textAlign="right"}else{if(c.A=="start"){f.textAlign="left"}}}}return f;function d(l){var j=l.split(" ");var i=0,h=[];for(;i<j.length;i++){var k=j[i].split(":",2);if(k&&k.length>0){h[k[0].replace(/^\s*?/,"")]=k.length>1?k[1]:""}}return h}};a.common.WebVttParser.prototype.parseCueText=function(d){var c="";c=d.replace(/(<(\d\d\:)?\d\d\:\d\d[.,]\d\d\d>)/g," ");return c};a.common.WebVttParser.prototype.parseJSON=function(e){var d=null;try{d=JSON&&JSON.parse(e)}catch(c){a.Logger.log(a.Logger.WARNING,"Cannot parse JSON object in WebVtt content of type %0: %1\n%2",this.type,c,e)}if(!d){throw new Error("Invalid JSON object in WebVtt content")}return d};a.common.WebVttParser.prototype.addData=function(f,h,g){if(f.length==0||h.length==0){return}var c=f.match(/((\d\d\:)?\d\d\:\d\d[.,]\d\d\d)/g);if(c.length<2){return}var e=f.substring(f.indexOf(c[1])+c[1].length);this.items.push(new a.common.WebVttItem(d(c[0]),d(c[1]),this.parseTextFcn.apply(this,[h]),this.parseCueSettings(e),g));function d(l){var m=l.split(":");var i=0,j=0,k=0;if(m.length>0){k=parseFloat(m[m.length-1])}else{return -1}if(m.length>1){j=parseInt(m[m.length-2])}if(m.length>2){i=parseInt(m[m.length-3])}return Number(((i*60+j)*60+k)*1000).toFixed(0)}}}if(!a.common.WebVttItem){a.common.WebVttItem=function WebVttItem(g,c,e,d,f){this.start=g;this.end=c;this.data=e;if(d){this.settings=d}if(f){this.id=f}};a.common.WebVttItem.prototype.toString=function(){function c(d){if(typeof(d)=="object"){if(JSON){return JSON.stringify(d)}}else{if(d){return d.toString()}}}return this.start+" --> "+this.end+", data="+c(this.data)+", id="+this.id+", settings="+c(this.settings)}}})(s7getCurrentNameSpace());