/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.set");b.Util.require("s7sdk.common.IS");b.Util.require("s7sdk.common.ScrollableDiv");b.Util.require("s7sdk.common.Thumb");b.Util.require("s7sdk.utils.SwatchesParser");b.Util.require("s7sdk.common.ItemDesc");b.Util.require("s7sdk.common.Geometry");b.Util.require("s7sdk.common.Button");b.Util.require("s7sdk.event.Event");b.Util.require("s7sdk.common.ScrollBar");if(!b.set.ThumbnailGridViewControl){b.set.ThumbnailGridViewControl=function(c){arguments.callee.superclass.apply(this,[c,b.set.ThumbnailGridViewControl.NS,c.constructor,b.set.ThumbnailGridView.RESTRICTED_STYLES])};b.set.ThumbnailGridViewControl.NS="s7sdk.set.ThumbnailGridViewControl";b.set.ThumbnailGridViewControl.prototype.rebuild=function(d){if(this.component){var c=this.component.getFrame();this.superproto.rebuild.apply(this,[d]);this.component.selectSwatch(c)}}}b.Class.inherits(b.set.ThumbnailGridViewControl.NS,"s7sdk.ControlComponent");if(!b.set.ThumbnailGridView){b.set.ThumbnailGridView=function ThumbnailGridView(e,g,o){var m=!!arguments[3];o=(typeof o=="string"&&o.length)?o:"ThumbnailGridView_"+b.Util.createUniqueId();b.Logger.log(b.Logger.CONFIG,"s7sdk.set.ThumbnailGridView constructor - container: %0, settings: %1 , compId: %2",e,g,o);arguments.callee.superclass.apply(this,[o,e,"div","s7thumbnailgridview",g,!m]);this.container=this.getParent();if(this.serverUrl.lastIndexOf("/")!=(this.serverUrl.length-1)){this.serverUrl+="/"}this.imageModifier=b.MediaSetParser.parseAssetForSetReq(this.asset).mod;if(this.size.width==0||this.size.height==0){this.size.width=parseInt(b.Util.css.getCss("s7thumbnailgridview","width",this.id,null,this.container));this.size.height=parseInt(b.Util.css.getCss("s7thumbnailgridview","height",this.id,null,this.container));if(!b.Util.isNumber(this.size.width)||!b.Util.isNumber(this.size.height)||this.size.width<=0||this.size.height<=0){this.size.width=500;this.size.height=250}}if(this.tmbSize.width==0||this.tmbSize.height==0){this.tmbSize.width=parseInt(b.Util.css.getCss("s7thumb","width",this.id,"s7thumbnailgridview",this.container));this.tmbSize.height=parseInt(b.Util.css.getCss("s7thumb","height",this.id,"s7thumbnailgridview",this.container));if(!b.Util.isNumber(this.tmbSize.width)||!b.Util.isNumber(this.tmbSize.height)||this.tmbSize.width<=0||this.tmbSize.height<=0){this.tmbSize.width=75;this.tmbSize.height=75}}if(typeof this.getParam("cellspacing")!="undefined"&&(this.getParam("cellspacing")!="")){}else{var f=0;var c=0;var k=0;var d=0;var n=["margin-left","margin-right"];var l=["margin-top","margin-bottom"];for(var j=0;j<n.length;j++){k=parseInt(b.Util.css.getCss("s7thumbcell",n[j],this.id,"s7thumbnailgridview",this.container));if(b.Util.isNumber(k)){f+=k}}for(var j=0;j<l.length;j++){d=parseInt(b.Util.css.getCss("s7thumbcell",l[j],this.id,"s7thumbnailgridview",this.container));if(b.Util.isNumber(d)){c+=d}}f=isNaN(f)?0:f;c=isNaN(c)?0:c;this.cellSpacing.horizontalSpacing=f;this.cellSpacing.verticalSpacing=c}this.maxTmbWid_=this.tmbSize.width;this.maxTmbHei_=this.tmbSize.height;var h=0;this.locale=this.getParam("locale","");this.dir=this.direction=="auto"?this.locale=="ja":this.direction!="left";this.mediaSet_=null;this.totalWidth_=this.size.width;this.totalHeight_=this.size.height;this.wid_=this.size.width-h*2;this.hei_=this.size.height-h*2;this.showSwatches_=true;this.fitCols_=NaN;this.fitRows_=NaN;this.assetName_=null;this.isReq_=null;this.swatches_=[];this.filteredSet_=[];this.swatchGroup_=null;this.scrollParentDiv_=null;this.swatchGroupRect_=null;this.currentSwatch_=null;this.itemIndex_=-1;this.rollOver_=false;this.createElement();this.attachToContainer();this.viewReady=false;this.preloadInProgress=false;this.delay=50;this.queue=new Array();this.timer=setInterval(b.Util.wrapContext(this.onProcess,this),this.delay);this.splitFrames={orientation:false};this.setAsset(this.asset);if(!m){return new b.set.ThumbnailGridViewControl(this)}else{return this}};b.Class.inherits("s7sdk.set.ThumbnailGridView","s7sdk.UIComponent");b.set.ThumbnailGridView.prototype.getComponent=function(){return this};b.set.ThumbnailGridView.prototype.getMediaSet=function(){return this.mediaSet_};b.set.ThumbnailGridView.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},asset:{params:["imageSet"],defaults:[""],parseParams:false},aemmode:{params:["value"],defaults:[false],ranges:[[true,false]]},iscommand:{params:["value"],defaults:[""],parseParams:false},maxloadradius:{params:["value"],defaults:["1"],ranges:["-1:"]},cellSpacing:{params:["horizontalSpacing","verticalSpacing"],defaults:[10,10],ranges:["0:","0:"]},textPos:{params:["textpos"],defaults:["bottom"],ranges:[["bottom","top","left","right","tooltip","none"]]},fmt:{params:["format"],defaults:["jpg"],ranges:[["jpg","jpeg","png","png-alpha","gif","gif-alpha"]]},direction:{params:["direction"],defaults:["auto"],ranges:[["auto","left","right"]]},enableDragging:{params:["enabled","overdragvalue"],defaults:[true,0.5,0],ranges:[,"0:1"]},scrollbar:{params:["value"],defaults:[true],ranges:[[true,false]]},align:{params:["align"],defaults:["center"],ranges:[["left","center","right"]]},interval:{params:["value"],defaults:[20],ranges:["1:1000"]},tmbSize:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"],deprecated:true},size:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"],deprecated:true}};b.set.ThumbnailGridView.RESTRICTED_STYLES={s7thumbnailgridview:["width","height"],"s7thumbnailgridview s7thumb":["width","height"],"s7thumbnailgridview s7thumbcell":["margin-left","margin-right","margin-top","margin-bottom","margin"],"s7thumbnailgridview s7label":["font-family","font-size","font-style"]};b.set.ThumbnailGridView.prototype.setCSS=function(e,d,c){if(this.isRestrictedCSSProperty(b.set.ThumbnailGridView.RESTRICTED_STYLES,d)){throw new Error("You cannot set "+e+" : "+d+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[e,d,c])}};b.set.ThumbnailGridView.prototype.setModifier=function(c){throw new Error("Trying to use setModifier on the Core class (ThumbnailGridView) is unsupported! Please refer to SDK documentation on using setModifier.")};b.set.ThumbnailGridView.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};b.set.ThumbnailGridView.prototype.setAsset=function(e){if(typeof e!="string"){throw new Error("Asset name must be represented by a string!")}this.currentAsset=e;var c=unescape(e);if(!(c.length>0)){return}if(this.assetName_!=null&&c!=this.assetName_){var d=new b.event.UserEvent(b.event.UserEvent.SWAP,[0,e],true);b.Event.dispatch(this.obj,d,false)}this.itemIndex_=-1;this.filteredSet_=[];this.assetName_=c;this.loadAsset()};b.set.ThumbnailGridView.prototype.getContainer=function(){return this.getParent()};b.set.ThumbnailGridView.prototype.build=function(){this.attachToContainer();this.filteredSet_=this.splitFrames.orientation?this.filteredSet_P:this.filteredSet_L;this.initSwatches();this.layoutGrid();var c=new b.event.AssetEvent(b.event.AssetEvent.ASSET_CHANGED,this.mediaSet_,0,true);this.dispatchEvent(c)};b.set.ThumbnailGridView.prototype.getObjRect=function(d){var c=d.getBoundingClientRect();c=new b.Rectangle(c.left,c.top,d.offsetWidth,d.offsetHeight);return c};b.set.ThumbnailGridView.prototype.getNextToLoad=function(){if(!this.swatchGroup_||!this.toLoad||this.toLoad.length==0){return}var k=new Array();for(var g=0;g<this.toLoad.length;g++){var m=this.toLoad[g];if(!(this.swatches_[m].isLoading||this.swatches_[m].isComlete)){k.push(m)}}this.toLoad=k;var l=this.getObjRect(this.swatchGroup_.div);var h=this.getObjRect(this.scrollParentDiv_);h.x=h.x-l.x;h.y=h.y-l.y;this.checkForload=function(){for(var q=0;q<this.toLoad.length;q++){var p=this.toLoad[q];if(this.swatchesPositions[p]&&this.swatchesPositions[p].rect){var o=h.intersection(this.swatchesPositions[p].rect);if(o.width==0||o.height==0||this.swatches_[p].isLoading||this.swatches_[p].isComlete){continue}return this.swatches_[p]}}return null};this.allVisisbleLoaded=function(){for(var q=0;q<this.toLoad.length;q++){var p=this.toLoad[q];if(this.swatchesPositions[p]&&this.swatchesPositions[p].rect){var o=h.intersection(this.swatchesPositions[p].rect);if(o.width==0||o.height==0){continue}if(!this.swatches_[p].isComlete){return false}}}return true};var n=this.checkForload();if(n){return n}if(!this.viewReady&&this.allVisisbleLoaded()){this.viewReady=true;var e=new b.event.StatusEvent(b.event.StatusEvent.NOTF_VIEW_READY,true);b.Event.dispatch(this.obj,e,false)}var j=this.maxloadradius==0?0:(Math.ceil(this.maxloadradius)-0.5);if(j==0){return null}var c=(this.maxTmbWid_+this.cellSpacing.horizontalSpacing)*j;var f=(this.maxTmbHei_+this.cellSpacing.verticalSpacing)*j;h.x-=c;h.width+=2*c;h.y-=f;h.height+=2*f;var d=this.checkForload();return d};b.set.ThumbnailGridView.prototype.onProcess=function(){var e=new Array();for(var d=0;d<3;d++){var f=this.queue[d];if(f!=null&&!f.isComlete){e.push(f)}else{var f=this.getNextToLoad();if(f){f.loadImage();e.push(f)}}}this.queue=e;if(this.maxloadradius!=0){this.preloadComplete=function(){for(var g=0;g<this.swatches_.length;g++){if(this.swatches_[g].isLoading){return false}}return true};if(!this.preloadComplete()){if(!this.preloadInProgress){var c=new b.event.StatusEvent(b.event.StatusEvent.NOTF_PRELOAD_START,true);b.Event.dispatch(this.obj,c,false)}this.preloadInProgress=true}else{if(this.preloadInProgress){this.preloadInProgress=false;var c=new b.event.StatusEvent(b.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);b.Event.dispatch(this.obj,c,false)}}}};b.set.ThumbnailGridView.prototype.cleanUp=function(){if(this.isReq_){this.isReq_.cancelHttpReq();this.isReq_=null}this.swatches_=[];this.currentSwatch_=null;this.toLoad=[];this.cleanUpcommon();this.obj.style.cssText=""};b.set.ThumbnailGridView.prototype.cleanUpcommon=function(){if(this.timer){clearInterval(this.timer);this.timer=null}if(this.scr){this.obj.removeChild(this.scr);this.scrollbarInst=null;this.scr=null}if(this.scrollParentDiv_!=null){if(this.swatchGroup_){this.swatchGroup_.dispose()}this.obj.removeChild(this.scrollParentDiv_);this.scrollParentDiv_=null;this.swatchGroup_=null}b.Util.removeTags(this.obj)};b.set.ThumbnailGridView.prototype.layoutGrid=function(){if(!this.timer){this.timer=setInterval(b.Util.wrapContext(this.onProcess,this),this.delay)}var c=this.layoutSwatches(false);if(c==null){return}if((this.fitRows_<Math.ceil(this.filteredSet_.length/c.cols)&&this.scrollbar)){c=this.layoutSwatches(true)}if(c==null){return}this.injectSwatches(c);this.obj.appendChild(this.scrollParentDiv_);if(this.itemIndex_!=-1&&this.currentSwatch_){this.selectSwatch(this.itemIndex_,true)}};b.set.ThumbnailGridView.prototype.setMediaSet=function(f,e){e=(typeof e=="number")?e:0;this.cleanUp();this.obj.setWidth(this.getWidth());this.obj.setHeight(this.getHeight());this.itemIndex_=-1;this.assetName_=null;var c=f;if(!(f instanceof b.OrientationSetDesc)){c=new b.OrientationSetDesc(c,null)}this.mediaSet_=c;this.currentAsset=c;this.createIndexTexts(" - ");this.filteredSet_L=b.SwatchesParser.filterSet(c.landscape,e,this.showSwatches_);this.filteredSet_P=b.SwatchesParser.filterSet(c.portrait,e,this.showSwatches_);this.build();var d=new b.event.StatusEvent(b.event.StatusEvent.NOTF_ASSET_METADATA_READY,true);b.Event.dispatch(this.obj,d,false)};b.set.ThumbnailGridView.prototype.createIndexTexts=function(e){var d=this.mediaSet_.landscape.items;var c=this.mediaSet_.landscape.type!==b.ItemDescType.ECAT_SET;this.indexTextLandscape=[];var g=1;e=e?e:" - ";for(var f=0;f<d.length;f++){var h=d[f];this.indexTextLandscape[f]=g.toString();if(!(h.np||c)){g++;this.indexTextLandscape[f]+=e+g}g++}this.indexTextPortrait=[];if(this.mediaSet_.portrait){d=this.mediaSet_.portrait.items;for(var f=0;f<d.length;f++){this.indexTextPortrait[f]=(f+1).toString()}}};b.set.ThumbnailGridView.prototype.getIndexFromItem=function(f){if(this.mediaSet_==null){throw new Error("Cannot get index of item because media-set is does not exist!")}var e=-1;var d=this.filteredSet_;for(var c=0;c<d.length;c++){if(d[c].name==f.name){e=c;break}}return e};b.set.ThumbnailGridView.prototype.applyItem=function(d){var c=this.getIndexFromItem(d);if(c<0){throw new Error("Cannot apply item because it does not exist in set!")}this.selectSwatch(c)};b.set.ThumbnailGridView.prototype.loadAsset=function(){b.Logger.log(b.Logger.FINER,"s7sdk.set.ThumbnailGridView.loadAsset");var c=this.serverUrl+"/"+b.MediaSetParser.parseAssetForSetReq(this.assetName_).req;if(b.Util.isNonEmptyString(this.locale)){c+="&locale="+this.locale}if(this.isReq){this.isReq.cancelHttpReq()}this.isReq_=new b.IS(this.serverUrl,this.assetName_);this.isReq_.getHttpReq(c,function(e,d){b.set.ThumbnailGridView.prototype.setRequestComplete.apply(d,[e])},function(e,d){b.set.ThumbnailGridView.prototype.setRequestError.apply(d,[e])},this)};b.set.ThumbnailGridView.prototype.setRequestComplete=function(d){var c=d.set;if(c==null){return}var e=b.MediaSetParser.parse(c,this.imageModifier,this.aemmode,this.dir);this.updateLandscapeLabels(e," - ");this.setMediaSet(e)};b.set.ThumbnailGridView.prototype.updateLandscapeLabels=function(d,g){var f=d.items;var e=d.type!==b.ItemDescType.ECAT_SET;g=g?g:" : ";for(var h=0;h<f.length;h++){var j=f[h];var c=j.label;var k=undefined;if(j.images){if(j.images[0].label){c=j.images[0].label}if(j.images[1]&&j.images[1].label){k=j.images[1].label}}j.label=c;if(j.np||e){if(!j.label){j.label=k?k:""}}else{if(j.label){j.label+=k?g+k:""}else{j.label=k?k:""}}if(!j.label){j.label=""}}};b.set.ThumbnailGridView.prototype.setRequestError=function(c){b.Logger.log(b.Logger.WARNING,"s7sdk.set.ThumbnailGridView.setRequestError - response: %0",c)};b.set.ThumbnailGridView.prototype.initSwatches=function(){var h;var g;var e;var d=1;this.toLoad=new Array();var c=this.splitFrames.orientation?Math.round(this.tmbSize.width/2):this.tmbSize.width;this.maxTmbWid_=c;for(var f=0;f<this.filteredSet_.length;f++){h=this.filteredSet_[f];g=h.swatch;var j=g.owner.label;if(!j||j==""){j=this.splitFrames.orientation?this.indexTextPortrait[g.sourceFrame]:this.indexTextLandscape[g.sourceFrame]}e=new b.Thumb(this.obj,this.serverUrl,this.iscommand,g,c,this.tmbSize.height,this.fmt,-1,0,undefined,this.textPos,this.cl,this.locale,true,j,this.maxloadradius!=-1);this.maxTmbWid_=(e.getWidth()<this.maxTmbWid_)?this.maxTmbWid_:e.getWidth();this.maxTmbHei_=(e.getHeight()<this.maxTmbHei_)?this.maxTmbHei_:e.getHeight();this.swatches_[g.frame]=e;this.toLoad[f]=f;e.div.style.margin=0+"px"}};b.set.ThumbnailGridView.prototype.resize=function(c,d){this.normalizedPosition=this.scrollbarInst?this.scrollbarInst.getNormalizedPosition():0;var e=false;if(d!=null&&d!=""&&b.Util.isNumber(d)){this.totalHeight_=d;this.size.height=d;this.obj.setHeight(this.totalHeight_);e=true}if(c!=null&&c!=""&&b.Util.isNumber(c)){this.totalWidth_=c;this.size.width=c;this.obj.setWidth(this.totalWidth_);e=true}if(e){this.cleanUpcommon();this.layoutGrid()}};b.set.ThumbnailGridView.prototype.layoutSwatches=function(e){this.wid_=this.obj.clientWidth;if(e){this.scr=document.createElement("div");this.scr.id="ctnr_"+b.Util.createUniqueId();this.scr.style.position="absolute";this.scr.style.height=this.obj.clientHeight+"px";this.scr.style.width=this.obj.clientWidth+"px";this.obj.appendChild(this.scr);this.scrollbarInst=new b.ScrollBar(this.scr.id,this.settings,"scrollBar_"+b.Util.createUniqueId());this.scrollbarInst.thumb_.obj.style.visibility="hidden";var c=this;this.scrollbarInst.addEventListener(b.ScrollEvent.SCROLL_POSITION_EVENT,function(h){c.move(h.s7event.position)},false);this.wid_-=this.scrollbarInst.obj.offsetWidth}this.hei_=this.obj.clientHeight;var g=Math.floor((this.wid_-this.cellSpacing.horizontalSpacing)/(this.maxTmbWid_+this.cellSpacing.horizontalSpacing));var d=e?Math.ceil:Math.floor;var f=d((this.hei_-this.cellSpacing.verticalSpacing)/(this.maxTmbHei_+this.cellSpacing.verticalSpacing));if(g<=0){this.cleanUpcommon();return null}if(f<=0){this.cleanUpcommon();return null}this.fitCols_=g;this.fitRows_=f;while(g*f<this.swatches_.length){if(f==0||(f*g<this.swatches_.length)){f++}}if(f>this.fitRows_){this.fitRows_=Math.floor((this.hei_-this.cellSpacing.verticalSpacing)/(this.maxTmbHei_+this.cellSpacing.verticalSpacing))}if(this.fitCols_<=0||this.fitRows_<=0){b.Logger.log(b.Logger.WARNING,"s7sdk.set.ThumbnailGridView.layoutSwatches - Cannot fit any thumbnails into the given area: width %0 height %1",this.wid_,this.hei_);this.createScrollParentDiv(0,0)}if(g>this.swatches_.length){g=this.swatches_.length}return{cols:g,rows:f}};b.set.ThumbnailGridView.prototype.injectSwatches=function(f){var p=NaN;var d=NaN;var n=0;var q=0;var o;this.swatchGroup_=new b.ScrollableDiv(this,this.enableDragging.enabled,new b.Point2D(this.fitCols_*(this.cellSpacing.horizontalSpacing+this.maxTmbWid_)+2*this.cellSpacing.horizontalSpacing,this.hei_-this.cellSpacing.verticalSpacing),this.interval,this.pageHandler,this.enableDragging.overdragvalue);var g=new Array();for(var h=0;h<this.swatches_.length&&h<f.cols*f.rows;h++){o=this.swatches_[h];p=Math.floor(h/f.cols);d=h%f.cols;g[h]={col:d,row:p};n=(n<p)?p:n;q=(q<d)?d:q;o.x=this.cellSpacing.horizontalSpacing/2+(this.dir?(f.cols-1-d):d)*(this.maxTmbWid_+this.cellSpacing.horizontalSpacing);if(this.textPos==b.Thumb.TEXT_LEFT){o.x+=this.maxTmbWid_-o.getWidth()}o.y=this.cellSpacing.verticalSpacing/2+p*(this.maxTmbHei_+this.cellSpacing.verticalSpacing);if(this.textPos==b.Thumb.TEXT_TOP){o.y+=this.maxTmbHei_-o.getHeight()}this.swatchGroup_.div.appendChild(o.div);o.div.style.position="absolute";o.updatePosition();function e(i,r){b.Event.addDOMListener(r.div,"mouseup",function(s){i.onSwatchClicked(s,r)},true);b.Event.addDOMListener(r.div,"touchend",function(s){i.onSwatchClicked(s,r)},true)}e(this,o);g[h].rect=new b.Rectangle(o.x,o.y,this.maxTmbWid_,this.maxTmbHei_)}this.swatchesPositions=g;n++;q++;var l=0;var c=0;this.swatchGroup_.xNotch=2;this.swatchGroup_.xNotch=2;var m=this.cellSpacing.horizontalSpacing+q*(this.cellSpacing.horizontalSpacing+this.maxTmbWid_);var k=this.obj.clientHeight;this.swatchGroup_.setLogicalWidth((q+l)*(this.cellSpacing.horizontalSpacing+this.maxTmbWid_)+this.cellSpacing.horizontalSpacing);this.swatchGroup_.setLogicalHeight((n+c)*(this.cellSpacing.verticalSpacing+this.maxTmbHei_));this.swatchGroupRect_=new b.Rectangle(0,0,Math.max(Math.min(this.swatchGroup_.scrollBounds.x,m),0),Math.max(k,0));this.createScrollParentDiv(this.swatchGroupRect_.width,this.swatchGroupRect_.height);this.scrollParentDiv_.appendChild(this.swatchGroup_.div);switch(this.align){case"left":this.scrollParentDiv_.setX(0);break;case"right":this.scrollParentDiv_.setX(this.wid_-this.swatchGroupRect_.width);break;default:this.scrollParentDiv_.setX((this.wid_-this.swatchGroupRect_.width)/2);break}this.scrollParentDiv_.setY(0);this.swatchGroup_.layout();if(this.scrollbarInst){this.scrollbarInst.setMaxScroll(this.swatchGroup_.getLogicalHeight()-this.swatchGroupRect_.height+this.cellSpacing.verticalSpacing);this.scrollbarInst.setScrollStep(this.maxTmbHei_+2*this.cellSpacing.verticalSpacing);var j=this;setTimeout(function(){if(j.scrollbarInst){j.scrollbarInst.setNormalizedPosition(j.normalizedPosition?j.normalizedPosition:0)}},20)}if(this.scrollbarInst||(f.rows*(this.cellSpacing.verticalSpacing+this.maxTmbHei_)>this.hei_)){this.swatchGroup_.scrollY=true}this.swatchGroup_.positionEvents_=true};b.set.ThumbnailGridView.prototype.onSwatchClicked=function(d,c){if(this.swatchGroup_.getInterpretAsClick()){this.itemIndex_=c.item.frame;if(c!=this.currentSwatch_){this.dispatchEvent(new b.event.UserEvent(b.event.UserEvent.SWATCH,[c.item.frame,c.item.label?c.item.label:""],false))}this.applySwatchSelection(c,true,true)}};b.set.ThumbnailGridView.prototype.applySwatchSelection=function(k,c,d){c=(typeof c!="undefined")?c:false;d=(typeof d!="undefined")?d:false;if(k==this.currentSwatch_){return}if(this.currentSwatch_!=null){this.currentSwatch_.setSelected(false)}this.currentSwatch_=k;this.currentSwatch_.setSelected(true);if(c){var h=0;var f=0;var j=this.swatchGroup_.scrollBounds.x/2;var i=this.swatchGroup_.scrollBounds.y/2;if(k.x>j&&k.x<(this.swatchGroup_.getLogicalWidth()-j)){h=-k.x+j}else{if(k.x>=(this.swatchGroup_.getLogicalWidth()-j)){h=-this.swatchGroup_.getLogicalWidth()+this.swatchGroup_.scrollBounds.x}}if(k.y>i&&k.y<(this.swatchGroup_.getLogicalHeight()-i)){f=-k.y+i}else{if(k.y>=(this.swatchGroup_.getLogicalHeight()-i)){f=-this.swatchGroup_.getLogicalHeight()+this.swatchGroup_.scrollBounds.y}}var l=this;function g(){if(l.swatchGroup_){l.swatchGroup_.slideTo(new b.Point2D(h,f))}}setTimeout(g,100)}if(!this.orientationChanged){var m=this.splitFrames.orientation?this.mediaSet_.portrait.items[this.itemIndex_]:this.mediaSet_.landscape.items[this.itemIndex_];var e=new b.event.AssetEvent(b.event.AssetEvent.SWATCH_SELECTED_EVENT,m,k.item.frame,false);e.orientation=this.splitFrames.orientation;this.dispatchEvent(e)}this.orientationChanged=false};b.set.ThumbnailGridView.prototype.addEventListener=function(e,d,c){this.superproto.addEventListener.apply(this,[e,d,c])};b.set.ThumbnailGridView.prototype.selectSwatch=function(c,d){if(c==-1){if(this.currentSwatch_!=null){this.currentSwatch_.setSelected(false);this.currentSwatch_=null}}else{d=(typeof d!="undefined")?d:true;this.itemIndex_=c;if(this.swatches_[c]!=null&&this.swatchGroup_){this.applySwatchSelection(this.swatches_[c],d)}}};b.set.ThumbnailGridView.prototype.move=function(c){this.swatchGroup_.slideToImmediately(new b.Point2D(this.swatchGroup_.getX(),-c))};b.set.ThumbnailGridView.prototype.positionChanged=function(c){if(this.scrollbarInst){this.scrollbarInst.setPosition(-c.y)}};b.set.ThumbnailGridView.prototype.getWidth=function(){return this.totalWidth_};b.set.ThumbnailGridView.prototype.getHeight=function(){return this.totalHeight_};b.set.ThumbnailGridView.prototype.getDiv=function(){return this.obj};b.set.ThumbnailGridView.prototype.getFrame=function(){return this.itemIndex_};b.set.ThumbnailGridView.prototype.createElement=function(){b.UIComponent.prototype.createElement.apply(this,[]);this.obj=this.prepareDiv(this.obj);this.obj.setWidth(this.totalWidth_);this.obj.setHeight(this.totalHeight_);this.obj.className="s7thumbnailgridview";b.Event.addDOMListener(this.obj,"click",function(c){c=c||window.event;b.Event.preventDefault(c)},true)};b.set.ThumbnailGridView.prototype.createScrollParentDiv=function(d,c){if(this.scrollParentDiv_==null){this.scrollParentDiv_=this.prepareDiv();this.scrollParentDiv_.setWidth(d);this.scrollParentDiv_.setHeight(c);this.scrollParentDiv_.style.position="absolute";this.scrollParentDiv_.style.overflow="hidden"}};b.set.ThumbnailGridView.prototype.prepareDiv=function(c){var d=(c&&typeof c!="undefined")?c:document.createElement("div");d.getX=function(){return d.x_};d.getY=function(){return d.y_};d.setX=function(e){d.x_=e;d.style.left=e+"px"};d.setY=function(e){d.y_=e;d.style.top=e+"px"};d.getWidth=function(){return d.width_};d.getHeight=function(){return d.height_};d.setWidth=function(e){d.width_=e;d.style.width=e+"px"};d.setHeight=function(e){d.height_=e;d.style.height=e+"px"};return d};b.set.ThumbnailGridView.prototype.hide=function(){b.Util.fade(this.obj,true,0.3,"block")};b.set.ThumbnailGridView.prototype.show=function(){b.Util.fade(this.obj,false,0.3,"block")};b.set.ThumbnailGridView.prototype.setPortrait=function(){this.setSplitFrames(true)};b.set.ThumbnailGridView.prototype.setLandscape=function(){this.setSplitFrames(false)};b.set.ThumbnailGridView.prototype.setSplitFrames=function(e){if(this.splitFrames.orientation==e){return e}if(this.mediaSet_.portrait==null){this.splitFrames.orientation=false;return false}this.splitFrames.orientation=e;if(this.mediaSet_){this.orientationChanged=true;var c=this.getFrame();var d=e?this.mediaSet_.getPortraitIndex(c):this.mediaSet_.getLandscapeIndex(c);this.itemIndex_=typeof(d)=="undefined"?-1:d;this.cleanUp();this.build()}return e};b.set.ThumbnailGridView.prototype.getCurrentAsset=function(){return typeof this.currentAsset=="undefined"?null:this.currentAsset};b.set.ThumbnailGridView.prototype.setCurrentAsset=function(c){if(typeof(c)=="string"){this.setAsset(c)}else{this.setMediaSet(c)}};b.ThumbnailGridView=b.set.ThumbnailGridView;(function a(){var i=b.Util.css.createCssRuleText;var f=b.Util.css.createCssImgUrlText;var g=b.browser&&b.browser.name=="ie"&&b.browser.version.major<=8;var e=b.browser&&b.browser.name=="ie"&&b.browser.version.major>=10;var c=i(".s7thumbnailgridview",{"background-color":g?"rgb(224, 224, 224)":"rgba(100, 100, 100, 0.2)",position:"absolute","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-ms-touch-action":e?"none":"","touch-action":e?"none":"",width:"500px",height:"250px"})+i(".s7thumbnailgridview .s7thumbcell",{margin:"5px"})+i(".s7thumbnailgridview .s7thumb",{border:"1px solid transparent",width:"75px",height:"75px"})+i(".s7thumbnailgridview .s7thumb[state='selected']",{border:"1px solid #FFFFFF"})+i(".s7thumbnailgridview .s7label",{"font-family":"Helvetica, sans-serif","font-size":"12px"});var h={display:"block",width:"20px",height:"20px"};var d=i(".s7thumbnailgridview .s7scrollbar",{"background-color":g?"rgb(224, 224, 224)":"rgba(100, 100, 100, 0.2)",position:"absolute",top:"0px",bottom:"0px",right:"0px",width:"22px"})+i(".s7thumbnailgridview .s7scrollbar .s7scrollthumb",{width:"20px",position:"absolute",backgroundRepeat:"no-repeat",backgroundPosition:"center",height:"30px"})+i(".s7thumbnailgridview .s7scrollbar .s7scrollthumb[state='up']",{"background-image":f("scrollbar_thumb_up.png")})+i(".s7thumbnailgridview .s7scrollbar .s7scrollthumb[state='over']",{"background-image":f("scrollbar_thumb_over.png")})+i(".s7thumbnailgridview .s7scrollbar .s7scrollthumb[state='down']",{"background-image":f("scrollbar_thumb_down.png")})+i(".s7thumbnailgridview .s7scrollbar .s7scrollthumb[state='disabled']",{"background-image":f("scrollbar_thumb_disabled.png")})+i(".s7thumbnailgridview .s7scrollbar .s7scrolltrack",{width:"20px","background-color":"#cbcbcb"})+i(".s7thumbnailgridview .s7scrollbar .s7scrollupbutton",h)+i(".s7thumbnailgridview .s7scrollbar .s7scrollupbutton[state='up']",{"background-image":f("scroll_up_up.png")})+i(".s7thumbnailgridview .s7scrollbar .s7scrollupbutton[state='over']",{"background-image":f("scroll_up_over.png")})+i(".s7thumbnailgridview .s7scrollbar .s7scrollupbutton[state='down']",{"background-image":f("scroll_up_down.png")})+i(".s7thumbnailgridview .s7scrollbar .s7scrollupbutton[state='disabled']",{"background-image":f("scroll_up_disabled.png")})+i(".s7thumbnailgridview .s7scrollbar .s7scrolldownbutton",h)+i(".s7thumbnailgridview .s7scrollbar .s7scrolldownbutton[state='up']",{"background-image":f("scroll_down_up.png")})+i(".s7thumbnailgridview .s7scrollbar .s7scrolldownbutton[state='over']",{"background-image":f("scroll_down_over.png")})+i(".s7thumbnailgridview .s7scrollbar .s7scrolldownbutton[state='down']",{"background-image":f("scroll_down_down.png")})+i(".s7thumbnailgridview .s7scrollbar .s7scrolldownbutton[state='disabled']",{"background-image":f("scroll_down_disabled.png")});b.Util.css.addDefaultCSS(c+d,"ThumbnailGridView")})()}})(s7getCurrentNameSpace());