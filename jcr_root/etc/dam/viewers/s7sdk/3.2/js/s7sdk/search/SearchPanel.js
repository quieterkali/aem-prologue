/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.search");b.Util.require("s7sdk.event.Event");b.Util.require("s7sdk.set.Swatches");if(!b.search.SearchPanelControl){b.search.SearchPanelControl=function(c){arguments.callee.superclass.apply(this,[c,b.search.SearchPanelControl.NS,c.constructor,b.search.SearchPanel.RESTRICTED_STYLES])};b.search.SearchPanelControl.NS="s7sdk.search.SearchPanelControl";b.search.SearchPanelControl.prototype.rebuild=function(e){if(!this.component.allowResize){return}var d=this.component.searchResults;var c=this.component.globalMediaSet;var f=this.component.splitFrames;this.superproto.rebuild.apply(this,[e]);this.component.splitFrames=f;this.component.setMediaSet(c);this.component.setSearchResults(d)}}b.Class.inherits(b.search.SearchPanelControl.NS,"s7sdk.ControlComponent");if(!b.search.SearchPanel){b.search.SearchPanel=function SearchPanel(c,e,j){b.Logger.log(b.Logger.CONFIG,"s7sdk.search.SearchPanel constructor - container: %0, settings: %1 , compId: %2",c,e,j);var f=!!arguments[3];j=(typeof j=="string"&&j.length)?j:"SearchPanel_"+b.Util.createUniqueId();arguments.callee.superclass.apply(this,[j,c,"div","s7searchpanel",e,!f]);this.container=this.getParent();this.searchResults=null;this.globalMediaSet=null;this.mapInnerGlobalIdx=[];this.splitFrames={orientation:false};this.createElement();this.attachToContainer();this.searchResultsBack=document.createElement("div");this.searchResultsBack.className="s7backoverlay";this.obj.appendChild(this.searchResultsBack);this.searchResultsPanel=document.createElement("div");this.searchResultsPanel.className="s7searchresultspanel";this.obj.appendChild(this.searchResultsPanel);this.inputSearchTextConntr=document.createElement("div");this.inputSearchTextConntr.className="s7searchinputcontainer";this.searchResultsPanel.appendChild(this.inputSearchTextConntr);this.inputSearchText=document.createElement("input");this.inputSearchText.className="s7searchinput";this.inputSearchText.setAttribute("type","search");this.inputSearchText.setAttribute("placeholder",this.getLocalizedText("PLACEHOLDER"));this.inputSearchTextConntr.appendChild(this.inputSearchText);var h=this;function d(n){var l=n.which||n.keyCode;if(l=="13"){h.allowResize=true;h.inputSearchText.blur();var m=new b.event.SearchEvent(b.event.SearchEvent.SEARCH_SUBMITTED,h.inputSearchText.value,null,false);h.dispatchEvent(m);return false}else{}}b.Event.addDOMListener(this.inputSearchText,"keypress",d,true);b.Event.addDOMListener(this.inputSearchText,"click",function(l){h.allowResize=false;h.inputSearchText.focus()},true);this.searchInfo=document.createElement("div");this.searchInfo.className="s7searchinfo";this.searchInfo.innerHTML=this.getLocalizedText("INFO_PROMPT");this.searchInfo.setAttribute("state","prompt");this.searchResultsPanel.appendChild(this.searchInfo);this.innerSwatchesContr=document.createElement("div");this.innerSwatchesContr.className="s7innerswatchescontainer";this.innerSwatchesContr.id=j+"_swatchesContr";this.innerSwatchesContr.style.display="none";this.searchResultsPanel.appendChild(this.innerSwatchesContr);this.innerSwatches=new b.Swatches(this.innerSwatchesContr.id,this.settings,j+"_swatches",true);this.innerSwatches.serverUrl=this.serverUrl;this.innerSwatches.iscommand=this.iscommand;this.innerSwatches.maxloadradius=this.maxloadradius;this.innerSwatches.textPos=this.textPos;this.innerSwatches.align=this.align;this.innerSwatches.fmt=this.fmt;this.innerSwatches.tmbLayout={cols:1,rows:0};this.innerSwatches.orientation=1;this.innerSwatches.enableScrollButtons=false;this.innerSwatches.resizable=false;this.isTouch=b.browser.device.name!="desktop";this.innerScrollButtonContr=document.createElement("div");this.innerScrollButtonContr.className="s7innerscrollbuttoncontainer";this.innerScrollButtonContr.id=j+"_innerscrollbuttonContr";this.innerScrollButtonContr.style.display="none";this.innerSwatchesContr.appendChild(this.innerScrollButtonContr);this.upButton_=new b.ScrollUpButton(this.innerScrollButtonContr.id,this.settings,"upButton_"+b.Util.createUniqueId(),true);this.downButton_=new b.ScrollDownButton(this.innerScrollButtonContr.id,this.settings,"downButton_"+b.Util.createUniqueId(),true);this.innerSwatches.toggleUpButton=this.toggleUpButton.bind(this);this.innerSwatches.toggleDownButton=this.toggleDownButton.bind(this);var g=this;b.Event.addDOMListener(this.upButton_,"mouseup",function(l){g.buttonClick(l,g.upButton_)});b.Event.addDOMListener(this.upButton_,"touchend",function(l){g.buttonClick(l,g.upButton_)});b.Event.addDOMListener(this.downButton_,"mouseup",function(l){g.buttonClick(l,g.downButton_)});b.Event.addDOMListener(this.downButton_,"touchend",function(l){g.buttonClick(l,g.downButton_)});this.allowResize=true;var k=parseInt(b.Util.css.getCss("s7searchpanel","width",j,null,this.getParent()));var i=parseInt(b.Util.css.getCss("s7searchpanel","height",j,null,this.getParent()));this.resize(k,i);this.innerSwatches.addEventListener(b.event.AssetEvent.SWATCH_SELECTED_EVENT,function(q){var m=-1;var o=null;var n=q.s7event.frame;var l=g.mapInnerGlobalIdx[n];if(g.splitFrames.orientation){m=l;o=g.globalMediaSet.portrait.items[m]}else{m=l;o=g.globalMediaSet.landscape.items[m]}var p=new b.event.AssetEvent(b.AssetEvent.ITEM_SELECTED_EVENT,o,m);g.dispatchEvent(p)});if(!f){return new b.search.SearchPanelControl(this)}else{return this}};b.Class.inherits("s7sdk.search.SearchPanel","s7sdk.UIComponent");b.search.SearchPanel.prototype.symbols={PLACEHOLDER:"Search this catalog",INFO_PROMPT:"<p>What are you looking for?</p>",INFO_NO_RESULTS:"<p>No results found on this catalog for <b>'$SEARCH_TEXT$'</b>...</p>",INFO_RESULTS:"<p>Found <b>$HIT_COUNT$</b> result(s) in <b>$PAGE_COUNT$</b> page(s) for <b>'$SEARCH_TEXT$'</b>.</p>",THUMBNAIL_LABEL:"<b>$PAGE$ - $PAGE_HIT_COUNT$</b> result(s)"};b.search.SearchPanel.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},iscommand:{params:["value"],defaults:[""],parseParams:false},maxloadradius:{params:["value"],defaults:[1],ranges:["-1:"]},textPos:{params:["textpos"],defaults:["top"],ranges:[["bottom","top","left","right","tooltip","none"]]},align:{params:["horizontal","vertical"],defaults:["center","top"],ranges:[["left","center","right"],["top","center","bottom"]]},fmt:{params:["fmt"],defaults:["jpg"],ranges:[["jpg","jpeg","png","png-alpha","gif","gif-alpha"]]}};b.search.SearchPanel.RESTRICTED_STYLES={s7searchpanel:["width","height"],"s7searchpanel s7swatches s7thumb":["width","height"],"s7searchpanel s7swatches s7thumbcell":["margin-left","margin-right","margin-top","margin-bottom"],"s7searchpanel s7swatches s7label":["font-family","font-size","font-style"]};b.search.SearchPanel.prototype.setCSS=function(e,d,c){if(this.isRestrictedCSSProperty(b.search.SearchPanel.RESTRICTED_STYLES,d)){throw new Error("You cannot set "+e+" : "+d+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[e,d,c])}};b.search.SearchPanel.prototype.setModifier=function(c){throw new Error("Trying to use setModifier on the Core class (SearchPanel) is unsupported! Please refer to SDK documentation on using setModifier.")};b.search.SearchPanel.prototype.addEventListener=function(e,d,c){b.Logger.log(b.Logger.FINE,"s7sdk.search.SearchPanel.addEventListener - type: %0, handler: %1, useCapture: %2",e,d.toString().substring(0,d.toString().indexOf("(")),c);this.superproto.addEventListener.apply(this,[e,d,c])};b.search.SearchPanel.prototype.setMediaSet=function(d){b.Logger.log(b.Logger.FINE,"s7sdk.search.SearchPanel.setMediaSet - mediaSet: %0, type: %1",d);if(d!=null){var c=d;if(!(d instanceof b.OrientationSetDesc)){c=new b.OrientationSetDesc(c,null)}if(c.landscape==null||typeof(c.landscape.items[0])=="undefined"){return}this.globalMediaSet=c;this.searchResults=null;this.innerSwatches.cleanUp();this.resetSearch()}};b.search.SearchPanel.prototype.cleanUp=function(){this.globalMediaSet=null;this.searchResults=null;this.innerSwatches.cleanUp();b.Util.removeTags(this.obj);this.obj.style.cssText=""};b.search.SearchPanel.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};b.search.SearchPanel.prototype.setSearchResults=function(e){if(this.searchResults===e){return}if(e){this.innerScrollButtonContr.style.display="none";this.searchResults=e;this.searchInfo.setAttribute("state","results");if(e.getHitCount()>0){this.innerSwatchesContr.style.display="table-row";var d=this.createSearchResultsMediaSet();var c=this.innerSwatchesContr.offsetHeight;var f=this.innerSwatchesContr.offsetWidth;if(c<f){this.innerSwatches.tmbLayout={cols:0,rows:1};this.innerSwatches.orientation=0;this.innerSwatches.resize(f,c)}else{this.innerSwatches.tmbLayout={cols:1,rows:0};this.innerSwatches.orientation=1;this.innerSwatches.resize(f,c)}this.innerSwatches.setMediaSet(d.mediaSetDesc);if((d.mediaSetDesc.items.length>this.innerSwatches.fitRows_)&&(this.innerSwatches.orientation==1)){this.innerScrollButtonContr.style.display="block"}else{this.innerScrollButtonContr.style.display="none"}this.mapInnerGlobalIdx=d.mapInnerGlobalIdx;this.searchInfo.innerHTML=this.getLocalizedText("INFO_RESULTS").replace("$HIT_COUNT$",e.getHitCount()).replace("$SEARCH_TEXT$",e.searchText).replace("$PAGE_COUNT$",d.mapInnerGlobalIdx.length)}else{this.searchInfo.setAttribute("state","no_results");this.searchInfo.innerHTML=this.getLocalizedText("INFO_NO_RESULTS").replace("$SEARCH_TEXT$",e.searchText);this.innerSwatchesContr.style.display="none"}}else{this.searchInfo.setAttribute("state","prompt");this.searchInfo.innerHTML=this.getLocalizedText("INFO_PROMPT");this.innerSwatchesContr.style.display="none"}};b.search.SearchPanel.prototype.getSearchResults=function(){return this.searchResults};b.search.SearchPanel.prototype.createSearchResultsMediaSet=function(d){var e={mapInnerGlobalIdx:[],mediaSetDesc:new b.MediaSetDesc()};if(!this.splitFrames.orientation){var o=this.globalMediaSet.landscape.items;var g=this.globalMediaSet.landscape.type!==b.ItemDescType.ECAT_SET;this.indexTextLandscape=[];var f=1;for(var n=0;n<o.length;n++){var s=o[n];this.indexTextLandscape[n]=f.toString();if(!(s.np||g)){f++;this.indexTextLandscape[n]+="-"+f}f++}for(var m=0;m<this.searchResults.frameList.length;m++){var c=0;var l=this.globalMediaSet.landscape.items[this.searchResults.frameList[m].idx];for(var h=0;h<this.searchResults.frameList[m].pageList.length;h++){c+=this.searchResults.frameList[m].pageList[h].objList.length}var q=this.searchResults.frameList[m].idx;var p=new b.ImageDesc(l.parent,l.type,l.name,l.swatch,l.width,l.height,l.version,l.isDefault,l.mod,l.pmod,l.label,null,null,null,(l.maps&&l.maps.length)?true:false,false,true);var r=this.indexTextLandscape[q];p.label=this.getLocalizedText("THUMBNAIL_LABEL").replace("$PAGE$",r).replace("$PAGE_HIT_COUNT$",c);e.mediaSetDesc.items.push(p);e.mapInnerGlobalIdx.push(this.searchResults.frameList[m].idx)}}else{for(var m=0;m<this.searchResults.frameList.length;m++){for(var h=0;h<this.searchResults.frameList[m].pageList.length;h++){var c=0;var q=this.globalMediaSet.getPortraitIndex(this.searchResults.frameList[m].idx);var l=this.globalMediaSet.portrait.items[q+this.searchResults.frameList[m].pageList[h].idx];c=this.searchResults.frameList[m].pageList[h].objList.length;var p=new b.ImageDesc(l.parent,l.type,l.name,l.swatch,l.width,l.height,l.version,l.isDefault,l.mod,l.pmod,l.label,null,null,null,(l.maps&&l.maps.length)?true:false,false,true);p.label=this.getLocalizedText("THUMBNAIL_LABEL").replace("$PAGE$",(q+1+this.searchResults.frameList[m].pageList[h].idx)).replace("$PAGE_HIT_COUNT$",c);e.mediaSetDesc.items.push(p);e.mapInnerGlobalIdx.push(q+this.searchResults.frameList[m].pageList[h].idx)}}}return e};b.search.SearchPanel.prototype.getWidth=function(){return this.w};b.search.SearchPanel.prototype.getHeight=function(){return this.h};b.search.SearchPanel.prototype.resize=function(c,e){b.Logger.log(b.Logger.FINE,"s7sdk.search.SearchPanel.resize - width: %0, height: %1",c,e);this.w=c;this.h=e;this.obj.style.width=c+"px";this.obj.style.height=e+"px";var d=this.innerSwatchesContr.offsetHeight;var f=this.innerSwatchesContr.offsetWidth;if(d<f){this.innerSwatches.tmbLayout={cols:0,rows:1};this.innerSwatches.orientation=0;this.innerSwatches.resize(f,d)}else{this.innerSwatches.tmbLayout={cols:1,rows:0};this.innerSwatches.orientation=1;this.innerSwatches.resize(f,d)}this.checkButtons();b.UIComponent.prototype.resize.apply(this,[c,e])};b.search.SearchPanel.prototype.checkButtons=function(){if((!this.upButton_.getActivated()&&!this.downButton_.getActivated())||this.innerSwatches.orientation==0){this.innerScrollButtonContr.style.display="none"}else{this.innerScrollButtonContr.style.display="block"}};b.search.SearchPanel.prototype.getFrame=function(){b.Logger.log(b.Logger.FINE,"s7sdk.search.SearchPanel.getFrame");return this.innerSwatches.getFrame()};b.search.SearchPanel.prototype.selectSwatch=function(c,d){b.Logger.log(b.Logger.FINE,"s7sdk.search.SearchPanel.selectSwatch - index: %0, triggerScroll: %1",c,d);this.innerSwatches.selectSwatch(c,d)};b.search.SearchPanel.prototype.hide=function(){b.Util.fade(this.obj,true,0.3,"block")};b.search.SearchPanel.prototype.show=function(){b.Util.fade(this.obj,false,0.3,"block")};b.search.SearchPanel.prototype.resetSearch=function(){this.inputSearchText.value="";this.inputSearchText.setAttribute("type","search");this.inputSearchText.setAttribute("placeholder",this.getLocalizedText("PLACEHOLDER"));this.searchInfo.innerHTML=this.getLocalizedText("INFO_PROMPT");this.innerSwatchesContr.style.display="none";this.searchInfo.innerHTML=this.getLocalizedText("INFO_PROMPT");this.searchInfo.setAttribute("state","prompt");this.innerSwatches.toggleUpButton=this.toggleUpButton.bind(this);this.innerSwatches.toggleDownButton=this.toggleDownButton.bind(this)};b.search.SearchPanel.prototype.disable=function(c){this.inputSearchText.disabled=c;if(c){this.inputSearchText.blur()}};b.search.SearchPanel.prototype.setPortrait=function(){this.setSplitFrames(true)};b.search.SearchPanel.prototype.setLandscape=function(){this.setSplitFrames(false)};b.search.SearchPanel.prototype.setSplitFrames=function(d){if(this.splitFrames.orientation==d){return d}if(!this.globalMediaSet||this.globalMediaSet.portrait==null){this.splitFrames.orientation=false;return false}this.splitFrames.orientation=d;if(this.globalMediaSet&&this.searchResults&&this.searchResults.getHitCount()!=0){var c=this.createSearchResultsMediaSet();this.innerSwatches.setMediaSet(c.mediaSetDesc);this.mapInnerGlobalIdx=c.mapInnerGlobalIdx}return d};b.search.SearchPanel.prototype.buttonClick=function(d,c){if(c===this.upButton_){this.innerSwatches.buttonClick_("up",c)}if(c===this.downButton_){this.innerSwatches.buttonClick_("down",c)}};b.search.SearchPanel.prototype.toggleUpButton=function(c){if(this.upButton_){c?this.upButton_.activate():this.upButton_.deactivate()}};b.search.SearchPanel.prototype.toggleDownButton=function(c){if(this.downButton_){c?this.downButton_.activate():this.downButton_.deactivate()}};(function a(){var f=b.Util.css.createCssRuleText;var e=b.Util.css.createCssImgUrlText;var d=b.browser&&b.browser.name=="ie"&&b.browser.version.major>=10;var c=f(".s7searchpanel",{position:"absolute","-ms-touch-action":d?"none":"","touch-action":d?"none":"",width:"100%",height:"100%"})+f(".s7searchpanel .s7backoverlay",{position:"absolute",width:"100%",height:"100%","background-color":"#000000",opacity:"0.3"})+f(".s7searchpanel .s7searchresultspanel",{position:"absolute","box-sizing":"border-box",display:"table","background-color":"#DDDDDD",overflow:"hidden",width:"250px",height:"100%"})+f(".s7searchpanel .s7searchinputcontainer",{"padding-left":"10px","padding-right":"10px","box-sizing":"border-box"})+f(".s7searchpanel .s7searchinput",{"padding-left":"20px","background-repeat":"no-repeat","background-image":e("search_form_field.png"),"box-sizing":"border-box",border:"1px solid #696969","margin-top":"10px","margin-bottom":"10px",width:"100%","font-family":"Helvetica, sans-serif","font-size":"12px"})+f(".s7searchpanel .s7searchinput::-ms-clear",{display:"none"})+f(".s7searchpanel .s7searchinput::-ms-reveal",{display:"none"})+f(".s7searchpanel .s7searchinput::-webkit-search-cancel-button",{display:"none"})+f(".s7searchpanel .s7searchinput::-webkit-search-decoration,.s7searchpanel .s7searchinput::-webkit-search-results-button,.s7searchpanel .s7searchinput::-webkit-search-results-decoration",{display:"none"})+f(".s7searchpanel .s7searchinfo",{"text-align":"center","box-sizing":"border-box","padding-bottom":"10px",width:"100%",height:"100%"})+f(".s7searchpanel .s7searchinfo[state='prompt'],.s7searchinfo[state='no_results']",{"font-family":"Helvetica, sans-serif","font-size":"18px",color:"#696969",display:"table-row","text-align":"center"})+f(".s7searchpanel .s7searchinfo[state='prompt'] p,.s7searchinfo[state='no_results'] p",{display:"table-cell","vertical-align":"middle","text-align":"center"})+f(".s7searchpanel .s7searchinfo[state='results']",{"padding-left":"10px","padding-right":"10px","font-family":"Helvetica, sans-serif","font-size":"14px",color:"#000000"})+f(".s7searchpanel .s7innerswatchescontainer",{width:"100%",height:"100%",display:"table-row","padding-top":"10px","padding-bottom":"10px","font-size":"22px","background-color":"#FFFFFF","text-align":"center",overflow:"hidden"})+f(".s7searchpanel .s7swatches",{margin:"0 auto","background-color":"#FFFFFF","border-top":"1px solid #696969",width:"100%",height:"100%"})+f(".s7searchpanel .s7swatches .s7thumbcell",{margin:"5px"})+f(".s7searchpanel .s7swatches .s7thumb",{border:"1px solid #d3d3d3",width:"215px",height:"129px"})+f(".s7searchpanel .s7swatches .s7thumb[state='selected']",{border:"1px solid #696969"})+f(".s7searchpanel .s7swatches .s7label",{"text-align":"left",color:"#4c4c4c","font-family":"Helvetica, sans-serif","font-size":"12px"})+f(".s7searchpanel .s7innerscrollbuttoncontainer",{position:"absolute","background-color":"#FFFFFF",width:"100%",bottom:"0px",left:"0px"})+f(".s7searchpanel .s7scrollupbutton",{position:"absolute",width:"125px",height:"35px",bottom:"0px",left:"0px"})+f(".s7searchpanel .s7scrollupbutton[state='up']",{"background-image":e("searchpanel_scroll_up_up.png")})+f(".s7searchpanel .s7scrollupbutton[state='over']",{"background-image":e("searchpanel_scroll_up_over.png")})+f(".s7searchpanel .s7scrollupbutton[state='down']",{"background-image":e("searchpanel_scroll_up_down.png")})+f(".s7searchpanel .s7scrollupbutton[state='disabled']",{"background-image":e("searchpanel_scroll_up_disabled.png")})+f(".s7searchpanel .s7scrolldownbutton",{position:"absolute",width:"125px",height:"35px",bottom:"0px",right:"0px"})+f(".s7searchpanel .s7scrolldownbutton[state='up']",{"background-image":e("searchpanel_scroll_down_up.png")})+f(".s7searchpanel .s7scrolldownbutton[state='over']",{"background-image":e("searchpanel_scroll_down_over.png")})+f(".s7searchpanel .s7scrolldownbutton[state='down']",{"background-image":e("searchpanel_scroll_down_down.png")})+f(".s7searchpanel .s7scrolldownbutton[state='disabled']",{"background-image":e("searchpanel_scroll_down_disabled.png")});b.Util.css.addDefaultCSS(c,"SearchPanel")})()}})(s7getCurrentNameSpace());