/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(s7sdk){s7sdk.pkg("s7sdk.set");if(s7sdk.browser.name==="ie"&&(s7sdk.browser.version.major<9)){s7sdk.Util.require("s7sdk.image.rgn.View")}else{s7sdk.Util.require("s7sdk.image.View")}s7sdk.Util.require("s7sdk.event.InputController2");s7sdk.Util.require("s7sdk.common.Enumeration");s7sdk.Util.require("s7sdk.common.IS");s7sdk.Util.require("s7sdk.event.Event");s7sdk.Util.require("s7sdk.common.ItemDesc");s7sdk.Util.require("s7sdk.set.SlideAnimation");if(!s7sdk.set.CarouselViewControl){s7sdk.set.CarouselViewControl=function(component){arguments.callee.superclass.apply(this,[component,s7sdk.set.CarouselViewControl.NS,component.constructor,s7sdk.set.CarouselView.RESTRICTED_STYLES])};s7sdk.set.CarouselViewControl.NS="s7sdk.set.CarouselViewControl";s7sdk.set.CarouselViewControl.prototype.rebuild=function(mods){var idx=this.component.getCurrentFrameIndex();this.superproto.rebuild.apply(this,[mods]);this.component.setCurrentFrameIndex(idx)}}s7sdk.Class.inherits(s7sdk.set.CarouselViewControl.NS,"s7sdk.ControlComponent");if(!s7sdk.set.CarouselView){s7sdk.set.CarouselView=function CarouselView(container,settings,compId){var useCore=!!arguments[3];s7sdk.Logger.log(s7sdk.Logger.CONFIG,"s7sdk.set.CarouselView constructor - container: %0, settings: %1 , compId: %2",container,settings,compId);compId=(typeof compId=="string"&&compId.length)?compId:"CarouselView_"+s7sdk.Util.createUniqueId();arguments.callee.superclass.apply(this,[compId,container,"div","s7carouselview",settings,useCore]);this.container=this.getParent();this.assetIsChanged=false;if(this.serverUrl.lastIndexOf("/")!=(this.serverUrl.length-1)){this.serverUrl+="/"}this.wid=0;this.hei=0;this.startupFrame=0;if(this.wid==0||this.hei==0){this.wid=parseInt(s7sdk.Util.css.getCss("s7carouselview","width",compId,null,this.container));this.hei=parseInt(s7sdk.Util.css.getCss("s7carouselview","height",compId,null,this.container));if(!s7sdk.Util.isNumber(this.wid)||!s7sdk.Util.isNumber(this.hei)||this.wid<=0||this.hei<=0){if("clientHeight" in this.container&&"clientWidth" in this.container){this.wid=this.container.clientWidth;this.hei=this.container.clientHeight}if(this.wid==0||this.hei==0){this.wid=400;this.hei=400}}}if(this.iscommand==""){this.iscommand=this.modifier}this.direction="auto";this.locale=this.getParam("locale","");this.dir=this.direction=="auto"?this.locale=="ja":this.direction!="left";this.bgColor=s7sdk.Util.css.getCss("s7carouselview","background-color",this.id,null,this.container);this.bgColor=s7sdk.Util.convertColor(this.bgColor,"flash");if(this.enableHD.enable.toLowerCase()=="always"){this.enableHD.maxHdPixels=-1}else{if(this.enableHD.enable.toLowerCase()=="never"){this.enableHD.maxHdPixels=0}else{if(this.enableHD.enable.toLowerCase()=="limit"){if(NaN==this.enableHD.maxHdPixels){this.enableHD.maxHdPixels=2250000}else{this.enableHD.maxHdPixels=this.enableHD.maxHdPixels*this.enableHD.maxHdPixels}}else{this.enableHD.maxHdPixels=2250000}}}this.devicePixelRatio=s7sdk.Util.adjustDevicePixelRatio(this.enableHD.maxHdPixels,this.hei,this.wid);this.viewProps=new Object();this.viewProps.fmt=this.fmt;this.viewProps.outHeight=this.hei*this.devicePixelRatio;this.viewProps.outWidth=this.wid*this.devicePixelRatio;this.viewProps.resetHeight=this.hei*this.devicePixelRatio;this.viewProps.resetWidth=this.wid*this.devicePixelRatio;this.viewProps.transitionTime=null;this.viewProps.transitionEasing=null;this.viewProps.bgColor=this.bgColor;this.viewProps.zoomStep=1;this.viewProps.limit=1;this.spacing=this.frametransition.transition=="slide"?this.frametransition.spacing*this.wid:0;this.totalWidth_=this.wid+this.spacing;this.totalHeight_=this.hei;this.pageFrames=null;this.createElement();if(this.container.tagName=="DIV"&&(!this.container.style.position||this.container.style.position=="static")){this.container.style.position="relative"}this.uid=s7sdk.Util.createUniqueId();this.container3=this.prepareDiv();this.container3.id="container3_"+this.uid;this.container3.setWidth(this.totalWidth_*3);this.container3.setHeight(this.totalHeight_);this.container3.style.zIndex=0;this.container3.style.position="absolute";this.container3.style.left=-this.totalWidth_+"px";this.container3.style.top=0+"px";this.obj.appendChild(this.container3);this.dLeft=new s7sdk.set.CViewWrapper(this,this.wid,this.hei,this.wid,this.hei,0,this.spacing,900,this.devicePixelRatio);this.dCenter=new s7sdk.set.CViewWrapper(this,this.wid,this.hei,this.wid,this.hei,1,this.spacing,910,this.devicePixelRatio);this.dRight=new s7sdk.set.CViewWrapper(this,this.wid,this.hei,this.wid,this.hei,2,this.spacing,920,this.devicePixelRatio);this.dLeft.obj.id="left"+this.uid;this.dCenter.obj.id="center"+this.uid;this.dRight.obj.id="right"+this.uid;this.container3.appendChild(this.dLeft.obj);this.container3.appendChild(this.dCenter.obj);this.container3.appendChild(this.dRight.obj);this.maxload=parseInt(this.maxloadradius);this.maxload=this.maxload==0?1:this.maxload;this.startupFrameMaxload=this.maxload;switch(this.frametransition.transition){case"fade":this.setOpacity(this.dLeft.obj,0);this.dLeft.obj.style.left=this.totalWidth_+"px";this.setOpacity(this.dRight.obj,0);this.dRight.obj.style.left=this.totalWidth_+"px";break;case"slide":break;case"default":}this.attachToContainer();this.changeToNext=null;this.loader=new s7sdk.set.CPageFrameLoader(this);this.mediaSet_=null;this.isReq_=null;this.frame_=0;this.added=false;this.prevFrameIdx_=-1;this.currentFrame=null;this.isNewLayout=true;this.setAsset(this.asset);this.isFirst=true;this.createPageFramesTimeoutId=null;this.autoPlayTimer=null;this.autoPlayCounter=0;this.autoPlayPaused=false;if(!useCore){return new s7sdk.set.CarouselViewControl(this)}else{return this}};s7sdk.Class.inherits("s7sdk.set.CarouselView","s7sdk.UIComponent");s7sdk.set.CarouselView.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},asset:{params:["asset"],defaults:[""],parseParams:false},aemmode:{params:["value"],defaults:[false],ranges:[[true,false]]},direction:{params:["direction"],defaults:["auto"],ranges:[["auto","left","right"]]},maxloadradius:{params:["value"],defaults:[1],ranges:["-1:"]},iscommand:{params:["value"],defaults:[""],parseParams:false},enableHD:{params:["enable","maxHdPixels"],defaults:["limit",1500],ranges:[["always","never","limit"],"0:"]},frametransition:{params:["transition","duration","spacing"],ranges:[["none","fade","slide"],"0:","0:1"],defaults:["none",0.3,0]},autoPlay:{params:["enable","duration","direction"],defaults:[false,2,1],ranges:["0:1","0:","0:1"]},modifier:{params:["modifier"],defaults:[""],deprecated:true},fmt:{params:["fmt"],defaults:["jpg"],ranges:[["jpg","jpeg","png","png-alpha","gif","gif-alpha"]]}};s7sdk.set.CarouselView.RESTRICTED_STYLES={s7carouselview:["width","height"]};s7sdk.set.CarouselView.prototype.getCurrentView=function(){return this.currentFrame&&this.currentFrame.view};s7sdk.set.CarouselView.prototype.loadAsset=function(){s7sdk.Logger.log(s7sdk.Logger.INFO,"s7sdk.set.CarouselView.loadAsset");var tReq=s7sdk.MediaSetParser.parseAssetForSetReq(this.assetName_);this.imageModifier=tReq.mod;var req=this.serverUrl+"/"+tReq.req;if(s7sdk.Util.isNonEmptyString(this.locale_)){req+="&locale="+this.locale_}if(this.isReq){this.isReq.cancelHttpReq()}this.isReq_=new s7sdk.IS(this.serverUrl,this.assetName_);this.isReq_.getHttpReq(req,function(rsp,viewObj){s7sdk.set.CarouselView.prototype.setRequestComplete.apply(viewObj,[rsp])},function(rsp,viewObj){s7sdk.set.CarouselView.prototype.setRequestError.apply(viewObj,[rsp])},this)};s7sdk.set.CarouselView.prototype.setRequestError=function(rsp){s7sdk.Logger.log(s7sdk.Logger.WARNING,"s7sdk.set.CarouselView.setRequestError %0",rsp)};s7sdk.set.CarouselView.prototype.setRequestComplete=function(rsp){var jsonSet=rsp.set;if(jsonSet==null){return}var mediaSet=s7sdk.MediaSetParser.parse(jsonSet,this.imageModifier,this.aemmode,this.dir);this.setMediaSetInternal(mediaSet)};s7sdk.set.CarouselView.prototype.createPageFrames=function(){function appendUrlArgument(url,argname,value){url+=((url.indexOf("?")==-1)?"?":"&")+argname;url+=(typeof value=="undefined")?"":"="+value;return url}var image;var i=0;this.pageFrames=[];for(var idx=0;idx<this.items.length;idx++){var item=this.items[idx];if(typeof(item)=="undefined"){s7sdk.Logger.log(s7sdk.Logger.WARNING,"s7sdk.set.CarouselView - Malformed data in MediaSetDesc %0",this.mediaSet_.landscape.name);continue}image=item.name||"";image=image.trim();if(this.iscommand!=null&&this.iscommand.length>0){image=appendUrlArgument(image,"layer","comp");image=appendUrlArgument(image,this.iscommand)}if(s7sdk.Util.isNonEmptyString(this.locale)){image=appendUrlArgument(image,"locale",this.locale)}if(s7sdk.Util.isNonEmptyString(item.version)){image=appendUrlArgument(image,"id",item.version)}var frixx=this.dir?(this.items.length-1-i):i;this.pageFrames[frixx]=new s7sdk.set.CPageFrame(this,this.serverUrl,image,frixx,this.viewProps,item.width,item.height,0,item.label);i++}this.settings.trackLoad(this);this.isstartFrame=true;this.startupFrame=this.startupFrame>=this.pageFrames.length?0:(this.startupFrame<=0?0:this.startupFrame);this.startupFrameMaxload=this.maxload;this.loadFrames(this.startupFrame,true);this.assetIsChanged=true;this.isNewLayout=true};s7sdk.set.CarouselView.prototype.notifyAssetChanded=function(){if(!this.assetIsChanged){return}this.assetIsChanged=false;var inst=this;setTimeout(function(){var ev=new s7sdk.event.AssetEvent(s7sdk.event.AssetEvent.ASSET_CHANGED,inst.mediaSet_,inst.currentFrame?inst.currentFrame.idx:0,true);s7sdk.Event.dispatch(inst.obj,ev,false)},0)};s7sdk.set.CarouselView.prototype.loadFrames=function(frm,transition){this.frame_=frm;if(this.inprogress){return}var cIdx=this.getFrameIdx(this.frame_);this.nextFrame=this.getFrameByIdx(cIdx);this.nextFrame.transition=transition;this.inprogress=this.loader.load([this.getFrameByIdx((cIdx-1)<0?this.pageFrames.length-1:(cIdx-1)),this.nextFrame,this.getFrameByIdx(((cIdx+1)>this.pageFrames.length)?0:cIdx+1)],cIdx)};s7sdk.set.CarouselView.prototype.getFrameByIdx=function(idx){return this.pageFrames[this.getFrameIdx(idx)]};s7sdk.set.CarouselView.prototype.getFrameIdx=function(idx){if(idx<0){idx=this.pageFrames.length+idx%this.pageFrames.length}return idx%this.pageFrames.length};s7sdk.set.CarouselView.prototype.invalidate=function(){if(this.currentFrame!=null&&this.frameInvalidated==false){this.currentFrame.setTileRender(true);this.currentFrame.setDelayTileLoad(false);this.currentFrame.invalidate();this.frameInvalidated=true}};s7sdk.set.CarouselView.prototype.onResetImageLoaded=function(opResult,idx){if(this.loader.toLoad!=0){return}if(!opResult){this.inprogress=false;return}if(typeof(this.currentFrame)!="undefined"&&this.currentFrame!=null){if(this.pageFrames.length<2){return}this.dCenter.obj.style.display="block";this.setOpacity(this.dCenter.obj,1);switch(this.frametransition.transition){case"fade":if(typeof(this.animate)=="undefined"){this.animate=new s7sdk.set.SlideAnimation(this,this.frametransition.duration)}this.attachView(this.dLeft,this.nextFrame);this.animate.startTransition(true,0,false);break;case"slide":if(typeof(this.animate)=="undefined"){this.animate=new s7sdk.set.SlideAnimation(this,this.frametransition.duration)}if(!this.changeToNext){this.attachView(this.dLeft,this.nextFrame)}else{this.attachView(this.dRight,this.nextFrame)}this.animate.startTransition(!this.changeToNext,0,false);this.nextFrame.transition=false;break;default:this.attachView(this.dLeft,this.nextFrame);this.replaceFrame(true)}}else{if(this.autoPlay.enable){this.autoPlayOnOff(true)}this.currentFrame=this.nextFrame;this.notifyAssetChanded();switch(this.frametransition.transition){case"fade":this.attachView(this.dLeft,this.currentFrame);this.replaceFrame(true);break;case"slide":this.attachView(this.dCenter,this.currentFrame);this.prevFrameIdx_=this.currentFrame.idx;this.replaceFrame(true);break;default:this.prevFrameIdx_=this.currentFrame.idx;this.attachView(this.dCenter,this.currentFrame);this.replaceFrame(true)}}};s7sdk.set.CarouselView.prototype.dispatchTransitionEvent=function(evType){if(this.isFirst){if(evType==s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_END){this.isFirst=false}return}var frmev=this.dir?this.items.length-1-this.currentFrame.idx:this.currentFrame.idx;var itemDesc=this.items[this.currentFrame.idx];var ev=new s7sdk.event.FrameEvent(evType,itemDesc.name,frmev,false);s7sdk.Event.dispatch(this.obj,ev,false)};s7sdk.set.CarouselView.prototype.attachView=function(cnv,dst){if(dst&&dst.view&&cnv){dst.view.detach();dst.view.attach(cnv)}};s7sdk.set.CarouselView.prototype.setOpacity=function(obj,value){if(s7sdk.browser.name=="ie"){if((s7sdk.browser.version.minor>5.5)&&(s7sdk.browser.version.minor<=8)&&(document.body.filters)){if(obj.id=="left"||obj.id=="center"){obj.style.filter="alpha(opacity ="+(value*100)+")";return}}else{obj.style.opacity=value}}else{obj.style.opacity=value}};s7sdk.set.CarouselView.prototype.animationFinalStep=function(){if(this.animate.reverse||this.frametransition.transition!="slide"){return}if(this.animate.direction){this.container3.style.left=0+"px"}else{this.container3.style.left=-2*this.totalWidth_+"px"}};s7sdk.set.CarouselView.prototype.animationStop=function(){this.isstartFrame=false;if(this.isDragComplete){this.isDragComplete=false;if(this.autoPlay.enable){this.autoPlayOnOff(true)}}if(this.frametransition.transition=="slide"||this.frametransition.transition=="fade"){if(this.animate.reverse){this.animate.reverse=false;this.animate.custom=false;if(this.frametransition.transition=="slide"){this.container3.style.left=-this.totalWidth_+"px"}else{this.setOpacity(this.dLeft.obj,0);this.setOpacity(this.dCenter.obj,1);this.setOpacity(this.dRight.obj,0)}this.moved=false;this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_END);return}if(!this.animate.custom){if(this.frametransition.transition=="slide"){this.container3.style.left=-this.totalWidth_+"px"}this.replaceFrame(true)}else{this.animate.custom=false;this.replaceFrame(false)}}else{if(!this.animate.custom){this.replaceFrame(true)}else{this.animate.custom=false;this.replaceFrame(false)}}this.animate.reverse=false};s7sdk.set.CarouselView.prototype.containerMove=function(pos){this.container3.style.left=pos+"px";if(pos!=-this.totalWidth_&&!this.moved){this.moved=true;this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_START)}};s7sdk.set.CarouselView.prototype.replaceFrame=function(checkForDelayed){this.inprogress=false;if(this.pageFrames.length>1){if(this.currentFrame!=null&&this.currentFrame.view!=null){this.currentFrame.view.writeOverlay(null);this.currentFrame.unload(1);if(this.currentFrame.view.getDisplayElement()!=null){this.currentFrame.view.getDisplayElement().s7carouselview=null;this.currentFrame.view.detach()}}}this.currentFrame=this.nextFrame;this.notifyAssetChanded();this.frameInvalidated=false;this.attachView(this.dCenter,this.currentFrame);if(!this.currentFrame.view){return}this.currentFrame.view.invalidated=true;this.currentFrame.view.isClearted=false;if(this.frametransition.transition=="slide"){this.container3.style.left=-this.totalWidth_+"px"}var inst=this;var delay=0;if(s7sdk.browser.device.name=="android"&&s7sdk.browser.device.version=="4"){delay=60}this.replaseFrameTimeOut=setTimeout(function(){inst.replaceFrameDelayed(checkForDelayed)},delay);this.currentFrame.view.draw()};s7sdk.set.CarouselView.prototype.replaceFrameDelayed=function(checkForDelayed){this.inprogress=false;if(this.pageFrames.length>1){var fr=this.getFrameByIdx(this.currentFrame.idx+1);var pos;if(fr.view){this.attachView(this.dRight,fr);fr.view.invalidated=true;fr.view.isClearted=false;if(this.frametransition.transition!="fade"){}else{this.setOpacity(this.dRight.obj,0)}fr.view.draw()}fr=this.getFrameByIdx(this.currentFrame.idx-1);if(fr.view){this.attachView(this.dLeft,fr);if(this.frametransition.transition!="fade"){}else{this.setOpacity(this.dLeft.obj,0)}fr.view.isClearted=false;fr.view.invalidated=true;fr.view.draw()}}this.setOpacity(this.dCenter.obj,1);this.dCenter.obj.style.display="block";this.frame=this.currentFrame.idx;this.invalidate();if(this.prevFrameIdx_!=this.currentFrame.idx||this.currentFrame.idx==0||this.isNewLayout){var frmev=this.dir?this.items.length-1-this.currentFrame.idx:this.currentFrame.idx;this.viewStateChange(this.getCapabilityState());var itemDesc=this.items[this.currentFrame.idx];var assetEvent=new s7sdk.event.AssetEvent(s7sdk.event.AssetEvent.ITEM_SELECTED_EVENT,itemDesc,frmev,true);this.dispatchEvent(assetEvent);this.isAssetChanged=false;this.dispatchEvent(new s7sdk.event.UserEvent(s7sdk.event.UserEvent.BANNER,[itemDesc.name,frmev,typeof(itemDesc.label)!="undefined"?itemDesc.label:""]));this.isNewLayout=false;this.prevFrameIdx_=this.currentFrame.idx}if(checkForDelayed){var inst=this;if(this.frame_!=this.currentFrame.idx){setTimeout(function(){inst.loadFrames(inst.frame_,true)},0)}}else{this.frame_=this.currentFrame.idx}this.moved=false;switch(this.frametransition.transition){case"fade":this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_END);break;case"slide":this.dispatchTransitionEvent(s7sdk.event.FrameEvent.NOTF_FRAME_TRANSITION_END);break;default:}};s7sdk.set.CarouselView.prototype.animationStep=function(step,slideDirection,reverse){if(this.frametransition.transition=="slide"){this.containerMove(this.totalWidth_*((reverse?(slideDirection?-1:1):0)-(1+(slideDirection?-1:1)*step)))}else{if(reverse){if(slideDirection){this.setOpacity(this.dLeft.obj,1-step);this.setOpacity(this.dCenter.obj,step);this.setOpacity(this.dRight.obj,0)}else{this.setOpacity(this.dLeft.obj,0);this.setOpacity(this.dCenter.obj,step);this.setOpacity(this.dRight.obj,1-step)}}else{if(slideDirection){this.setOpacity(this.dLeft.obj,step);this.setOpacity(this.dCenter.obj,1-step);this.setOpacity(this.dRight.obj,0)}else{this.setOpacity(this.dLeft.obj,0);this.setOpacity(this.dCenter.obj,1-step);this.setOpacity(this.dRight.obj,step)}}if(s7sdk.browser.device.name=="android"&&s7sdk.browser.device.version=="4"){this.container3.style.display="none";var abc=this.container3.offsetWidth;this.container3.style.display="block"}}};s7sdk.set.CarouselView.prototype.viewInvalidate=function(viewPort){if(this.currentFrame==null){return}if(!this.currentFrame.view){return}var view=this.currentFrame.view;var rgn=new s7sdk.Rectangle(Math.round(viewPort.x*view.imageWidth),Math.round(viewPort.y*view.imageHeight),Math.round(viewPort.width*view.imageWidth),Math.round(viewPort.height*view.imageHeight));var viewTL=this.imagePixelsToViewPoint(rgn.topLeft());var viewBR=this.imagePixelsToViewPoint(rgn.bottomRight());var scale=(viewBR.y-viewTL.y)/(viewPort.height*view.imageHeight);scale=Math.round((scale+0.00005)*10000)/100;if(!this.lastViewPort||this.lastViewPort.isEmpty()){this.lastViewPort=viewPort}else{if(viewPort.equals(this.lastViewPort)&&!this.pvResized){if(this.prevScale!=scale){this.prevScale=scale;s7sdk.Event.dispatch(this.obj,new s7sdk.ZoomRgnEvent(s7sdk.ZoomRgnEvent.NOTF_ZOOM_NRGN,viewPort),false);s7sdk.Event.dispatch(this.obj,new s7sdk.ZoomRgnEvent(s7sdk.ZoomRgnEvent.NOTF_ZOOM_RGN,rgn),false)}return}}this.pvResized=false;this.lastViewPort=viewPort;s7sdk.Event.dispatch(this.obj,new s7sdk.ZoomRgnEvent(s7sdk.ZoomRgnEvent.NOTF_ZOOM_NRGN,viewPort),false);s7sdk.Event.dispatch(this.obj,new s7sdk.ZoomRgnEvent(s7sdk.ZoomRgnEvent.NOTF_ZOOM_RGN,rgn),false)};s7sdk.set.CarouselView.prototype.imagePixelsToViewPoint=function(inPt){if(this.currentFrame==null||this.currentFrame.view==null){return new s7sdk.Point2D(Number.POSITIVEINFINITY,Number.POSITIVEINFINITY)}var viewPoint=this.currentFrame.view.imagePixelsToViewPoint(inPt);return viewPoint};s7sdk.set.CarouselView.prototype.viewPointToImagePixels=function(inPt){if(this.currentFrame==null||this.currentFrame.view==null){return new s7sdk.Point2D(Number.POSITIVEINFINITY,Number.POSITIVEINFINITY)}var padding=new s7sdk.Point2D(0,0);var imgPoint=new s7sdk.Point2D(inPt.x-padding.x,inPt.y-padding.y);return this.currentFrame.view.viewPointToImagePixels(imgPoint)};s7sdk.set.CarouselView.prototype.viewStateChange=function(state){var newState=state;if(typeof(state)=="number"){newState=this.getStateInternal(state)}if(this.viewState==newState.state){return}this.viewState=newState.state;var ev=new s7sdk.event.CapabilityStateEvent(s7sdk.event.CapabilityStateEvent.NOTF_CAROUSELVIEW_CAPABILITY_STATE,newState);s7sdk.Event.dispatch(this.obj,ev,false)};s7sdk.set.CarouselView.prototype.getCapabilityState=function(){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.CarouselView.getCapabilityState");return this.getStateInternal(this.viewState)};s7sdk.set.CarouselView.prototype.getStateInternal=function(newState){var carouselViewState=new s7sdk.CarouselViewCapabilityState(typeof(newState)=="undefined"?(this.currentFrame?this.currentFrame.view.state:0):newState);carouselViewState.removeCapability(s7sdk.CarouselViewCapabilityState.FIRST_PAGE|s7sdk.CarouselViewCapabilityState.LAST_PAGE);if(this.currentFrame==null||this.currentFrame.idx==0){carouselViewState.setCapability(s7sdk.CarouselViewCapabilityState.FIRST_PAGE)}else{if(this.currentFrame.idx==(this.pageFrames.length-1)){carouselViewState.setCapability(s7sdk.CarouselViewCapabilityState.LAST_PAGE)}}return carouselViewState};s7sdk.set.CarouselView.prototype.build=function(){if(!this.added){this.attachToContainer();this.added=true}if(this.handler){this.handler.detach(this.obj)}if(this.items.length>1){this.setupInputController()}};s7sdk.set.CarouselView.prototype.setupInputController=function(){var self=this;this.handler=new s7sdk.event.InputController2(this.obj);this.handler.singleTapCallback=function(event,x,y){self.resumeAnimation()};this.handler.doubleTapCallback=function(event,x,y){self.resumeAnimation()};this.handler.startTouchCallback=function(event,x,y){if(self.pageFrames.length<2){return}var view=self.getCurrentView();if(view){self.dragStarted=false;self.startX=x;self.startY=y;self.detectEventOwner=true;self.componentOwnsEvent=true;self.startScrollX=window.scrollX;self.startScrollY=window.scrollY;self.pauseAnimation();self.mouseDown(x,y)}};this.handler.endTouchCallback=function(event,x,y){self.mouseUp(x,y,new Date().getTime())};this.handler.swipeCallback=function(swipeDir){};this.handler.dragCallback=function(event,x,y,diffX,diffY){if(self.pageFrames.length<2){return}var view=self.getCurrentView();if(self.detectEventOwner&&(self.startScrollX!=window.scrollX||self.startScrollY!=window.scrollY)){self.componentOwnsEvent=false;self.detectEventOwner=false}if(view){if(self.detectEventOwner){var dx=Math.abs(self.startX-x);var dy=Math.abs(self.startY-y);var cancheck=(dx>1)||(dy>1);if(cancheck){if(self.frametransition.transition=="slide"||self.frametransition.transition=="fade"){self.componentOwnsEvent=(dx>dy)&&self.componentOwnsEvent}else{self.componentOwnsEvent=true;self.detectEventOwner=false}}else{return}}if(self.componentOwnsEvent){self.detectEventOwner=false;event.preventDefault();self.mouseMove(x,y,new Date().getTime())}}};this.handler.endDragCallback=function(event,x,y,diffX,diffY){}};s7sdk.set.CarouselView.prototype.mouseMove=function(x,y,timeStamp){if(this.frametransition.transition=="slide"){var absSshift=this.paused*this.totalWidth_;var nxtX=absSshift+(-this.totalWidth_+x-this.lastX);if(nxtX<-2*this.totalWidth_){nxtX=-2*this.totalWidth_}else{if(nxtX>0){nxtX=0}}this.containerMove(nxtX)}else{if(this.frametransition.transition=="fade"){var reldef=this.paused+2*(x-this.lastX)/this.totalWidth_;if(reldef>0){reldef=reldef>1?1:reldef;this.setOpacity(this.dRight.obj,0);this.setOpacity(this.dCenter.obj,1-reldef);this.setOpacity(this.dLeft.obj,reldef)}else{reldef=reldef<-1?-1:reldef;this.setOpacity(this.dRight.obj,-reldef);this.setOpacity(this.dCenter.obj,1+reldef);this.setOpacity(this.dLeft.obj,0)}this.lastPaused=reldef}}this.mouseInmove=true};s7sdk.set.CarouselView.prototype.mouseDown=function(x,y){var instance=this;this.__mouseUp=function(e){instance.onDocumentClicked(e)};this.__mouseTouchend=function(e){instance.onDocumentClicked(e)};s7sdk.Event.removeDOMListener(document,"mouseup",this.__mouseUp,true);s7sdk.Event.removeDOMListener(document,"touchend",this.__mouseTouchend,true);s7sdk.Event.addDOMListener(document,"mouseup",this.__mouseUp,true);s7sdk.Event.addDOMListener(document,"touchend",this.__mouseTouchend,true);var dt=new Date();this.startTimeChk=dt.getTime();this.mouseInmove=false;this.lastX=x;this.lastY=y;s7sdk.Logger.log(s7sdk.Logger.FINEST,"s7sdk.set.CarouselView.mouseDown - x: %0, y: %1",x,y);this.mouseIsDown=true;return false};s7sdk.set.CarouselView.prototype.onDocumentClicked=function(e){var inst=this;this.timerMouseUpCheck=setTimeout(function(){inst.mouseUpCheck()},0)};s7sdk.set.CarouselView.prototype.mouseUpCheck=function(){if(this.mouseIsDown){this.mouseUp(this.lastX,this.lastY,new Date().getTime());this.handler.stop(this.dCenter.displayElement);this.currentFrame.invalidate()}else{}};s7sdk.set.CarouselView.prototype.mouseUp=function(x,y,timeStamp){s7sdk.Event.removeDOMListener(document,"mouseup",this.__mouseUp,true);s7sdk.Event.removeDOMListener(document,"touchend",this.__mouseTouchend,true);if(this.mouseInmove){var newfr;if(this.frametransition.transition=="slide"){if(typeof(this.animate)=="undefined"){this.animate=new s7sdk.set.SlideAnimation(this,this.frametransition.duration)}this.animate.inTransition=false;var step;var pos=parseFloat(this.container3.style.left.replace("px",""));var chkpos=pos+this.totalWidth_;var dx=this.lastX-x;var switchPage=(timeStamp-this.startTimeChk)<150&&this.mouseInmove&&Math.abs(dx)>1;if(Math.abs(chkpos)>(this.totalWidth_/2+10)||switchPage){if(switchPage){chkpos=-dx}if(chkpos<0){step=pos/this.totalWidth_+1;newfr=this.getFrameByIdx(this.currentFrame.idx+1)}else{step=-(pos+this.totalWidth_)/this.totalWidth_;newfr=this.getFrameByIdx(this.currentFrame.idx-1)}this.nextFrame=newfr;this.loader.processed.idx=this.nextFrame.idx;var swdir=this.nextFrame.idx<this.currentFrame.idx;swdir=this.currentFrame.idx==0&&this.nextFrame.idx==(this.pageFrames.length-1)||this.nextFrame.idx==0&&this.currentFrame.idx==(this.pageFrames.length-1)?!swdir:swdir;this.animate.startTransition(swdir,Math.abs(step),false);this.animate.custom=true}else{if(chkpos>0){step=pos/this.totalWidth_+1;this.animate.startTransition(false,1-Math.abs(step),true);this.animate.custom=true}else{step=-(pos+this.totalWidth_)/this.totalWidth_;this.animate.startTransition(true,1-Math.abs(step),true);this.animate.custom=true}}this.isDragComplete=true}else{if(this.frametransition.transition=="fade"){if(typeof(this.animate)=="undefined"){this.animate=new s7sdk.set.SlideAnimation(this,this.frametransition.duration)}this.animate.inTransition=false;var dx=this.lastX-x;var switchPage=(timeStamp-this.startTimeChk)<150&&this.mouseInmove&&Math.abs(dx)>1;if(Math.abs(this.lastPaused)>0.6||switchPage){if(this.lastPaused>0){newfr=this.getFrameByIdx(this.currentFrame.idx-1)}else{newfr=this.getFrameByIdx(this.currentFrame.idx+1)}this.nextFrame=newfr;this.loader.processed.idx=this.nextFrame.idx;var swdir=this.nextFrame.idx<this.currentFrame.idx;swdir=this.currentFrame.idx==0&&this.nextFrame.idx==(this.pageFrames.length-1)||this.nextFrame.idx==0&&this.currentFrame.idx==(this.pageFrames.length-1)?!swdir:swdir;this.animate.startTransition(swdir,Math.abs(this.lastPaused),false);this.animate.custom=true}else{this.nextFrame=this.currentFrame;if(this.lastPaused>0){this.animate.startTransition(false,1-Math.abs(this.lastPaused),true);this.animate.custom=true}else{this.animate.startTransition(true,1+this.lastPaused,true);this.animate.custom=true}}this.lastPaused=0;this.isDragComplete=true}else{if(this.frametransition.transition=="none"){var dx=this.lastX-x;var switchPage=(timeStamp-this.startTimeChk)<150&&this.mouseInmove&&Math.abs(dx)>1;if(switchPage||(this.mouseInmove&&(Math.abs(dx)>this.totalWidth_/2+10))){if(dx>0){this.next_Page()}else{this.prev_Page()}}else{}this.lastPaused=0;this.isDragComplete=true}}}}this.mouseInmove=false;this.mouseIsDown=false};s7sdk.set.CarouselView.prototype.pauseAnimation=function(){if(this.autoPlay.enable){this.autoPlayOnOff(false)}if(typeof(this.animate)=="undefined"){this.animate=new s7sdk.set.SlideAnimation(this,this.frametransition.duration)}this.animate.pause();if(typeof this.animate.stepSize=="undefined"||this.animate.stepSize>=1){this.paused=0}else{this.paused=1+((this.animate.reverse?(this.animate.direction?-1:1):0)-(1+(this.animate.direction?-1:1)*this.animate.stepSize))}this.lastPaused=this.paused};s7sdk.set.CarouselView.prototype.resumeAnimation=function(){if(this.autoPlay.enable){this.autoPlayOnOff(true)}if(this.animate){this.animate.resume()}};s7sdk.set.CarouselView.prototype.cleanUp=function(){if(this.replaseFrameTimeOut){clearTimeout(this.replaseFrameTimeOut);this.replaseFrameTimeOut=null}if(this.firstPreloadTimer){clearTimeout(this.firstPreloadTimer);this.firstPreloadTimer=null}if(this.loader.timer){clearInterval(this.loader.timer);this.loader.timer=null}this.cleanUp_();delete this.loader;if(this.animate){this.animate.cleanUp();delete this.animate;this.animate=null}if(this.autoPlayTimer){clearTimeout(this.autoPlayTimer);this.autoPlayTimer=null}if(this.handler){this.handler.detach(this.obj)}if(this.dLeft){if(this.dLeft.view){this.dLeft.view.detach();this.dLeft.view.unload(8)}}if(this.dRight){if(this.dRight.view){this.dRight.view.detach();this.dRight.view.unload(8)}}if(this.dCenter){if(this.dCenter.view){this.dCenter.view.detach();this.dCenter.view.unload(8)}}this.container3.removeChild(this.dLeft.obj);this.container3.removeChild(this.dCenter.obj);this.container3.removeChild(this.dRight.obj);delete this.dLeft;delete this.dCenter;delete this.dRight;if(this.viewport&&this.obj){this.obj.removeChild(this.viewport)}s7sdk.Util.removeTags(this.obj);this.obj.style.cssText=""};s7sdk.set.CarouselView.prototype.cleanUp_=function(){if(this.isReq_){this.isReq_.cancelHttpReq();this.isReq_=null}this.currentFrame=null;this.nextFrame=null;this.inprogress=false;this.loader.processed=[];this.loader.queue=[];this.loader.frameToLoad=null;this.toLoad=0;if(this.createPageFramesTimeoutId){clearTimeout(this.createPageFramesTimeoutId);this.createPageFramesTimeoutId=null}if(this.pageFrames!=null&&this.pageFrames.length!=0){for(var i=0;i<this.pageFrames.length;i++){if(this.pageFrames[i].view!=null){this.pageFrames[i].view.onResetImageLoaded=s7sdk.Callback.noop}this.pageFrames[i].unload(8);delete this.pageFrames[i]}}};s7sdk.set.CarouselView.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};s7sdk.set.CarouselView.prototype.getContainer=function(){return this.container};s7sdk.set.CarouselView.prototype.createElement=function(){s7sdk.UIComponent.prototype.createElement.apply(this,[]);this.obj=this.prepareDiv(this.obj);this.obj.setWidth(this.wid);this.obj.setHeight(this.hei);this.obj.className="s7carouselview";this.obj.style.overflow="hidden"};s7sdk.set.CarouselView.prototype.prepareDiv=function(using){var div=(using&&typeof using!="undefined")?using:document.createElement("div");div.getX=function(){return div.x_};div.getY=function(){return div.y_};div.setX=function(value){div.x_=value;div.style.left=value+"px"};div.setY=function(value){div.y_=value;div.style.top=value+"px"};div.getWidth=function(){return div.width_};div.getHeight=function(){return div.height_};div.setWidth=function(value){div.width_=value;div.style.width=value+"px"};div.setHeight=function(value){div.height_=value;div.style.height=value+"px"};return div};s7sdk.set.CarouselView.prototype.getWidth=function(){return this.wid};s7sdk.set.CarouselView.prototype.getHeight=function(){return this.hei};s7sdk.set.CarouselView.prototype.resize=function(w,h){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.CarouselView.resize - w: %0, h: %1",w,h);if(w==this.wid&&h==this.hei){return}this.pvResized=true;this.wid=w>0?w:1;this.hei=h>0?h:1;this.devicePixelRatio=s7sdk.Util.adjustDevicePixelRatio(this.enableHD.maxHdPixels,this.hei,this.wid);if(this.currentFrame&&this.currentFrame.view){this.currentFrame.view.devicePixelRatio=this.devicePixelRatio}this.viewProps.outWidth=this.wid*this.devicePixelRatio;this.viewProps.outHeight=this.hei*this.devicePixelRatio;this.totalWidth_=this.wid+this.spacing;this.totalHeight_=this.hei;this.container3.setWidth(this.totalWidth_*3);this.container3.setHeight(this.totalHeight_);this.container3.style.left=-this.totalWidth_+"px";this.obj.setWidth(this.wid);this.obj.setHeight(this.hei);this.dLeft.resize(this.viewProps.outWidth,this.viewProps.outHeight,this.wid,this.hei,this.devicePixelRatio);this.dCenter.resize(this.viewProps.outWidth,this.viewProps.outHeight,this.wid,this.hei,this.devicePixelRatio);this.dRight.resize(this.viewProps.outWidth,this.viewProps.outHeight,this.wid,this.hei,this.devicePixelRatio);switch(this.frametransition.transition){case"fade":this.dLeft.obj.style.left=this.totalWidth_+"px";this.dRight.obj.style.left=this.totalWidth_+"px";break;case"slide":break;case"default":}if(this.currentFrame!=null){this.currentFrame.resize();if(this.currentFrame.view){this.currentFrame.view.draw()}}var frm;if(this.pageFrames){for(var i=0;i<this.pageFrames.length;i++){frm=this.pageFrames[i];if(frm!=this.currentFrame){if(frm!=null&&frm.view!=null){frm.view.devicePixelRatio=this.devicePixelRatio}frm.resize()}}}this.dispatchEvent(new s7sdk.event.ResizeEvent(s7sdk.event.ResizeEvent.COMPONENT_RESIZE,w,h,false));s7sdk.UIComponent.prototype.resize.apply(this,[w,h])};s7sdk.set.CarouselView.prototype.adjustDevicePixelRatio=function(){this.devicePixelRatio=1;this.viewProps.outWidth=this.wid;this.viewProps.outHeight=this.hei;this.totalWidth_=this.wid+this.spacing;this.totalHeight_=this.hei;this.container3.setWidth(this.totalWidth_*3);this.container3.setHeight(this.totalHeight_);this.container3.style.left=-this.totalWidth_+"px";this.obj.setWidth(this.wid);this.obj.setHeight(this.hei);this.dLeft.resize(this.viewProps.outWidth,this.viewProps.outHeight,this.wid,this.hei,this.devicePixelRatio);this.dCenter.resize(this.viewProps.outWidth,this.viewProps.outHeight,this.wid,this.hei,this.devicePixelRatio);this.dRight.resize(this.viewProps.outWidth,this.viewProps.outHeight,this.wid,this.hei,this.devicePixelRatio);var frm;if(this.pageFrames){for(var i=0;i<this.pageFrames.length;i++){frm=this.pageFrames[i];frm.viewProps=this.viewProps;frm.resize()}}};s7sdk.set.CarouselView.prototype.addEventListener=function(type,handler,useCapture){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.CarouselView.addEventListener - type: %0, handler: %1, useCapture: %2",type,handler.toString().substring(0,handler.toString().indexOf("(")),useCapture);s7sdk.Base.prototype.addEventListener.apply(this,[type,handler,useCapture])};s7sdk.set.CarouselView.prototype.sendStatusEvent=function(view){if(view.viewReady){if(!this.hiresIsReadySent){var statusEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_HIGHRES_VIEW_READY,true);s7sdk.Event.dispatch(this.obj,statusEvent,false);this.hiresIsReadySent=true;var inst=this;this.firstPreloadTimer=setTimeout(function(){inst.maxload=inst.startupFrameMaxload},inst.autoPlay.enable?(inst.frametransition.duration+inst.autoPlay.duration)*1000/2:1000)}}if(!view.viewReady){if(!this.viewIsReadySent){var statusEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_VIEW_READY,true);s7sdk.Event.dispatch(this.obj,statusEvent,false);this.viewIsReadySent=true}view.viewReady=true}};s7sdk.set.CarouselView.prototype.setAsset=function(assetName){if(this.chk&&this.chk.started&&!this.chk.complete){var userEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);s7sdk.Event.dispatch(this.obj,userEvent,false)}this.chk=null;this.viewIsMetadataSent=false;this.viewIsReadySent=false;this.hiresIsReadySent=false;this.isAssetChanged=true;this.setAssetInternal(assetName)};s7sdk.set.CarouselView.prototype.setAssetInternal=function(assetName){if(typeof assetName!="string"){throw new Error("Asset name must be represented by a string!")}if(assetName==""){return}this.currentAsset=assetName;s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.CarouselView.setAsset - assetName: %0",assetName);var newAsset=unescape(assetName);if(this.assetName_!=null&&newAsset!=this.assetName_){var userEvent=new s7sdk.UserEvent(s7sdk.UserEvent.SWAP,[0,assetName],true);s7sdk.Event.dispatch(this.obj,userEvent,false)}this.itemIndex_=-1;this.filteredSet_=[];this.assetName_=newAsset;this.loadAsset()};s7sdk.set.CarouselView.prototype.setMediaSet=function(mediaSet){if(this.chk&&this.chk.started&&!this.chk.complete){var userEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);s7sdk.Event.dispatch(this.obj,userEvent,false)}this.isAssetChanged=true;this.chk=null;this.viewIsMetadataSent=false;this.viewIsReadySent=false;this.hiresIsReadySent=false;this.setMediaSetInternal(mediaSet)};s7sdk.set.CarouselView.prototype.setMediaSetInternal=function(mediaSet){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.CarouselView.setMediaSet - mediaSet: %0",mediaSet);if(this.autoPlay.enable){this.autoPlayOnOff(false)}this.mediaSet_=mediaSet;this.items=this.mediaSet_.items;if(parseInt(this.maxloadradius)==-1){this.maxload=this.items.length}this.currentAsset=this.mediaSet_;this.refresh();if(!this.viewIsMetadataSent){var userEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_ASSET_METADATA_READY,true);s7sdk.Event.dispatch(this.obj,userEvent,false);this.viewIsMetadataSent=true}};s7sdk.set.CarouselView.prototype.refresh=function(){this.cleanUp_();this.startupFrame=this.dir?(this.items.length-1):0;var inst=this;this.createPageFramesTimeoutId=setTimeout(function(){inst.createPageFrames();inst.build()},0)};s7sdk.set.CarouselView.prototype.setFrameTransition=function(frmTransition,duration){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.CarouselView.setFrameTransition - frmTransition: %0, duration: %1",frmTransition,duration);this.frametransition.transition=frmTransition=="slide"||frmTransition=="fade"?frmTransition:"none";if(frmTransition=="fade"){this.setOpacity(this.dLeft.obj,0);this.dLeft.obj.style.left=this.totalWidth_+"px";this.setOpacity(this.dRight.obj,0);this.dRight.obj.style.left=this.totalWidth_+"px"}else{this.dLeft.obj.style.left=0+"px";this.dRight.obj.style.left=2*this.totalWidth_+"px";this.setOpacity(this.dLeft.obj,1);this.setOpacity(this.dRight.obj,1)}if(typeof(duration)!="undefined"&&s7sdk.Util.isNumber(duration)){this.frametransition.duration=duration}};s7sdk.set.CarouselView.prototype.nextPage=function(){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.CarouselView.nextPage");if(this.dir){this.prev_Page()}else{this.next_Page()}};s7sdk.set.CarouselView.prototype.next_Page=function(){if(this.pageFrames==null){return}if(this.frame_==this.pageFrames.length-1){this.frame_=-1}this.changeToNext=true;this.loadFrames(this.frame_+1,true)};s7sdk.set.CarouselView.prototype.prevPage=function(){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.CarouselView.prevPage");if(this.dir){this.next_Page()}else{this.prev_Page()}};s7sdk.set.CarouselView.prototype.prev_Page=function(){if(this.pageFrames==null){return}if(this.frame_==0){this.frame_=this.pageFrames.length}this.changeToNext=false;this.loadFrames(this.getFrameIdx(this.frame_-1),true)};s7sdk.set.CarouselView.prototype.stopAutoPlay=function(){if(this.autoPlayTimer){clearTimeout(this.autoPlayTimer);this.autoPlayTimer=null;this.autoPlayCounter=0}};s7sdk.set.CarouselView.prototype.autoPlayOnOff=function(value){this.stopAutoPlay();if(value){var inst=this;function auto(){if(!inst.autoPlayPaused){if(inst.autoPlay.direction==1){inst.nextPage()}else{inst.prevPage()}}inst.autoPlayTimer=setTimeout(auto,(inst.frametransition.duration+inst.autoPlay.duration)*1000)}inst.autoPlayTimer=setTimeout(auto,(inst.frametransition.duration+inst.autoPlay.duration)*1000)}};s7sdk.set.CarouselView.prototype.autoPlayPause=function(){return this.autoPlayPaused=true};s7sdk.set.CarouselView.prototype.autoPlayResume=function(){return this.autoPlayPaused=false};s7sdk.set.CarouselView.prototype.getCurrentFrameIndex=function(){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.CarouselView.getCurrentFrameIndex");return this.currentFrame!=null?(this.dir?this.items.length-1-this.currentFrame.idx:this.currentFrame.idx):-1};s7sdk.set.CarouselView.prototype.setCurrentFrameIndex=function(idx){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.CarouselView.setCurrentFrameIndex - idx: %0",idx);if(idx>=0&&this.mediaSet_){var neidx=this.dir?this.items.length-1-idx:idx;if(this.autoPlay.enable){this.autoPlayOnOff(false)}if(!this.currentFrame){this.startupFrame=neidx}else{if(neidx!=this.currentFrame.idx){this.loadFrames(this.getFrameIdx(neidx),true)}}if(this.autoPlay.enable){this.autoPlayOnOff(true)}}};s7sdk.set.CarouselView.prototype.getFromRadius=function(cidx){if(typeof(cidx)=="undefined"||(this.chk&&this.chk.tilesLoaded)){return null}if(!this.chk){this.chk={};this.chk.tilesLoaded=false;this.chk.started=false;this.chk.complete=false}if(this.chk.currentFrameChk!=cidx){this.chk.currentFrameChk=cidx;if(this.chk.started){if(this.chk.complete){this.chk.started=false;this.chk.complete=false;this.chk.tilesLoaded=true;for(var i=0;i<this.pageFrames.length;i++){var chkframe=this.getFrameByIdx(i);if(chkframe&&chkframe.loaded){this.chk.tilesLoaded=false;break}}}}}var frameToLoad=null;this.inprogress=false;for(var i=0;i<this.maxload;i++){if((cidx+1+i)<this.pageFrames.length){frameToLoad=this.getFrameByIdx(cidx+1+i);if(frameToLoad&&!frameToLoad.loaded&&(cidx+1+i)<this.pageFrames.length){break}}if((cidx-1-i)>=0){frameToLoad=this.getFrameByIdx(cidx-1-i);if(frameToLoad&&!frameToLoad.loaded&&(cidx-1-i)>=0){break}else{frameToLoad=null}}else{frameToLoad=null}}if(frameToLoad){if(!this.chk.started){this.chk.started=true;var userEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_PRELOAD_START,true);s7sdk.Event.dispatch(this.obj,userEvent,false)}}else{if(this.chk.started){if(!this.chk.complete){this.chk.complete=true;var userEvent=new s7sdk.event.StatusEvent(s7sdk.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);s7sdk.Event.dispatch(this.obj,userEvent,false)}}else{}}return frameToLoad};s7sdk.set.CarouselView.prototype.getCurrentAsset=function(){return typeof this.currentAsset=="undefined"?null:this.currentAsset};s7sdk.set.CarouselView.prototype.setCurrentAsset=function(assetInfo){this.viewIsMetadataSent=true;this.viewIsReadySent=true;this.hiresIsReadySent=true;if(typeof(assetInfo)=="string"){this.setAssetInternal(assetInfo)}else{this.setMediaSetInternal(assetInfo)}};s7sdk.set.CarouselView.prototype.setModifier=function(modObj){throw new Error("Trying to use setModifier on the Core class (CarouselView) is unsupported! Please refer to SDK documentation on using setModifier.")};s7sdk.set.CarouselView.prototype.setCSS=function(classname,property,value){if(this.isRestrictedCSSProperty(s7sdk.set.CarouselView.RESTRICTED_STYLES,property)){throw new Error("You cannot set "+classname+" : "+property+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[classname,property,value])}};(function addDefaultCSS(){var createRule=s7sdk.Util.css.createCssRuleText;var createImgUrl=s7sdk.Util.css.createCssImgUrlText;var isTouchActionIE=s7sdk.browser&&s7sdk.browser.name=="ie"&&s7sdk.browser.version.major>=10;var cssText=createRule(".s7carouselview",{"background-color":"#ffffff",position:"absolute",width:"400px",height:"400px","z-index":"0","-ms-touch-action":isTouchActionIE?"none":"","touch-action":isTouchActionIE?"none":"","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)"})+createRule(".s7carouselview img",{"max-width":"none","max-height":"none"});s7sdk.Util.css.addDefaultCSS(cssText,"CarouselView")})()}if(!s7sdk.set.CPageFrame){s7sdk.set.CPageFrame=function(container,serverUrl,imageName,idx,viewProps,initWidth,initHeight,pgalign,label){this.container=container;this.idx=idx;this.imageName=imageName;this.serverUrl=serverUrl;this.viewProps=viewProps;this.initWidth=initWidth;this.initHeight=initHeight;this.view=null;this.viewPort=null;this.notify=true;this.invalidated=false;this.tileRender=false;this.delayTileLoad=true;this.priority=0;this.loaded=false;this.align=pgalign;this.label=label;this.isReq=null;this.image=new Image();this.image.imageFrame=this};s7sdk.set.CPageFrame.MAX_PRIORITY=100;s7sdk.set.CPageFrame.prototype.loadFrame=function(){if(this.view!=null){return}if(!this.loaded){this.viewProps.width=this.initWidth;this.viewProps.height=this.initHeight;this.initView();s7sdk.Event.dispatch(this.image,s7sdk.Event.VIEW_LOADED,true);s7sdk.Event.addDOMListener(this.image,s7sdk.Event.RENDER,this.renderHandler,true);this.loaded=true}};s7sdk.set.CPageFrame.prototype.initView=function(){with(this){s7sdk.Logger.log(s7sdk.Logger.FINER,"PageFrame.initView - imageName: %0",imageName);if(s7sdk.browser.name==="ie"&&(s7sdk.browser.version.major<9)){this.view=new s7sdk.rgn.View(serverUrl+"/"+imageName,viewProps.width,viewProps.height,viewProps.resetWidth,viewProps.resetHeight,this.container.devicePixelRatio,viewProps.zoomStep,viewProps.limit,viewProps.transitionTime,viewProps.transitionEasing,viewPort,viewProps.elasticZoom,viewProps.clickToZoom,viewProps.fmt,0,true,this.idx,this.align)}else{this.view=new s7sdk.View(serverUrl+"/"+imageName,viewProps.width,viewProps.height,viewProps.resetWidth,viewProps.resetHeight,this.container.devicePixelRatio,viewProps.zoomStep,viewProps.limit,viewProps.transitionTime,viewProps.transitionEasing,viewPort,viewProps.elasticZoom,viewProps.clickToZoom,viewProps.fmt,0,true,this.idx,this.align)}view.tileRender=tileRender;view.delayTileLoad=delayTileLoad;view.viewParent=this.container;if(this.container.devicePixelRatio!=this.view.devicePixelRatio){this.container.adjustDevicePixelRatio()}this.container.viewStateChange(this.view.state);if(viewProps.resetHeight!=viewProps.outHeight||viewProps.resetWidth!=viewProps.outWidth){view.resize(viewProps.outWidth,viewProps.outHeight)}if(invalidated){view.loadImage();view.invalidate();invalidated=false}}};s7sdk.set.CPageFrame.prototype.resize=function(){if(this.view!=null){this.view.resize(this.viewProps.outWidth,this.viewProps.outHeight)}};s7sdk.set.CPageFrame.prototype.renderHandler=function(event){if(this.imageFrame.view!=null){this.imageFrame.view.draw()}};s7sdk.set.CPageFrame.prototype.invalidate=function(delayed){if(this.view!=null){this.view.tileRender=this.tileRender;this.view.loadImage();this.view.invalidate()}else{this.invalidated=true}};s7sdk.set.CPageFrame.prototype.setDelayTileLoad=function(value){if(this.view!=null){this.view.delayTileLoad=value}this.delayTileLoad=value};s7sdk.set.CPageFrame.prototype.unload=function(mask){if(this.view!=null){this.view.unload(mask)}};s7sdk.set.CPageFrame.prototype.setTileRender=function(value){if(this.view!=null){this.view.tileRender=value}this.tileRender=value};s7sdk.set.CPageFrame.prototype.setPriority=function(p){this.priority=(p<1)?1:(p>s7sdk.set.CPageFrame.MAX_PRIORITY)?s7sdk.set.CPageFrame.MAX_PRIORITY:p};s7sdk.set.CPageFrame.prototype.getView=function(){return this.view};s7sdk.set.CPageFrame.prototype.resetImageLoaded=function(){return this.view!=null&&this.view.resetImageLoaded}}if(!s7sdk.set.CPageFrameLoader){s7sdk.set.CPageFrameLoader=function(container,delay){this.container=container;this.delay=(null==delay)?100:delay;this.timer=setInterval(s7sdk.Util.wrapContext(this.onProcess,this),this.delay);this.queue=[];this.processed=[];this.toLoad=0;this.frameToLoad=null};s7sdk.set.CPageFrameLoader.prototype.load=function(inFrames,idx,noWait){inFrames.idx=idx;inFrames.noWait=noWait;this.queue.push(inFrames);return true};s7sdk.set.CPageFrameLoader.prototype.onProcess=function(){if(this.processed.length==0){if(this.queue.length!=0){this.processed=this.queue.pop();this.toLoad=0;this.queue=[]}else{if(!this.frameToLoad){this.frameToLoad=this.container.getFromRadius(this.processed.idx);if(this.frameToLoad&&!this.frameToLoad.loaded){this.frameToLoad.loadFrame();this.frameToLoad.setTileRender(false);this.frameToLoad.setDelayTileLoad(true)}else{this.frameToLoad=null}}else{if(this.frameToLoad&&this.frameToLoad.loaded){this.frameToLoad=null}}}}var alreadyLoaded=[];while(this.processed.length!=0){var frame=this.processed.pop();if(!frame.loaded){frame.loadFrame();if(frame.view.resetImageLoaded){alreadyLoaded.push(frame)}else{if(this.processed.noWait){if(this.processed.idx==frame.idx||frame.idx==0){frame.view.onResetImageLoaded=s7sdk.Util.wrapContext(this.onResetImageLoaded,this)}else{this.toLoad--}}else{frame.view.onResetImageLoaded=s7sdk.Util.wrapContext(this.onResetImageLoaded,this)}}frame.setTileRender(false);frame.setDelayTileLoad(true);this.toLoad++}else{if(frame.view.resetImageLoaded){alreadyLoaded.push(frame);this.toLoad++}}}while(alreadyLoaded.length!=0){var frame=alreadyLoaded.pop();this.onResetImageLoaded(true,frame.idx)}};s7sdk.set.CPageFrameLoader.prototype.onResetImageLoaded=function(opResult,idx){this.toLoad--;this.container.onResetImageLoaded(opResult,idx)}}if(!s7sdk.set.CViewWrapper){s7sdk.set.CViewWrapper=function CViewWrapper(parentObj,ow,oh,w,h,leftPos,spacing,zIndex,devicePixelRatio){this.parentObj=parentObj;this.leftPos=leftPos;this.spacing=spacing;this.obj=s7sdk.Util.createObj(null,"div",null,null);this.obj.style.zIndex=zIndex;this.displayElement=s7sdk.browser.name==="ie"&&(s7sdk.browser.version.major<9)?s7sdk.rgn.View.createDisplay():s7sdk.View.createDisplay();this.displayElement.width=ow*devicePixelRatio;this.displayElement.height=oh*devicePixelRatio;this.obj.style.position="absolute";this.displayElement.style.width=this.obj.style.width=w+"px";this.displayElement.style.height=this.obj.style.height=h+"px";this.obj.style.left=leftPos*(w+spacing)+"px";this.obj.style.width=(w+spacing)+"px";this.obj.appendChild(this.displayElement);this.loresIsloaded=false};s7sdk.set.CViewWrapper.prototype.onReadyToDislpay=function(){this.loresIsloaded=true;if(this.parentObj&&this.parentObj.doInitialSlide){this.parentObj.doInitialSlide()}};s7sdk.set.CViewWrapper.prototype.resize=function(ow,oh,w,h,devicePixelRatio){this.displayElement.width=ow;this.displayElement.height=oh;this.displayElement.style.width=this.obj.style.width=w+"px";this.displayElement.style.height=this.obj.style.height=h+"px";this.obj.style.left=this.leftPos*(w+this.spacing)+"px";this.obj.style.width=(w+this.spacing)+"px";if(this.view){this.view.resize(w*devicePixelRatio,h*devicePixelRatio)}}}})(s7getCurrentNameSpace());