/*!************************************************************************
 *
 * ADOBE CONFIDENTIAL
 * ___________________
 *
 *  Copyright 2011 Adobe Systems Incorporated
 *  All Rights Reserved.
 *
 * NOTICE:  All information contained herein is, and remains
 * the property of Adobe Systems Incorporated and its suppliers,
 * if any.  The intellectual and technical concepts contained
 * herein are proprietary to Adobe Systems Incorporated and its
 * suppliers and are protected by trade secret or copyright law.
 * Dissemination of this information or reproduction of this material
 * is strictly forbidden unless prior written permission is obtained
 * from Adobe Systems Incorporated.
 **************************************************************************/
(function(b){b.pkg("s7sdk.model");b.Util.require("s7sdk.css.Property");if(!b.model.CSSPropertyModel){"use strict";b.model.CSSPropertyModel=function i(k,j,l){arguments.callee.superclass.apply(this,[]);this.selectorModel=k;this.config=j||{};this.metadata=l||{};this.initProperties();this.propertyChangeListener=this.propertyChangeListener.bind(this);this.widget=null};b.Class.inherits("s7sdk.model.CSSPropertyModel","s7sdk.Observable");b.model.CSSPropertyModel.prototype.initProperties=function(){var j=this.getPropertyDeclaration();this.properties={};j.forEach(function(m){var q=this.config[m.name]||{};for(var p in q){if(q.hasOwnProperty(p)){if(m.defaultValues.hasOwnProperty(p)){m.defaultValues[p]=q[p]}else{throw new Error("Invalid user config property: "+p)}}}var l=m.name.match(/retina-/)?this.readRetinaCSS:this.readCSS;var n=l.apply(this,[m.name]),o=b.Util.isNonEmptyString(n)&&n!=="initial"&&n!=="inherit",k=this.createProperty(m.name,m.defaultValues,n,o),r=o||Boolean(m.defaultValues.insert);k=k.clone({fromCss:r,active:r});this.properties[m.name]=k}.bind(this))};b.model.CSSPropertyModel.prototype.createWidget=function(j){if(!j){throw new Error("Cannot create widget. No factory provided!")}var k=j.createWidget(this.selectorModel,this);if(!k||typeof k.addPropertyListeners==="undefined"){throw new Error("Factory created widget does not define a interface of 'addPropertyListeners'")}this.connectWidget(k);return k};b.model.CSSPropertyModel.prototype.disconnectWidget=function(){for(var j in this.properties){if(this.properties.hasOwnProperty(j)){this.widget.removePropertyListener(j,this.propertyChangeListener)}}this.widget=null};b.model.CSSPropertyModel.prototype.connectWidget=function(j){this.widget=j;for(var k in this.properties){if(this.properties.hasOwnProperty(k)){this.widget.addPropertyListener(k,this.propertyChangeListener)}}};b.model.CSSPropertyModel.prototype.notifyAll=function(){for(var j in this.properties){if(this.properties.hasOwnProperty(j)){this.notifyPropertyChanged(j,null,this.properties[j])}}};b.model.CSSPropertyModel.prototype.propertyChangeListener=function(l,j,m){var k=this.properties[l];if(!m.active){this.removeFromCSS(l)}if(m&&!(m instanceof b.css.Property)){throw new Error("Invalid property type")}if(k&&k.equal&&k.equal(m)||k===m){return}this.properties[l]=m;this.notifyPropertyChanged(l,k,m)};b.model.CSSPropertyModel.prototype.setProperty=function(l,k){var j=this.properties&&this.properties[l],m=j.clone(k);b.model.CSSPropertyModel.prototype.propertyChangeListener.apply(this,[l,j,m])};b.model.CSSPropertyModel.prototype.createProperty=function(l,m,j,k){return new b.css.GenericProperty(l,j,k)};b.model.CSSPropertyModel.prototype.getPropertyDeclaration=function(){return[]};b.model.CSSPropertyModel.prototype.readCSS=function(m,j){var n=this.selectorModel.getParsedCSS()||{},l=b.Util.merge(n.cascaded||{},(j&&{})||(n.attributes||{})),k=b.model.CSSPropertyModel.EquivalentResolver(m,l);return k};b.model.CSSPropertyModel.prototype.readRetinaCSS=function(m,j){m=m.replace(/retina-/,"");var n=this.selectorModel.getParsedCSS()||{},k=n.queryStyle||{},l=k.attributes||{};return l[m]};b.model.CSSPropertyModel.prototype.removeFromCSS=function(l){var m=this.selectorModel.getParsedCSS()||{},k=m.attributes||{};if(l.match(/retina-/)){var j=m.queryStyle||{};k=j.attributes||{};l=l.replace(/retina-/,"")}delete k[l]};b.model.CSSPropertyModel.EquivalentResolver=function(m,l){var n=document.createElement("div");for(var k in l){if(l.propertyIsEnumerable(k)){n.style.setProperty(k,l[k])}}var j=n.style.getPropertyValue(m);return m=="box-shadow"||!j?l[m]:j}}if(!b.model.CSSPositionModel){b.model.CSSPositionModel=function d(k,j,l){arguments.callee.superclass.apply(this,[k,j,l])};b.Class.inherits("s7sdk.model.CSSPositionModel","s7sdk.model.CSSPropertyModel");b.model.CSSPositionModel.prototype.getPropertyDeclaration=function(){return[{name:b.css.Property.LEFT,defaultValues:{value:100,min:0,max:300,insert:false}},{name:b.css.Property.RIGHT,defaultValues:{value:100,min:0,max:300,insert:false}},{name:b.css.Property.TOP,defaultValues:{value:0,min:0,max:300,insert:false}},{name:b.css.Property.BOTTOM,defaultValues:{value:0,min:0,max:300,insert:false}}]};b.model.CSSPositionModel.prototype.createProperty=function(l,m,j,k){if(k){return b.css.LengthProperty.parse(l,j,m.min,m.max)}else{return new b.css.LengthProperty(l,{unit:b.css.Unit.PX,min_value:m.min,max_value:m.max,active:false,value:m.value})}}}if(!b.model.CSSSizeModel){b.model.CSSSizeModel=function c(k,j,l){arguments.callee.superclass.apply(this,[k,j,l])};b.Class.inherits("s7sdk.model.CSSSizeModel","s7sdk.model.CSSPropertyModel");b.model.CSSSizeModel.prototype.createProperty=function(l,m,j,k){if(k){return b.css.LengthProperty.parse(l,j,m.min,m.max).clone({hide:m.hide})}else{return new b.css.LengthProperty(l,{unit:b.css.Unit.PX,min_value:m.min,max_value:m.max,active:false,value:m.value,hide:m.hide})}};b.model.CSSSizeModel.prototype.getPropertyDeclaration=function(){return[{name:b.css.Property.WIDTH,defaultValues:{min:0,max:600,value:0,hide:false}},{name:b.css.Property.HEIGHT,defaultValues:{min:0,max:600,value:0,hide:false}}]}}if(!b.model.CSSBackgroundModel){b.model.CSSBackgroundModel=function f(k,j,l){arguments.callee.superclass.apply(this,[k,j,l])};b.Class.inherits("s7sdk.model.CSSBackgroundModel","s7sdk.model.CSSPropertyModel");b.model.CSSBackgroundModel.prototype.createProperty=function(m,n,k,l){var j;if(m==b.css.Property.BACKGROUND_COLOR){j=l?b.css.ColorProperty.parse(m,k):b.css.ColorProperty.parse(m,n.value)}else{j=new b.css.GenericProperty(m,b.Util.merge(n,l?{value:k}:{}))}return j.clone({active:l})};b.model.CSSBackgroundModel.prototype.propertyChangeListener=function(l,k,o){var j=o;if(l==b.css.Property.BACKGROUND_IMAGE){var n=this.readCSS(b.css.Property.BACKGROUND_IMAGE,true)||"none",m=!(o.value==="none"||o.value===n);j=o.clone({active:m,value:m?o.value:n});if(this.properties[b.css.Property.BACKGROUND_REPEAT].hide){this.setProperty(b.css.Property.BACKGROUND_POSITION,{active:m,value:"50% 50%",set:m});this.setProperty(b.css.Property.BACKGROUND_REPEAT,{active:m,value:"no-repeat",set:m});this.setProperty(b.css.Property.BACKGROUND_SIZE,{active:m,value:"contain",set:m})}else{this.setProperty(b.css.Property.BACKGROUND_POSITION,{active:m,set:m});this.setProperty(b.css.Property.BACKGROUND_SIZE,{active:m,set:m});this.setProperty(b.css.Property.BACKGROUND_REPEAT,{active:m,set:m})}}else{if(l=="retina-background-image"){var m=!(o.value===""||o.value==="none");j=o.clone({active:m});if(this.properties[b.css.Property.BACKGROUND_REPEAT].hide){this.setProperty("retina-background-position",{active:m,value:"50% 50%",set:m});this.setProperty("retina-background-repeat",{active:m,value:"no-repeat",set:m});this.setProperty("retina-background-size",{active:m,value:"contain",set:m})}else{this.setProperty("retina-background-position",{active:m,set:m});this.setProperty("retina-background-repeat",{active:m,set:m});this.setProperty("retina-background-size",{active:m,set:m})}}else{j=o.clone({active:o.active||o.set})}}b.model.CSSBackgroundModel.superclass.prototype.propertyChangeListener.apply(this,[l,k,j])};b.model.CSSBackgroundModel.prototype.getPropertyDeclaration=function(){return[{name:b.css.Property.BACKGROUND_IMAGE,defaultValues:{value:"none",hide:false}},{name:"retina-background-image",defaultValues:{value:"none",hide:false}},{name:"retina-background-position",defaultValues:{value:"50% 50%",hide:false}},{name:"retina-background-size",defaultValues:{value:"contain",hide:false}},{name:"retina-background-repeat",defaultValues:{value:"repeat",hide:false}},{name:b.css.Property.BACKGROUND_COLOR,defaultValues:{value:"transparent",hide:false}},{name:b.css.Property.BACKGROUND_SIZE,defaultValues:{value:"contain",hide:true}},{name:b.css.Property.BACKGROUND_REPEAT,defaultValues:{value:"repeat",hide:true}},{name:b.css.Property.BACKGROUND_POSITION,defaultValues:{value:"%50 %50",hide:true}},{name:b.css.Property.OPACITY,defaultValues:{value:1}}]}}if(!b.model.CSSSpriteModel){b.model.CSSSpriteModel=function e(k,j,l){arguments.callee.superclass.apply(this,[k,j,l])};b.Class.inherits("s7sdk.model.CSSSpriteModel","s7sdk.model.CSSPropertyModel");b.model.CSSSpriteModel.prototype.createProperty=function(m,n,k,l){var j=l?new b.css.GenericProperty(m,{value:k}):new b.css.GenericProperty(m,n);return j.clone({active:l})};b.model.CSSSpriteModel.prototype.propertyChangeListener=function(l,k,o){var n=this.readCSS(b.css.Property.BACKGROUND_IMAGE,true)||"none",m=!(o.value==="none"||o.value===n);var j=o.clone({active:m,value:m?o.value:n});if(!m){}b.model.CSSSpriteModel.superclass.prototype.propertyChangeListener.apply(this,[l,k,j])};b.model.CSSSpriteModel.prototype.getPropertyDeclaration=function(){return[{name:b.css.Property.BACKGROUND_IMAGE,defaultValues:{value:"none"}}]}}if(!b.model.CSSBoxShadowModel){b.model.CSSBoxShadowModel=function g(k,j,l){arguments.callee.superclass.apply(this,[k,j,l])};b.Class.inherits("s7sdk.model.CSSBoxShadowModel","s7sdk.model.CSSPropertyModel");b.model.CSSBoxShadowModel.prototype.createProperty=function(n,o,l,m){var j;var k=b.Util.merge(o,{color:b.css.ColorProperty.parse(n,o.colorHex)});j=m?b.css.BoxShadowProperty.parse(n,l):new b.css.BoxShadowProperty(n,k);return j};b.model.CSSBoxShadowModel.prototype.propertyChangeListener=function(l,k,m){var j=m.clone({active:m.type!="none"});b.model.CSSBoxShadowModel.superclass.prototype.propertyChangeListener.apply(this,[l,k,j])};b.model.CSSBoxShadowModel.prototype.getPropertyDeclaration=function(){return[{name:b.css.Property.BOX_SHADOW,defaultValues:{horizontal:0,vertical:0,blur:30,spread:0,type:"none",active:false,colorHex:"#888"}}]}}if(!b.model.CSSBorderModel){b.model.CSSBorderModel=function a(k,j,l){arguments.callee.superclass.apply(this,[k,j,l])};b.Class.inherits("s7sdk.model.CSSBorderModel","s7sdk.model.CSSPropertyModel");b.model.CSSBorderModel.prototype.createProperty=function(m,n,k,l){var j={unit:b.css.Unit.PX,min_value:n.min,max_value:n.max,active:l,value:l?parseInt(k):n.value};if(m==b.css.Property.BORDER_WIDTH||m==b.css.Property.BORDER_RADIUS){defaultConfig=new b.css.LengthProperty(m,j)}else{if(m==b.css.Property.BORDER_COLOR){defaultConfig=b.css.ColorProperty.parse(m,l?k:n.value)}else{if(m==b.css.Property.BORDER_STYLE){defaultConfig=b.css.BorderStyleProperty.parse(m,l?k:n.value)}}}return defaultConfig.clone({step:n.step})};b.model.CSSBorderModel.prototype.propertyChangeListener=function(l,k,m){if(l==b.css.Property.BORDER_STYLE){var j={set:m.set};this.setProperty(b.css.Property.BORDER_WIDTH,j);this.setProperty(b.css.Property.BORDER_COLOR,j);this.setProperty(b.css.Property.BORDER_RADIUS,j)}m=m.clone({active:m.active||m.set});b.model.CSSBorderModel.superclass.prototype.propertyChangeListener.apply(this,[l,k,m])};b.model.CSSBorderModel.prototype.getPropertyDeclaration=function(){return[{name:b.css.Property.BORDER_WIDTH,defaultValues:{min:0,max:20,value:2,step:1}},{name:b.css.Property.BORDER_COLOR,defaultValues:{value:"rgba(126,126,126,1)"}},{name:b.css.Property.BORDER_STYLE,defaultValues:{value:"none"}},{name:b.css.Property.BORDER_RADIUS,defaultValues:{min:0,max:50,value:0,step:1}}]}}if(!b.model.CSSFontModel){b.model.CSSFontModel=function h(k,j,l){arguments.callee.superclass.apply(this,[k,j,l])};b.Class.inherits("s7sdk.model.CSSFontModel","s7sdk.model.CSSPropertyModel");b.model.CSSFontModel.prototype.createProperty=function(m,n,k,l){var j;if(m==b.css.Property.COLOR){j=l?b.css.ColorProperty.parse(m,k):b.css.ColorProperty.parse(m,n.value)}return j};b.model.CSSFontModel.prototype.propertyChangeListener=function(k,j,l){l=l.clone({active:l.active||l.set});b.model.CSSBorderModel.superclass.prototype.propertyChangeListener.apply(this,[k,j,l])};b.model.CSSFontModel.prototype.getPropertyDeclaration=function(){return[{name:b.css.Property.COLOR,defaultValues:{value:"transparent",}}]}}})(s7getCurrentNameSpace());