/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(a){a.pkg("s7sdk.video");a.Util.require("s7sdk.common.ItemDesc");a.Util.require("s7sdk.common.IS");a.Util.require("s7sdk.common.IconEffect");a.Util.require("s7sdk.common.Enumeration");a.Util.require("s7sdk.common.WebVtt");a.Util.require("s7sdk.event.Event");if(!a.video.VideoPlayerControl){a.video.VideoPlayerControl=function(j){arguments.callee.superclass.apply(this,[j,a.video.VideoPlayerControl.NS,j.constructor,a.video.VideoPlayer.RESTRICTED_STYLES]);delete this.dynamicModifiers.posterimage};a.video.VideoPlayerControl.NS="s7sdk.video.VideoPlayerControl";a.video.VideoPlayerControl.prototype.setModifier=function(q){var j;for(var o in q){var l=o.toLowerCase();if(l=="navigation"){value=q[o];if(value){var n,m=true;prevVal=this.component.navigation.file+","+(this.component.enableNavigation?"1":"0");var p=value.split(",");if(p&&p.length>0){n=p[0];if(p.length>1){m=parseInt(p[1])!=0}if(n&&n.length>0){this.component.setNavigation(n,m);this.dispatchEvent(new a.event.ControlComponentEvent(a.event.ControlComponentEvent.NOTF_CONTROLCOMPONENT_MODIFIERUPDATED,{id:this.component.getId(),oldvalue:prevVal,newvalue:n+","+(m?"1":"0"),property:l},false))}}}}else{if(l=="interactivedata"){value=q[o];if(value){var n,m=true;prevVal=this.component.interactiveData.file+","+(this.component.enableInteractiveData?"1":"0");var p=value.split(",");if(p&&p.length>0){n=p[0];if(p.length>1){m=parseInt(p[1])!=0}if(n&&n.length>0){this.component.setInteractiveData(n,m);this.dispatchEvent(new a.event.ControlComponentEvent(a.event.ControlComponentEvent.NOTF_CONTROLCOMPONENT_MODIFIERUPDATED,{id:this.component.getId(),oldvalue:prevVal,newvalue:n+","+(m?"1":"0"),property:l},false))}}}}else{if(!j){j={}}j[o]=q[o]}}}if(j){this.superclass.prototype.setModifier.apply(this,[j])}};a.video.VideoPlayerControl.prototype.rebuild=function(z){if(this.component){if(this.component.videoProxy.hlsjsLoadTimer){clearTimeout(this.component.videoProxy.hlsjsLoadTimer);this.component.videoProxy.hlsjsLoadTimer=null}var k=this.component.getVolume();var x=this.component.muted();var m=this.component.viewReadyEventSent;var t=this.component.metadataReadyEventSent;var v=this.component.assetSpecificPosterImage;var u=z.posterimage;z.posterimage=u?u:this.component.posterimage;var p=z.asset;var j=z.video;var r;var s=this.component.getCurrentAsset()?true:false;if(p){r=p;delete z.asset;m=false;t=false;s=true}else{if(j){r=j;delete z.video;m=false;t=false;s=false}else{if(s){r=this.component.getCurrentAsset()}else{r=this.component.getCurrentVideo()}}}var y,w,l;if((typeof this.component.getWidth=="function")&&(typeof this.component.getHeight=="function")){y=this.component.getWidth();w=this.component.getHeight()}var q,o;if(this.restrictedStylesValues[this.getCl()]){q=this.restrictedStylesValues[this.getCl()].width;o=this.restrictedStylesValues[this.getCl()].height}this.listenerProxy=a.Util.copyListeners(this.component);this.unload();this.component=new this.componentconstructor(this.parentId,z,this.compId,true);this.restrictedStylesValues=this.readRestrictedStylesValues();var n=false;if(q&&o&&this.restrictedStylesValues[this.getCl()]){n=(q!=this.restrictedStylesValues[this.getCl()].width);n=n||(o!=this.restrictedStylesValues[this.getCl()].height)}if(!n&&(typeof this.component.resize=="function")){this.component.resize(y,w)}a.Util.assignListeners(this.listenerProxy,this.component);delete z.posterimage;if(this.component.assetSpecificPosterImage){v=this.component.assetSpecificPosterImage}else{if(u&&u.toLowerCase()=="none"){v=undefined}}if(s){this.component.setCurrentAsset(r,v)}else{this.component.setCurrentVideo(r,v)}this.component.setVolume(k);if(x){this.component.mute()}else{this.component.unmute()}this.component.viewReadyEventSent=m;this.component.metadataReadyEventSent=t}}}a.Class.inherits(a.video.VideoPlayerControl.NS,"s7sdk.ControlComponent");if(!a.video.VideoPlayer){a.video.VideoPlayer=function VideoPlayer(j,n,l){var o=!!arguments[3];arguments.callee.superclass.apply(this,[l,j,"div","s7videoplayer",n,!o]);this.createElement();this.container=this.getParent();if(this.videoServerUrl.lastIndexOf("/")!=(this.videoServerUrl.length-1)){this.videoServerUrl+="/"}if(/(http:\/\/[^\/]*)\b(\/DMGateway\/(public)\/)/.test(this.videoServerUrl)&&(a.browser.name=="ie"&&a.browser.version.minor==11&&(typeof(MediaSource)!="undefined")&&this.playback.type=="auto")){this.videoServerUrl=this.videoServerUrl.replace(/(https?:)(\/\/[^\/]*)(\/[^\/]*)(\/public\/)/g,"https:$2$3$4")}if(/(https:\/\/[^\/]*)\b(\/DMGateway\/(public|private)\/)/.test(this.videoServerUrl)){this.videoServerUrl=this.videoServerUrl.replace(/(https:\/\/[^\/]*)(\/[^\/]*)(\/public\/)/g,"$1$2/public-ssl/");this.videoServerUrl=this.videoServerUrl.replace(/(https:\/\/[^\/]*)(\/[^\/]*)(\/private\/)/g,"$1$2/private-ssl/")}this.compId=(a.Util.isNull(l)?"":l);this.videoItem=null;this.serverDuration=undefined;this.curMilestone=undefined;this.seekTime=undefined;this.methodCallQueue=[];this.setRequestLoaded=true;this.viewReadyEventSent=false;this.metadataReadyEventSent=false;this.assetSpecificPosterImage=undefined;this.endNotificationSent=false;this.videoCapabilityState=new a.VideoCapabilityState();this.wid=this.size.width;this.hei=this.size.height;if(this.wid==0||this.hei==0){this.wid=parseInt(a.Util.css.getCss("s7videoplayer","width",this.compId,null,this.container));this.hei=parseInt(a.Util.css.getCss("s7videoplayer","height",this.compId,null,this.container));if(!a.Util.isNumber(this.wid)||!a.Util.isNumber(this.hei)||this.wid<=0||this.hei<=0){if("clientHeight" in this.container&&"clientWidth" in this.container){this.wid=this.container.clientWidth;this.hei=this.container.clientHeight}if(this.wid==0||this.hei==0){this.wid=400;this.hei=300}}}this.obj.style.width=this.wid+"px";this.obj.style.height=this.hei+"px";if(("ipad"==a.browser.device.name)||("iphone"==a.browser.device.name)||("android"==a.browser.device.name)){this.autoplay=false}this.clickToPlay=0;if((/play/i).test(this.singleclick)){this.clickToPlay=1}if(this.serverUrl.lastIndexOf("/")!=(this.serverUrl.length-1)){this.serverUrl+="/"}this.attachToContainer();var k=this;this.videoProxy=this.resolveVideoProxy();this.onTogglePauseHandler=function(p){if(window.MouseEvent&&p instanceof MouseEvent){k.togglePause()}};this.onClickHandler=function(p){a.Event.dispatch(k.obj,a.Event.CLICK,false)};this.onTouchEndHandler=function(p){if(window.TouchEvent&&p instanceof TouchEvent){k.ovlInTouch=true}};this.onTouchClickHandler=function(p){if(window.TouchEvent&&p instanceof TouchEvent){if(k.ovlInTouch){k.togglePause()}k.ovlInTouch=false}};if(!((this.playback.controls&&(this.playback.type=="native"||this.playback.type=="auto"))||(a.browser.supportflash()&&this.playback.type=="flash"&&a.browser.name=="chrome"&&a.browser.device.name=="desktop"))){this.divClickElement=document.createElement("div");this.obj.appendChild(this.divClickElement);this.divClickElement.style.width=this.wid+"px";this.divClickElement.style.height=this.hei+"px";this.divClickElement.style.position="absolute";this.divClickElement.style.top="0px";this.divClickElement.style.left="0px";if(a.browser.name=="ie"){if(a.browser.version.minor<9){this.divClickElement.style.backgroundColor="#000";this.divClickElement.style.filter="alpha(opacity=0)"}else{this.divClickElement.style.opacity=0;this.divClickElement.style.filter=""}if(a.browser.version.minor==9||a.browser.version.minor==10){this.divClickElement.style.backgroundColor="#000000"}}}if(this.clickToPlay&&!this.hasNativeControls()&&this.divClickElement){a.Event.addDOMListener(this.divClickElement,"touchend",k.onTouchEndHandler,false);a.Event.addDOMListener(this.obj,"click",k.onTouchClickHandler,false);a.Event.addDOMListener(this.obj,"click",k.onTogglePauseHandler,false)}if(a.browser.supportflash()&&this.playback.type=="flash"&&a.browser.name=="chrome"&&a.browser.device.name=="desktop"&&this.clickToPlay){a.Event.addDOMListener(this.obj,"mouseup",k.onTogglePauseHandler,false)}if(!this.hasNativeControls()){a.Event.addDOMListener(this.obj,"click",k.onClickHandler,false)}this.createIconEffect();var m=unescape(this.asset);if(m!=""&&this.video==""){this.setAsset(m,this.posterimage)}if(this.video!=""){this.setVideo(this.video,this.posterimage)}if(this.posterimage&&this.posterimage!=""){if(this.posterimage.indexOf("?")!=0&&this.posterimage!="none"){this.assetSpecificPosterImage=this.posterimage;this.posterimage=""}else{this.assetSpecificPosterImage=undefined}}this.addEventListener(a.event.CapabilityStateEvent.NOTF_VIDEO_CAPABILITY_STATE,function(p){k.onCapabilityState(p)},false);this.setCaption(this.caption.file);this.setCaptionEnabled(this.caption.enabled);this.setNavigation(this.navigation.file,this.navigation.enabled);this.setInteractiveData(this.interactiveData.file);if(!o){return new a.video.VideoPlayerControl(this)}else{return this}};a.Class.inherits("s7sdk.video.VideoPlayer","s7sdk.UIComponent");a.video.VideoPlayer.prototype.symbols={ERROR:"Your Browser does not support HTML5 Video tag or the video cannot be played."};a.video.VideoPlayer.prototype.setModifier=function(j){throw new Error("Trying to use setModifier on the Core class (VideoPlayer) is unsupported! Please refer to SDK documentation on using setModifier.")};a.video.VideoPlayer.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},videoServerUrl:{params:["value"],defaults:["/is/content/"]},contentUrl:{params:["value"],defaults:["/is/content/"]},size:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"]},asset:{params:["value"],defaults:[""]},autoplay:{params:["enabled"],defaults:[true]},singleclick:{params:["singleclick"],defaults:["playPause"],ranges:[["none","playPause"]]},posterimage:{params:["posterimage"],defaults:[""]},iconEffect:{params:["enabled","count","fade","autoHide"],defaults:[true,1,0.3,3],ranges:[null,"-1:","0:","0:"]},playback:{params:["type","controls"],defaults:["auto",false],ranges:[["auto","native","flash"]]},progressivebitrate:{params:["value"],defaults:[700],ranges:["1:"]},caption:{params:["file","enabled"],defaults:["",false]},navigation:{params:["file","enabled"],defaults:["",true]},interactiveData:{params:["file","enabled"],defaults:["",true]},smoothing:{params:["enabled"],defaults:[false]},initialbitrate:{params:["value"],defaults:[0],ranges:["0:"]},aemmode:{params:["value"],defaults:[false],ranges:[[true,false]]},loop:{params:["enabled"],defaults:[false]},video:{params:["value"],defaults:[""],parseParams:false}};a.video.VideoPlayer.RESTRICTED_STYLES={s7videoplayer:["width","height"],"s7videoplayer s7iconeffect":["width","height"]};a.video.VideoPlayer.prototype.addEventListener=function(l,k,j){this.superproto.addEventListener.apply(this,[l,k,j])};a.video.VideoPlayer.prototype.getCurrentAsset=function(){return this.currentAsset};a.video.VideoPlayer.prototype.setCurrentAsset=function(k,j){this.assetSpecificPosterImage=j;if(typeof(k)=="string"){this.setAsset(k,j)}else{if(this.isReq){this.isReq.cancelHttpReq()}this.currentAsset=k;this.createViewer(k)}};a.video.VideoPlayer.prototype.getCurrentVideo=function(){return this.currentVideo};a.video.VideoPlayer.prototype.setCurrentVideo=function(k,j){this.assetSpecificPosterImage=j;if(typeof(k)=="string"){this.setVideo(k,j)}};a.video.VideoPlayer.prototype.onCapabilityState=function(j){var k=j.s7event.state;if(k.hasCapability(a.VideoCapabilityState.PAUSE)){if(this.iconEffectObj){this.iconEffectObj.hide()}}if(k.hasCapability(a.VideoCapabilityState.PLAY)){if(this.iconEffectObj){this.iconEffectObj.show(this.wid,this.hei);a.Util.css.setCSSAttributeSelector(this.iconEffectObj.obj,"state","play")}}if(k.hasCapability(a.VideoCapabilityState.REPLAY)){if(this.iconEffectObj){this.iconEffectObj.show(this.wid,this.hei);a.Util.css.setCSSAttributeSelector(this.iconEffectObj.obj,"state","replay")}}};a.video.VideoPlayer.prototype.getWidth=function(){return this.wid};a.video.VideoPlayer.prototype.getHeight=function(){return this.hei};a.video.VideoPlayer.prototype.resize=function(j,k){if(j==this.wid&&k==this.hei){return}this.wid=j>0?j:1;this.hei=k>0?k:1;this.videoProxy.resize(this.wid,this.hei);this.obj.style.width=this.wid+"px";this.obj.style.height=this.hei+"px";if(this.divClickElement){this.divClickElement.style.width=this.wid+"px";this.divClickElement.style.height=this.hei+"px"}if(this.iconEffectObj&&this.iconEffectObj.enabled){this.iconEffectObj.centerOverlay(j,k)}if(this.captionContainerDiv){this.obj.removeChild(this.captionContainerDiv);this.captionContainerDiv=undefined}a.UIComponent.prototype.resize.apply(this,[j,k]);a.Logger.log(a.Logger.INFO,"VideoPlayer.resize( %0 %1 )",j,k)};a.video.VideoPlayer.prototype.supportsInline=function(){a.Logger.log(a.Logger.INFO,"VideoPlayer.supportsInline() = %0",!((a.browser.device.name=="android"&&a.browser.device.version<4)||a.browser.device.name=="iphone"));return !((a.browser.device.name=="android"&&a.browser.device.version<4)||a.browser.device.name=="iphone")};a.video.VideoPlayer.prototype.getAsset=function(){var j=(this.videoItem==null?null:this.videoItem.name);a.Logger.log(a.Logger.INFO,"VideoPlayer.getAsset() = %0",j);return j};a.video.VideoPlayer.prototype.invalidateWebVttData=function(){this.captionCues=[];this.invalidateNavigation();this.invalidateInteractiveData()};a.video.VideoPlayer.prototype.setAsset=function(l,j){this.metadataReadyEventSent=false;this.viewReadyEventSent=false;this.setRequestLoaded=false;this.methodCallQueue.splice(0,this.methodCallQueue.length);var k=new a.event.VideoEvent(a.event.VideoEvent.NOTF_CURRENT_TIME,0,true);this.dispatchEvent(k,false);this.invalidateWebVttData();this.assetSpecificPosterImage=j;this.currentAsset=l;this.loadAsset(l);a.Logger.log(a.Logger.INFO,"VideoPlayer.setAsset( %0 )",l+(j?", "+j:""))};a.video.VideoPlayer.prototype.setVideo=function(l,j){this.metadataReadyEventSent=false;this.viewReadyEventSent=false;this.setRequestLoaded=true;this.methodCallQueue.splice(0,this.methodCallQueue.length);var k=new a.event.VideoEvent(a.event.VideoEvent.NOTF_CURRENT_TIME,0,true);this.dispatchEvent(k,false);this.invalidateWebVttData();this.assetSpecificPosterImage=j;this.currentVideo=l;this.videoProxy.setVideo(l);a.Logger.log(a.Logger.INFO,"VideoPlayer.videoName( %0 )",l+(j?", "+j:""))};a.video.VideoPlayer.prototype.setCaption=function(j){this.caption.file=j;this.captionCues=[];if(a.Util.isNonEmptyString(this.caption.file)){this.loadWebVTT()}};a.video.VideoPlayer.prototype.setNavigation=function(j){var k=true;if(arguments.length>1){k=arguments[1]}this.navigation.file=j;this.enableNavigation=k;this.navigationCues=null;if(a.Util.isNonEmptyString(this.navigation.file)){this.loadNavigationWebVTT()}};a.video.VideoPlayer.prototype.setInteractiveData=function(j){var k=true;if(arguments.length>1){k=arguments[1]}this.interactiveData.file=j;this.enableInteractiveData=k;this.interactiveCues=null;this.currentInteractiveDataIndex=-1;if(a.Util.isNonEmptyString(this.interactiveData.file)){this.loadInteractiveDataWebVTT()}};a.video.VideoPlayer.prototype.loadAsset=function(j){a.Logger.log(a.Logger.INFO,"VideoPlayer.loadAsset");var k=this.serverUrl+"/"+a.MediaSetParser.parseAssetForSetReq(j).req;if(a.Util.isNonEmptyString(this.locale)){k+="&locale="+this.locale}if(this.isReq){this.isReq.cancelHttpReq()}this.isReq_=new a.IS(this.serverUrl,j);this.isReq_.getHttpReq(k,function(m,l){a.video.VideoPlayer.prototype.setRequestComplete.apply(l,[m])},function(m,l){a.video.VideoPlayer.prototype.setRequestError.apply(l,[m,j])},this)};a.video.VideoPlayer.prototype.invalidateNavigation=function(){if(this.videoItem){a.Logger.log(a.Logger.INFO,"Invalidate navigation content");var j=new a.event.VideoEvent(a.event.VideoEvent.NOTF_NAVIGATION,null,true);this.dispatchEvent(j,false)}this.navigationCues=null};a.video.VideoPlayer.prototype.loadNavigationWebVTT=function(){var j;if(/^\s*http[s]?:\/\//.test(this.navigation.file)){j=this.navigation.file}else{j=this.contentUrl+"/"+this.navigation.file}j+="?req=CONTENT,json,utf-8";if(this.navigationReq){this.navigationReq.cancelHttpReq()}var k=this;this.navigationReq=new a.IS();this.navigationReq.getHttpReq(j,function(n,l){k.navigationCues=a.common.WebVtt.parse(n,a.common.WebVtt.TYPE_NAVIGATION);var o=(k.enableNavigation)?k.navigationCues:null;var m=new a.event.VideoEvent(a.event.VideoEvent.NOTF_NAVIGATION,o,true);k.dispatchEvent(m,false)},function(l){a.Logger.log(a.Logger.WARNING,"Error loading navigation file: %0",k.navigation.file)},this)};a.video.VideoPlayer.prototype.loadWebVTT=function(){var j;if(/^\s*http[s]?:\/\//.test(this.caption.file)){j=this.caption.file}else{j=this.contentUrl+"/"+this.caption.file}j+="?req=CONTENT,json,utf-8";if(this.captionReq){this.captionReq.cancelHttpReq()}this.captionReq=new a.IS();this.captionReq.getHttpReq(j,function(m,k){var l=a.common.WebVtt.parse(m,a.common.WebVtt.TYPE_CAPTION).getItems();for(i in l){var n=l[i];k.captionCues.push({start:n.start,end:n.end,caption:n.data,settings:n.settings})}k.checkCaptions(k.getCurrentTime())},function(k){a.Logger.log(a.Logger.ERROR,"Error loading caption file: %0",this.caption.file)},this)};a.video.VideoPlayer.prototype.invalidateInteractiveData=function(){if(this.videoItem){a.Logger.log(a.Logger.INFO,"Invalidate interactive data content");var j=new a.event.VideoEvent(a.event.InteractiveDataEvent.NOTF_INTERACTIVE_DATA,null,true);this.dispatchEvent(j,false);this.interactiveDataCues=null;this.interactiveData_=null;this.globalInteractiveDataSegment=null;this.interactiveDataSegments=null}};a.video.VideoPlayer.prototype.loadInteractiveDataWebVTT=function(){var j;if(/^\s*http[s]?:\/\//.test(this.interactiveData.file)){j=this.interactiveData.file}else{j=this.contentUrl+"/"+this.interactiveData.file}j.indexOf("?")==-1?j+="?":j+="&";j+="req=CONTENT,json,utf-8";if(this.interactiveDataReq){this.interactiveDataReq.cancelHttpReq()}var k=this;this.interactiveDataReq=new a.IS();this.interactiveDataReq.getHttpReq(j,function(m,l){k.setInteractiveDataCues(a.common.WebVtt.parse(m,a.common.WebVtt.TYPE_METADATA))},function(l){a.Logger.log(a.Logger.WARNING,"Error loading interactive data file: %0",k.interactiveData.file)},this)};a.video.VideoPlayer.prototype.setInteractiveDataCues=function(r){var q=this;q.interactiveDataCues=r;q.interactiveData_=null;var p=(q.enableInteractiveData)?q.interactiveDataCues:null;if(p&&p.items){q.interactiveData_=[];q.globalInteractiveDataSegment=null;var j=-1;var k=-1;var s=-1;for(var o=0;o<p.items.length;o++){var l=Number(p.items[o].start),n=Number(p.items[o].end);if(j==-1){j=l;k=n;if(p.items[o].data.hasOwnProperty("properties")){a.Logger.log(a.Logger.FINE,"global segment: %0 --> %1",l,n);s=q.interactiveData_.length;q.globalInteractiveDataSegment=p.items[o]}}else{if(l<j){j=l}if(n>=k){k=n;if(l==j&&p.items[o].data.hasOwnProperty("properties")){a.Logger.log(a.Logger.FINE,"global segment: %0 --> %1",l,n);q.globalInteractiveDataSegment=p.items[o];s=q.interactiveData_.length}}if(q.globalInteractiveDataSegment&&(Number(q.globalInteractiveDataSegment.start)!=j||Number(q.globalInteractiveDataSegment.end)!=k)){s=-1;q.globalInteractiveDataSegment=null}}a.Logger.log(a.Logger.FINE,"Cue["+o+"]: "+p.items[o]);q.interactiveData_.push(p.items[o].data)}function t(u){p.items.splice(u,1);q.interactiveData_.splice(u,1)}if(s!=-1){a.Logger.log(a.Logger.FINE,"Remove global InteractiveData WebVTT segment[%0]",s);t(s)}for(var o=q.interactiveData_.length-1;o>=0;o--){if(!q.interactiveData_[o].swatches){a.Logger.log(a.Logger.FINE,"Remove InteractiveData WebVTT segment[%0] that does not have swatches",o);t(o)}}}q.processInteractiveData(-1);var m=new a.event.InteractiveDataEvent(a.event.InteractiveDataEvent.NOTF_INTERACTIVE_DATA,{properties:q.getInteractiveDataProperties(),interactiveData:q.getInteractiveData()},true);q.dispatchEvent(m,false)};a.video.VideoPlayer.prototype.processInteractiveData=function(m){if(m!=-1&&!m){a.Logger.log(a.Logger.SEVERE,"Invalid number of visible interactive data elements: %0",count);return}this.interactiveDataVisible=m;if(!this.interactiveDataCues){a.Logger.log(a.Logger.WARNING,"Interactive data uninitialized");return}function u(C,B){if(C&&C instanceof Object){return C[B]}return null}var r=this.interactiveDataCues;this.interactiveDataSegments=[];var o=0;var p;for(var x=0;x<r.items.length;x++){var A=r.items[x];a.Logger.log(a.Logger.INFO,"Cue["+x+"]: "+A);var s=u(u(u(A,"data"),"swatches"),"item");if(!s){a.Logger.log(a.Logger.WARNING,"Ignore InteractiveData WebVTT segment[%0] that does not have swatches",x);continue}if(m==-1||s.length<m){this.interactiveDataSegments.push({start:A.start,end:A.end,index:o})}else{var w=Math.ceil(s.length/m);var j=Number(A.end)-Number(A.start);var t=Math.ceil(j/w),l=j,k=Math.ceil(s.length/w);var z=s.length;var q=Number(A.start),n;var p=o;var y=o+s.length-m;for(var v=0;v<w;v++){if(z<=m){n=Number(A.end)}else{n=q+t}this.interactiveDataSegments.push({start:q,end:n,index:Math.min(p,y)});q=n;p+=k;l-=t;z-=k}}o+=s.length}for(var x=0;x<this.interactiveDataSegments.length;x++){a.Logger.log(a.Logger.FINE,"Interactive data segments[%0]: %1 - %2, %3",x,this.interactiveDataSegments[x].start,this.interactiveDataSegments[x].end,this.interactiveDataSegments[x].index)}};a.video.VideoPlayer.prototype.updateVisibleInterativeData=function(j){if(!j){a.Logger.log(a.Logger.SEVERE,"Invalid number of visible interactive data elements: %0",j);return}this.processInteractiveData(j)};a.video.VideoPlayer.prototype.setRequestComplete=function(k){var p=this.videoItem;var j=k.set;if(j==null){return}var n=a.MediaSetParser.parse(j,"");switch(n.type){case a.ItemDescType.VIDEO_SET:this.createViewer(n);break;case a.ItemDescType.VIDEO:this.createViewer(n.items[0]);break;case a.ItemDescType.VIDEO_GROUP:this.createViewer(n);break;default:throw new Error("parsed media set is of wrong type: "+n.type)}this.setRequestLoaded=true;while(this.methodCallQueue.length>0){var m=this.methodCallQueue[0];this.methodCallQueue.splice(0,1);this[m.func].apply(this,m.args)}if(!this.metadataReadyEventSent){var l=new a.event.StatusEvent(a.event.StatusEvent.NOTF_ASSET_METADATA_READY,true);a.Event.dispatch(this.obj,l,false);this.metadataReadyEventSent=true}if(p!=null){var o=new a.UserEvent(a.UserEvent.SWAP,[0,this.videoItem],true);this.dispatchEvent(o,false)}};a.video.VideoPlayer.prototype.createViewer=function(j){this.videoCapabilityState=new a.VideoCapabilityState();this.endNotificationSent=false;this.setAssetInternal(j);this.settings.trackLoad(this);this.checkCaptions(this.getCurrentTime());var l=new a.UserEvent(this.autoplay?a.UserEvent.PLAY:a.UserEvent.PAUSE,this.videoProxy.getCurrentTime(),true);this.dispatchEvent(l,false);var k=new a.event.AssetEvent(a.event.AssetEvent.ASSET_CHANGED,j,this.getIndexFromItem(j),true);this.dispatchEvent(k)};a.video.VideoPlayer.prototype.getIndexFromItem=function(m){if(m.parent!=null){var l=-1;var k=m.parent.items;for(var j=0;j<k.length;j++){if(k[j].name==m.name){l=j;break}}return l}else{return 0}};a.video.VideoPlayer.prototype.createIconEffect=function(){if(this.clickToPlay&&!this.hasNativeControls()){this.iconEffectObj=new a.IconEffect(this,this.iconEffect.enabled,this.iconEffect.count,this.iconEffect.fade,this.iconEffect.autoHide);if(this.autoplay){this.iconEffectObj.hide()}}};a.video.VideoPlayer.prototype.hasNativeControls=function(){if(a.browser.supportflash()&&this.playback.type=="flash"){return false}else{if((a.browser.device.name=="android"&&a.browser.device.version<4)||this.playback.controls){return true}else{return false}}};a.video.VideoPlayer.prototype.setCaptionEnabled=function(j){var k=!this.enableCaptions&&j&&this.videoProxy.paused();this.enableCaptions=j;if(!this.enableCaptions){if(this.currentCaption){this.hideCaption();this.currentCaption=null}}else{if(k&&this.videoProxy){this.checkCaptions(this.videoProxy.getCurrentTime())}}};a.video.VideoPlayer.prototype.getCaptionEnabled=function(){return this.enableCaptions};a.video.VideoPlayer.prototype.checkCaptions=function(k){if(this.captionCues.length==0){return}if(!this.enableCaptions){return}var j=this.findCaption(k);if(this.currentCaption&&j&&this.currentCaption.start==j.start){return}this.currentCaption=j;if(j){this.showCaption(j.caption,j.settings)}else{this.hideCaption()}};a.video.VideoPlayer.prototype.showCaption=function(r,l){if(!this.captionContainerDiv){this.captionContainerDiv=document.createElement("div");this.captionContainerDiv.style.position="absolute";this.captionContainerDiv.style.visibility="hidden";this.captionContainerDiv.style.overflow="hidden";if(this.iconEffectObj.hiddenState_){this.obj.appendChild(this.captionContainerDiv)}else{this.obj.insertBefore(this.captionContainerDiv,this.iconEffectObj.iconEffectDiv_)}this.captionDiv=document.createElement("div");this.captionDiv.className="s7caption";this.captionDiv.style.visibility="hidden";this.captionContainerDiv.appendChild(this.captionDiv);this.captionDiv.style.position="relative";this.captionDiv.style.display="table"}else{this.captionDiv.style.visibility="hidden"}this.captionContainerDiv.style.width=this.wid+"px";this.captionDiv.innerText=r;this.captionDiv.textContent=r;var p=this.captionDiv.offsetHeight;var n=this.captionDiv.offsetWidth;var q,k,j;if(l.vertical=="rl"){q=Math.round((100-parseInt(l.lineSize))/2);this.captionContainerDiv.style.top=q+"%";this.captionContainerDiv.style.height=l.lineSize;this.captionContainerDiv.style.left=l.linePosition}else{if(l.vertical=="lr"){q=Math.round((100-parseInt(l.lineSize))/2);this.captionContainerDiv.style.top=q+"%";this.captionContainerDiv.style.height=l.lineSize;k=(100-parseInt(l.linePosition));this.captionContainerDiv.style.left=k+"%"}else{n=Math.min(Math.round(parseInt(l.lineSize)*this.wid/100),n);this.captionContainerDiv.style.width=n+"px";n=this.captionDiv.offsetWidth;k=Math.round(((parseInt(l.textPosition)/100)*this.wid)-n/2);k=k<0?0:k;if((k+n)>this.wid){k=this.wid-n}this.captionContainerDiv.style.left=k+"px";p=this.captionDiv.offsetHeight;var o=(p/this.hei)*100;if(l.linePosition){if(l.linePosition.indexOf("%")>0){var m=parseInt(l.linePosition);q=m-(o)/2;j=m+o;if(o>100){q=0}else{if(q<0){q=0}else{if(j>100){if(o>100){q=0}else{q=100-o}}}}if((o+q)>100){o=100-q}this.captionContainerDiv.style.top=q+"%"}else{this.captionContainerDiv.style.bottom=(p*(l.linePosition-1))+"px"}this.captionContainerDiv.style.height=o+"%"}else{if(o>85){this.captionContainerDiv.style.top="0"}else{this.captionContainerDiv.style.top=(85-o)+"%"}this.captionContainerDiv.style.bottom="15%"}}}if(l.vertical=="rl"){this.captionDiv.style.writingMode="tb-rl"}else{if(l.vertical=="lr"){this.captionDiv.style.writingMode="tb-rl"}}if(l.textAlign=="left"){this.captionDiv.style.textAlign="left"}else{if(l.textAlign=="right"){this.captionDiv.style.textAlign="right"}else{if(l.textAlign=="middle"){this.captionDiv.style.textAlign="center"}}}this.captionDiv.style.visibility="inherit";this.captionContainerDiv.style.visibility="inherit"};a.video.VideoPlayer.prototype.hideCaption=function(){if(this.captionContainerDiv){this.captionDiv.style.visibility="hidden";this.captionContainerDiv.visibility="hidden";this.captionDiv.innerText="";this.captionDiv.textContent=""}};a.video.VideoPlayer.prototype.findCaption=function(k){var j=a.video.VideoPlayer.findWebVttIndex(this.captionCues,k);if(j!=-1){return this.captionCues[j]}return null};a.video.VideoPlayer.findWebVttIndex=function(n,p,o){if(n){var l=0;var m=-1;for(var k=0;k<n.length;k++){var j=n[k];if(!j){continue}var q=Number(j.start);if(q<=p){if(p<=Number(j.end)){return k}if(q>l){l=q;m=k}}}if(o){return m}}return -1};a.video.VideoPlayer.prototype.getNavigation=function(){return this.navigationCues};a.video.VideoPlayer.prototype.getNavigationEnabled=function(){return this.enableNavigation};a.video.VideoPlayer.prototype.getInteractiveData=function(){return this.interactiveData_};a.video.VideoPlayer.prototype.getInteractiveDataProperties=function(){return(this.globalInteractiveDataSegment&&this.globalInteractiveDataSegment.data)?this.globalInteractiveDataSegment.data.properties:null};a.video.VideoPlayer.prototype.checkInteractiveData=function(o,n){if(!this.interactiveDataSegments||this.interactiveDataSegments.length==0){return}if(!this.enableInteractiveData){return}var m=this;var j=a.video.VideoPlayer.findWebVttIndex(this.interactiveDataSegments,o);if(j==-1&&n){var l=a.video.VideoPlayer.findWebVttIndex(this.interactiveDataSegments,o,n);if(this.currentInteractiveDataIndex!=l){this.currentInteractiveDataIndex=l;k(l)}}if(this.currentInteractiveDataIndex==j){return}this.currentInteractiveDataIndex=j;k(j);function k(p){var r=p==-1?-1:m.interactiveDataSegments[p].index;a.Logger.log(a.Logger.INFO,"Interactive segment %0, swatch %1",p,r);var q=new a.event.InteractiveDataEvent(a.event.InteractiveDataEvent.NOTF_ACTIVE_INTERACTIVE_DATA_UPDATED,r,true);m.dispatchEvent(q,false)}};a.video.VideoPlayer.prototype.getInteractiveDataEnabled=function(){return this.enableInteractiveData};a.video.VideoPlayer.prototype.resolveVideoProxy=function(){var k;if(a.browser.device.name=="iphone"){k=this.buildIphoneVideoProxy()}else{if((a.browser.supportflash()&&this.playback.type=="flash")&&(a.browser.device.name!=="android")&&!((a.browser.name=="safari")&&(a.browser.device.name=="desktop")&&(a.browser.version.minor>6))){k=this.buildFlashVideoProxy()}else{if(this.playback.type=="auto"&&((a.browser.name=="firefox"&&a.browser.version.minor>=45)||(a.browser.name=="ie"&&a.browser.version.minor==11&&(typeof(MediaSource)!="undefined"))||(a.browser.device.name=="desktop"&&a.browser.name=="chrome"))&&!(/^((http|https):\/\/[^\/]*)\b(\/DMGateway\/(private-ssl|private)\/)/.test(this.videoServerUrl))){k=this.buildHLSVideoProxy()}else{k=this.buildHTML5VideoProxy()}}}var j=this;k.onCurrentTime=function(){var n=j.videoProxy.getCurrentTime();j.checkCaptions(n);j.checkInteractiveData(n);if(!j.endNotificationSent){j.checkTimingEvents()}j.checkState();if(!j.endNotificationSent){var l=new a.event.VideoEvent(a.event.VideoEvent.NOTF_CURRENT_TIME,j.videoProxy.getCurrentTime(),true);j.dispatchEvent(l,false);if(j.pendingStopNotification||j.videoProxy.ended()){j.pendingStopNotification=false;var o=new a.UserEvent(a.UserEvent.STOP,j.videoProxy.getCurrentTime(),true);j.dispatchEvent(o,false)}if(j.videoProxy.ended()){j.endNotificationSent=true;var m=new a.event.VideoEvent(a.event.VideoEvent.NOTF_VIDEO_END,j.videoProxy.getCurrentTime(),true);j.dispatchEvent(m,false)}}};k.onDuration=function(){j.checkState();var m=new a.event.UserEvent(a.UserEvent.METADATA,["DURATION",j.videoProxy.getDuration()],true);j.dispatchEvent(m,false);var l=new a.event.VideoEvent(a.event.VideoEvent.NOTF_DURATION,j.videoProxy.getDuration(),true);j.dispatchEvent(l,false)};k.onLoadProgress=function(){j.checkState();var l=new a.event.VideoEvent(a.event.VideoEvent.NOTF_LOAD_PROGRESS,j.videoProxy.getLoadedPosition(),true);j.dispatchEvent(l,false)};k.onVolume=function(){j.checkState();var l=new a.event.VideoEvent(a.event.VideoEvent.NOTF_VOLUME,j.videoProxy.getVolume(),true);j.dispatchEvent(l,false)};k.onSeeked=function(){var n=j.videoProxy.getCurrentTime();if(n!=j.videoProxy.getDuration()){if(j.videoProxy.paused()&&j.iconEffectObj){j.iconEffectObj.show(this.wid,this.hei)}}if(n!=this.seekTime){var o=new a.event.VideoEvent(a.event.VideoEvent.NOTF_SEEK,j.videoProxy.getCurrentTime(),true);j.dispatchEvent(o,false);var m=new a.event.UserEvent(a.UserEvent.METADATA,["SEEK",j.videoProxy.getCurrentTime()],true);j.dispatchEvent(m,false)}this.seekTime=j.videoProxy.getCurrentTime();var l=new a.event.VideoEvent(a.event.VideoEvent.NOTF_CURRENT_TIME,this.seekTime,true);j.dispatchEvent(l,false)};k.onStateChange=function(){j.checkState()};k.onViewReady=function(){if(!j.viewReadyEventSent){var l=new a.event.StatusEvent(a.event.StatusEvent.NOTF_VIEW_READY,true);a.Event.dispatch(j.obj,l,false)}j.viewReadyEventSent=true};return k};a.video.VideoPlayer.prototype.resolvePosterUrl=function(k){var l=(this.assetSpecificPosterImage!=undefined)?this.assetSpecificPosterImage:this.posterimage;var m="";if(l==""||l.indexOf("?")==0){m=l;if(this.aemmode){l=k.name}else{if(k.hasOwnProperty("image")&&k.image){l=a.video.VideoPlayer.parseMovieUrl(k.image.name)}else{l=a.video.VideoPlayer.parseMovieUrl(k.name)}}}var j=null;if(l!=null&&l!=""&&l!="none"){var n=(l.indexOf("?")>=0)?"&":"?";if(m!=""){if(m.indexOf("?")==0){n=m}else{n+=m}n+="&"}n+="fit=constrain,1&wid="+this.wid+"&hei="+this.hei;j=l+n}return j};a.video.VideoPlayer.prototype.buildHTML5VideoProxy=function(){return new a.video.HTML5VideoProxy(this.obj,this.wid,this.hei,this.serverUrl,this.videoServerUrl,this.autoplay,this.playback,this.progressivebitrate,this.loop,this.getLocalizedText("ERROR"),this.aemmode)};a.video.VideoPlayer.prototype.buildIphoneVideoProxy=function(){return new a.video.IPhoneProxy(this.obj,this.wid,this.hei,this.serverUrl,this.videoServerUrl,this.autoplay,this.playback,this.progressivebitrate,this.loop,this.getLocalizedText("ERROR"),this.aemmode)};a.video.VideoPlayer.prototype.buildFlashVideoProxy=function(){return new a.video.FlashVideoProxy(this.obj,(this.compId!="")?this.compId+"_"+a.Util.createUniqueId():"flashVideo_"+a.Util.createUniqueId(),this.wid,this.hei,this.serverUrl,this.videoServerUrl,this.autoplay,this.playback,this.progressivebitrate,this.smoothing,this.initialbitrate,this.loop,this.aemmode)};a.video.VideoPlayer.prototype.buildHLSVideoProxy=function(){return new a.video.HLSVideoProxy(this.obj,this.wid,this.hei,this.serverUrl,this.videoServerUrl,this.autoplay,this.playback,this.progressivebitrate,this.initialbitrate,this.loop,this.getLocalizedText("ERROR"),this.aemmode)};a.video.VideoPlayer.prototype.setRequestError=function(j){a.Logger.log(a.Logger.ERROR,"setRequestError %0",j)};a.video.VideoPlayer.prototype.setAssetInternal=function(j){this.videoItem=j;this.serverDuration=a.video.VideoPlayer.getDurationFromItem(j);this.videoProxy.serverDuration=this.serverDuration;if(!a.Util.isNull(this.serverDuration)){var k=new a.event.VideoEvent(a.event.VideoEvent.NOTF_DURATION,this.serverDuration,true);this.dispatchEvent(k,false)}this.videoProxy.setAsset(j,this.resolvePosterUrl(j))};a.video.VideoPlayer.prototype.setItem=function(k){a.Logger.log(a.Logger.INFO,"VideoPlayer.setItem( %0 )",k);if(this.isReq){this.isReq.cancelHttpReq()}if(!((k instanceof a.VideoDesc&&k.type==a.ItemDescType.VIDEO)||(k instanceof a.MediaSetDesc&&(k.type==a.ItemDescType.VIDEO_SET)||k.type==a.ItemDescType.VIDEO_GROUP))){throw new Error("Item must be a video!")}this.currentAsset=k;if(this.asset!=""){this.assetSpecificPosterImage=undefined}var j=new a.event.VideoEvent(a.event.VideoEvent.NOTF_CURRENT_TIME,0,true);this.dispatchEvent(j,false);this.invalidateWebVttData();this.createViewer(k);this.asset="";if(!this.metadataReadyEventSent){var l=new a.event.StatusEvent(a.event.StatusEvent.NOTF_ASSET_METADATA_READY,true);a.Event.dispatch(this.obj,l,false);this.metadataReadyEventSent=true}};a.video.VideoPlayer.prototype.getVolume=function(){if(this.supportsVolumeControl()){return this.videoProxy.getVolume()}else{return 1}};a.video.VideoPlayer.prototype.setVolume=function(j){if(this.supportsVolumeControl()){this.videoProxy.setVolume(j);this.checkState()}};a.video.VideoPlayer.prototype.getCurrentTime=function(){return this.videoProxy.getCurrentTime()};a.video.VideoPlayer.prototype.getLoadedPosition=function(){return this.videoProxy.getLoadedPosition()};a.video.VideoPlayer.prototype.getDuration=function(){if(!a.Util.isNull(this.videoProxy.getDuration())){return this.videoProxy.getDuration()}else{if(!a.Util.isNull(this.serverDuration)){return this.serverDuration}else{return undefined}}};a.video.VideoPlayer.prototype.getCapabilityState=function(){a.Logger.log(a.Logger.INFO,"VideoPlayer.getCapabilityState() = %0 ",this.videoCapabilityState);return this.videoCapabilityState};a.video.VideoPlayer.prototype.checkState=function(){var j=this.videoCapabilityState;this.videoCapabilityState=new a.VideoCapabilityState();if(this.videoProxy.paused()&&!this.videoProxy.ended()){this.videoCapabilityState.setCapability(a.VideoCapabilityState.PLAY);if(this.videoProxy.getCurrentTime()>0){this.videoCapabilityState.setCapability(a.VideoCapabilityState.STOP)}}if(!this.videoProxy.paused()&&!this.videoProxy.ended()){if(((a.browser.name=="chrome")||((a.browser.name=="safari")&&(a.browser.version.minor==6)))&&(a.browser.device.name=="desktop")&&this.divClickElement){this.divClickElement.style.opacity=0;this.divClickElement.style.opacity=1}this.videoCapabilityState.setCapability(a.VideoCapabilityState.PAUSE);this.videoCapabilityState.setCapability(a.VideoCapabilityState.STOP)}this.videoProxy.muted()?this.videoCapabilityState.setCapability(a.VideoCapabilityState.UNMUTE):this.videoCapabilityState.setCapability(a.VideoCapabilityState.MUTE);if(this.videoProxy.ended()){this.videoCapabilityState.setCapability(a.VideoCapabilityState.REPLAY)}if((j==null)||(j.state!=this.videoCapabilityState.state)){this.dispatchEvent(new a.event.CapabilityStateEvent(a.event.CapabilityStateEvent.NOTF_VIDEO_CAPABILITY_STATE,this.videoCapabilityState))}};a.video.VideoPlayer.prototype.ended=function(){return this.videoProxy.ended()};a.video.VideoPlayer.prototype.supportsFullScreen=function(){return this.videoProxy.supportsFullScreen()};a.video.VideoPlayer.prototype.enterFullScreen=function(){return this.videoProxy.enterFullScreen()};a.video.VideoPlayer.prototype.play=function(){if(!this.setRequestLoaded){this.fillMethodQueue("play");return}if(!this.videoProxy.ended()){this.videoProxy.play();this.currentInteractiveDataIndex=-1;var j=this.videoProxy.getCurrentTime();this.checkInteractiveData(j,true);var k=new a.UserEvent(a.UserEvent.PLAY,j,true);this.dispatchEvent(k,false);this.endNotificationSent=false}};a.video.VideoPlayer.prototype.pause=function(){if(!this.setRequestLoaded){this.fillMethodQueue("pause");return}this.videoProxy.pause();var j=new a.UserEvent(a.UserEvent.PAUSE,this.videoProxy.getCurrentTime(),true);this.dispatchEvent(j,false)};a.video.VideoPlayer.prototype.stop=function(){if(!this.setRequestLoaded){this.fillMethodQueue("stop");return}this.videoProxy.pause();this.videoProxy.seek(0);this.pendingStopNotification=true};a.video.VideoPlayer.prototype.togglePause=function(){if(this.videoCapabilityState!=null){if(this.videoCapabilityState.hasCapability(a.VideoCapabilityState.PLAY)||this.videoCapabilityState.hasCapability(a.VideoCapabilityState.REPLAY)){var j=this.getDuration()-this.getCurrentTime();if(j<=1){this.seek(0)}this.play()}else{if(this.videoCapabilityState.hasCapability(a.VideoCapabilityState.PAUSE)){this.pause()}}}};a.video.VideoPlayer.prototype.seek=function(k){if(!this.setRequestLoaded){this.fillMethodQueue("seek",[k]);return}this.videoProxy.seek(k);var j=this.getCurrentTime();if(!a.Util.isNumber(j)){j=k}this.checkInteractiveData(j,true);this.endNotificationSent=false};a.video.VideoPlayer.prototype.muted=function(){if(this.supportsVolumeControl()){return this.videoProxy.muted()}else{return false}};a.video.VideoPlayer.prototype.mute=function(){if(this.supportsVolumeControl()){this.videoProxy.mute(true);this.checkState()}};a.video.VideoPlayer.prototype.unmute=function(){if(this.supportsVolumeControl()){this.videoProxy.mute(false);this.checkState()}};a.video.VideoPlayer.prototype.checkTimingEvents=function(){var j=this.videoProxy.getDuration();if(a.Util.isNull(j)||j==0){return}var l=a.Util.isNull(this.videoProxy.getCurrentTime())?0:this.videoProxy.getCurrentTime();l=25*Math.floor((l*4)/j);if(l!=this.curMilestone){this.curMilestone=l;var k=new a.UserEvent(a.UserEvent.MILESTONE,this.curMilestone,true);this.dispatchEvent(k,false)}};a.video.VideoPlayer.prototype.fillMethodQueue=function(k,j){this.methodCallQueue.push({func:k,args:j})};a.video.VideoPlayer.parseMovieUrl=function(k){var j=null;if(k){j=k.replace(/[\\]/g,"/");ar=j.split(/\.(mp4|f4v|flv|webm)/i);if(ar.length>1){j=ar[0]}ar=j.split(":");if(ar.length>1){j=ar[1]}ar=j.split("/");j=ar.length>1?ar[0]+"/"+ar[ar.length-1]:j}return j};a.video.VideoPlayer.prototype.supportsVolumeControl=function(){var j=true;if(("ipad"==a.browser.device.name)||("iphone"==a.browser.device.name)||("android"==a.browser.device.name)){j=false}return j};a.video.VideoPlayer.prototype.setCSS=function(l,k,j){if(this.isRestrictedCSSProperty(a.video.VideoPlayer.RESTRICTED_STYLES,k)){throw new Error("You cannot set "+l+" : "+k+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[l,k,j])}};a.video.VideoPlayer.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};a.video.VideoPlayer.prototype.cleanUp=function(){if(this.videoProxy&&this.videoProxy.hlsjsLoadTimer){clearTimeout(this.videoProxy.hlsjsLoadTimer);this.videoProxy.hlsjsLoadTimer=null}if(this.isReq_){this.isReq_.cancelHttpReq();this.isReq_=null}if(this.navigationReq){this.navigationReq.cancelHttpReq();this.navigationReq=null}if(this.captionReq){this.captionReq.cancelHttpReq();this.captionReq=null}if(this.interactiveDataReq){this.interactiveDataReq.cancelHttpReq();this.interactiveDataReq=null}this.methodCallQueue.splice(0,this.methodCallQueue.length);if(this.iconEffectObj){this.iconEffectObj.dispose();this.iconEffectObj=null}if(this.videoProxy){this.videoProxy.dispose()}if(this.obj){a.Event.removeDOMListener(this.obj,"click",this.onClickHandler,false);a.Event.removeDOMListener(this.obj,"click",this.onTogglePauseHandler,false);a.Event.removeDOMListener(this.obj,"touchend",this.onTouchEndHandler,false);a.Event.removeDOMListener(this.obj,"click",this.onTouchClickHandler,false)}a.Util.removeTags(this.obj);this.obj.style.cssText=""};a.video.VideoPlayer.getDurationFromItem=function(k){if(k.type==a.ItemDescType.VIDEO_SET){var j=k.items[0];if(j.userData&&j.userData.Video_Length){return parseFloat(j.userData.Video_Length)*1000}else{if((j.userData instanceof Array)&&j.userData[0].Video_Length){return parseFloat(j.userData[0].Video_Length)*1000}}}else{if(k.userData&&k.userData.Video_Length){return parseFloat(k.userData.Video_Length)*1000}else{if((k.userData instanceof Array)&&k.userData[0].Video_Length){return parseFloat(k.userData[0].Video_Length)*1000}}}return undefined};a.video.VideoPlayer.prototype.setHLSLevel=function(j){this.videoProxy.setHLSLevel(j)};a.VideoPlayer=a.video.VideoPlayer;(function d(){var m=a.Util.css.createCssRuleText;var l=a.Util.css.createCssImgUrlText;var k=a.browser&&a.browser.name=="ie"&&a.browser.version.major>=10;var j=m(".s7videoplayer",{position:"absolute",width:"400px",height:"300px","background-color":"#000000","-webkit-touch-callout":"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-ms-touch-action":k?"none":"","touch-action":k?"none":""})+m(".s7videoplayer div[role='button']",{position:"relative","z-index":"1"})+m(".s7videoplayer .s7iconeffect",{width:"120px",height:"120px","-webkit-transform":"translateZ(0px)","background-repeat":"no-repeat","background-position":"center"})+m(".s7videoplayer .s7iconeffect[state='play']",{"background-image":l("videoplayicon.png")})+m(".s7videoplayer .s7iconeffect[state='replay']",{"background-image":l("videoreplayicon.png")})+m(".s7videoplayer .s7videoposter",{top:"0px",left:"0px",position:"absolute","background-repeat":"no-repeat","background-position":"center center","background-size":"contain"})+m(".s7videoplayer .s7caption",{"font-family":"sans-serif","font-size":"large",color:"#ffffff","-webkit-transform":"translateZ(0px)",margin:"0 auto"})+m(".s7videoplayer .vjs-caption-settings",{display:"none"})+m(".s7videoplayer .vjs-big-play-button",{display:"none"})+m(".s7videoplayer .vjs-poster",{position:"relative"})+m(".s7videoplayer .vjs-error-display",{display:"none"});a.Util.css.addDefaultCSS(j,"VideoPlayer")})()}if(!a.video.FlashVideoProxy){a.video.FlashVideoProxy=function b(m,A,l,n,w,v,r,s,k,p,j,y,z){a.Logger.log(a.Logger.INFO,"FlashVideoProxy constructor");this.viewerReady=false;this.seekPosition=0;this.aemmode=z;var t=a.Util.lib.root.substring(0,a.Util.lib.root.lastIndexOf("/js"));if(t!=""){t+="/"}t+="flash/VideoPlayer.swf";var o=document.URL.indexOf("https://")==0?"https":"http";var u="videoserverurl="+v+"&serverurl="+w+"&autoplay="+r+"&stagesize="+l+","+n+"&smoothing="+p+"&initialbitrate="+j+"&loop="+y+"&streaming=true&singleclick=none&namespacePrefix="+a.namespacePrefix;var q='<object style="max-width:none; max-height:none;"	classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+o+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0"  width="'+l+'" height="'+n+'" 	id="'+A+'" name = "'+A+'" align="middle"> ';q+=' <param name="allowScriptAccess" value="always" />';q+='<PARAM NAME="movie" VALUE="'+t+'" />';q+='<PARAM NAME="flashVars" value="'+u+'"/>';q+='<PARAM NAME="quality" VALUE="high" />';q+='<PARAM NAME="bgcolor" VALUE="#ffffff" />';q+='<PARAM NAME="wmode" VALUE="transparent" />';q+='<PARAM NAME="allowScriptAccess" VALUE="always" />';q+='<PARAM NAME="allowFullScreen" value="true" />';q+=' <embed type="application/x-shockwave-flash"';q+=' pluginspage="http://www.adobe.com/go/getflashplayer"';q+=' name="'+A+'"';q+=' id="'+A+'"';q+=' allowScriptAccess="always"';q+=' quality="high"';q+=' bgcolor="#ffffff"';q+=' width="'+l+'"';q+=' height="'+n+'"';q+=' wmode="transparent"';q+=' allowFullScreen="true"';q+=' src="'+t+'"';q+=' flashVars="'+u+'">';q+=" </embed>";q+=" </object>";m.innerHTML=q;this.callQueue=[];this.flash=a.video.FlashVideoProxy.getSWF(A);var x=this;this.flash.onCurrentTimeUpdate=function(B){x.onCurrentTime()};this.flash.onDurationUpdate=function(B){x.onDuration()};this.flash.onLoadProgressUpdate=function(B){x.onLoadProgress()};this.flash.onVolumeUpdate=function(B){x.onVolume()};this.flash.onSeekUpdate=function(B){x.onSeeked()};this.flash.onCapabilityStateUpdate=function(B){x.onStateChange()};this.flash.onViewerReady=function(){x.viewerReady=true;while(x.callQueue.length>0){var B=x.callQueue[0];x.callQueue.splice(0,1);x.flash[B.func].apply(x.flash,B.args)}};this.flash.onViewReadyUpdate=function(B){x.onViewReady()};this.playback=s;this.progressivebitrate=k*1024};a.video.FlashVideoProxy.VIDEO_POLLING_RATE=100;a.video.FlashVideoProxy.prototype.setAsset=function(k,j){this.seekPosition=0;var l=a.MediaSetParser.resolveVideoAsset(k,this.playback,this.progressivebitrate,this.aemmode,this.videoServerUrl);this.protectedCall("setAsset",[l,j])};a.video.FlashVideoProxy.prototype.setVideo=function(k,j){this.seekPosition=0;this.protectedCall("setVideo",[k,j])};a.video.FlashVideoProxy.prototype.getVolume=function(){if(this.viewerReady){return this.flash.getVolume()}else{return 1}};a.video.FlashVideoProxy.prototype.setVolume=function(j){if(this.viewerReady){if(this.flash.muted()){this.mute(false)}}this.protectedCall("setVolume",[j])};a.video.FlashVideoProxy.prototype.mute=function(j){this.protectedCall("muteVideo",[j])};a.video.FlashVideoProxy.prototype.muted=function(){if(this.viewerReady){return this.flash.muted()}else{return false}};a.video.FlashVideoProxy.prototype.getLoadedPosition=function(){if(this.viewerReady){return this.flash.getLoadedPosition()}else{return 0}};a.video.FlashVideoProxy.prototype.getDuration=function(){if(this.viewerReady&&!isNaN(this.flash.getDuration())){return this.flash.getDuration()}else{return undefined}};a.video.FlashVideoProxy.prototype.ended=function(){if(this.viewerReady){if(isNaN(this.flash.getDuration())){return this.flash.ended()}else{var j=Math.max(this.seekPosition,this.flash.getCurrentTime());return j>=this.flash.getDuration()}}else{return false}};a.video.FlashVideoProxy.prototype.getWidth=function(){return this.inWidth};a.video.FlashVideoProxy.prototype.getHeight=function(){return this.inHeight};a.video.FlashVideoProxy.prototype.resize=function(j,k){this.protectedCall("resize",[j,k]);this.flash.style.width=j+"px";this.flash.style.height=k+"px";this.flash.width=j;this.flash.height=k};a.video.FlashVideoProxy.prototype.play=function(){this.protectedCall("playVideo",[])};a.video.FlashVideoProxy.prototype.paused=function(){if(this.viewerReady){return this.flash.paused()}else{return false}};a.video.FlashVideoProxy.prototype.pause=function(){this.protectedCall("pauseVideo",[])};a.video.FlashVideoProxy.prototype.getCurrentTime=function(){if(this.viewerReady){return this.flash.getCurrentTime()}else{return 0}};a.video.FlashVideoProxy.prototype.seek=function(j){this.seekPosition=j;this.protectedCall("seekVideo",[j])};a.video.FlashVideoProxy.prototype.dispose=function(){};a.video.FlashVideoProxy.prototype.setHLSLevel=function(j){};a.video.FlashVideoProxy.prototype.onLoadProgress=function(){};a.video.FlashVideoProxy.prototype.onCurrentTime=function(){};a.video.FlashVideoProxy.prototype.onDuration=function(){};a.video.FlashVideoProxy.prototype.onSeeked=function(){};a.video.FlashVideoProxy.prototype.onVolume=function(){};a.video.FlashVideoProxy.prototype.onStateChange=function(){};a.video.FlashVideoProxy.prototype.onViewReady=function(){};a.video.FlashVideoProxy.getSWF=function(j){var k=navigator.userAgent.toLowerCase();if(k.indexOf("gecko")!=-1){return document.embeds[j]}else{if(a.browser.name=="ie"){return document.getElementById(j)}else{return window[j]}}};a.video.FlashVideoProxy.prototype.protectedCall=function(k,j){if(this.viewerReady){this.flash[k].apply(this.flash,j)}else{this.callQueue.push({func:k,args:j})}}}if(!a.video.BaseVideoProxy){a.video.BaseVideoProxy=function h(s,o,r,j,t,l,k,n,m,p,q){this.serverUrl=j;this.aemmode=q;this.videoServerUrl=t;this.curTime=undefined;this.bufTime=undefined;this.serverDuration=undefined;this.videoDuration=undefined;this.fallbackmessage=p;this.volume=1;this.mutedValue=false;this.playback=k;this.progressivebitrate=n*1024;this.width=o;this.height=r;this.callQueue=[];this.proxyIsReady=false;this.loop=m;this.inContainer=s;this.inAutoPlay=l;this.isDisposed=false;this.firstAsset=true;this.videoElement=null;this.createVideoElement()};a.video.BaseVideoProxy.prototype.createVideoElement=function(){if(this.videoElement){this.curTime=0;this.bufTime=0;this.serverDuration=0;this.videoDuration=0;this.inContainer.removeChild(this.videoElement);this.videoElement=null}this.videoElement=a.Util.createObj(null,"video",null,null);this.videoElement.volume=this.volume;this.videoElement.muted=this.mutedValue;this.videoElement.style.position="absolute";this.resize(this.width,this.height);this.videoElement.preload="auto";if(a.browser.name=="ie"){this.videoElement.preload="none"}this.inContainer.insertBefore(this.videoElement,this.inContainer.firstChild);if(this.inAutoPlay){this.videoElement.autoplay=true}if(this.playback.controls){this.videoElement.controls=true}else{if(("ipad"==a.browser.device.name)||(("blackberry"==a.browser.device.name)&&(a.browser.device.version==10))){this.videoElement.setAttribute("webkit-playsinline",1)}}if(this.loop){this.videoElement.loop=true}this.addVideoElementEventListeners()};a.video.BaseVideoProxy.prototype.addVideoElementEventListeners=function(){var j=this;a.Event.addDOMListener(this.videoElement,"timeupdate",function(){if(j.isDisposed){return}var k=j.curTime;j.curTime=j.videoElement.currentTime;if(j.videoElement.ended&&(j.videoDuration!=j.curTime)){j.curTime=j.videoDuration}if(k!=j.curTime){j.onCurrentTime()}},true);a.Event.addDOMListener(this.videoElement,"loadstart",function(){if(j.isDisposed){return}j.onLoadProgress()},true);a.Event.addDOMListener(this.videoElement,"loadedmetadata",function(){if(j.isDisposed){return}if(!j.videoWidth&&!j.videoHeight){j.videoWidth=this.videoWidth;j.videoHeight=this.videoHeight;j.resize(j.getWidth(),j.getHeight())}j.proxyIsReady=true;while(j.callQueue.length>0){var k=j.callQueue[0];j.callQueue.splice(0,1);j[k.func].apply(j,k.args)}j.onLoadProgress()},true);a.Event.addDOMListener(this.videoElement,"progress",function(){if(j.isDisposed){return}j.onLoadProgress()},true);a.Event.addDOMListener(this.videoElement,"durationchange",function(){if(j.isDisposed){return}var k=j.videoElement.duration;if(("android"==a.browser.device.name)&&(4==a.browser.device.version)&&(j.videoElement.readyState<4)){return}if((a.browser.name=="safari")&&(j.serverDuration)&&((k==Math.floor(j.serverDuration))||(k==Math.ceil(j.serverDuration)))){k=j.serverDuration}if(k!=j.videoDuration){j.videoDuration=k;j.onDuration()}},true);a.Event.addDOMListener(this.videoElement,"volumechange",function(){if(j.isDisposed){return}j.onVolume()},true);a.Event.addDOMListener(this.videoElement,"seeked",function(){if(j.isDisposed){return}j.onSeeked()},true);a.Event.addDOMListener(this.videoElement,"play",function(){if(j.isDisposed){return}j.onStateChange()},true);a.Event.addDOMListener(this.videoElement,"pause",function(){if(j.isDisposed){return}j.onStateChange()},true);a.Event.addDOMListener(this.videoElement,"ended",function(){if(j.isDisposed){return}if(j.videoDuration!=j.curTime){j.curTime=j.videoDuration;j.onCurrentTime()}j.onStateChange()},true);a.Event.addDOMListener(this.videoElement,"loadeddata",function(){if(j.isDisposed){return}j.onViewReady()},true)};a.video.BaseVideoProxy.prototype.getVolume=function(){return this.videoElement.volume};a.video.BaseVideoProxy.prototype.setVolume=function(j){if(this.videoElement.muted){this.mutedValue=this.videoElement.muted=false}this.volume=j;this.videoElement.volume=j};a.video.BaseVideoProxy.prototype.mute=function(j){this.mutedValue=this.videoElement.muted=j};a.video.BaseVideoProxy.prototype.muted=function(){return this.videoElement.muted};a.video.BaseVideoProxy.prototype.getLoadedPosition=function(){return((this.videoElement.buffered&&this.videoElement.buffered.length>0)?this.videoElement.buffered.end(0)*1000:0)};a.video.BaseVideoProxy.prototype.getDuration=function(){if(a.Util.isNull(this.videoDuration)){return undefined}else{return this.videoDuration*1000}};a.video.BaseVideoProxy.prototype.ended=function(){return this.videoElement.ended};a.video.BaseVideoProxy.prototype.supportsFullScreen=function(){if(("ipad"==a.browser.device.name)||("safari"==a.browser.name)||("chrome"==a.browser.name)){return this.videoElement.webkitSupportsFullscreen}if("firefox"==a.browser.name){return document.mozFullScreenEnabled}return false};a.video.BaseVideoProxy.prototype.enterFullScreen=function(){if(this.supportsFullScreen()){if("firefox"==a.browser.name){this.videoElement.mozRequestFullScreen()}if(this.videoElement.webkitSupportsFullscreen){this.videoElement.webkitEnterFullScreen()}}};a.video.BaseVideoProxy.prototype.getWidth=function(){return this.width};a.video.BaseVideoProxy.prototype.getHeight=function(){return this.height};a.video.BaseVideoProxy.prototype.play=function(){this.videoElement.play()};a.video.BaseVideoProxy.prototype.paused=function(){return this.videoElement.paused};a.video.BaseVideoProxy.prototype.pause=function(){this.videoElement.pause()};a.video.BaseVideoProxy.prototype.getCurrentTime=function(){return this.curTime*1000};a.video.BaseVideoProxy.prototype.dispose=function(){if(this.videoElement){this.videoElement.pause();this.videoElement.src="";this.videoElement.load()}this.isDisposed=true};a.video.BaseVideoProxy.prototype.resize=function(k,l){var j,m;this.width=k;this.height=l;if(this.videoHeight&&this.videoWidth){j=k*this.videoHeight/this.videoWidth;if(j>l){m=this.videoWidth*l/this.videoHeight;j=l}else{m=k}}else{j=l;m=k}this.videoElement.width=m*a.browser.device.pixelratio;this.videoElement.height=j*a.browser.device.pixelratio;this.videoElement.style.width=m+"px";this.videoElement.style.height=j+"px";this.videoElement.style.left=(k-m)/2+"px";this.videoElement.style.top=(l-j)/2+"px"};a.video.BaseVideoProxy.prototype.seek=function(k){if(!this.proxyIsReady){this.fillMethodQueue("seek",[k]);return}var j=(!this.videoElement.paused);this.videoElement.currentTime=k/1000;this.curTime=k/1000;if((a.browser.device.name=="ipad")&&(a.browser.device.version==6)&&k==0){if(j){this.videoElement.play()}}};a.video.BaseVideoProxy.prototype.onLoadProgress=function(){};a.video.BaseVideoProxy.prototype.onCurrentTime=function(){};a.video.BaseVideoProxy.prototype.onDuration=function(){};a.video.BaseVideoProxy.prototype.onSeeked=function(){};a.video.BaseVideoProxy.prototype.onVolume=function(){};a.video.BaseVideoProxy.prototype.onStateChange=function(){};a.video.BaseVideoProxy.prototype.onViewReady=function(){};a.video.BaseVideoProxy.prototype.fillMethodQueue=function(k,j){this.callQueue.push({func:k,args:j})}}if(!a.video.HTML5VideoProxy){a.video.HTML5VideoProxy=function g(s,o,r,j,t,l,k,n,m,p,q){a.Logger.log(a.Logger.INFO,"HTML5VideoProxy constructor");arguments.callee.superclass.apply(this,[s,o,r,j,t,l,k,n,m,p,q])};a.Class.inherits("s7sdk.video.HTML5VideoProxy","s7sdk.video.BaseVideoProxy");a.video.HTML5VideoProxy.prototype.setVideo=function(k,j){this.callQueue.splice(0,this.callQueue.length);this.proxyIsReady=false;var o;if(this.firstAsset){this.firstAsset=false}else{this.createVideoElement()}var n=this;if(j!=null){this.videoElement.poster=this.serverUrl+j;var m=new Image();a.Event.addDOMListener(m,"load",function(){n.onViewReady()},true);m.src=this.serverUrl+j}while(this.videoElement.firstChild){this.videoElement.removeChild(this.videoElement.firstChild)}var l=document.createElement("p");l.innerHTML=this.fallbackmessage;this.videoElement.appendChild(l);var p=document.createElement("source");p.src=k;this.videoElement.appendChild(p);this.resize(this.width,this.height)};a.video.HTML5VideoProxy.prototype.setAsset=function(k,j){this.callQueue.splice(0,this.callQueue.length);this.proxyIsReady=false;this.serverDuration=a.video.VideoPlayer.getDurationFromItem(k)/1000;if(this.serverDuration){this.videoDuration=this.serverDuration}var q=a.MediaSetParser.resolveVideoAsset(k,this.playback,this.progressivebitrate,this.aemmode,this.videoServerUrl);if(k.items){this.videoWidth=k.items[0].width;this.videoHeight=k.items[0].height}else{if(k.width){this.videoWidth=k.width;this.videoHeight=k.height}}if(this.firstAsset){this.firstAsset=false}else{this.createVideoElement()}var o=this;if(j!=null){this.videoElement.poster=this.serverUrl+j;var n=new Image();a.Event.addDOMListener(n,"load",function(){o.onViewReady()},true);n.src=this.serverUrl+j}var m;if(a.Util.isArray(q)){m=[];for(i=0;i<q.length;i++){m[i]=a.Util.resolveURL(this.videoServerUrl,q[i])}}else{m=a.Util.resolveURL(this.videoServerUrl,q)}while(this.videoElement.firstChild){this.videoElement.removeChild(this.videoElement.firstChild)}var l=document.createElement("p");l.innerHTML=this.fallbackmessage;this.videoElement.appendChild(l);var p;if(a.Util.isArray(m)){for(i=0;i<m.length;i++){p=document.createElement("source");p.src=m[i];this.videoElement.appendChild(p)}}else{p=document.createElement("source");p.src=m;this.videoElement.appendChild(p)}this.resize(this.width,this.height)};a.video.HTML5VideoProxy.prototype.setHLSLevel=function(j){}}if(!a.video.IPhoneProxy){a.video.IPhoneProxy=function f(s,o,r,j,t,l,k,n,m,p,q){a.Logger.log(a.Logger.INFO,"IPhoneProxy constructor");arguments.callee.superclass.apply(this,[s,o,r,j,t,l,k,n,m,p,q]);this.createPosterElement(o,r)};a.Class.inherits("s7sdk.video.IPhoneProxy","s7sdk.video.BaseVideoProxy");a.video.IPhoneProxy.prototype.createVideoElement=function(){if(this.videoElement){this.inContainer.removeChild(this.videoElement);this.videoElement=null}this.videoElement=a.Util.createObj(null,"video",null,null);this.videoElement.style.position="absolute";this.videoElement.style.width="1px";this.videoElement.style.height="1px";var j=document.createElement("p");j.innerHTML=this.fallbackmessage;this.videoElement.appendChild(j);if(this.loop){this.videoElement.loop=true}this.inContainer.insertBefore(this.videoElement,this.inContainer.firstChild);this.addVideoElementEventListeners()};a.video.IPhoneProxy.prototype.createPosterElement=function(j,k){if(this.divPosterElement){this.inContainer.removeChild(this.divPosterElement)}this.divPosterElement=a.Util.createObj(null,"div",null,null);this.divPosterElement.className="s7videoposter";this.divPosterElement.style.width=j+"px";this.divPosterElement.style.height=k+"px";this.inContainer.insertBefore(this.divPosterElement,this.videoElement)};a.video.IPhoneProxy.prototype.setAsset=function(l,j){var o=a.MediaSetParser.resolveVideoAsset(l,this.playback,this.progressivebitrate,this.aemmode,this.videoServerUrl);this.serverDuration=a.video.VideoPlayer.getDurationFromItem(l)/1000;if(this.serverDuration){this.videoDuration=this.serverDuration}if(this.firstAsset){this.firstAsset=false}else{this.createPosterElement(this.width,this.height);this.createVideoElement()}var k=this;a.Event.addDOMListener(this.videoElement,"webkitendfullscreen",function(p){k.onStateChange()},false);if(j!=null){this.divPosterElement.style.backgroundImage="url('"+this.serverUrl+j+"')"}var m;if(a.Util.isArray(o)){m=[];for(i=0;i<o.length;i++){m[i]=a.Util.resolveURL(this.videoServerUrl,o[i])}}else{m=a.Util.resolveURL(this.videoServerUrl,o)}while(this.videoElement.firstChild){this.videoElement.removeChild(this.videoElement.firstChild)}var n;if(a.Util.isArray(m)){for(i=0;i<m.length;i++){n=document.createElement("source");n.src=m[i];this.videoElement.appendChild(n)}}else{n=document.createElement("source");n.src=m;this.videoElement.appendChild(n)}this.resize(this.width,this.height);this.videoElement.load()};a.video.IPhoneProxy.prototype.getVolume=function(){return 1};a.video.IPhoneProxy.prototype.setVolume=function(j){};a.video.IPhoneProxy.prototype.mute=function(j){};a.video.IPhoneProxy.prototype.setHLSLevel=function(j){};a.video.IPhoneProxy.prototype.resize=function(j,k){this.width=j;this.height=k;this.divPosterElement.style.width=j+"px";this.divPosterElement.style.height=k+"px"};a.video.IPhoneProxy.prototype.seek=function(j){this.videoElement.currentTime=j/1000}}if(!a.video.HLSVideoProxy){a.video.HLSVideoProxy=function c(u,q,t,j,v,l,k,n,p,m,r,s){a.Util.require("s7sdk.video.hls");arguments.callee.superclass.apply(this,[u,q,t,j,v,l,k,n,m,r,s]);a.Logger.log(a.Logger.INFO,"HLSVideoProxy constructor");this.hlsPlayer=null;this.mediaResource=null;this.videoView=null;this.initialbitrate=p*1024;var o=this;this.loadHlsJsAndCreatePlayer=function(){if(a.Hls){o.createHLSPlayer();clearTimeout(o.hlsjsLoadTimer);o.hlsjsLoadTimer=null}else{if(o.hlsjsLoadTimer){clearTimeout(o.hlsjsLoadTimer);o.hlsjsLoadTimer=null}o.hlsjsLoadTimer=setTimeout(o.loadHlsJsAndCreatePlayer,100)}};this.loadHlsJsAndCreatePlayer()};a.Class.inherits("s7sdk.video.HLSVideoProxy","s7sdk.video.BaseVideoProxy");a.video.HLSVideoProxy.prototype.createHLSPlayer=function(l){if(this.hlsPlayer){this.curTime=0;this.bufTime=0;this.serverDuration=0;this.videoDuration=0;this.hlsPlayer.destroy();this.hlsPlayer=null;delete this.hlsPlayer}var j={fragLoadingTimeOut:60000,maxBufferSize:30*1000*1000};this.hlsPlayer=new a.Hls(j);this.hlsPlayer.on(a.Hls.Events.MEDIA_ATTACHED,function(){a.Logger.log(a.Logger.FINE,"HLSVideoProxy: Hls.Events.MEDIA_ATTACHED - Media attached !")});this.hlsPlayer.on(a.Hls.Events.MANIFEST_LOADING,function(m,n){a.Logger.log(a.Logger.FINE,"HLSVideoProxy: Hls.Events.MANIFEST_LOADING Manifest=%0",n.url)});this.hlsPlayer.on(a.Hls.Events.MANIFEST_LOADED,function(m,n){a.Logger.log(a.Logger.FINE,"HLSVideoProxy: Hls.Events.MANIFEST_LOADED Manifest data levels=%0",n.levels.length)});this.hlsPlayer.on(a.Hls.Events.MANIFEST_PARSED,function(n,o){a.Logger.log(a.Logger.FINE,"HLSVideoProxy: Hls.Events.MANIFEST_PARSED Found %0 quality levels",o.levels.length);for(var m=0;m<o.levels.length;m++){a.Logger.log(a.Logger.FINE,"HLSVideoProxy: * %0 quality level  bitrate=%1",m,o.levels[m].bitrate)}});this.hlsPlayer.on(a.Hls.Events.LEVEL_SWITCH,function(m,n){a.Logger.log(a.Logger.FINE,"HLSVideoProxy: Hls.Events.LEVEL_SWITCH Level switched! Current level =%0",n.level)});this.hlsPlayer.on(a.Hls.Events.FRAG_CHANGED,function(m,n){a.Logger.log(a.Logger.FINE,"HLSVideoProxy: Hls.Events.FRAG_CHANGED Fragment changed! Current fragment number =%0; fragment's level =%1; fragment's url =%2",n.frag.sn,n.frag.level,n.frag.url)});this.hlsPlayer.on(a.Hls.Events.FRAG_LOADING,function(m,n){a.Logger.log(a.Logger.FINE,"HLSVideoProxy: Hls.Events.FRAG_LOADING Fragment loading! Current fragment number =%0; fragment's level =%1; fragment's url =%2",n.frag.sn,n.frag.level,n.frag.url)});this.hlsPlayer.on(a.Hls.Events.FRAG_LOADED,function(m,n){a.Logger.log(a.Logger.FINE,"HLSVideoProxy: Hls.Events.FRAG_LOADED Fragment loaded! Current fragment number =%0; fragment's level =%1; fragment's url =%2; length=%3",n.frag.sn,n.frag.level,n.frag.url,n.stats.length)});this.hlsPlayer.on(a.Hls.Events.FRAG_PARSING_METADATA,function(m,n){a.Logger.log(a.Logger.FINE,"HLSVideoProxy: Hls.Events.FRAG_PARSING_METADATA Parsing id3 is completed! Demuxer id =%0",n.id)});this.hlsPlayer.on(a.Hls.Events.FRAG_PARSING_DATA,function(m,n){a.Logger.log(a.Logger.FINE,"HLSVideoProxy: Hls.Events.FRAG_PARSING_DATA Parsing id3 is completed! Number of samples =%0; type  =%1;  PTS of first sample =%2; PTS of last sample =%2; DTS of first sample =%4; DTS of last sample =%5",n.nb,n.type,n.startPTS,n.endPTS,n.startDTS,n.endDTS)});while(this.callQueue.length>0){var k=this.callQueue[0];this.callQueue.splice(0,1);this[k.func].apply(this,k.args)}};a.video.HLSVideoProxy.prototype.setVideo=function(k,j){this.callQueue.splice(0,this.callQueue.length);this.proxyIsReady=false;var n;if(this.firstAsset){this.firstAsset=false}else{this.createHLSPlayer()}var m=this;if(j!=null){this.videoElement.poster=this.serverUrl+j;var l=new Image();a.Event.addDOMListener(l,"load",function(){m.onViewReady()},true);l.src=this.serverUrl+j}else{this.videoElement.poster=""}if(this.hlsPlayer){this.hlsPlayer.startLevel=e(k,this.initialbitrate);this.hlsPlayer.attachMedia(this.videoElement);this.hlsPlayer.loadSource(k)}else{this.fillMethodQueue("setVideo",[k,j])}this.resize(this.width,this.height)};function e(m,l){if(m!=null&&m.items){var q=m.items;if(typeof(q.filter)!="undefined"){q=q.filter(function(s,t,r){return r.map(function(u){return u.bitrate}).indexOf(s.bitrate)===t})}if(q.length>1){q.sort(function(s,r){return s.bitrate-r.bitrate});var p=0;var o=false;for(var j=q.length-1;j>0;j--){var k=q[j];if(k.bitrate<=l){p=j;o=true;break}}var n=o?p:0;return n}}else{return -1}}a.video.HLSVideoProxy.prototype.setAsset=function(k,j){this.callQueue.splice(0,this.callQueue.length);this.proxyIsReady=false;if(!this.videoElement){this.createVideoElement()}if(this.firstAsset){this.firstAsset=false}else{this.createHLSPlayer()}var o=a.MediaSetParser.resolveVideoAsset(k,this.playback,this.progressivebitrate,this.aemmode,this.videoServerUrl);var n=a.Util.resolveURL(this.videoServerUrl,o);if(this.hlsPlayer){this.hlsPlayer.startLevel=e(k,this.initialbitrate);this.hlsPlayer.streamController.fragBitrateTest=true;this.hlsPlayer.loadSource(n);this.hlsPlayer.attachMedia(this.videoElement)}else{this.fillMethodQueue("setAsset",[k,j])}var m=this;if(j!=null){this.videoElement.poster=this.serverUrl+j;var l=new Image();a.Event.addDOMListener(l,"load",function(){m.onViewReady()},true);l.src=this.serverUrl+j}else{this.videoElement.poster=""}this.resize(this.width,this.height)};a.video.HLSVideoProxy.prototype.dispose=function(){if(this.hlsPlayer){this.hlsPlayer.destroy()}this.superclass.prototype.dispose.apply(this)};a.video.HLSVideoProxy.prototype.setHLSLevel=function(j){if(this.hlsPlayer){this.hlsPlayer.loadLevel=j}}}})(s7getCurrentNameSpace());