/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.image");b.Util.require("s7sdk.common.Thumb");b.Util.require("s7sdk.common.Geometry");if(!b.image.ImageMapEffectControl){b.image.ImageMapEffectControl=function(e){arguments.callee.superclass.apply(this,[e,b.image.ImageMapEffectControl.NS,e.constructor,b.image.ImageMapEffect.RESTRICTED_STYLES])};b.image.ImageMapEffectControl.NS="s7sdk.image.ImageMapEffectControl";b.image.ImageMapEffectControl.prototype.rebuild=function(h){var e=this.component.itemIndex_;var g=this.component.mediaSet_;var f=this.getOverlaysVisible();this.superproto.rebuild.apply(this,[h]);this.component.mediaSet_=g;if(g.items&&g.items[e]){if(!g.items[e].mapsuppressed){this.component.setCurrentIndex(e)}else{this.component.retrieveImageMap(g.items[e])}}this.setOverlaysVisible(f)}}b.Class.inherits(b.image.ImageMapEffectControl.NS,"s7sdk.ControlComponent");if(!b.image.ImageMapEffect){b.image.ImageMapEffect=function ImageMapEffect(f,h,g){this.fadeTimer=null;var i=!!arguments[3];b.Logger.log(b.Logger.CONFIG,"s7sdk.image.ImageMapEffect constructor - containerId: %0, settings: %1 , compId: %2",f,h,g);g=(typeof g=="string"&&g.length)?g:"ImageMapEffect_"+b.Util.createUniqueId();arguments.callee.superclass.apply(this,[g,f,"div","s7imagemapeffect",h,!i]);if(this.serverUrl.lastIndexOf("/")!=(this.serverUrl.length-1)){this.serverUrl+="/"}this.container=this.getParent();var j=this.container?this.container.s7base:null;if(b.browser&&b.browser.name=="ie"&&b.browser.version.major<=8){this.mode="icon"}if(this.mode=="auto"){this.mode=b.browser.supportsTouch()?"icon":"region"}if(b.browser.supportsTouch()){this.rollover=false}var e=0;e|=this.mode=="region"?b.image.ImageMapEffect.OVERLAY_FLAG:0;e|=this.mode=="icon"?b.image.ImageMapEffect.ICON_FLAG:0;e|=this.mode=="mixed"?b.image.ImageMapEffect.MIXED_FLAG:0;e|=b.browser.supportsTouch()?b.image.ImageMapEffect.ALWAYS_ACTIVE_FLAG:0;e|=this.mapTips==true?b.image.ImageMapEffect.TOOLTIP_FLAG:0;this.create(j,this.serverUrl,e,this.rollover==true);if(!i){return new b.image.ImageMapEffectControl(this)}else{return this}};b.Class.inherits("s7sdk.image.ImageMapEffect","s7sdk.UIComponent");b.image.ImageMapEffect.RESTRICTED_STYLES={"s7imagemapeffect s7icon":["width","height"],"s7imagemapeffect s7region":["background","background-color","border-left","border-right","border-top","border-bottom","border-width","border-color","border"],};b.image.ImageMapEffect.prototype.setCSS=function(g,f,e){if(this.isRestrictedCSSProperty(b.image.ImageMapEffect.RESTRICTED_STYLES,f)){throw new Error("You cannot set "+g+" : "+f+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[g,f,e])}};b.image.ImageMapEffect.prototype.setModifier=function(e){throw new Error("Trying to use setModifier on the Core class (ImageMapEffect) is unsupported! Please refer to SDK documentation on using setModifier.")};b.image.ImageMapEffect.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};b.image.ImageMapEffect.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},rollover:{params:["rollover"],defaults:[true]},mapTips:{params:["maptips"],defaults:[false]},mode:{params:["value"],defaults:["icon"],ranges:[["region","icon","auto","none","mixed"]]}};b.image.ImageMapEffect.ICON_FLAG=1;b.image.ImageMapEffect.OVERLAY_FLAG=2;b.image.ImageMapEffect.ALWAYS_ACTIVE_FLAG=4;b.image.ImageMapEffect.TOOLTIP_FLAG=8;b.image.ImageMapEffect.MIXED_FLAG=16;b.image.ImageMapEffect.prototype.create=function(j,e,f,i,h){this.flags_=f;this.target_=null;this.linkedOverlayMap_=null;this.serverUrl_=e;this.itemIndex_=-1;this.mapOverlays_=null;this.overlayContainer_=null;this.destroyed_=false;this.overlaysVisible_=true;this.mediaSet_=null;this.rollover_=i;this.createElement();this.obj.style.position="absolute";this.obj.style.top="0px";this.obj.style.left="0px";var g=this;this.__targetZoomRegion=function(k){g.targetZoomRegion(k)};this.__targetAssetChanged=function(k){g.targetAssetChanged(k)};this.__targetItemSelected=function(k){g.targetAssetChanged(k)};this.__transitionStart=function(k){g.transitionStart(k)};this.__transitionEnd=function(k){g.transitionEnd(k)};this.__tgtMouseDownHandler=function(k){g.tgtMouseMapHandler(k,0)};this.__tgtMouseMoveHandler=function(k){g.tgtMouseMapHandler(k,1)};this.__tgtMouseUpHandler=function(k){g.tgtMouseMapHandler(k,2)};if(j!=null){this.attachToView(j)}};b.image.ImageMapEffect.prototype.addEventListener=function(g,f,e){b.Logger.log(b.Logger.FINE,"s7sdk.image.ImageMapEffect.addEventListener - type: %0, handler: %1, useCapture: %2",g,f.toString().substring(0,f.toString().indexOf("(")),e);b.Base.prototype.addEventListener.apply(this,[g,f,e])};b.image.ImageMapEffect.prototype.attachToView=function(e){if(e!==this.target_){if(this.target_){this.detachFromView(this.target_)}this.target_=e;if(e){if((this.flags_&b.image.ImageMapEffect.OVERLAY_FLAG)>0||(this.flags_&b.image.ImageMapEffect.MIXED_FLAG)>0){if(window.PointerEvent&&b.browser.name==="ie"){this.target_.addEventListener("pointerdown",this.__tgtMouseDownHandler,true);this.target_.addEventListener("pointerup",this.__tgtMouseUpHandler,true);this.target_.addEventListener("pointermove",this.__tgtMouseMoveHandler,true)}else{this.target_.addEventListener("mousedown",this.__tgtMouseDownHandler,true);this.target_.addEventListener("mouseup",this.__tgtMouseUpHandler,true);this.target_.addEventListener("mousemove",this.__tgtMouseMoveHandler,true)}this.target_.addEventListener("touchstart",this.__tgtMouseDownHandler,true);this.target_.addEventListener("touchend",this.__tgtMouseUpHandler,true);this.target_.addEventListener("touchmove",this.__tgtMouseMoveHandler,true)}this.target_.addEventListener(b.event.ZoomRgnEvent.NOTF_ZOOM_RGN,this.__targetZoomRegion,false);this.target_.addEventListener(b.event.AssetEvent.ASSET_CHANGED,this.__targetAssetChanged,false);this.target_.addEventListener(b.event.AssetEvent.ITEM_SELECTED_EVENT,this.__targetItemSelected,false);this.target_.addEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_START,this.__transitionStart,false);this.target_.addEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_END,this.__transitionEnd,false);this.target_.obj.appendChild(this.obj)}}};b.image.ImageMapEffect.prototype.fixEvent=function(g){if(!g){g=window.event}var f=null;if(g.target){f=(g.target.nodeType==3)?g.target.parentNode:g.target}else{f=g.srcElement}g.targetNode=f;if(!g.touches){g.touches=[{pageX:g.pageX||g.clientX+(document&&document.scrollLeft||document.body&&document.body.scrollLeft||0)-(document&&document.clientLeft||document.body&&document.body.clientLeft||0),pageY:g.pageY||g.clientY+(document&&document.scrollTop||document.body&&document.body.scrollTop||0)-(document&&document.clientTop||document.body&&document.body.clientTop||0)}]}if(!g.preventDefault){g.preventDefault=function(){g.returnValue=false}}if(!g.stopPropagation){g.stopPropagation=function(){g.cancelBubble=true}}return g};b.image.ImageMapEffect.prototype.tgtMouseMapHandler=function(v,z){if(this.mapOverlays_&&this.mapOverlays_.length&&this.overlaysVisible_){this.fixEvent(v);var m,l;switch(z){case 2:if(!this.touch||!this.touch.start){return}m=this.touch.start.x;l=this.touch.start.y;break;case 1:this.touch={isMove:false};default:if(v.touches.length!=1){return}m=v.touches[0].pageX;l=v.touches[0].pageY}var g=m;var j=l;if(this.overlayContainer_.displayElement){var h=b.Util.getObjPos(this.overlayContainer_.displayElement);g=m-h.x;j=l-h.y}var r=this.reverseTransformPoint(new b.Point2D(g,j));var q=-1;var f=-1;var u;for(var s=0;s<this.mapOverlays_.length;s++){u=this.mapOverlays_[s];if(u.isOver){f=s;if(b.browser.device.name=="desktop"&&u.toolTip_){u.toolTip_.mouseMoveHandler(v)}}if(u.checkMousePoint(r.x,r.y)&&q==-1){q=s;u.isOver=true}else{u.isOver=false}}if(q!=f&&b.browser.device.name=="desktop"){var o=this.overlayContainer_.displayElement.getContext("2d");o.save();o.clearRect(0,0,this.overlayContainer_.getWidth(),this.overlayContainer_.getHeight());o.restore();if(this.lastShowing!=-1){u=this.mapOverlays_[this.lastShowing];var k=u.getBounds();if(this.rollover==true){var n=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.ROLLOVER_DEACTIVATED,u.mapDesc_.rolloverKey,k);this.overlayRolloverEvent(n)}this.lastShowing=-1;if(b.browser.device.name=="desktop"&&u.toolTip_){u.toolTip_.rollOutHandler(v)}}if(q!=-1){u=this.mapOverlays_[q];u.showShape();var p=this.getLinkedOverlays(u);for(var s=0;s<p.length;s++){var w=p[s];if(w!=u){var t=w.isOver;w.isOver=true;if(w.shape){w.showShape()}w.isOver=t}}var k=u.getBounds();if(this.rollover==true){var n=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.ROLLOVER_ACTIVATED,u.mapDesc_.rolloverKey,k);this.overlayRolloverEvent(n)}if(b.browser.device.name=="desktop"&&u.toolTip_){u.toolTip_.rollOverHandler(v)}this.lastShowing=q}}for(var s=0;s<this.mapOverlays_.length;s++){u=this.mapOverlays_[s];if(u.isOver){switch(z){case 0:this.touch={start:{x:m,y:l}};this.touch.isMove=false;break;case 1:if(!this.touch){this.touch={}}this.touch.isMove=true;break;case 2:if(!this.touch.isMove&&!this.isIconActivated){u.overlayClickHandler_(v);v.preventDefault();v.stopPropagation()}this.touch=null;break}break}}}};b.image.ImageMapEffect.prototype.targetZoomRegion=function(e){this.updateOverlayCoverage()};b.image.ImageMapEffect.prototype.targetAssetChanged=function(f){var e=f.s7event.asset instanceof b.MediaSetDesc?f.s7event.asset.items[f.s7event.frame]:f.s7event.asset;if(typeof e=="string"){throw new Error("AssetEvent should not be providing a string as the asset, it should be an ItemDesc!")}if(e.parent==null){throw new Error("ItemDesc must be part of a parent set!")}this.mediaSet_=e.parent;if(this.mediaSet_.items&&this.mediaSet_.items[f.s7event.frame]){if(!this.mediaSet_.items[f.s7event.frame].mapsuppressed){this.setCurrentIndex(f.s7event.frame)}else{this.retrieveImageMap(this.mediaSet_.items[f.s7event.frame])}}};b.image.ImageMapEffect.prototype.transitionStart=function(e){if(this.overlayContainer_){this.overlayContainer_.style.visibility="hidden"}};b.image.ImageMapEffect.prototype.transitionEnd=function(e){if(this.overlayContainer_){this.overlayContainer_.style.visibility="inherit"}};b.image.ImageMapEffect.prototype.retrieveImageMap=function(e){if(this.serverUrl_==null||!(e instanceof b.ImageDesc)){b.Logger.log(b.Logger.WARNING,"ImageMapEffectCC.retrieveImageMap Neither serverUrl or image can be null!");return}this.removeOverlaysFromView(true);this.stopRequest();b.Logger.log(b.Logger.INFO,"ImageMapEffectCC.retrieveImageMap Performing map request for image: %0",e.name);var f=this.serverUrl_+e.name;if(f.indexOf("?")==-1){f+="?req=map"}else{f+="&req=map"}f+=",json,utf-8&scl=1";this.isReq_=new b.IS(this.serverUrl_,e.name);this.isReq_.getHttpReq(f,function(h,g){b.ImageMapEffect.prototype.loadCompleteHandler.apply(g,[h])},null,this)};b.image.ImageMapEffect.prototype.loadCompleteHandler=function(f){if(this.destroyed_){return}var e=b.ImageMapUtil.parseMapAreaArray(f);if(this.mediaSet_){var g=[];if(this.mediaSet_.maps){g=g.concat(this.mediaSet_.maps)}if(typeof e!="undefined"&&e instanceof Array){g=g.concat(e)}this.createMapOverlays(g)}else{throw new Error("Internal media-set unknown!")}};b.image.ImageMapEffect.prototype.stopRequest=function(){if(this.isReq_){this.isReq_.cancelHttpReq()}};b.image.ImageMapEffect.prototype.setCurrentIndex=function(e){this.itemIndex_=e;this.stopRequest();if(this.mediaSet_){var g=[];if(this.mediaSet_.maps){g=g.concat(this.mediaSet_.maps)}if(this.mediaSet_.items&&this.mediaSet_.items[e]){var f=this.mediaSet_.items[e];if(typeof f.maps!="undefined"&&f.maps instanceof Array){g=g.concat(f.maps)}}this.createMapOverlays(g)}else{throw new Error("Internal media-set unknown!")}};b.image.ImageMapEffect.prototype.getOverlaysVisible=function(){b.Logger.log(b.Logger.FINE,"s7sdk.image.ImageMapEffect.getOverlaysVisible");return this.overlaysVisible_};b.image.ImageMapEffect.prototype.setOverlaysVisible=function(e){b.Logger.log(b.Logger.FINE,"s7sdk.image.ImageMapEffect.setOverlaysVisible - value: %0",e);this.overlaysVisible_=e;if(e){this.updateOverlayCoverage(true)}else{this.removeOverlaysFromView(false)}};b.image.ImageMapEffect.prototype.updateOverlayCoverage=function(e){e=(typeof e=="undefined")?false:e;if(this.target_&&this.mapOverlays_&&this.mapOverlays_.length&&this.overlaysVisible_){if(!this.overlayContainer_){this.overlayContainer_=this.createOverlayContainer(0,0,0,0)}this.overlayContainer_.setWidth(this.target_.wid);this.overlayContainer_.setHeight(this.target_.hei);if(!this.overlayContainer_.parentNode){this.obj.appendChild(this.overlayContainer_)}for(var g=0;g<this.mapOverlays_.length;g++){var f=this.mapOverlays_[g];f.updateOverlay();if(!f.element_.parentNode||f.element_.parentNode.nodeType!=1){this.overlayContainer_.appendChild(f.element_)}}if(e){this.fadeInOverlays_()}}};b.image.ImageMapEffect.prototype.fadeInOverlays_=function(){var g=this.overlayContainer_;var e=parseFloat(b.Util.css.getCss("s7mapoverlay s7icon","opacity",null,"s7imagemapeffect",this.overlayContainer_,{state:"default"}));function f(){if(!g.currentOpacity_){g.currentOpacity_=0}if(g.currentOpacity_<e){g.currentOpacity_+=0.05/0.5;for(var h=0;h<g.childNodes.length;h++){b.Util.setOpacity(g.childNodes[h],g.currentOpacity_)}this.fadeTimer=setTimeout(f,50)}else{if(b.browser.device.name=="desktop"){for(var h=0;h<g.childNodes.length;h++){if(b.browser.name==="ie"&&b.browser.version.major<=8){g.childNodes[h].style.removeAttribute("filter")}else{g.childNodes[h].style.opacity=""}}}}if(b.browser.device.name=="android"&&b.browser.device.version=="4"){g.style.display="none";var j=g.offsetWidth;g.style.display="block"}}f()};b.image.ImageMapEffect.prototype.removeOverlaysFromView=function(g){g=(typeof g=="undefined")?false:g;if(this.overlayContainer_&&this.overlayContainer_.parentNode){this.overlayContainer_.parentNode.removeChild(this.overlayContainer_)}if(g){this.overlayContainer_=null;if(this.mapOverlays_){for(var f=0;f<this.mapOverlays_.length;f++){var e=this.mapOverlays_[f];e.cleanUp()}this.mapOverlays_=null}}};b.image.ImageMapEffect.prototype.detachFromView=function(e){if((this.flags_&b.image.ImageMapEffect.OVERLAY_FLAG)>0||(this.flags_&b.image.ImageMapEffect.MIXED_FLAG)>0){if(window.PointerEvent&&b.browser.name==="ie"){e.removeEventListener("pointerdown",this.__tgtMouseDownHandler,true);e.removeEventListener("pointerup",this.__tgtMouseUpHandler,true);e.removeEventListener("pointermove",this.__tgtMouseMoveHandler,true)}else{e.removeEventListener("mousedown",this.__tgtMouseDownHandler,true);e.removeEventListener("mouseup",this.__tgtMouseUpHandler,true);e.removeEventListener("mousemove",this.__tgtMouseMoveHandler,true)}e.removeEventListener("touchstart",this.__tgtMouseDownHandler,true);e.removeEventListener("touchend",this.__tgtMouseUpHandler,true);e.removeEventListener("touchmove",this.__tgtMouseMoveHandler,true)}e.removeEventListener(b.event.ZoomRgnEvent.NOTF_ZOOM_RGN,this.__targetZoomRegion,false);e.removeEventListener(b.event.AssetEvent.ASSET_CHANGED,this.__targetAssetChanged,false);e.removeEventListener(b.event.AssetEvent.ITEM_SELECTED_EVENT,this.__targetItemSelected,false);e.removeEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_START,this.__transitionStart,false);e.removeEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_END,this.__transitionEnd,false);if(this.obj.parentElement===e.obj){this.obj.parentElement.removeChild(this.obj)}};b.image.ImageMapEffect.prototype.cleanUp=function(){if(this.isReq_){this.isReq_.cancelHttpReq();this.isReq_=null}if(this.fadeTimer){clearTimeout(this.fadeTimer);this.fadeTimer=null}if(this.target_){this.detachFromView(this.target_);this.target_=null}this.container=null;b.Logger.log(b.Logger.FINE,"s7sdk.image.ImageMapEffect.cleanUp");this.removeOverlaysFromView(true);this.destroyed_=true;if(this.obj){b.Util.removeTags(this.obj);this.obj.style.cssText=""}};b.image.ImageMapEffect.prototype.createMapOverlays=function(f){this.removeOverlaysFromView(true);this.mapOverlays_=[];this.linkedOverlayMap_={};this.lastShowing=-1;for(var i=0;i<f.length;i++){var e=f[i];var h=new b.MapAreaOverlay(this,e,this.flags_,this.rollover_);this.mapOverlays_.push(h);var g;if(e.rolloverKey&&e.rolloverKey.length){g=e.rolloverKey}else{if(e.href&&e.href.length){g=e.href}}if(g){var k=this.linkedOverlayMap_[g];if(!k){k=[];this.linkedOverlayMap_[g]=k}k.push(h)}}function j(m,l){return(m.getArea()==l.getArea())?0:((m.getArea()>l.getArea())?1:-1)}this.mapOverlays_.sort(j);if(this.overlaysVisible_){this.updateOverlayCoverage(true)}};b.image.ImageMapEffect.prototype.createOverlayContainer=function(f,i,g,e){var h=b.image.ImageMapEffect.createSmartDiv(false,((this.flags_&b.image.ImageMapEffect.OVERLAY_FLAG)>0||(this.flags_&b.image.ImageMapEffect.MIXED_FLAG)>0));h.setX(f);h.setY(i);h.setWidth(g);h.setHeight(e);h.style.overflow="hidden";h.style.position="absolute";h.style.pointerEvents="none";h.id=this.id+"_overlayContainer";return h};b.image.ImageMapEffect.createSmartDiv=function(f,e){var g=(f&&typeof f!="undefined")?f:document.createElement("div");if(e&&!g.displayElement){g.displayElement=document.createElement("canvas");g.appendChild(g.displayElement)}g.getX=function(){return g.x_||parseInt(g.style.left)};g.getY=function(){return g.y_||parseInt(g.style.top)};g.getWidth=function(){return g.width_||parseInt(g.style.width)};g.getHeight=function(){return g.height_||parseInt(g.style.height)};g.setX=function(h){g.x_=h;g.style.left=h+"px"};g.setY=function(h){g.y_=h;g.style.top=h+"px"};g.setWidth=function(h){g.width_=h;if(!g.displayElement){g.style.width=h+"px";return}g.displayElement.setAttribute("width",h);g.displayElement.style.width=g.style.width=h+"px"};g.setHeight=function(h){g.height_=h;if(!g.displayElement){g.style.height=h+"px";return}g.displayElement.setAttribute("height",h);g.displayElement.style.height=g.style.height=h+"px"};return g};b.image.ImageMapEffect.prototype.getLinkedOverlays=function(g){var h;if(this.linkedOverlayMap_){var f;var e=g.getMapDesc();if(e.rolloverKey&&e.rolloverKey.length){f=e.rolloverKey}else{if(e.href&&e.href.length){f=e.href}}h=this.linkedOverlayMap_[f]}if(!h){h=[]}return h};b.image.ImageMapEffect.prototype.transformPoint=function(e){return this.target_.imagePixelsToViewPoint(e)};b.image.ImageMapEffect.prototype.reverseTransformPoint=function(e){return this.target_.viewPointToImagePixels(e)};b.image.ImageMapEffect.prototype.getTargetId=function(){return this.target_.obj.id};b.image.ImageMapEffect.prototype.getTargetClassName=function(){return this.target_.obj.className};b.image.ImageMapEffect.prototype.overlayRolloverEvent=function(e){this.dispatchEvent(e)};b.image.ImageMapEffect.prototype.getModifiers=function(){return this.modifiers};(function a(){var h=b.Util.css.createCssRuleText;var g=b.Util.css.createCssImgUrlText;var f=b.browser&&b.browser.name=="ie"&&b.browser.version.major>=10;var e=h(".s7imagemapeffect .s7icon",{width:"50px",height:"50px","background-repeat":"no-repeat","background-position":"center","background-image":g("map_overlay_icon.png"),"z-index":"999",cursor:"pointer","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-ms-touch-action":f?"none":"","touch-action":f?"none":""})+h(".s7imagemapeffect .s7icon[state='default']",{opacity:"0.6",filter:"alpha(opacity = 60)"})+h(".s7imagemapeffect .s7icon[state='active']",{opacity:"1",filter:"alpha(opacity = 100)"})+h(".s7imagemapeffect .s7region",{background:"rgba(0,0,0, 0)",border:"1px solid #000000"});b.Util.css.addDefaultCSS(e,"ImageMapEffect")})()}if(!b.MapAreaOverlay){b.MapAreaOverlay=function c(j,f,g,i){this.overlayManager_=j;this.mapDesc_=f;this.flags_=g;this.iconStyle_="s7mapareaicon";this.rollover_=i;this.active_=false;this.rawShapeInfo_=null;this.prevRect_=null;this.targetClassName_=this.overlayManager_.cl;this.targetId_=this.overlayManager_.id;this.element_=this.createDiv();if(this.mapDesc_.shape==b.MapDescShape.SHAPE_POLY){var h=this.getPoints(this.mapDesc_.coords,false);this.rawShapeInfo_=this.processPolygon(h);if((this.flags_&b.image.ImageMapEffect.OVERLAY_FLAG)>0||((this.flags_&b.image.ImageMapEffect.MIXED_FLAG)>0&&!this.isIcon())){this.createShape(h)}}var e=this;this.__overlayRolloverHandler=function(k){e.overlayRolloverHandler_(k)};this.__overlayClickHandler=function(k){e.overlayClickHandler_(k)};this.__touchHandler=function(k){e.touchHandler_(k)};this.__overlayMouseDownHandler=function(k){e.overlayMouseDownHandler_(k)};if((this.flags_&b.image.ImageMapEffect.ICON_FLAG)!=0||((this.flags_&b.image.ImageMapEffect.MIXED_FLAG)!=0&&this.isIcon())){if(window.PointerEvent&&b.browser.name==="ie"){b.Event.addDOMListener(this.element_,"pointerover",this.__overlayRolloverHandler,false);if(this.rollover_){b.Event.addDOMListener(this.element_,"pointerout",this.__overlayRolloverHandler,false)}b.Event.addDOMListener(this.element_,"pointerdown",this.__overlayMouseDownHandler,true);b.Event.addDOMListener(this.element_,"click",this.__overlayClickHandler,false)}else{b.Event.addDOMListener(this.element_,"mouseover",this.__overlayRolloverHandler,false);if(this.rollover_){b.Event.addDOMListener(this.element_,"mouseout",this.__overlayRolloverHandler,false)}b.Event.addDOMListener(this.element_,"mousedown",this.__overlayMouseDownHandler,false);b.Event.addDOMListener(this.element_,"click",this.__overlayClickHandler,false)}b.Event.addDOMListener(this.element_,"touchstart",this.__touchHandler,false);b.Event.addDOMListener(this.element_,"touchmove",this.__touchHandler,false);b.Event.addDOMListener(this.element_,"touchend",this.__touchHandler,false)}if((this.flags_&b.image.ImageMapEffect.TOOLTIP_FLAG)&&this.mapDesc_.alt&&this.mapDesc_.alt.length){this.toolTip_=new b.SimpleToolTip(this.element_,this.mapDesc_.alt)}if(this.flags_&b.image.ImageMapEffect.ALWAYS_ACTIVE_FLAG){this.setActive(true)}this.focusRect=false;this.prevRect_=new b.Rectangle()};b.MapAreaOverlay.prototype.overlayMouseDownHandler_=function(e){if((this.flags_&b.image.ImageMapEffect.ICON_FLAG)!=0||(this.flags_&b.image.ImageMapEffect.MIXED_FLAG)!=0){this.overlayManager_.isIconActivated=true;b.image.ImageMapEffect.prototype.fixEvent(e);e.preventDefault();e.stopPropagation()}};b.MapAreaOverlay.prototype.touchHandler_=function(e){if((this.flags_&b.image.ImageMapEffect.ICON_FLAG)!=0||(this.flags_&b.image.ImageMapEffect.MIXED_FLAG)!=0){if(e.type=="touchstart"){this.overlayManager_.isIconActivated=true}if(e.type=="touchend"){this.overlayClickHandler_(e);return}b.image.ImageMapEffect.prototype.fixEvent(e);e.preventDefault();e.stopPropagation()}if(e.type=="touchmove"){e.preventDefault()}};b.MapAreaOverlay.prototype.getActive=function(){return this.active_};b.MapAreaOverlay.prototype.setActive=function(e){if(this.active_!=e){this.active_=e;this.updateOverlay()}};b.MapAreaOverlay.prototype.getArea=function(){return this.rawShapeInfo_?this.rawShapeInfo_.area:NaN};b.MapAreaOverlay.prototype.getMapDesc=function(){return this.mapDesc_};b.MapAreaOverlay.prototype.cleanUp=function(){if(this.rollover_){if(window.PointerEvent&&b.browser.name==="ie"){b.Event.removeDOMListener(this.element_,"pointerover",this.__overlayRolloverHandler);b.Event.removeDOMListener(this.element_,"pointerout",this.__overlayRolloverHandler)}else{b.Event.removeDOMListener(this.element_,"mouseover",this.__overlayRolloverHandler);b.Event.removeDOMListener(this.element_,"mouseout",this.__overlayRolloverHandler)}}if(this.toolTip_){this.toolTip_.removeToolTip()}b.Event.removeDOMListener(this.element_,"touchstart",this.__touchHandler);b.Event.removeDOMListener(this.element_,"touchmove",this.__touchHandler);b.Event.removeDOMListener(this.element_,"touchend",this.__touchHandler)};b.MapAreaOverlay.prototype.updateOverlay=function(){if(this.mapDesc_.shape==b.MapDescShape.SHAPE_POLY){if(this.shape){if(this.overlayManager_.overlayContainer_&&this.overlayManager_.overlayContainer_.displayElement){this.showShape()}}var f=this.getPoints(this.mapDesc_.coords,true);var e=this.processPolygon(f).centroid;this.element_.setX(e.x-this.element_.getWidth()/2);this.element_.setY(e.y-this.element_.getHeight()/2);b.Util.css.setCSSAttributeSelector(this.element_,"state",this.active_?"active":"default")}};b.MapAreaOverlay.prototype.showShape=function(){var j=this.overlayManager_.overlayContainer_.displayElement.getContext("2d");var h=this.getTransformedPoint(0);var g=j.globalCompositeOperation;if(this.isOver||((this.flags_&b.image.ImageMapEffect.ALWAYS_ACTIVE_FLAG)!=0)){j.save();j.beginPath();j.save();j.translate(0,0);var e=this.getTransformedPoint(0);j.moveTo(e.x,e.y);for(var f=0;f<this.shape.points.length;f++){e=this.getTransformedPoint(f);j.lineTo(e.x,e.y)}j.closePath();j.restore();j.globalCompositeOperation="destination-out";j.fill();j.globalCompositeOperation=g;j.fillStyle=this.shape.fill;j.fill();if(this.shape.strokeWidth>0){j.lineWidth=this.shape.strokeWidth;j.strokeStyle=this.shape.strokeStyle;j.stroke()}j.restore()}};b.MapAreaOverlay.prototype.overlayRolloverHandler_=function(h){if((this.flags_&b.image.ImageMapEffect.ICON_FLAG)==0){return}var g=(h.type=="mouseover"||h.type=="pointerover");if(this.rollover_){var e=this.overlayManager_.getLinkedOverlays(this);if(!(this.flags_&b.image.ImageMapEffect.ALWAYS_ACTIVE_FLAG)){this.setLinkedOverlaysActive(g)}if(this.mapDesc_.rolloverKey&&this.mapDesc_.rolloverKey.length&&this.rollover_==true){var k,f=this.getBounds();if(g){k=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.ROLLOVER_ACTIVATED,this.mapDesc_.rolloverKey,f)}else{k=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.ROLLOVER_DEACTIVATED,this.mapDesc_.rolloverKey,f)}this.overlayManager_.overlayRolloverEvent(k)}}if(g){var i=this.getRollover(this.mapDesc_);if(i!=null){var j=new b.event.UserEvent(b.event.UserEvent.ITEM,[i],true);this.overlayManager_.overlayRolloverEvent(j)}}};b.MapAreaOverlay.prototype.getRollover=function(e){if(e.rolloverKey&&e.rolloverKey.length){return e.rolloverKey}else{if(e.href&&e.href.length){return e.href}else{if(e.alt&&e.alt.length){return e.alt}}}return null};b.MapAreaOverlay.prototype.isIcon=function(){function g(i,h){if(i.x<h.x){return -1}if(i.x>h.x){return 1}return 0}var f=this.getPoints(this.mapDesc_.coords,false);f.sort(g);var e=(f.length==4&&f[0].x==f[1].x&&f[2].x==f[3].x&&f[2].x-f[1].x==(Math.abs(f[0].y-f[1].y))&&(Math.abs(f[1].y-f[0].y)==10||Math.abs(f[3].y-f[4].y)<10)&&(f[2].x-f[1].x)==10);return e};b.MapAreaOverlay.prototype.getBounds=function(){var e=b.ImageMapUtil.getPosition(this.element_);var f=new b.Rectangle(e.x,e.y,this.element_.getWidth(),this.element_.getHeight());return f};b.MapAreaOverlay.prototype.setLinkedOverlaysActive=function(h){var f,e=this.overlayManager_.getLinkedOverlays(this);this.setActive(h);for(var g=0;g<e.length;g++){var f=e[g];if(f!=this){f.setActive(h)}}};b.MapAreaOverlay.prototype.overlayClickHandler_=function(g){this.overlayManager_.isIconActivated=false;b.image.ImageMapEffect.prototype.fixEvent(g);g.preventDefault();g.stopPropagation();if(this.rollover_==false){if(this.mapDesc_.href&&this.mapDesc_.href.length>0){var p=this.mapDesc_.href.toLowerCase();if(p.indexOf("quickview:")==0){var f=new Object();var v=this.mapDesc_.href;var u=/^QUICKVIEW:(.+)$/gi;var n=u.exec(v);var l=(n!=null&&n.length==2?n[1]:"");var w=l.split("&");for(var k=0;k<w.length;k++){var j=w[k].split("=");if(j.length>1){f[j[0]]=decodeURIComponent(w[k].split("=")[1])}}var r=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.QUICKVIEW_ACTIVATED,this.mapDesc_.rolloverKey,e,this.mapDesc_.href,false,null,f);this.overlayManager_.overlayRolloverEvent(r)}else{if(p.indexOf("target:")==0){p=p.substring("target:".length);var q=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.TARGET_INDEX,this.mapDesc_.rolloverKey,e,this.mapDesc_.href,false,p);this.overlayManager_.overlayRolloverEvent(q)}else{if(p.indexOf("javascript:")==0){this.evaluateJavaScriptLink_(this.mapDesc_.href)}else{this.evaluateWebLink_(this.mapDesc_.href)}}}}else{if(this.mapDesc_.rolloverKey&&this.mapDesc_.rolloverKey.length>0){var h,e=this.getBounds(),t=this;this.setLinkedOverlaysActive(true);setTimeout(function(){t.setLinkedOverlaysActive(false)},200);h=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.ROLLOVER_ACTIVATED,this.mapDesc_.rolloverKey,e);this.overlayManager_.overlayRolloverEvent(h)}else{}}}else{if(this.mapDesc_.href&&this.mapDesc_.href.length>0){var p=this.mapDesc_.href.toLowerCase();if(p.indexOf("quickview:")==0){var f=new Object();var v=this.mapDesc_.href;var u=/^QUICKVIEW:(.+)$/gi;var n=u.exec(v);var l=(n!=null&&n.length==2?n[1]:"");var w=l.split("&");for(var k=0;k<w.length;k++){var j=w[k].split("=");if(j.length>1){f[j[0]]=decodeURIComponent(w[k].split("=")[1])}}var r=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.QUICKVIEW_ACTIVATED,this.mapDesc_.rolloverKey,e,this.mapDesc_.href,false,null,f);this.overlayManager_.overlayRolloverEvent(r)}else{if(p.indexOf("target:")==0){p=p.substring("target:".length);var q=new b.event.RolloverKeyEvent(b.event.RolloverKeyEvent.TARGET_INDEX,this.mapDesc_.rolloverKey,e,this.mapDesc_.href,false,p);this.overlayManager_.overlayRolloverEvent(q)}else{if(p.indexOf("javascript:")==0){this.evaluateJavaScriptLink_(this.mapDesc_.href)}else{this.evaluateWebLink_(this.mapDesc_.href)}}}}else{}}var m=this.getRollover(this.mapDesc_);if(m!=null){var o=new b.event.UserEvent(b.event.UserEvent.HREF,[m],true);this.overlayManager_.overlayRolloverEvent(o)}};b.MapAreaOverlay.prototype.evaluateWebLink_=function(e){window.open(e,this.mapDesc_.target||"_self")};b.MapAreaOverlay.prototype.evaluateJavaScriptLink_=function(f){var g=f.replace("javascript:","");var e=new Function("",g);e()};b.MapAreaOverlay.prototype.getPoints=function(k,h){h=(typeof h=="undefined")?false:h;var g=[];if(k.length%2){b.Logger.log(b.Logger.WARNING,"s7sdk.image.ImageMapEffect - s7sdk.MapAreaOverlay.getPoints - There are an odd number of coordinates!")}var f=Math.floor(k.length/2);for(var j=0;j<f;j++){var e=new b.Point2D(k[j*2],k[j*2+1]);if(h){e=this.overlayManager_.transformPoint(e)}g.push(e)}return g};b.MapAreaOverlay.prototype.processPolygon=function(h){var f=h.length;var i=0;var e=0;var l=0;for(var j=0;j<f;j++){var g=(j+1)%f;var k=h[j].x*h[g].y-h[g].x*h[j].y;i+=k;e+=(h[j].x+h[g].x)*k;l+=(h[j].y+h[g].y)*k}i*=0.5;e/=6*i;l/=6*i;return new b.ShapeInfo(new b.Point2D(e,l),Math.abs(i))};b.MapAreaOverlay.prototype.createShape=function(f){var e={};var h;e.left=e.right=f[0].x;e.top=e.bottom=f[0].y;e.points=[];for(var g=0;g<f.length;g++){var j={x:f[g].x,y:f[g].y};if(h){if(e.left>j.x){e.left=j.x}if(e.right<j.x){e.right=j.x}if(e.top>j.y){e.top=j.y}if(e.bottom<j.y){e.bottom=j.y}j.box={L:j.x>h.x?h.x:j.x,R:j.x>h.x?j.x:h.x,T:j.y>h.y?h.y:j.y,B:j.y>h.y?j.y:h.y};j.px=h.x;j.py=h.y}e.points[g]=j;h=j}e.width=e.right-e.left;e.height=e.bottom-e.top;e.px=e.right+40;e.py=e.bottom+40;e.fill=b.Util.css.getCss("s7region","background-color",this.targetId_,this.targetClassName_,this.overlayManager_.container);e.strokeStyle=b.Util.css.getCss("s7region","border-top-color",this.targetId_,this.targetClassName_,this.overlayManager_.container);e.strokeWidth=Math.ceil(parseFloat(b.Util.css.getCss("s7region","border-top-width",this.targetId_,this.targetClassName_,this.overlayManager_.container)));this.shape=e};b.MapAreaOverlay.prototype.getTransformedPoint=function(e){if(this.shape){return this.overlayManager_.transformPoint(new b.Point2D(this.shape.points[e].x,this.shape.points[e].y))}};b.MapAreaOverlay.prototype.checkMousePoint=function(e,k){if(this.shape){var h=e>this.shape.left&&e<this.shape.right&&k>this.shape.top&&k<this.shape.bottom}function j(q,v){var m={x:v.x-q.x,y:v.y-q.y};var l={x:q.px-q.x,y:q.py-q.y};var y={x:v.px-v.x,y:v.py-v.y};var p=m.x*l.y-m.y*l.x;var o=m.x*y.y-m.y*y.x;var i=l.x*y.y-l.y*y.x;if(p==0){return((v.x-q.x<0)!=(v.x-q.px<0))||((v.y-q.y<0)!=(v.y-q.py<0))}if(i==0){return false}var n=1/i;var x=o*n;var w=p*n;return(x>=0)&&(x<=1)&&(w>=0)&&(w<=1)}if(h){this.shape.x=e;this.shape.y=k;var g=0;for(var f=1;f<this.shape.points.length;f++){if(j(this.shape,this.shape.points[f])){g++}}return(g&1)==1}return false};b.MapAreaOverlay.prototype.createDiv=function(){var e=b.image.ImageMapEffect.createSmartDiv();e.style.position="absolute";e.style.backgroundRepeat="no-repeat";e.style.backgroundPosition="center";e.style.pointerEvents="auto";if((this.flags_&b.image.ImageMapEffect.ICON_FLAG)!=0||((this.flags_&b.image.ImageMapEffect.MIXED_FLAG)!=0&&this.isIcon())){e.className="s7mapoverlay s7icon";e.setWidth(parseInt(b.Util.css.getCss("s7mapoverlay s7icon","width",this.targetId_,this.targetClassName_,this.overlayManager_.container)));e.setHeight(parseInt(b.Util.css.getCss("s7mapoverlay s7icon","height",this.targetId_,this.targetClassName_,this.overlayManager_.container)))}return e};b.ImageMapEffect=b.image.ImageMapEffect}if(!b.ImageMapUtil){b.ImageMapUtil={getPosition:function(f){var e=0;var g=0;while(f!=document){e+=f.offsetLeft;g+=f.offsetTop;f=f.parentNode}return new b.Point2D(e,g)},parseMapAreaArray:function(h){var k=new Array();for(var f=0;f<h.length;f++){var g=h[f];for(var e=0;e<g.coords.length;e++){g.coords[e]=parseInt(g.coords[e])}k.push(new b.MapDesc(g.shape,g.coords,g.alt,g.href,g.rollover_key,g.target))}return k}}}if(!b.ShapeInfo){b.ShapeInfo=function d(e,f){this.centroid=e;this.area=f}}})(s7getCurrentNameSpace());