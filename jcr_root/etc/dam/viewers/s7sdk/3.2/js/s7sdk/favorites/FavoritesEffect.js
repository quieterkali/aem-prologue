/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.favorites");b.Util.require("s7sdk.common.Thumb");b.Util.require("s7sdk.common.Geometry");if(!b.favorites.FavoritesEffectControl){b.favorites.FavoritesEffectControl=function(c){arguments.callee.superclass.apply(this,[c,b.favorites.FavoritesEffectControl.NS,c.constructor,b.favorites.FavoritesEffect.RESTRICTED_STYLES])};b.favorites.FavoritesEffectControl.NS="s7sdk.favorites.FavoritesEffectControl";b.favorites.FavoritesEffectControl.prototype.rebuild=function(f){var c=this.component.itemIndex_;var e=this.component.mediaSet_;var d=this.getOverlaysVisible();this.superproto.rebuild.apply(this,[f]);this.component.mediaSet_=e;if(e.items&&e.items[c]){this.component.retrieveFavorites()}this.setOverlaysVisible(d)}}b.Class.inherits(b.favorites.FavoritesEffectControl.NS,"s7sdk.ControlComponent");if(!b.favorites.FavoritesEffect){b.favorites.FavoritesEffect=function FavoritesEffect(c,e,d){this.fadeTimer=null;var f=!!arguments[3];b.Logger.log(b.Logger.CONFIG,"s7sdk.favorites.FavoritesEffect constructor - containerId: %0, settings: %1 , compId: %2",c,e,d);d=(typeof d=="string"&&d.length)?d:"FavoritesEffect_"+b.Util.createUniqueId();arguments.callee.superclass.apply(this,[d,c,"div","s7favoriteseffect",e,!f]);b.Component.prototype.parseMods.apply(this,[]);this.container=this.getParent();var g=this.container?this.container.s7base:null;this.create(g);if(!f){return new b.favorites.FavoritesEffectControl(this)}else{return this}};b.favorites.FavoritesEffect.MODE_VIEW=0;b.favorites.FavoritesEffect.MODE_ADD=1;b.favorites.FavoritesEffect.MODE_REMOVE=2;b.Class.inherits("s7sdk.favorites.FavoritesEffect","s7sdk.Base");b.favorites.FavoritesEffect.RESTRICTED_STYLES={"s7favoriteseffect s7icon":["width","height"]};b.favorites.FavoritesEffect.prototype.symbols={TOOLTIP:"Favorite"};b.favorites.FavoritesEffect.prototype.setCSS=function(e,d,c){if(this.isRestrictedCSSProperty(b.favorites.FavoritesEffect.RESTRICTED_STYLES,d)){throw new Error("You cannot set "+e+" : "+d+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[e,d,c])}};b.favorites.FavoritesEffect.prototype.setModifier=function(c){throw new Error("Trying to use setModifier on the Core class (FavoritesEffect) is unsupported! Please refer to SDK documentation on using setModifier.")};b.favorites.FavoritesEffect.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};b.favorites.FavoritesEffect.prototype.modifiers={expiration:{params:["value"],defaults:[30],ranges:["0:"]}};b.favorites.FavoritesEffect.prototype.create=function(d){this.target_=null;this.mediaSet_=null;this.asset_=null;this.favorites_=[];this.itemIndex_=-1;this.createElement();this.obj.style.position="absolute";this.obj.style.top="0px";this.obj.style.left="0px";this.obj.style.width="100%";this.obj.style.height="100%";this.overlayContainer_=b.Util.createElement("div");this.overlayContainer_.className="";this.overlayContainer_.style.width="0%";this.overlayContainer_.style.height="0%";this.overlayContainer_.mode=b.favorites.FavoritesEffect.MODE_VIEW;this.obj.appendChild(this.overlayContainer_);this.overlaysVisible_=true;this.destroyed_=false;this.hint=this.getLocalizedText("TOOLTIP");var c=this;this.__targetZoomRegion=function(f){c.targetZoomRegion(f)};this.__targetAssetChanged=function(f){c.targetAssetChanged(f)};this.__targetItemSelected=function(f){c.targetAssetChanged(f)};this.__transitionStart=function(f){c.transitionStart(f)};this.__transitionEnd=function(f){c.transitionEnd(f)};this.__tgtMouseDownHandler=function(f){c.tgtMouseMapHandler(f,0)};this.__tgtMouseMoveHandler=function(f){c.tgtMouseMapHandler(f,1)};this.__tgtMouseUpHandler=function(f){c.tgtMouseMapHandler(f,2)};if(d!=null){this.attachToView(d)}};b.favorites.FavoritesEffect.prototype.addEventListener=function(e,d,c){b.Logger.log(b.Logger.FINE,"s7sdk.favorites.FavoritesEffect.addEventListener - type: %0, handler: %1, useCapture: %2",e,d.toString().substring(0,d.toString().indexOf("(")),c);b.Base.prototype.addEventListener.apply(this,[e,d,c])};b.favorites.FavoritesEffect.prototype.attachToView=function(c){if(c!==this.target_){if(this.target_){this.detachFromView(this.target_)}this.target_=c;if(c){this.target_.addEventListener("mousedown",this.__tgtMouseDownHandler,true);this.target_.addEventListener("mouseup",this.__tgtMouseUpHandler,true);this.target_.addEventListener("mousemove",this.__tgtMouseMoveHandler,true);this.target_.addEventListener("touchstart",this.__tgtMouseDownHandler,true);this.target_.addEventListener("touchend",this.__tgtMouseUpHandler,true);this.target_.addEventListener("touchmove",this.__tgtMouseMoveHandler,true);this.target_.addEventListener("pointerdown",this.__tgtMouseDownHandler,true);this.target_.addEventListener("pointerup",this.__tgtMouseUpHandler,true);this.target_.addEventListener("pointermove",this.__tgtMouseMoveHandler,true);this.target_.addEventListener(b.event.ZoomRgnEvent.NOTF_ZOOM_RGN,this.__targetZoomRegion,false);this.target_.addEventListener(b.event.AssetEvent.ASSET_CHANGED,this.__targetAssetChanged,false);this.target_.addEventListener(b.event.AssetEvent.ITEM_SELECTED_EVENT,this.__targetItemSelected,false);this.target_.addEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_START,this.__transitionStart,false);this.target_.addEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_END,this.__transitionEnd,false);this.target_.obj.appendChild(this.obj)}}};b.favorites.FavoritesEffect.prototype.detachFromView=function(c){c.removeEventListener("mousedown",this.__tgtMouseDownHandler,true);c.removeEventListener("mouseup",this.__tgtMouseUpHandler,true);c.removeEventListener("mousemove",this.__tgtMouseMoveHandler,true);c.removeEventListener("touchstart",this.__tgtMouseDownHandler,true);c.removeEventListener("touchend",this.__tgtMouseUpHandler,true);c.removeEventListener("touchmove",this.__tgtMouseMoveHandler,true);c.removeEventListener("pointerdown",this.__tgtMouseDownHandler,true);c.removeEventListener("pointerup",this.__tgtMouseUpHandler,true);c.removeEventListener("pointermove",this.__tgtMouseMoveHandler,true);c.removeEventListener(b.event.ZoomRgnEvent.NOTF_ZOOM_RGN,this.__targetZoomRegion,false);c.removeEventListener(b.event.AssetEvent.ASSET_CHANGED,this.__targetAssetChanged,false);c.removeEventListener(b.event.AssetEvent.ITEM_SELECTED_EVENT,this.__targetItemSelected,false);c.removeEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_START,this.__transitionStart,false);c.removeEventListener(b.event.FrameEvent.NOTF_FRAME_TRANSITION_END,this.__transitionEnd,false);c.obj.removeChild(this.obj)};b.favorites.FavoritesEffect.prototype.createLandscapeFD=function(d,j,c){var g=c;var f=this.target_.splitFrames.orientation?this.target_.mediaSet_.getLandscapeIndex(g):g;var h=this.target_.splitFrames.orientation&&(this.target_.mediaSet_.getPortraitIndex(f)<g);var e=h?this.asset_.width:0;var i=new b.favorites.FavoriteDesc(d+e,j,f);return i};b.favorites.FavoritesEffect.prototype.tgtMouseMapHandler=function(k,g){if(this.overlaysVisible_&&(this.getMode()!=b.favorites.FavoritesEffect.MODE_VIEW)&&b.Storage()){b.Event.preventDefault(k);b.Event.stopPropagation(k);var o,l;o=b.Util.getEventPos(k).x;l=b.Util.getEventPos(k).y;var f=b.Util.getObjPos(this.overlayContainer_);var i=o-f.x;var d=l-f.y;var n=this.reverseTransformPoint(new b.Point2D(i,d));if(g==2){}if(g==2){var h=this.checkPresense(o,l);var j=this.getMode();if(j==b.favorites.FavoritesEffect.MODE_REMOVE){if(h==-1){}else{if(h!=-1){b.Storage.removeArrayItem(this.mediaSet_.landscape.name,this.createLandscapeFD(this.favorites_[h].favoriteDesc_.x,this.favorites_[h].favoriteDesc_.y,this.favorites_[h].favoriteDesc_.frameIdx),this.expiration);this.retrieveFavorites()}}}else{if(j==b.favorites.FavoritesEffect.MODE_ADD){if(h==-1){b.Storage.pushArrayItem(this.mediaSet_.landscape.name,this.createLandscapeFD(n.x,n.y,this.itemIndex_),this.expiration);var c=new b.favorites.FavoriteDesc(n.x,n.y,this.itemIndex_);var m=new b.FavoriteOverlay(this,c);m.updateOverlay(i,d);this.overlayContainer_.appendChild(m.element_);this.favorites_.push(m)}else{if(h!=-1){}}}}this.setMode(b.favorites.FavoritesEffect.MODE_VIEW);var p=new b.event.FavoritesEvent(b.event.FavoritesEvent.FAVORITES_CHANGED,false);b.Event.dispatch(this.obj,p,false)}}};b.favorites.FavoritesEffect.prototype.checkPresense=function(c,e){for(var d=0;d<this.favorites_.length;d++){if(this.favorites_[d].getBounds().containsPoint(c,e)){return d}}return -1};b.favorites.FavoritesEffect.prototype.targetZoomRegion=function(c){this.updateOverlayCoverage()};b.favorites.FavoritesEffect.prototype.targetAssetChanged=function(e){var c=e.s7event.asset instanceof b.MediaSetDesc?e.s7event.asset.items[e.s7event.frame]:e.s7event.asset;if(typeof c=="string"){throw new Error("AssetEvent should not be providing a string as the asset, it should be an ItemDesc!")}if(c.parent==null){throw new Error("ItemDesc must be part of a parent set!")}this.mediaSet_=this.target_.mediaSet_;this.mediaSet_.items=this.target_.splitFrames.orientation?this.target_.mediaSet_.portrait.items:this.target_.mediaSet_.landscape.items;var d=this.target_.splitFrames.orientation?this.target_.mediaSet_.getPortraitIndex(e.s7event.frame):this.target_.mediaSet_.getLandscapeIndex(e.s7event.frame);this.asset_=c;this.itemIndex_=e.s7event.frame;if(this.mediaSet_.items&&this.mediaSet_.items[this.itemIndex_]){this.retrieveFavorites()}};b.favorites.FavoritesEffect.prototype.transitionStart=function(c){if(this.overlayContainer_){this.overlayContainer_.style.visibility="hidden"}};b.favorites.FavoritesEffect.prototype.transitionEnd=function(c){if(this.overlayContainer_){this.overlayContainer_.style.visibility="inherit"}};b.favorites.FavoritesEffect.prototype.retrieveFavorites=function(){this.removeOverlaysFromView();if(b.Storage()){var c=b.Storage.readArrayItems(this.mediaSet_.landscape.name).value;var h=new b.event.FavoritesEvent(b.event.FavoritesEvent.FAVORITES_CHANGED,false);b.Event.dispatch(this.obj,h,false);var g=this.getFavorites();if(this.destroyed_||g.length==0){return}var g=this.getFavorites();for(var e=0;e<g.length;e++){var f=g[e];if(f.frameIdx==this.itemIndex_){var d=new b.FavoriteOverlay(this,f);this.overlayContainer_.appendChild(d.element_);this.favorites_.push(d)}}this.updateOverlayCoverage(true)}};b.favorites.FavoritesEffect.prototype.setMode=function(d){var c=["mode_view","mode_add","mode_remove"];switch(d){case b.favorites.FavoritesEffect.MODE_VIEW:this.overlayContainer_.mode=b.favorites.FavoritesEffect.MODE_VIEW;this.overlayContainer_.style.width="0%";this.overlayContainer_.style.height="0%";this.obj.style.width="0%";this.obj.style.height="0%";break;case b.favorites.FavoritesEffect.MODE_ADD:this.overlayContainer_.mode=b.favorites.FavoritesEffect.MODE_ADD;this.overlayContainer_.style.width="100%";this.overlayContainer_.style.height="100%";this.obj.style.width="100%";this.obj.style.height="100%";break;case b.favorites.FavoritesEffect.MODE_REMOVE:this.overlayContainer_.mode=b.favorites.FavoritesEffect.MODE_REMOVE;this.overlayContainer_.style.width="100%";this.overlayContainer_.style.height="100%";this.obj.style.width="100%";this.obj.style.height="100%";break}b.Util.css.setCSSAttributeSelector(this.obj,"cursortype",c[d])};b.favorites.FavoritesEffect.prototype.getMode=function(){return this.overlayContainer_.mode};b.favorites.FavoritesEffect.prototype.getFavoriteByFd=function(d){for(var c=0;c<this.favorites_.length;c++){var e=this.favorites_[c];if(JSON.stringify(e.getFavoriteDesc())==JSON.stringify(d)){return e}}return null};b.favorites.FavoritesEffect.prototype.getFavorites=function(){var k=[];if(b.Storage()){var e=b.Storage.readArrayItems(this.mediaSet_.landscape.name).value;for(var j=0;j<e.length;j++){var c=e[j];var f=this.target_.splitFrames.orientation?this.target_.mediaSet_.getPortraitIndex(c.frameIdx):c.frameIdx;var h=this.target_.splitFrames.orientation?(c.x>=this.asset_.width):false;f+=h?1:0;var d=h?this.asset_.width:0;var g=new b.favorites.FavoriteDesc(c.x-d,c.y,f);k.push(g)}}return k};b.favorites.FavoritesEffect.prototype.getOverlaysVisible=function(){b.Logger.log(b.Logger.FINE,"s7sdk.favorites.FavoritesEffect.getOverlaysVisible");return this.overlaysVisible_};b.favorites.FavoritesEffect.prototype.setOverlaysVisible=function(c){b.Logger.log(b.Logger.FINE,"s7sdk.favorites.FavoritesEffect.setOverlaysVisible - value: %0",c);this.overlaysVisible_=c;if(c){this.updateOverlayCoverage(true)}else{this.removeOverlaysFromView()}};b.favorites.FavoritesEffect.prototype.updateOverlayCoverage=function(j){j=(typeof j=="undefined")?false:j;if(this.favorites_&&this.favorites_.length&&this.overlaysVisible_){var f=b.Util.getObjPos(this.overlayContainer_);for(var g=0;g<this.favorites_.length;g++){var l=this.favorites_[g].favoriteDesc_.x;var k=this.favorites_[g].favoriteDesc_.y;var e=new b.Point2D(l,k);var c=this.transformPoint(e);var h=c.x;var d=c.y;this.favorites_[g].updateOverlay(h,d)}if(j){this.fadeInOverlays_()}}};b.favorites.FavoritesEffect.prototype.fadeInOverlays_=function(){var e=this.overlayContainer_;var c=parseFloat(b.Util.css.getCss("s7icon","opacity",null,"s7favoriteseffect",this.overlayContainer_,{state:"default"}));function d(){if(!e.currentOpacity_){e.currentOpacity_=0}if(e.currentOpacity_<c){e.currentOpacity_+=0.05/0.5;for(var f=0;f<e.childNodes.length;f++){b.Util.setOpacity(e.childNodes[f],e.currentOpacity_)}this.fadeTimer=setTimeout(d,50)}else{if(b.browser.device.name=="desktop"){for(var f=0;f<e.childNodes.length;f++){if(b.browser.name==="ie"&&b.browser.version.major<=8){e.childNodes[f].style.removeAttribute("filter")}else{e.childNodes[f].style.opacity=""}}}}if(b.browser.device.name=="android"&&b.browser.device.version=="4"){e.style.display="none";var g=e.offsetWidth;e.style.display="block"}}d()};b.favorites.FavoritesEffect.prototype.removeOverlaysFromView=function(){if(this.favorites_){for(var c=this.favorites_.length-1;c>=0;c--){if(this.favorites_[c].toolTip_){this.favorites_[c].toolTip_.removeToolTip()}this.overlayContainer_.removeChild(this.favorites_[c].element_);this.favorites_.pop(this.favorites_[c])}}};b.favorites.FavoritesEffect.prototype.cleanUp=function(){if(this.fadeTimer){clearTimeout(this.fadeTimer);this.fadeTimer=null}if(this.target_){this.detachFromView(this.target_);this.target_=null}this.container=null;b.Logger.log(b.Logger.FINE,"s7sdk.favorites.FavoritesEffect.cleanUp");this.removeOverlaysFromView();this.destroyed_=true;if(this.obj){b.Util.removeTags(this.obj);this.obj.style.cssText=""}};b.favorites.FavoritesEffect.prototype.transformPoint=function(c){return this.target_.imagePixelsToViewPoint(c)};b.favorites.FavoritesEffect.prototype.reverseTransformPoint=function(c){return this.target_.viewPointToImagePixels(c)};b.favorites.FavoritesEffect.prototype.getTargetId=function(){return this.target_.obj.id};b.favorites.FavoritesEffect.prototype.getTargetClassName=function(){return this.target_.obj.className};b.favorites.FavoritesEffect.prototype.getModifiers=function(){return this.modifiers};b.favorites.FavoritesEffect.supportsHTML5Storage=function(){try{return typeof(Storage)!=="undefined"&&window.localStorage!=null}catch(c){return false}};(function a(){var e=b.Util.css.createCssRuleText;var d=b.Util.css.createCssImgUrlText;var c=e(".s7favoriteseffect[cursortype='mode_add']",{cursor:"crosshair"})+e(".s7favoriteseffect[cursortype='mode_remove']",{cursor:"not-allowed"})+e(".s7favoriteseffect[cursortype='mode_view']",{cursor:"default"})+e(".s7favoriteseffect",{"z-index":"999",cursor:"pointer","pointer-events":"auto","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)"})+e(".s7favoriteseffect .s7icon",{position:"absolute",height:"28px",width:"28px","background-size":"100% 100%","background-image":d("favoriteseffect_up.png"),"z-index":"999","pointer-events":"auto","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)"});b.Util.css.addDefaultCSS(c,"FavoritesEffect")})()}if(!b.FavoriteOverlay){b.FavoriteOverlay=function FavoriteOverlay(e,f,d){this.overlayManager_=e;this.favoriteDesc_=f;this.active_=false;this.element_=b.Util.createElement("div");this.element_.className="s7icon";this.toolTip_=new b.SimpleToolTip(this.element_,this.overlayManager_.hint);var c=this;this.__touchHandler=function(g){c.touchHandler_(g)};this.__overlayMouseDownHandler=function(g){c.overlayMouseDownHandler_(g)};b.Event.addDOMListener(this.element_,"mousedown",this.__overlayMouseDownHandler,false);b.Event.addDOMListener(this.element_,"touchstart",this.__touchHandler,false);b.Event.addDOMListener(this.element_,"touchmove",this.__touchHandler,false);b.Event.addDOMListener(this.element_,"touchend",this.__touchHandler,false);b.Event.addDOMListener(this.element_,"pointerdown",this.__overlayMouseDownHandler,false)};b.FavoriteOverlay.prototype.updateOverlay=function(c,f){var d=parseFloat(b.Util.css.getCss("s7icon","width",null,"s7favoriteseffect"));var e=parseFloat(b.Util.css.getCss("s7icon","height",null,"s7favoriteseffect"));this.element_.style.left=c-d/2+"px";this.element_.style.top=f-e/2+"px";b.Util.css.setCSSAttributeSelector(this.element_,"state",this.active_?"active":"default")};b.FavoriteOverlay.prototype.overlayMouseDownHandler_=function(c){b.Event.preventDefault(c);b.Event.stopPropagation(c)};b.FavoriteOverlay.prototype.touchHandler_=function(c){if(c.type=="touchend"){return}b.Event.preventDefault(c);b.Event.stopPropagation(c)};b.FavoriteOverlay.prototype.cleanUp=function(){b.Event.removeDOMListener(this.element_,"mousedown",this.__overlayMouseDownHandler);if(this.toolTip_){this.toolTip_.removeToolTip()}b.Event.removeDOMListener(this.element_,"touchstart",this.__touchHandler);b.Event.removeDOMListener(this.element_,"touchmove",this.__touchHandler);b.Event.removeDOMListener(this.element_,"touchend",this.__touchHandler);b.Event.removeDOMListener(this.element_,"pointerdown",this.__overlayMouseDownHandler)};b.FavoriteOverlay.prototype.getFavoriteDesc=function(){return this.favoriteDesc_};b.FavoriteOverlay.prototype.getBounds=function(){var c=new b.Rectangle(b.Util.getObjPos(this.element_).x,b.Util.getObjPos(this.element_).y,this.element_.offsetWidth,this.element_.offsetHeight);return c};b.FavoriteOverlay.prototype.getActive=function(){return this.active_};b.FavoriteOverlay.prototype.setActive=function(c){if(this.active_!=c){this.active_=c;this.updateOverlay()}};b.FavoritesEffect=b.favorites.FavoritesEffect}if(!b.favorites.FavoriteDesc){b.favorites.FavoriteDesc=function FavoriteDesc(c,e,d){this.x=c;this.y=e;this.frameIdx=d}}if(!b.Storage){b.Storage=function Storage(){if(typeof(Storage)!=="undefined"&&window.localStorage!=null){return this}else{return null}};b.Storage.today=function(){return new Date()};b.Storage.setObject=function(d,e,c){var c=c?b.Storage.today().setDate(b.Storage.today().getDate()+c):b.Storage.today().setDate(b.Storage.today().getDate()+30);localStorage.setItem(d,JSON.stringify({val:e,exp:c}))};b.Storage.getObject=function(c){try{var e=JSON.parse(localStorage.getItem(c));if(e!==null&&e.exp>b.Storage.today()){return e}else{if(e!==null&&e.exp<b.Storage.today()){localStorage.removeItem(c);return null}}}catch(d){throw new Error("s7sdk.Storage.getObject - JSON parse failed for lookup of ",c,"\n error was: ",d);return null}};b.Storage.removeObject=function(c){try{return localStorage.removeItem(c)}catch(d){return null}};b.Storage.clear=function(){localStorage.clear()};b.Storage.getLength=function(){return localStorage.length};b.Storage.getKey=function(c){if(typeof c!=="number"||c<0||localStorage.key.length<=c){throw new Error("Invalid argument")}return localStorage.key[c]};b.Storage.getKeys=function(){var c=new Array();for(var d=0;d<localStorage.length;d++){c.push(localStorage.key(d))}return c};b.Storage.pushArrayItem=function(e,h,c){var d=b.Storage.getObject(e);if(d==null){var g=new Array();g.push(h);d=g}else{var f=d.val;f.push(h);d=f;c=c||new Date(b.Storage.getObject(e)["exp"]).getDate()}b.Storage.setObject(e,d,c)};b.Storage.popArrayItem=function(e){var c=new Array();var d=b.Storage.readArrayItems(e).value;if(d&&d.length>0){c=d.pop();b.Storage.setObject(e,d,b.Storage.readArrayItems(e).expires)}return c};b.Storage.addArrayItem=function(f,i,c,d){var e=b.Storage.getObject(f);if(e==null){var h=new Array();h.push(i);e=h}else{var g=e.val;g[g.length]=i;e=g;d=d||new Date(b.Storage.getObject(f)["exp"]).getDate()}b.Storage.setObject(f,e,d)};b.Storage.getArrayItem=function(f,d){var c=new Array();var e=b.Storage.readArrayItems(f).value;if(e&&e.length>0){c=e[d]}return c};b.Storage.removeArrayItemByIdx=function(f,d){var c=new Array();var e=b.Storage.readArrayItems(f);if(e&&e.value.length>0){c=e.value.splice(d,1);b.Storage.setObject(f,e.value,new Date(e.expires).getDate())}return c};b.Storage.removeArrayItem=function(g,h,d){var c=new Array();var e=b.Storage.readArrayItems(g);if(e&&e.value.length>0){for(var f=e.value.length;f--;){if(JSON.stringify(e.value[f])==JSON.stringify(h)){e.value.splice(f,1)}}d=d||new Date(e.expires).getDate();c=e.value;b.Storage.setObject(g,e.value,d)}return c};b.Storage.readArrayItems=function(f){var c=new Array();var d=null;var e=b.Storage.getObject(f);if(e!=null){c=e.val;d=e.exp}return{value:c,expires:d}}}})(s7getCurrentNameSpace());