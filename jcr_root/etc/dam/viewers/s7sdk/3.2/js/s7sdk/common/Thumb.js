/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.Util.require("s7sdk.common.Geometry");if(!b.Thumb){b.Thumb=function(l,p,m,u,j,n,d,h,f,g,r,e,o,i,q,s,c){this.serverUrl_=p;this.iscommand_=m;this.item=u;this.wid_=j;this.hei_=n;this.fmt_=d;this.highlight_=h;this.highlightColor_=f;this.textPos_=r||b.Thumb.TEXT_BOTTOM;this.parentClassName_=e||"";this.toolTip_=null;this.locale_=o;this.sourceRect=g;this.container_=l;this.x=0;this.y=0;this.div=null;this.selected_=false;this.mouseOver_=false;this.labelHeight_=0;this.labelWidth_=0;this.isgridview=i;this.div=this.createMainDiv();var k=c==b.ItemDescType.EMPTY;if(k){b.Util.css.setCSSAttributeSelector(this.div,"type","none");return}this.imgDiv=this.createImgDiv();this.overlayDiv=this.createOverlayDiv();this.imgDiv.appendChild(this.overlayDiv);this.div.appendChild(this.imgDiv);switch(c){case b.ItemDescType.IMG:this.overlayType="image";break;case b.ItemDescType.IMAGE_SET:this.overlayType="swatchset";break;case b.ItemDescType.SPIN_SET:this.overlayType="spinset";break;case b.ItemDescType.VIDEO:this.overlayType="video";break;case b.ItemDescType.VIDEO_SET:this.overlayType="video";break;default:this.overlayType="";break}this.setOverlayType(this.overlayType);this.item_label=this.item.label?this.item.label:q;if((this.item_label&&this.item_label.length)||(this.item.customlabel&&u.customlabel.length)){this.txtDiv=this.createTxtDiv();if(this.textPos_==b.Thumb.TEXT_RIGHT||this.textPos_==b.Thumb.TEXT_LEFT){b.Thumb.setInlineBlock(this.imgDiv);b.Thumb.setInlineBlock(this.txtDiv);this.txtDiv.style.verticalAlign="top"}this.txtDiv.innerHTML=this.item_label}this.layoutComp();b.Event.addDOMListener(this.div,"mousedown",function(v){b.Event.preventDefault(v||window.event)},false);var t=this;b.Event.addDOMListener(this.div,"mousemove",function(v){if(!t.mouseOver_){t.showOverState(true);t.mouseOver_=true}},false);b.Event.addDOMListener(this.div,"mouseout",function(v){t.mouseOver_=false;t.showOverState(false)},false);if(this.textPos_==b.Thumb.TEXT_TOOLTIP&&this.item_label&&this.item_label.length){this.toolTip_=new b.SimpleToolTip(this.div,this.item_label)}this.setSelected(false);this.delayedLoad_=s==true;this.isLoading=false;this.isComlete=false;if(this.item.image!=null&&this.item.image!=""&&!this.delayedLoad_){this.loadImage()}};b.Thumb.TEXT_BOTTOM="bottom";b.Thumb.TEXT_TOP="top";b.Thumb.TEXT_LEFT="left";b.Thumb.TEXT_RIGHT="right";b.Thumb.TEXT_NONE="none";b.Thumb.TEXT_ONLY="only";b.Thumb.TEXT_TOOLTIP="tooltip";b.Thumb.setInlineBlock=function(c){if(b.browser.name=="ie"&&b.browser.version.major=="7"){c.style.display="inline";c.style.zoom="1"}else{c.style.display="inline-block"}};b.Thumb.prototype.getWidth=function(){var c=this.wid_;if(this.getLabelEnabled()){if(this.textPos_==b.Thumb.TEXT_LEFT||this.textPos_==b.Thumb.TEXT_RIGHT){if(this.isgridview){c=this.labelWidth_+this.wid_}else{c*=2}}}return c};b.Thumb.prototype.getHeight=function(){var c=this.hei_;if(this.textPos_==b.Thumb.TEXT_TOP||this.textPos_==b.Thumb.TEXT_BOTTOM){if(this.getLabelEnabled()){c+=this.labelHeight_}}return c};b.Thumb.prototype.getLabelEnabled=function(){return Boolean(this.item_label&&this.item_label.length)};b.Thumb.prototype.loadImage=function(){this.isLoading=true;var c=this.serverUrl_;if(!c.match(/\/$/)){c+="/"}if(!this.item.image&&this.item.color){c+=b.MediaSetParser.findCompanyNameInAsset(this.item.asset);c+="?bgc="+this.item.color+"&"}else{c+=this.item.image;if(c.indexOf("?")==-1){c+="?"}else{c+="&layer=comp&"}}c+="fit=constrain,1&";c+="wid="+this.wid_+"&hei="+this.hei_;c+="&fmt="+this.fmt_;if(typeof(this.sourceRect)!="undefined"){c+="&rgn="+this.sourceRect.x+","+this.sourceRect.y;c+=","+this.sourceRect.width+","+this.sourceRect.height}if(this.iscommand_!=null&&this.iscommand_.length>0){c+=(c.indexOf("?")==-1)?"?":"&";c+=this.iscommand_}if(b.Util.isNonEmptyString(this.locale_)){c+="&locale="+this.locale_}b.Logger.log(b.Logger.FINER,"s7sdk.Thumb.loadImage - req: %0",c);this.image_=new Image();var d=this;this.image_.onload=function(f){d.onLoadImage()};this.image_.onerror=function(f){d.onErrorImage()};this.image_.onabort=function(f){d.onAbortImage()};this.image_.src=c};b.Thumb.prototype.onLoadImage=function(){this.imgDiv.style.backgroundImage='url("'+this.image_.src+'")';this.isComlete=true;this.isLoading=false};b.Thumb.prototype.onErrorImage=function(){this.isComlete=true;this.isLoading=false};b.Thumb.prototype.onAbortImage=function(){this.isComlete=true;this.isLoading=false};b.Thumb.prototype.layoutComp=function(){this.imgDiv.style.width=this.wid_+"px";this.imgDiv.style.height=this.hei_+"px";if(this.item_label&&this.item_label.length){this.txtDiv.style.width=this.wid_+"px";this.labelHeight_=0;this.labelWidth_=0;this.container_.appendChild(this.txtDiv);this.labelHeight_=this.txtDiv.clientHeight;this.labelWidth_=this.txtDiv.clientWidth;this.container_.removeChild(this.txtDiv);switch(this.textPos_){case b.Thumb.TEXT_RIGHT:case b.Thumb.TEXT_BOTTOM:this.div.appendChild(this.txtDiv);break;case b.Thumb.TEXT_LEFT:case b.Thumb.TEXT_TOP:this.div.insertBefore(this.txtDiv,this.imgDiv);break}}};b.Thumb.prototype.updatePosition=function(){this.div.style.left=this.x+"px";this.div.style.top=this.y+"px"};b.Thumb.prototype.getSelected=function(){return this.selected_};b.Thumb.prototype.setSelected=function(c){this.selected_=c;this.showHighlight(c)};b.Thumb.prototype.showHighlight=function(d){b.Util.css.setCSSAttributeSelector(this.imgDiv,"state",d?"selected":"default");if(this.highlight_!=-1){var c=d?"inset 0 0 0px "+this.highlight_+"px "+this.highlightColor_:"none";this.imgDiv.style.boxShadow=c;this.imgDiv.style.webkitBoxShadow=c}};b.Thumb.prototype.showOverState=function(c){if(!this.selected_){b.Util.css.setCSSAttributeSelector(this.imgDiv,"state",c?"over":"default")}};b.Thumb.prototype.setOverlayType=function(c){b.Util.css.setCSSAttributeSelector(this.overlayDiv,"type",c?c:"")};b.Thumb.prototype.createOverlayDiv=function(){var c=this.createDiv();c.className="s7thumboverlay";return c};b.Thumb.prototype.createImgDiv=function(){var c=this.createDiv();c.className="s7thumb";return c};b.Thumb.prototype.createTxtDiv=function(){var c=this.createDiv();c.className="s7label";return c};b.Thumb.prototype.createMainDiv=function(){var c=this.createDiv();c.className="s7thumbcell";return c};b.Thumb.prototype.createDiv=function(d){var e=document.createElement("div");var c=(b.namespacePrefix=="")?false:true;if(c){e.setAttribute("data-namespace",b.namespacePrefix)}return e};(function a(){var e=b.Util.css.createCssRuleText;var d=b.Util.css.createCssImgUrlText;var c=e(".s7thumbcell .s7thumb",{"background-repeat":"no-repeat","background-position":"center"})+e(".s7thumbcell .s7thumboverlay",{"background-repeat":"no-repeat","background-position":"center"})+e(".s7thumbcell .s7label",{"text-align":"center","word-wrap":"break-word"});b.Util.css.addDefaultCSS(c,"Thumb")})()}if(!b.SimpleToolTip){b.SimpleToolTip=function SimpleToolTip(e,d){this.target_=null;this.content_=null;this.toolTip_=null;if(b.browser.supportsTouch()){return}this.createToolTip();var c=this;this.__rollOverHandler=function(f){c.rollOverHandler(f)};this.__rollOutHandler=function(f){c.rollOutHandler(f)};this.__mouseMoveHandler=function(f){c.mouseMoveHandler(f)};this.setTarget(e);this.setContent(d)};b.SimpleToolTip.prototype.getContainer=function(){return this.target_.parentNode};b.SimpleToolTip.prototype.getTarget=function(){return this.target_};b.SimpleToolTip.prototype.setTarget=function(c){if(this.toolTip_){this.removeToolTip();if(this.target_){b.Event.removeDOMListener(this.target_,"mouseover",this.__rollOverHandler);b.Event.removeDOMListener(this.target_,"mouseout",this.__rollOutHandler);b.Event.removeDOMListener(this.target_,"mousemove",this.__mouseMoveHandler)}if(c){b.Event.addDOMListener(c,"mouseover",this.__rollOverHandler,true);b.Event.addDOMListener(c,"mouseout",this.__rollOutHandler,true);b.Event.addDOMListener(c,"mousemove",this.__mouseMoveHandler,true)}}this.target_=c};b.SimpleToolTip.prototype.getContent=function(){return this.content_};b.SimpleToolTip.prototype.setContent=function(c){if(this.toolTip_){this.toolTip_.innerHTML=c;this.content_=c}};b.SimpleToolTip.prototype.cleanUp=function(){this.setTarget(null)};b.SimpleToolTip.prototype.removeToolTip=function(){if(this.toolTip_&&this.toolTip_.parentNode){this.toolTip_.parentNode.removeChild(this.toolTip_)}};b.SimpleToolTip.prototype.rollOverHandler=function(e){var f=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement||document.msFullscreenElement;var d=this.getAnchors();this.anchor=f?f:d.s7Container?d.s7Container.parentNode:document.body;var c=this.toolTip_.style.visibility;this.toolTip_.style.visibility="hidden";this.anchor.appendChild(this.toolTip_);this.positionToolTip(new b.Point2D(e.clientX,e.clientY));this.toolTip_.style.visibility=c};b.SimpleToolTip.prototype.getAnchors=function(){var d={};if(this.toolTip_){var c=this.target_;while(c!=null){c=c.parentNode;if(c==document.body){break}if(c!=null&&typeof(c.s7base)=="object"&&b.common&&b.common.Container&&(c.s7base instanceof b.common.Container)){d.s7Container=c}}d.nod=c}return d};b.SimpleToolTip.prototype.positionToolTip=function(c){if(this.toolTip_){var h=20;var f=b.browser.detectScreen();var d=b.Util.getScrollXY();var g=this.anchor!=document.body?b.Util.getObjPos(this.anchor):{x:0,y:0};var k={x:Math.max(d.x,g.x),y:Math.max(d.y,g.y)};var e=this.anchor!=document.body?{x:Math.min(d.x+f.w,g.x+this.anchor.offsetWidth),y:Math.min(d.y+f.h,g.y+this.anchor.offsetHeight)}:{x:d.x+f.w,y:d.y+f.h};var i={x:d.x+c.x+h,y:d.y+c.y+h};if(i.x+this.toolTip_.clientWidth+35>=e.x){i.x-=this.toolTip_.clientWidth+2*h;if(i.x<k.x){i.x-=h}}if(i.y+this.toolTip_.clientHeight+35>=e.y){i.y-=this.toolTip_.clientHeight+2*h;if(i.y<k.y){i.y-=h}}this.toolTip_.style.left=i.x+"px";this.toolTip_.style.top=i.y+"px";var j=b.Util.getObjPos(this.toolTip_);this.toolTip_.style.left=2*i.x-j.x+"px";this.toolTip_.style.top=2*i.y-j.y+"px"}};b.SimpleToolTip.prototype.rollOutHandler=function(c){this.removeToolTip()};b.SimpleToolTip.prototype.mouseMoveHandler=function(d){if(this.toolTip_.parentNode){var e=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;var c=this.getAnchors();this.anchor=e?e:c.s7Container?c.s7Container.parentNode:document.body;this.positionToolTip(new b.Point2D(d.clientX,d.clientY))}};b.SimpleToolTip.prototype.getElementCoords=function(e){var d=document.documentElement||document.body;var g=window.pageXOffset||d.scrollLeft;var f=window.pageYOffset||d.scrollTop;var c=e.getBoundingClientRect().left+g;var h=e.getBoundingClientRect().top+f;return new b.Point2D(c,h)};b.SimpleToolTip.prototype.createToolTip=function(){this.toolTip_=document.createElement("div");var c=(b.namespacePrefix=="")?false:true;if(c){this.toolTip_.setAttribute("data-namespace",b.namespacePrefix)}this.toolTip_.className="s7tooltip";this.toolTip_.style.position="absolute";this.toolTip_.style.whiteSpace="nowrap";this.toolTip_.style.pointerEvents="none"}}if(b.SimpleToolTip){(function a(){var e=b.Util.css.createCssRuleText;var d=b.Util.css.createCssImgUrlText;var c=e(".s7tooltip",{position:"absolute",padding:"5px","line-height":"100%","text-align":"center","background-color":"rgb(224, 224, 224)",color:"rgb(26,26,26)","font-family":"Helvetica, sans-serif","font-size":"11px","z-index":"10000",border:"1px solid rgb(191,191,191)"});b.Util.css.addDefaultCSS(c,"SimpleToolTip")})()}})(s7getCurrentNameSpace());