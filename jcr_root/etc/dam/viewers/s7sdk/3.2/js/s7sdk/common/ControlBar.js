/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.common");b.Util.require("s7sdk.event.Event");b.Util.require("s7sdk.common.Enumeration");b.Util.require("s7sdk.common.Button");if(!b.common.ControlBarControl){b.common.ControlBarControl=function(c){arguments.callee.superclass.apply(this,[c,b.common.ControlBarControl.NS,c.constructor,b.common.ControlBar.RESTRICTED_STYLES])};b.common.ControlBarControl.prototype.setModifier=function(g){var m=null;var l=null;var h=this.component.getModifiers();for(var f in h){var c=f.toLowerCase();if(c=="transition"){if(!g[c]){continue}l=g[c];m=this.component.getTransition();var e=[];for(var d in m){e.push(m[d])}m=e.join(",");this.component.setTransition(l);this.dispatchEvent(new b.event.ControlComponentEvent(b.event.ControlComponentEvent.NOTF_CONTROLCOMPONENT_MODIFIERUPDATED,{oldvalue:m,newvalue:l,property:c},false))}}};b.common.ControlBarControl.prototype.rebuild=function(j){if(this.component){var h=this.component.obj.childNodes;var c=this.component.innerContainer.childNodes;var f=Array.prototype.slice.call(h);var e=Array.prototype.slice.call(c);var k=[];var d=[];for(var g=f.length;g--;){if(f[g].getAttribute("protectednode")=="true"){f.splice(g,1)}}if(this.component.views.length>0){for(var g=0;g<this.component.views.length;g++){d.push(this.component.views[g])}}if(this.component.viewsExternal.length>0){for(var g=0;g<this.component.viewsExternal.length;g++){k.push(this.component.viewsExternal[g])}}this.superproto.rebuild.apply(this,[j]);if(e.length!=0){for(var g=0;g<e.length;g++){this.component.innerContainer.appendChild(e[g])}}if(f.length!=0){for(var g=0;g<f.length;g++){this.component.obj.appendChild(f[g])}}if(d.length!=0){for(var g=0;g<d.length;g++){this.component.attachView(d[g])}}if(k.length!=0){for(var g=0;g<k.length;g++){this.component.attach(k[g])}}}};b.common.ControlBarControl.NS="s7sdk.common.ControlBarControl"}b.Class.inherits(b.common.ControlBarControl.NS,"s7sdk.ControlComponent");if(!b.common.ControlBar){b.common.ControlBar=function ControlBar(c,e,d){var g=!!arguments[3];d=(typeof d=="string"&&d.length)?d:"ControlBar_"+b.Util.createUniqueId();b.Logger.log(b.Logger.CONFIG,"s7sdk.common.ControlBar constructor - container: %0, settings: %1 , compId: %2",c,e,d);arguments.callee.superclass.apply(this,[d,c,"div","s7controlbar",e,!g]);this.createElement();this.innerContainer=document.createElement("div");this.innerContainer.className="s7innercontrolbarcontainer";this.innerContainer.id=this.obj.id+"_inner";this.innerContainer.setAttribute("protectednode","true");this.obj.appendChild(this.innerContainer);this.scrollButtonCntr=document.createElement("div");this.scrollButtonCntr.id=this.obj.id+"_scrollBtnCntr";this.scrollButtonCntr.className="s7scrollbuttoncontainer";this.scrollButtonCntr.setAttribute("protectednode","true");this.obj.appendChild(this.scrollButtonCntr);this.attachToContainer();this.scrollButton=null;this.w=parseInt(b.Util.css.getCss(this.getCl(),"width",d,null,this.getParent()));this.h=parseInt(b.Util.css.getCss(this.getCl(),"height",d,null,this.getParent()));if(this.transition.transition=="fade"){if(b.browser.name==="ie"&&b.browser.version.major<9){this.transition.transition="none"}}else{this.transition.transition="none"}this.views=[];this.viewsExternal=[];this.manualOn=this.manual=false;this.allowHide=true;var f=this;this.lastMouse={x:-1000000,y:-1000000};this.fnShow=function(h){if(f.isHiding){return}f.showEv(h)};this.winMouseMoveHandler=function(h){h=h||window.event;f.lastMouse={x:b.Util.getEventPos(h).x,y:b.Util.getEventPos(h).y}};this.winMouseOutHandler=function(h){h=h||window.event;f.lastMouse={x:-1000000,y:-1000000}};if(this.transition.delaytohide!=-1){this.animate=new b.common.Animation(this,this.transition.duration*1000,this.transition.delaytohide*1000,this.transition.transition);this.addListeners()}if(!this.checkTimer){this.checkTimer=setInterval(function(){if(f.innerContainer.offsetWidth>f.obj.offsetWidth){if(!f.scrollButton){f.scrollButton=new b.common.ScrollLeftRightButton(f.scrollButtonCntr.id,f.settings,"scrollBtn_"+b.Util.createUniqueId(),true);f.scrollButton.addEventListener("click",function(h){if(f.innerContainer.offsetLeft==0){f.innerContainer.style.left=-(f.scrollButtonCntr.offsetWidth+(f.innerContainer.offsetWidth-f.obj.offsetWidth))+"px";f.checkScrolledVisibility()}else{f.innerContainer.style.left=0+"px";f.checkScrolledVisibility()}})}f.scrollButtonCntr.style.display="inline-block"}else{f.scrollButtonCntr.style.display="none";f.innerContainer.style.left=0+"px"}},50)}if(!g){return new b.common.ControlBarControl(this)}else{return this}};b.Class.inherits("s7sdk.common.ControlBar","s7sdk.UIComponent");b.common.ControlBar.prototype.getComponent=function(){return this};b.common.ControlBar.RESTRICTED_STYLES={s7controlbar:["width","height"]};b.common.ControlBar.prototype.setCSS=function(e,d,c){if(this.isRestrictedCSSProperty(b.common.ControlBar.RESTRICTED_STYLES,d)){throw new Error("You cannot set "+e+" : "+d+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[e,d,c])}};b.common.ControlBar.prototype.setModifier=function(c){throw new Error("Trying to use setModifier on the Core class (ControlBar) is unsupported! Please refer to SDK documentation on using setModifier.")};b.common.ControlBar.prototype.cleanUp=function(){if(this.checkTimer){clearInterval(this.checkTimer);this.checkTimer=null}if(this.animate){this.animate.dispose();delete this.animate}this.detachAll();this.viewsExternal=[];this.removeListeners();b.Util.removeTags(this.obj);this.obj.style.cssText=""};b.common.ControlBar.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};b.common.ControlBar.prototype.modifiers={transition:{params:["transition","delaytohide","duration"],defaults:["fade",2,0.5],ranges:[["none","fade"],"-1:","0:"]}};b.common.ControlBar.prototype.viewAttached=function(e,c){for(var d=0;d<e.length;d++){if(e[d]==c){return d}}return -1};b.common.ControlBar.prototype.animationStep=function(e,c){if(this.transition.transition=="fade"){var g=c?e:1-e;b.Util.setOpacity(this.obj,g);if(g>0){this.obj.style.display="";this.obj.style.visibility=""}for(var d=0;d<this.viewsExternal.length;d++){var f=this.viewsExternal[d];b.Util.setOpacity(f,g);if(g>0){f.style.display="";f.style.visibility=""}}}else{}};b.common.ControlBar.prototype.animationStart=function(){};b.common.ControlBar.prototype.animationStop=function(f){if(this.manualOn){this.animate.transitionTime=this.transition.duration*1000;if(f){this.manual=false}this.manualOn=false}if(this.isHiding){this.d_style=b.Util.getStyle(this.obj,"display");this.obj.style.display="none";this.isHiding=false}var g=f?1:0;b.Util.setOpacity(this.obj,g);if(g){this.obj.style.display="";this.obj.style.visibility=""}else{if(b.browser.name==="ie"&&b.browser.version.major<=8){var d=this.obj.getElementsByTagName("*");for(var c=0;c<d.length;c++){d[c].style.filter="inherit"}}}for(var c=0;c<this.viewsExternal.length;c++){var e=this.viewsExternal[c];b.Util.setOpacity(e,g);if(!g){e.style.display="none"}else{e.style.display="";e.style.visibility=""}}};b.common.ControlBar.prototype.showEv=function(d){if(!this.manual||this.manualOn){if(this.transition.transition=="none"){if(b.browser.name==="ie"&&b.browser.version.major<=8){this.obj.style.filter="";for(var c=0;c<this.viewsExternal.length;c++){var e=this.viewsExternal[c];e.style.filter=""}}this.obj.style.opacity="";this.obj.style.display="";this.obj.style.visibility="";for(var c=0;c<this.viewsExternal.length;c++){var e=this.viewsExternal[c];e.style.visibility="";e.style.opacity="";e.style.display=""}}this.animate.startTransition()}};b.common.ControlBar.prototype.checkMouseAll=function(){if(this.checkMouseEx(this.obj)){return true}for(var c=0;c<this.viewsExternal.length;c++){if(this.checkMouseEx(this.viewsExternal[c])){return true}}for(var c=0;c<this.views.length;c++){if(this.checkMouseEx(this.views[c])&&this.views[c].keepVisible){return true}}return false};b.common.ControlBar.prototype.checkMouseEx=function(g){if(b.browser.supportsTouch()){return false}var f=b.Util.getObjPos(g);var e=document.elementFromPoint(this.lastMouse.x,this.lastMouse.y);if(e){while(e=e.parentNode){if(e==g){return true}}}var d=this.lastMouse.x-f.x;var c=this.lastMouse.y-f.y;return(d>0&&d<g.offsetWidth&&c>0&&c<g.offsetHeight)};b.common.ControlBar.prototype.checkMouse=function(){if(b.browser.supportsTouch()){return false}var f=b.Util.getObjPos(this.obj);var e=document.elementFromPoint(this.lastMouse.x,this.lastMouse.y);if(e){while(e=e.parentNode){if(e==this.obj){return true}}}var d=this.lastMouse.x-f.x;var c=this.lastMouse.y-f.y;return(d>0&&d<this.obj.offsetWidth&&c>0&&c<this.obj.offsetHeight)};b.common.ControlBar.prototype.addEventListener=function(e,d,c){this.superproto.addEventListener.apply(this,[e,d,c])};b.common.ControlBar.prototype.attachView=function(d,e){b.Logger.log(b.Logger.FINE,"s7sdk.common.ControlBar.attachView - view: %0",d);if(this.transition.delaytohide!=-1){var c=d instanceof b.Base?(d.obj?d.obj:d.getObj()):d;c.keepVisible=e||false;var f=this.viewAttached(this.views,c);if(f==-1){this.views.push(c);b.Event.addDOMListener(c,"mousemove",this.fnShow);b.Event.addDOMListener(c,"touchmove",this.fnShow,true);b.Event.addDOMListener(c,"touchstart",this.fnShow,true)}}};b.common.ControlBar.prototype.detachView=function(d){b.Logger.log(b.Logger.FINE,"s7sdk.common.ControlBar.detachView - view: %0",d);if(this.transition.delaytohide!=-1){var c=d instanceof b.Base?(d.obj?d.obj:d.getObj()):d;var e=this.viewAttached(this.views,c);if(e!=-1){this.views.splice(e,1);b.Event.removeDOMListener(c,"mousemove",this.fnShow);b.Event.removeDOMListener(c,"touchmove",this.fnShow,true);b.Event.removeDOMListener(c,"touchstart",this.fnShow,true)}}};b.common.ControlBar.prototype.attach=function(d){var c=d instanceof b.Base?d.getObj():d;var e=this.viewAttached(this.viewsExternal,c);if(e==-1){this.viewsExternal.push(c)}};b.common.ControlBar.prototype.detach=function(d){var c=d instanceof b.Base?d.getObj():d;var e=this.viewAttached(this.viewsExternal,c);if(e!=-1){this.viewsExternal.splice(e,1)}};b.common.ControlBar.prototype.detachAll=function(){b.Logger.log(b.Logger.FINE,"s7sdk.common.ControlBar.detachAll");if(this.transition.delaytohide!=-1){while(this.views.length!=0){var c=this.views.pop();b.Event.removeDOMListener(c,"mousemove",this.fnShow);b.Event.removeDOMListener(c,"touchmove",this.fnShow,true);b.Event.removeDOMListener(c,"touchstart",this.fnShow,true)}}};b.common.ControlBar.prototype.show=function(){this.isHiding=false;if(this.d_style){this.obj.style.display=this.d_style}if(this.transition.transition=="fade"){this.manualOn=true}else{this.manualOn=false;this.manual=false}if(this.animate){switch(this.animate.state){case 0:this.animate.transitionTime=300;this.showEv();break;case 1:case 3:this.animate.transitionTime=300;this.animate.calcShift(this.animate.state==3);this.animate.state=1;this.animate.reverse=true;break}}else{if(b.browser.name==="ie"&&b.browser.version.major<=8){this.obj.style.filter="";for(var c=0;c<this.viewsExternal.length;c++){var d=this.viewsExternal[c];d.style.filter=""}}else{this.obj.style.opacity="";for(var c=0;c<this.viewsExternal.length;c++){var d=this.viewsExternal[c];d.style.opacity=""}}b.Util.fade(this.obj,false,0.3,"")}};b.common.ControlBar.prototype.hide=function(){this.manualOn=false;this.manual=true;this.isHiding=true;if(this.animate){switch(this.animate.state){case 2:this.animate.transitionTime=300;this.animate.startTransition();this.animate.startTime=(new Date()).getTime()-this.animate.delayToHide;if(!this.allowHide){this.animate.reverse=false;this.animate.state=5}break;case 3:case 1:this.animate.transitionTime=300;this.animate.calcShift(this.animate.state==3);if(this.animate.state==1){this.animate.state=3;this.animate.reverse=false}break;case 4:this.animate.transitionTime=300;this.animate.state=5;this.animate.startTransition();break}}else{if(b.browser.name==="ie"&&b.browser.version.major<=8){this.obj.style.filter="alpha(opacity=0)";for(var c=0;c<this.viewsExternal.length;c++){var d=this.viewsExternal[c];d.style.filter="alpha(opacity=0)"}}else{this.obj.style.opacity="0";for(var c=0;c<this.viewsExternal.length;c++){var d=this.viewsExternal[c];d.style.opacity="0"}}b.Util.fade(this.obj,true,0.3,"");this.isHiding=false}};b.common.ControlBar.prototype.allowAutoHide=function(c){this.allowHide=c;if(this.animate){this.animate.allowHide=c;switch(this.animate.state){case 0:this.animate.transitionTime=this.transition.duration*1000;this.showEv();break;case 4:this.manualOn=true;this.animate.state=2;this.animate.transitionTime=this.transition.duration*1000;this.animate.startTransition();this.animate.startTime=(new Date()).getTime()-this.animate.delayToHide;break;case 2:break;case 1:break;case 3:this.animate.calcShift(true);this.animate.state=1;this.animate.reverse=true;break}}};b.common.ControlBar.prototype.addListeners=function(){this.addEventListener("mousemove",this.fnShow);this.addEventListener("mousedown",this.fnShow);this.addEventListener("touchmove",this.fnShow,true);this.addEventListener("touchstart",this.fnShow,true);var d=b.browser.name=="ie"?document:window;b.Event.addDOMListener(d,"mouseout",this.winMouseOutHandler,true);b.Event.addDOMListener(d,"mousemove",this.winMouseMoveHandler,true);for(var c=0;c<this.views.length;c++){b.Event.addDOMListener(this.views[c],"mousemove",this.fnShow);b.Event.addDOMListener(this.views[c],"touchmove",this.fnShow,true);b.Event.addDOMListener(this.views[c],"touchstart",this.fnShow,true)}};b.common.ControlBar.prototype.removeListeners=function(){for(var c=0;c<this.views.length;c++){b.Event.removeDOMListener(this.views[c],"mousemove",this.fnShow);b.Event.removeDOMListener(this.views[c],"touchmove",this.fnShow,true);b.Event.removeDOMListener(this.views[c],"touchstart",this.fnShow,true)}this.removeEventListener("mousemove",this.fnShow);this.removeEventListener("mousedown",this.fnShow);this.removeEventListener("touchmove",this.fnShow,true);this.removeEventListener("touchstart",this.fnShow,true);var d=b.browser.name=="ie"?document:window;b.Event.removeDOMListener(d,"mouseout",this.winMouseOutHandler,true);b.Event.removeDOMListener(d,"mousemove",this.winMouseMoveHandler,true)};b.common.ControlBar.prototype.getTransition=function(){return this.transition};b.common.ControlBar.prototype.setTransition=function(g){if(this.animate){this.animationStop(true);this.removeListeners();this.animate.dispose();delete this.animate}var f=this.getModifiers().transition;var d=b.Modifier.parse(g,f.defaults,f.ranges);for(var c=0;c<f.params.length;c++){this.transition[f.params[c]]=d.values[c]}if(this.transition.delaytohide!=-1){this.animate=new b.common.Animation(this,this.transition.duration*1000,this.transition.delaytohide*1000,this.transition.transition);this.addListeners()}else{this.obj.style.display="";this.obj.style.visibility="";for(var c=0;c<this.viewsExternal.length;c++){var e=this.viewsExternal[c];e.style.visibility="";e.style.display=""}}};b.common.ControlBar.prototype.getWidth=function(){return this.w};b.common.ControlBar.prototype.getHeight=function(){return this.h};b.common.ControlBar.prototype.resize=function(c,d){this.w=c;this.h=d;this.obj.style.width=c+"px";this.obj.style.height=d+"px";b.UIComponent.prototype.resize.apply(this,[c,d]);this.checkScrolledVisibility()};b.common.ControlBar.prototype.checkScrolledVisibility=function(){if(this.obj.offsetWidth!=0){var d=this.innerContainer.childNodes;var c=this.obj.getBoundingClientRect();for(var e=0;e<this.innerContainer.childNodes.length;e++){var f=this.innerContainer.childNodes[e].getBoundingClientRect();if((f.right-f.left>0)&&(f.bottom-f.top>0)){if((f.right>=c.left+this.obj.offsetWidth)||(f.left<c.left)){this.innerContainer.childNodes[e].style.visibility="hidden"}else{this.innerContainer.childNodes[e].style.visibility=""}}}}};b.ControlBar=b.common.ControlBar;(function a(){var g=b.Util.css.createCssRuleText;var e=b.browser&&b.browser.name=="ie"&&b.browser.version.major>=10;var d={"background-color":"#a6a6a6",position:"relative",width:"420px",height:"30px","-webkit-touch-callout":"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","text-align":"left","-ms-touch-action":e?"none":"","touch-action":e?"none":""};if(("android"==b.browser.device.name)&&(4==b.browser.device.version)){d["-webkit-perspective"]="1000"}var f={position:"absolute",width:"25px",height:"25px"};var c=g(".s7controlbar",d)+g(".s7controlbar .s7innercontrolbarcontainer",{position:"static","white-space":"nowrap",height:"100%"})+g(".s7controlbar .s7scrollbuttoncontainer",{display:"none",position:"absolute",width:"25px",height:"100%",right:"0px","background-color":"inherit"})+g(".s7controlbar .s7scrollleftrightbutton",f);b.Util.css.addDefaultCSS(c,"ControlBar")})()}if(!b.common.Animation){b.common.Animation=function(g,d,c,e,h){this.allowHide=true;this.transitionEasing=typeof(h)=="undefined"?b.Enum.TRANSITION_EASING.AUTO:h;this.type=e;this.startTime=(new Date()).getTime();this.shiftTime=0;this.maxStep=60;this.transitionTime=d;this.delayToHide=c;this.state=2;this.viewParent=g;var f=this;this.tmr=setInterval(function(){f.onEnterFrame()},25)};b.common.Animation.prototype.onEnterFrame=function(){if(this.state==0||this.state==4){return}var e=(new Date()).getTime();if(this.state==2||this.state==5){if(e-this.startTime>this.delayToHide){if(this.allowHide||this.state==5){var d=false;if(this.viewParent!=null&&typeof(this.viewParent.checkMouse)!=null){d=this.viewParent.checkMouseAll()}if(!d){if(this.type=="none"){this.state=0;this.stopTransition(false)}else{this.prevStep=0;this.shiftTime=0;this.startTime=e;this.state=3;this.reverse=false}}}else{this.state=4}}return}var c=this.calcStep(e);if(c==0){return}if(c>=1){if(this.state==1){this.state=2;this.startTime=e;this.stopTransition(true)}else{if(this.state==3){this.state=0;this.stopTransition(false)}}return}if(this.viewParent!=null&&typeof(this.viewParent.viewTransitionStep)!=null){this.viewParent.animationStep(c,this.reverse)}};b.common.Animation.prototype.calcStep=function(d){var c=(this.transitionTime!=0)?(d+this.shiftTime-this.startTime)/this.transitionTime:1;if(c>this.prevStep+this.maxStep){c=this.prevStep+this.maxStep}this.prevStep=c;if(c==0){return c}if(c>=1){return c}if(this.transitionEasing==b.Enum.TRANSITION_EASING.AUTO){}else{if(this.transitionEasing==b.Enum.TRANSITION_EASING.QUADRATIC){c=(c*(c-2))*-1}else{if(this.transitionEasing==b.Enum.TRANSITION_EASING.CUBIC){c=(c-=1)*c*c+1}else{if(this.transitionEasing==b.Enum.TRANSITION_EASING.QUARTIC){c=((c-=1)*c*c*c-1)*-1}else{if(this.transitionEasing==b.Enum.TRANSITION_EASING.QUINTIC){c=(c-=1)*c*c*c*c+1}}}}}return c};b.common.Animation.prototype.startTransition=function(){this.reverse=true;switch(this.state){case 0:this.shiftTime=0;this.prevStep=0;this.startTime=(new Date()).getTime();if(this.type=="none"){this.state=2}else{this.state=1}if(this.viewParent!=null&&this.viewParent.animationStart!=null){this.viewParent.animationStart()}break;case 1:break;case 2:this.startTime=(new Date()).getTime();break;case 3:this.state=1;this.calcShift(true);if(this.viewParent!=null&&this.viewParent.animationStart!=null){this.viewParent.animationStart()}break}};b.common.Animation.prototype.calcShift=function(e){this.startTime=(new Date()).getTime();if(this.prevStep!=0){var d=e?1-this.prevStep:this.prevStep;var f=this.startTime;var c=this.calcStep(f);while(c<d){f++;c=this.calcStep(f)}this.shiftTime=f-this.startTime}else{this.shiftTime=0}};b.common.Animation.prototype.stopTransition=function(c){if(this.viewParent!=null&&this.viewParent.animationStop!=null){this.viewParent.animationStop(c)}};b.common.Animation.prototype.dispose=function(){clearInterval(this.tmr)}}})(s7getCurrentNameSpace());