/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(function(b){b.pkg("s7sdk.set");if(b.browser.name==="ie"&&b.browser.version.major<"11"){b.Util.require("s7sdk.image.rgn.View")}else{b.Util.require("s7sdk.image.View")}b.Util.require("s7sdk.set.SpinFrame");b.Util.require("s7sdk.image.Tile");b.Util.require("s7sdk.common.IS");b.Util.require("s7sdk.common.Enumeration");b.Util.require("s7sdk.common.IconEffect");b.Util.require("s7sdk.common.ItemDesc");b.Util.require("s7sdk.event.Event");b.Util.require("s7sdk.event.InputController2");if(!b.set.SpinViewControl){b.set.SpinViewControl=function(d){arguments.callee.superclass.apply(this,[d,b.set.SpinViewControl.NS,d.constructor,b.set.SpinView.RESTRICTED_STYLES])};b.set.SpinViewControl.NS="s7sdk.set.SpinViewControl";b.set.SpinViewControl.prototype.setModifier=function(f){this.isnewAsset=false;this.isnewAutospin=false;for(var e in f){var d=e.toLowerCase();if(d=="asset"){this.isnewAsset=true;break}else{if(d=="autospin"){this.isnewAutospin=true;break}}}this.superproto.setModifier.apply(this,[f])};b.set.SpinViewControl.prototype.rebuild=function(g){if(this.component){var d=this.component.getCurrentFrameIndex();var e=this.component.autoSpinIsWorking();var f=this.component.isMediaSet();this.superproto.rebuild.apply(this,[g]);if(this.isnewAutospin){if(!this.isnewAsset&&f){this.component.setMediaSetInternal(this.component.currentAsset)}}else{if(!this.isnewAsset){this.component.terminateAutospin();this.component.initialFrame=d;if(e){this.component.skipAutoSpin=false}if(f){if(!e){this.component.skipAutoSpin=true}this.component.setMediaSetInternal(this.component.currentAsset)}}}}this.isnewAutospin=false;this.isnewAsset=false}}b.Class.inherits(b.set.SpinViewControl.NS,"s7sdk.ControlComponent");if(!b.set.SpinView){b.set.SpinView=function SpinView(d,g,f){b.Logger.log(b.Logger.CONFIG,"s7sdk.set.SpinView constructor - container: %0, settings: %1 , compId: %2",d,g,f);arguments.callee.superclass.apply(this,[f,d,"div","s7spinview",g]);this.isDisposed=false;var h=!!arguments[3];f=(typeof f=="string"&&f.length)?f:"SpinView_"+b.Util.createUniqueId();this.id=(b.Util.isNull(f)?"":f);this.yReverse=this.sensitivity.ySensitivity<0?-1:1;this.ySensitivity=Math.abs(this.sensitivity.ySensitivity);this.createElement();this.container=this.getParent();if(this.container.tagName=="DIV"&&(!this.container.style.position||this.container.style.position=="static")){this.container.style.position="relative"}this.id=(b.Util.isNull(f)?"":f);if(this.serverUrl.lastIndexOf("/")!=(this.serverUrl.length-1)){this.serverUrl+="/"}this.wid=this.stagesize.width;this.hei=this.stagesize.height;if(this.wid==0||this.hei==0){this.wid=this.size.width;this.hei=this.size.height}if(this.wid==0||this.hei==0){this.wid=parseInt(b.Util.css.getCss("s7spinview","width",this.id,null,this.container));this.hei=parseInt(b.Util.css.getCss("s7spinview","height",this.id,null,this.container));if(!b.Util.isNumber(this.wid)||!b.Util.isNumber(this.hei)||this.wid<=0||this.hei<=0){if("clientHeight" in this.container&&"clientWidth" in this.container){this.wid=this.container.clientWidth;this.hei=this.container.clientHeight}if(this.wid==0||this.hei==0){this.wid=400;this.hei=400}}}this.obj.style.width=this.wid+"px";this.obj.style.height=this.hei+"px";if(this.iscommand==""){this.iscommand=this.modifier}this.locale=this.getParam("locale","");this.bgColor=b.Util.css.getCss("s7spinview","background-color",this.id,null,this.container);this.bgColor=b.Util.convertColor(this.bgColor,"flash");this.clickToZoom=0;if((/reset/i).test(this.singleclick)){this.clickToZoom|=b.Enum.CLICK_STATE.CLICK_TO_RESET}if((/zoom/i).test(this.singleclick)){this.clickToZoom|=b.Enum.CLICK_STATE.CLICK_TO_ZOOM}if((/reset/i).test(this.doubleclick)){this.clickToZoom|=b.Enum.CLICK_STATE.DOUBLE_CLICK_TO_RESET}if((/zoom/i).test(this.doubleclick)){this.clickToZoom|=b.Enum.CLICK_STATE.DOUBLE_CLICK_TO_ZOOM}this.spinSet=this.asset;this.currentAsset=this.asset;this.spinSetArray=[];this.spinSetFrames=[];this.spinSetItems=[];this.imageModifier=b.MediaSetParser.parseAssetForSetReq(this.spinSet).mod;this.buttonMode=true;this.useHandCursor=true;if(this.autospin.spinnumber==0){this.skipAutoSpin=true}this.viewState=0;this.panSpinMode=true;this.currentFrame=null;this.frameInvalidated=false;this.nextFrame=null;this.paused=false;this.frameQueue=new Array();this.frameSpeed=1;this.idleSpeed=-1;this.dragToSpin=true;this.smoothFactor=0.1;this.t=0;this.maxRadius=this.maxLoadRadius.radius>0?this.maxLoadRadius.radius:1;this.frame=-1;this.lastScale=100;this.mouseIsDown=false;this.currentSpinState=null;this.wrapVertical=false;this.wrapHorizontal=false;this.lastTime=0;this.createWaitOverlay();this.frameLoader=new b.SpinFrameLoader();if(this.enableHD.enable.toLowerCase()=="always"){this.enableHD.maxHdPixels=-1}else{if(this.enableHD.enable.toLowerCase()=="never"){this.enableHD.maxHdPixels=0}else{if(this.enableHD.enable.toLowerCase()=="limit"){if(NaN==this.enableHD.maxHdPixels){this.enableHD.maxHdPixels=2250000}else{this.enableHD.maxHdPixels=this.enableHD.maxHdPixels*this.enableHD.maxHdPixels}}else{this.enableHD.maxHdPixels=2250000}}}this.devicePixelRatio=b.Util.adjustDevicePixelRatio(this.enableHD.maxHdPixels,this.hei,this.wid);this.viewProps=new Object();this.viewProps.fmt=this.fmt;this.viewProps.outHeight=this.hei*this.devicePixelRatio;this.viewProps.outWidth=this.wid*this.devicePixelRatio;this.viewProps.resetHeight=this.hei*this.devicePixelRatio;this.viewProps.resetWidth=this.wid*this.devicePixelRatio;this.viewProps.zoomStep=this.zoomStep.step;this.viewProps.limit=this.zoomStep.limit;this.viewProps.transitionTime=this.transition.time;this.viewProps.transitionEasing=this.transition.easing;this.viewProps.bgColor=this.bgColor;this.viewProps.elasticZoom=this.elasticZoom;this.viewProps.clickToZoom=this.clickToZoom;this.iconEffectObj=new b.IconEffect(this,this.iconEffect.enabled,this.iconEffect.count,this.iconEffect.fade,this.iconEffect.autoHide);this.inSpinDrag=false;this.direction=b.Enum.SPIN_DIRECTION.WEST;this.previousDirection=this.direction;this.directionRadians=Math.PI;this.displayElement=b.browser.name==="ie"&&(b.browser.version.major<11)?b.rgn.View.createDisplay():b.View.createDisplay();this.displayElement.style.position="absolute";this.displayElement.width=this.wid*this.devicePixelRatio;this.displayElement.height=this.hei*this.devicePixelRatio;this.displayElement.style.width=this.wid+"px";this.displayElement.style.height=this.hei+"px";this.obj.appendChild(this.displayElement);this.attachToContainer();this.displayElement.onselectstart=function(){return false};this.spinFrameStepTime=0;this.spinFrameTimeStamp=0;this.autoSpinTimer=null;var e=this;this.setupInputController();this.iconEffectVisibility={show:function(){e.iconEffectVisible=true;e.checkIconEffect()},hide:function(){e.iconEffectVisible=false;e.checkIconEffect()}};this.viewIsReadySent=false;this.hiresIsReadySent=false;this.needPreload=[];if(this.spinSet.length>0){this.loadAsset(this.spinSet)}if(!h){return new b.set.SpinViewControl(this)}else{return this}};b.Class.inherits("s7sdk.set.SpinView","s7sdk.UIComponent");b.set.SpinView.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},asset:{params:["asset"],defaults:[""],parseParams:false},iscommand:{params:["value"],defaults:[""],parseParams:false},zoomStep:{params:["step","limit"],defaults:[1,1],ranges:["0:","0.1:"]},transition:{params:["time","easing"],defaults:[0.5,0]},singleclick:{params:["singleclick"],defaults:["none"],ranges:[["none","zoom","reset","zoomReset"]]},doubleclick:{params:["doubleclick"],defaults:["zoomReset"],ranges:[["none","zoom","reset","zoomReset"]]},maxLoadRadius:{params:["radius","highquality"],defaults:[6,false]},enableHD:{params:["enable","maxHdPixels"],defaults:["limit",1500],ranges:[["always","never","limit"],"1:"]},iconEffect:{params:["enabled","count","fade","autoHide"],defaults:[true,1,0.3,3],ranges:[,"-1:","0:","0:"]},autospin:{params:["enabled","duration","direction","spinnumber"],defaults:[false,1,true,1],ranges:[,"0.1:",,"-1:"]},stagesize:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"],deprecated:true},size:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"],deprecated:true},modifier:{params:["modifier"],defaults:[""],deprecated:true},elasticZoom:{params:["elasticzoom"],defaults:[0],ranges:["0.0:1.0"],deprecated:true},fmt:{params:["fmt"],defaults:["jpg"],ranges:[["jpg","jpeg","png","png-alpha","gif","gif-alpha"]]},lockdirection:{params:["enabled"],defaults:[false]},sensitivity:{params:["xSensitivity","ySensitivity"],defaults:[5,2],ranges:["0.0:",]},highResTileLimit:{params:["highResTileLimit"],defaults:[-1],deprecated:true}};b.set.SpinView.RESTRICTED_STYLES={s7spinview:["width","height"],"s7spinview s7iconeffect":["width","height"]};b.set.SpinView.prototype.setCSS=function(f,e,d){if(this.isRestrictedCSSProperty(b.set.SpinView.RESTRICTED_STYLES,e)){throw new Error("You cannot set "+f+" : "+e+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[f,e,d])}};b.set.SpinView.prototype.setModifier=function(d){throw new Error("Trying to use setModifier on the Core class ("+this.getClassName()+") is unsupported! Please refer to SDK documentation on using setModifier.")};b.set.SpinView.prototype.cleanUp=function(){if(this.handler){this.handler.detach(this.obj)}if(this.handlerOverlay&&this.iconEffectObj){this.handlerOverlay.detach(this.iconEffectObj)}if(this.iconEffectObj){this.iconEffectObj.dispose();this.iconEffectObj=null}if(this.spinTimer){clearTimeout(this.spinTimer);this.spinTimer=null}if(this.enterFrameTimer){clearInterval(this.enterFrameTimer);this.enterFrameTimer=null}if(this.autoSpinTimer){clearTimeout(this.autoSpinTimer);this.autoSpinTimer=null;this.stopSpin()}if(this.idleLoadTimer){clearInterval(this.idleLoadTimer);this.idleLoadTimer=null}if(this.frameLoader){this.frameLoader.dispose();this.frameLoader=null}this.onReadyToDislpay=null;if(this.idleSpeed){clearInterval(this.idleSpeed);this.idleSpeed=null}for(var d=0;d<this.spinSetFrames.length;d++){this.spinSetFrames[d].dispose();delete this.spinSetFrames[d]}this.spinSetArray=null;this.spinSetItems=null;this.spinSetFrames=null;this.frameQueue=null;this.needPreload=null;this.spinSet=null;this.currentAsset=null;if(this.currentFrame){this.currentFrame.dispose();delete this.currentFrame}if(this.nextFrame){this.nextFrame.dispose();delete this.nextFrame}if(this.spinparams){delete this.spinparams}if(this.autoSet){this.autoSet=null}if(this.chk){this.chk.idle=[];this.chk={};delete this.chk}if(this.displayElement){this.displayElement.onselectstart=null;delete this.displayElement}delete this.iconEffectVisibility;delete this.curIdle;delete this.spinSet2D;delete this.container;delete this.viewProps;b.Util.removeTags(this.obj);this.obj.style.cssText=""};b.set.SpinView.prototype.dispose=function(){this.isDisposed=true;this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};b.set.SpinView.prototype.getCurrentView=function(){return this.currentFrame&&this.currentFrame.view};b.set.SpinView.prototype.setupInputController=function(){var e=this;this.handler=new b.event.InputController2(this.obj);this.handler.singleTapCallback=function(g,f,h){e.doTapAction(f,h,g.shiftKey,false);b.Event.dispatch(e.obj,b.Event.CLICK,false)};this.handler.doubleTapCallback=function(g,f,h){e.doTapAction(f,h,g.shiftKey,true)};this.handler.startTouchCallback=function(i,g,j){e.terminateAutospin();e.mouseDown(g,j);e.startX=g;e.startY=j;e.detectEventOwner=true;e.detectDirection=true;e.componentOwnsEvent=true;e.capstate=e.getCapabilityState_();e.startScrollX=window.scrollX;e.startScrollY=window.scrollY;if(e.spinSet2D&&e.currentFrame){var h=e.hei/e.spinSetDesc.items.length;var f=e.wid/e.spinSetDesc.items[e.currentFrame.rowIdx].items.length;f=f/e.sensitivity.xSensitivity;h=h/e.ySensitivity;e.detectDist=Math.max(Math.min(f,h)/2,1)}};this.handler.endTouchCallback=function(g,f,h){e.mouseUp(f,h,new Date().getTime())};this.handler.swipeCallback=function(g){var f=e.getCurrentView();if(f){if(!(f.state&4)){}else{f.inPinch=false;f.inPan=false;f.doPan(0,0,false);e.invalidate();var h=new b.event.UserEvent(b.event.UserEvent.PAN,[],true);b.Event.dispatch(e.obj,h,false)}}};this.handler.dragCallback=function(l,f,m,k,j){if(e.detectEventOwner&&(e.startScrollX!=window.scrollX||e.startScrollY!=window.scrollY)){e.componentOwnsEvent=false;e.detectEventOwner=false}var h=e.getCurrentView();if(h){if((h.state&4)){if(e.detectEventOwner){var i=Math.abs(e.startX-f);var g=Math.abs(e.startY-m);e.componentOwnsEvent=true;if(i>0||g>0){if(g>i){if(!e.capstate.hasCapability(b.SpinCapabilityState.PAN_DOWN)){if((e.startY-m)>=0){e.componentOwnsEvent=false}}else{if(!e.capstate.hasCapability(b.SpinCapabilityState.PAN_UP)){if((e.startY-m)<=0){e.componentOwnsEvent=false}}}}else{if(!e.capstate.hasCapability(b.SpinCapabilityState.PAN_RIGHT)){if((e.startX-f)>=0){e.componentOwnsEvent=false}}else{if(!e.capstate.hasCapability(b.SpinCapabilityState.PAN_LEFT)){if((e.startX-f)<=0){e.componentOwnsEvent=false}}}}}else{return}}if(e.componentOwnsEvent){e.detectEventOwner=false;l.preventDefault();h.inPan=true;h.doPan(k,j,true)}}else{var i=Math.abs(e.startX-f);var g=Math.abs(e.startY-m);if(e.detectEventOwner){if(i>0||g>0){if(e.spinSet2D){e.componentOwnsEvent=true;if(i<g){if((e.startY-m)>0){if(!e.capstate.hasCapability(b.SpinCapabilityState.SPIN_NORTH)){e.componentOwnsEvent=false}}if((e.startY-m)<0){if(!e.capstate.hasCapability(b.SpinCapabilityState.SPIN_SOUTH)){e.componentOwnsEvent=false}}}}else{e.componentOwnsEvent=i>g}}else{return}}if(e.detectDirection&&(i>e.detectDist||g>e.detectDist)){e.lockedVDir=i<g;e.detectDirection=false}if(e.componentOwnsEvent){e.detectEventOwner=false;l.preventDefault();if(e.lockdirection&&e.spinSet2D){if(e.lockedVDir){f=e.startX}else{m=e.startY}}e.mouseMove(f,m,new Date().getTime())}}}};this.handler.endDragCallback=function(j,f,l,i,h){var g=e.getCurrentView();if(g){g.inPinch=false;g.inPan=false;g.doPan(0,0,false);e.invalidate();var k=new b.event.UserEvent(b.event.UserEvent.PAN,[],true);b.Event.dispatch(e.obj,k,false)}};this.handler.pinchCallback=function(h,f,j,i){var g=e.getCurrentView();if(g){f-=b.Util.getObjPos(e.obj).x;j-=b.Util.getObjPos(e.obj).y;g.inPinch=true;g.pinchZoom(f,j,i,g.viewToImage)}};this.handler.endPinchCallback=function(h,f,j,i){var g=e.getCurrentView();if(g){g.inPinch=false;g.inPan=false;g.invalidate(false);e.invalidate();e.sendZoomEvent()}};if(b.browser.name==="ie"&&b.browser.version.minor<=8){var d=e.handler;this.handlerOverlay=new b.event.InputController2(this.iconEffectObj);this.handlerOverlay.singleTapCallback=function(g,f,h){d.singleTapCallback(g,f,h)};this.handlerOverlay.doubleTapCallback=function(g,f,h){d.doubleTapCallback(g,f,h)};this.handlerOverlay.startTouchCallback=function(g,f,h){d.startTouchCallback(g,f,h)};this.handlerOverlay.endTouchCallback=function(g,f,h){d.endTouchCallback(g,f,h)};this.handlerOverlay.swipeCallback=function(f){d.swipeCallback(f)};this.handlerOverlay.dragCallback=function(i,f,j,h,g){d.dragCallback(i,f,j)};this.handlerOverlay.endDragCallback=function(i,f,j,h,g){d.endDragCallback(i,f,j)};this.handlerOverlay.pinchCallback=function(g,f,i,h){d.pinchCallback(g,f,i)};this.handlerOverlay.endPinchCallback=function(g,f,i,h){d.endPinchCallback(g,f,i)}}};b.set.SpinView.prototype.doTapAction=function(d,j,g,i){var f=this.getCurrentView();if(f){var e=i?b.Enum.CLICK_STATE.DOUBLE_CLICK_TO_ZOOM:b.Enum.CLICK_STATE.CLICK_TO_ZOOM;var h=i?b.Enum.CLICK_STATE.DOUBLE_CLICK_TO_RESET:b.Enum.CLICK_STATE.CLICK_TO_RESET;d-=b.Util.getObjPos(this.obj).x;j-=b.Util.getObjPos(this.obj).y;if(this.clickToZoom&e){if(this.clickToZoom&h&&!(f.state&1)){f.zoomReset()}else{f.zoomClick(d,j,g)}}else{if(this.clickToZoom&h){f.zoomReset()}}}};b.set.SpinView.prototype.addEventListener=function(f,e,d){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.addEventListener - type: %0, handler: %1, useCapture: %2",f,e.toString().substring(0,e.toString().indexOf("(")),d);b.Base.prototype.addEventListener.apply(this,[f,e,d])};b.set.SpinView.prototype.sendStatusEvent=function(d){if(d.viewReady){if(!this.hiresIsReadySent){var e=new b.event.StatusEvent(b.event.StatusEvent.NOTF_HIGHRES_VIEW_READY,true);b.Event.dispatch(this.obj,e,false);this.hiresIsReadySent=true}}if(!d.viewReady){if(!this.viewIsReadySent){var e=new b.event.StatusEvent(b.event.StatusEvent.NOTF_VIEW_READY,true);b.Event.dispatch(this.obj,e,false);this.viewIsReadySent=true}d.viewReady=true}};b.set.SpinView.prototype.loadRequest=function(d){b.Logger.log(b.Logger.FINER,"s7sdk.set.SpinView.loadRequest - response: %0",d);var g=new b.event.StatusEvent(b.event.StatusEvent.NOTF_ASSET_METADATA_READY,true);b.Event.dispatch(this.obj,g,false);this.createMediaSet2D(b.MediaSetParser.parse(d.set,this.imageModifier));var f;for(var e=0;e<this.spinSetFrames.length;e++){f=this.spinSetFrames[e];f.dragToPan=!this.dragToSpin}this.settings.trackLoad(this);if(!this.skipAutoSpin){this.startAutospin()}this.skipAutoSpin=false};b.set.SpinView.prototype.errorRequest=function(d){b.Logger.log(b.Logger.WARNING,"s7sdk.set.SpinView.errorRequest - response: %0",d)};b.set.SpinView.prototype.setMediaSet=function(d){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.setMediaSet - mediaSet: %0",d);if(this.spinTimer){clearTimeout(this.spinTimer);this.spinTimer=null}this.initialFrame=0;this.viewIsReadySent=false;this.hiresIsReadySent=false;this.setMediaSetInternal(d);var e=new b.event.StatusEvent(b.event.StatusEvent.NOTF_ASSET_METADATA_READY,true);b.Event.dispatch(this.obj,e,false)};b.set.SpinView.prototype.setMediaSetInternal=function(f){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.setMediaSet - mediaSet: %0",f);this.spinSet=f.name;this.currentAsset=f;if(f.hasOwnProperty("items")){this.createMediaSet2D(f)}else{this.loadAsset(f);return}var e;for(var d=0;d<this.spinSetFrames.length;d++){e=this.spinSetFrames[d];e.dragToPan=!this.dragToSpin}this.settings.trackLoad(this);if(!this.skipAutoSpin){this.startAutospin()}this.skipAutoSpin=false};b.set.SpinView.prototype.terminateAutospin=function(){if(this.isReq&&(this.isReq.getStatus()==b.IS.STATUS_PENDING)){this.skipAutoSpin=true}if(!this.startupSpin){return}this.blockAutospin();if(this.lastVisible!=-1&&this.currentFrame&&this.currentFrame.view){if(this.currentFrame.view.viewReady){this.nextFrame=this.currentFrame}else{this.nextFrame=this.spinSetFrames[this.lastVisible]}this.replaceFrame()}this.frameQueue.push(this.currentFrame?this.currentFrame.idx:0)};b.set.SpinView.prototype.setAsset=function(d){this.terminateAutospin();this.setAssetInternal(d)};b.set.SpinView.prototype.setAssetInternal=function(e){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.setAsset - asset: %0",e);var d=this.spinSet;this.spinSetArray=[];this.spinSetFrames=[];this.spinSetItems=[];this.viewIsReadySent=false;this.hiresIsReadySent=false;this.currentAsset=e;this.loadAsset(e);if(d!=this.spinSet&&d!=null&&d!=""){var f=new b.event.UserEvent(b.event.UserEvent.SWAP,[0,this.spinSet],true);b.Event.dispatch(this.obj,f,false)}};b.set.SpinView.prototype.loadAsset=function(d){this.spinSet=d;var e=this.serverUrl+"/"+b.MediaSetParser.parseAssetForSetReq(this.spinSet).req;if(b.Util.isNonEmptyString(this.locale)){e+="&locale="+this.locale}this.isReq=new b.IS(this.serverUrl,this.spinSet);this.isReq.getHttpReq(e,function(g,f){b.set.SpinView.prototype.loadRequest.apply(f,[g])},function(g,f){b.set.SpinView.prototype.errorRequest.apply(f,[g])},this)};b.set.SpinView.prototype.draw=function(){if(this.currentFrame!=null&&this.currentFrame.view!=null){this.currentFrame.view.draw()}};b.set.SpinView.prototype.getWidth=function(){return this.wid};b.set.SpinView.prototype.getHeight=function(){return this.hei};b.set.SpinView.prototype.resize=function(d,g){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.resize - w: %0, h: %1",d,g);if(d==this.wid&&g==this.hei){return}this.wid=d>0?d:1;this.hei=g>0?g:1;this.devicePixelRatio=b.Util.adjustDevicePixelRatio(this.enableHD.maxHdPixels,this.hei,this.wid);if(this.currentFrame!=null&&this.currentFrame.view!=null){this.currentFrame.view.devicePixelRatio=this.devicePixelRatio}this.viewProps.outWidth=this.wid*this.devicePixelRatio;this.viewProps.outHeight=this.hei*this.devicePixelRatio;this.displayElement.width=this.viewProps.outWidth;this.displayElement.height=this.viewProps.outHeight;this.displayElement.style.width=this.wid+"px";this.displayElement.style.height=this.hei+"px";this.obj.style.width=this.wid+"px";this.obj.style.height=this.hei+"px";var j=false;if(this.currentFrame!=null){this.currentFrame.resize();if(this.currentFrame.view){this.currentFrame.view.draw();j=!Boolean(this.currentFrame.view.state&4)}}var f;if(this.spinSetFrames){for(var e=0;e<this.spinSetFrames.length;e++){f=this.spinSetFrames[e];if(f!=this.currentFrame){if(f!=null&&f.view!=null){f.view.devicePixelRatio=this.devicePixelRatio}f.resize()}if(j&&f.view!=null){f.view.zoomReset()}}}if(this.iconEffectObj.enabled){this.iconEffectObj.centerOverlay(d,g)}this.dispatchEvent(new b.event.ResizeEvent(b.event.ResizeEvent.COMPONENT_RESIZE,d,g,false));b.UIComponent.prototype.resize.apply(this,[d,g])};b.set.SpinView.prototype.adjustDevicePixelRatio=function(){this.devicePixelRatio=1;this.viewProps.outWidth=this.wid;this.viewProps.outHeight=this.hei;this.displayElement.width=this.viewProps.outWidth;this.displayElement.height=this.viewProps.outHeight;this.displayElement.style.width=this.wid+"px";this.displayElement.style.height=this.hei+"px";this.obj.style.width=this.wid+"px";this.obj.style.height=this.hei+"px";var e;for(var d=0;d<this.spinSetFrames.length;d++){e=this.spinSetFrames[d];e.viewProps=this.viewProps;e.resize()}if(this.iconEffectObj.enabled){this.iconEffectObj.centerOverlay(this.wid,this.hei)}};b.set.SpinView.prototype.getFrameDist=function(){if(this.maxFramesPerRow==0){return 0}var d=360/this.maxFramesPerRow;return(this.wid*d)/(360*2)};b.set.SpinView.prototype.getFrameDistY=function(){var d=360/this.spinSetDesc.items.length;return(this.hei*d)/(360*2)};b.set.SpinView.prototype.setDragToSpin=function(d){if(d==this.dragToSpin){return}this.updateDragToSpin(d)};b.set.SpinView.prototype.updateDragToSpin=function(f){this.dragToSpin=f;var e;for(var d=0;d<this.spinSetFrames.length;d++){e=this.spinSetFrames[d];e.dragToPan=!this.dragToSpin}this.checkCursor();if(this.spinSetFrames.length>0){this.stateChangeNotify()}};b.set.SpinView.prototype.getPanSpinMode=function(){return this.panSpinMode};b.set.SpinView.prototype.setPanSpinMode=function(d){this.panSpinMode=d;if(this.panSpinMode){this.applyPanSpin()}};b.set.SpinView.prototype.applyPanSpin=function(){if(this.currentFrame){this.dragToSpin=!Boolean(this.viewState&4)}else{this.dragToSpin=true}};b.set.SpinView.prototype.getFrameCount=function(d){var g=0;var e=this.getFrameDist();var f=Math.abs(d.currentX-this.lastX);if(f>e&&e>0){g=Math.floor(f/e)}return g};b.set.SpinView.prototype.getFrameSet=function(f,e){var k,j,i,m,l,d,h,g=[];k=(f-this.lastX)/this.getFrameDist();j=this.spinSet2D?this.yReverse*(e-this.lastY)/this.getFrameDistY():0;h=n(this.currentFrame.position.x,this.currentFrame.position.y,Math.round(this.currentFrame.position.x-k),Math.round(this.currentFrame.position.y-j));for(m=0;m<h.length;m++){i=h[m];if(i.x==this.currentFrame.position.x&&i.y==this.currentFrame.position.y){continue}i=this.wrapPoint(i);for(l=0;l<this.spinSetFrames.length;l++){d=this.spinSetFrames[l];if(d.position.x==i.x&&d.position.y==i.y){g.push(l);break}}}return g;function n(p,w,o,v){var z=Math.abs(o-p),y=Math.abs(v-w),u=(p<o)?1:-1,t=(w<v)?1:-1,q=z-y,x=[];var r=200;while(true){x.push(new b.Point2D(p,w));if((p==o)&&(w==v)){break}var s=2*q;if(s>-y){q-=y;p+=u}if(s<z){q+=z;w+=t}if(r--<0){break}}return x}};b.set.SpinView.prototype.wrapPoint=function(i,f){var h,g,d,e;if(this.spinSet2D){h=this.spinSetDesc.items;if(i.y<0||i.y>=h.length){if(this.wrapVertical){i.y=((i.y%h.length)+h.length)%h.length}else{i.y=i.y<0?0:h.length-1}}g=h[i.y];e=Math.round((this.maxFramesPerRow-g.items.length)/2);if(i.x<e||i.x>=(g.items.length+e)){if(f==b.Enum.SPIN_DIRECTION.NORTH||f==b.Enum.SPIN_DIRECTION.SOUTH){i.x=(i.x>e)?(g.items.length+e-1):e}else{d=g.items.length;i.x-=e;i.x=((i.x%d)+d)%d;i.x+=e}}}else{d=this.spinSetDesc.items.length;i.x=i.x=((i.x%d)+d)%d}return i};b.set.SpinView.prototype.mouseDown=function(d,e){b.Logger.log(b.Logger.FINEST,"s7sdk.set.SpinView.mouseDown - x: %0, y: %1",d,e);if(this.autoSpinTimer!=null){clearTimeout(this.autoSpinTimer);this.autoSpinTimer=null;this.stopSpin()}this.mouseIsDown=true;this.lastX=d;this.lastY=e;this.startFramePos=new b.Point2D(this.currentFrame.position.x,this.currentFrame.position.y);if(this.spinSet2D){this.startFramePos.x+=Math.round((this.maxFramesPerRow-this.spinSetDesc.items[this.currentFrame.position.y].items.length)/2)}this.lastFramePos=this.startFramePos;return false};b.set.SpinView.prototype.mouseMove=function(m,h,e){var i,f,g,l,j,o,k,n;if(this.currentFrame.view&&this.currentFrame.view.inTransition){this.currentFrame.view.stopTransition()}if(this.dragToSpin&&this.mouseIsDown){if(m==this.lastX&&h==this.lastY){return false}this.setSpinDirection(m,h,this.lastX,this.lastY);l=m-this.lastX;j=this.spinSet2D?this.yReverse*(h-this.lastY):0;var d=this.spinSet2D?this.spinSetDesc.items[this.currentFrame.position.y].items.length:this.maxFramesPerRow;o=Math.round(l*(d+1)*this.sensitivity.xSensitivity/(2*this.wid));k=Math.round(j*(this.spinSetDesc.items.length+1)*this.ySensitivity/(2*this.hei));i=new b.Point2D(this.lastFramePos.x-o,this.lastFramePos.y-k);i=this.wrapPoint(i,this.direction);g=this.spinSet2D?Math.round((this.maxFramesPerRow-this.spinSetDesc.items[i.y].items.length)/2):0;if((this.currentFrame.position.x+g)==i.x&&this.currentFrame.position.y==i.y){return false}for(n=0;n<this.spinSetFrames.length;n++){f=this.spinSetFrames[n];if((f.position.x+g)==i.x&&f.position.y==i.y){break}}this.frame=parseInt(n);this.lastFramePos=new b.Point2D(f.position.x,f.position.y);if(this.spinSet2D){this.lastFramePos.x+=Math.round((this.maxFramesPerRow-this.spinSetDesc.items[f.position.y].items.length)/2)}this.lastX=m;this.lastY=h;this.nextFrame=f;this.nextFrame.setPriority(b.SpinFrame.MAX_PRIORITY);this.nextFrame.setTileRender(false);this.nextFrame.setDelayTileLoad(true);this.nextFrame.loadFrame();this.nextFrame.invalidate();if(this.nextFrame.view==null){if(this.currentFrame!=null){this.currentFrame.view.writeOverlay("Please Wait ...");this.currentFrame.invalidate()}this.nextFrame.image.parentView=this;b.Event.addDOMListener(this.nextFrame.image,b.Event.VIEW_LOADED,b.set.SpinView.onFrameLoaded,false);this.paused=true}else{this.replaceFrame()}this.spinFrameTimeStamp=e;this.inSpinDrag=true;if(this.previousDirection==this.direction){var p=(e-this.spinFrameTimeStamp)/this.maxFramesPerRow;this.spinFrameStepTime=p*0.8+this.spinFrameStepTime*0.2}else{this.spinFrameStepTime=0}return true}return false};b.set.SpinView.prototype.gridCoordsToFrameIndex=function(e){var d=0,f,g;if(this.spinSet2D){for(g=0;g<this.spinSetDesc.items.length&&g<e.y;g++){d+=this.spinSetDesc.items[g].items.length}f=this.spinSet2D?Math.round((this.maxFramesPerRow-this.spinSetDesc.items[e.y].items.length)/2):0;if(e.x>=f&&e.x<this.maxFramesPerRow-f){d+=e.x-f}else{d=NaN}}else{d=e.x}return d};b.set.SpinView.prototype.setSpinDirection=function(i,h,g,f){var n,m,j;this.previousDirection=this.direction;n=i-g;if(!this.spinSet2D){if(n<0){this.direction=b.Enum.SPIN_DIRECTION.WEST;this.directionRadians=Math.PI}else{this.direction=b.Enum.SPIN_DIRECTION.EAST;this.directionRadians=0}return}m=this.yReverse*(h-f);j=Math.sqrt(n*n+m*m);var l=Math.asin(m/j);var d=Math.acos(n/j);var k=360*l/(2*Math.PI);var e=360*d/(2*Math.PI);if(m<0){this.directionRadians=d}else{this.directionRadians=2*Math.PI-d}if(k>67.5){this.direction=b.Enum.SPIN_DIRECTION.SOUTH}else{if(k<-67.5){this.direction=b.Enum.SPIN_DIRECTION.NORTH}else{if(e>152.5){this.direction=b.Enum.SPIN_DIRECTION.WEST}else{if(e<22.5){this.direction=b.Enum.SPIN_DIRECTION.EAST}else{if(k>22.5){if(e>90){this.direction=b.Enum.SPIN_DIRECTION.SOUTH_WEST}else{this.direction=b.Enum.SPIN_DIRECTION.SOUTH_EAST}}else{if(k<-22.5){if(e>90){this.direction=b.Enum.SPIN_DIRECTION.NORTH_WEST}else{this.direction=b.Enum.SPIN_DIRECTION.NORTH_EAST}}else{b.Logger.log(b.Logger.FINER,"s7sdk.set.SpinView - error determining spin direction for "+n+", "+m+", "+j)}}}}}}};b.set.SpinView.prototype.filterFrames=function(j){var e=[];var h=null;var i=null;var k,d,f;var g;switch(j){case b.Enum.SPIN_DIRECTION.WEST:g=this.maxFramesPerRow-1;break;case b.Enum.SPIN_DIRECTION.EAST:g=1;break;default:return}while(h==null||i!=h){if(i!=null&&h==null){h=i}k=new b.Point2D(0,0);if(this.spinSetFrames.length>=1){k.x=this.spinSetFrames[this.frameIdx(g)].position.x;k.y=this.spinSetFrames[this.frameIdx(g)].position.y;k.x+=this.spinSet2D?Math.round((this.maxFramesPerRow-this.spinSetDesc.items[k.y].items.length)/2):0}switch(j){case b.Enum.SPIN_DIRECTION.EAST:k.x-=1;break;case b.Enum.SPIN_DIRECTION.WEST:k.x+=1;break;case b.Enum.SPIN_DIRECTION.NORTH:k.y+=1;break;case b.Enum.SPIN_DIRECTION.SOUTH:k.y-=1;break;case b.Enum.SPIN_DIRECTION.NORTH_WEST:k.y+=1;k.x+=1;break;case b.Enum.SPIN_DIRECTION.NORTH_EAST:k.y+=1;k.x-=1;break;case b.Enum.SPIN_DIRECTION.SOUTH_WEST:k.y-=1;k.x+=1;break;case b.Enum.SPIN_DIRECTION.SOUTH_EAST:k.y-=1;k.x-=1;break;default:return}if(k.y<0||k.y>=this.spinSetDesc.items.length){k.y=k.y<0?0:this.spinSetDesc.items.length-1}f=this.spinSet2D?Math.round((this.maxFramesPerRow-this.spinSetDesc.items[k.y].items.length)/2):0;k=this.wrapPoint(k);for(d=0;d<this.spinSetFrames.length;d++){i=this.spinSetFrames[d];if((i.position.x+f)==k.x&&i.position.y==k.y){e.push(parseInt(d));g=parseInt(d);break}}}return e};b.set.SpinView.prototype.startAutospin=function(){if(!this.autospin.enabled){return}this.lastVisible=-1;this.spinparams={};var j=30;this.autoSet=[];if(this.spinSet2D){this.autoSet=this.filterFrames(!this.autospin.direction?b.Enum.SPIN_DIRECTION.EAST:b.Enum.SPIN_DIRECTION.WEST);this.autoSet.splice(this.autoSet.length-1,1)}else{this.autoSet.push(0);for(var h=0;h<this.spinSetFrames.length;h++){var k=this.autospin.direction?this.spinSetFrames.length-1-h:h;if(k!=0){this.autoSet.push(k)}}}this.frame=typeof(this.initialFrame)!="undefined"?this.initialFrame:0;var m=this.autospin.spinnumber==-1?1:this.autospin.spinnumber;this.spinparams.initialSteps=this.spinparams.steps=Math.round(this.autoSet.length*m);var f=this.autospin.duration*1000;var g=f*m/this.spinparams.steps;this.spinparams.oneStep=g;this.startupSpin=true;this.spinparams.checkQueue=true;this.spinparams.inProgress=true;this.spinparams.startFrame=this.spinSetFrames[this.frame];this.cntinueIdx=0;for(var h=0;h<this.autoSet.length;h++){if(this.autoSet[h]==this.frame){this.cntinueIdx=h;break}}if(Math.round(m)==m||this.spinSet2D){this.spinparams.lastFrame=this.spinparams.startFrame}this.spinparams.preloadCount=this.maxLoadRadius.radius==-1?this.autoSet.length:Math.min(this.autoSet.length,this.maxLoadRadius.radius);var d=this.cntinueIdx;this.frameQueue=[];for(var h=0;h<this.spinparams.preloadCount;h++){var l=this.autoSet[d];if(this.maxLoadRadius.highquality||(d==this.cntinueIdx)){this.frameQueue.push(l)}else{var e=this.spinSetFrames[l];e.setPriority(this.spinparams.preloadCount-h);this.frameLoader.load(e)}d++;if(d>=this.autoSet.length){d=0}}this.spinparams.displayStart=true;var n=this;this.spinTimer=setTimeout(function(){b.set.SpinView.prototype.autoSpinStep.call(n)},30)};b.set.SpinView.prototype.autoSpinIsWorking=function(){return this.spinTimer!=null};b.set.SpinView.prototype.isMediaSet=function(){return typeof(this.currentAsset)!="string"};b.set.SpinView.prototype.autoSpinStep=function(){if(this.spinparams.steps<=0||this.spinTimer==null){if(this.autospin.spinnumber==-1){this.spinparams.steps=this.spinparams.initialSteps}else{if(this.spinparams.lastFrame){this.nextFrame=this.spinparams.lastFrame;if(this.nextFrame.idx!=this.currentFrame.idx){this.replaceFrame()}}this.startupSpin=false;this.checkIconEffect();this.spinTimer=null;return}}var k=this;if(!this.spinparams.startFrame.view||!this.spinparams.startFrame.view.resetImageLoaded){this.spinTimer=setTimeout(function(){b.set.SpinView.prototype.autoSpinStep.call(k)},30);return}if(this.spinparams.displayStart){this.spinparams.displayStart=false;if(this.spinparams.checkQueue){var l=new b.event.StatusEvent(b.event.StatusEvent.NOTF_PRELOAD_START,true);b.Event.dispatch(this.obj,l,false)}this.nextFrame=this.spinparams.startFrame;this.replaceFrame();this.spinTimer=setTimeout(function(){b.set.SpinView.prototype.autoSpinStep.call(k)},30);return}var j=this.spinparams.oneStep<30?30:this.spinparams.oneStep;if(this.spinparams.checkQueue){var f=this.cntinueIdx;for(var h=0;h<this.spinparams.preloadCount;h++){var m=this.spinSetFrames[this.autoSet[f]];if(!m.view||(this.maxLoadRadius.highquality?!m.view.resetImageLoaded:!m.loaded)){this.spinTimer=setTimeout(function(){b.set.SpinView.prototype.autoSpinStep.call(k)},30);return}f++;if(f>=this.autoSet.length){f=0}}this.frameQueue=[];this.crStep=this.cntinueIdx;this.startTime=new Date().getTime();this.stepsFromStart=0;var l=new b.event.StatusEvent(b.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);b.Event.dispatch(this.obj,l,false)}else{var e=new Date().getTime();var g=(e-this.startTime)/this.spinparams.oneStep;while(g>this.stepsFromStart){this.crStep++;this.spinparams.steps--;this.stepsFromStart++;g=(e-this.startTime)/this.spinparams.oneStep;if(this.crStep>=this.autoSet.length){this.crStep=0}}}this.spinparams.checkQueue=false;this.spinparams.inProgress=true;if(this.crStep>=this.autoSet.length){this.crStep=0}if(this.maxLoadRadius.highquality){this.frameQueue.push(this.autoSet[this.crStep])}else{var d=this.spinSetFrames[this.autoSet[this.crStep]];this.focusToFrame(d)}this.crStep++;var n=this;this.spinTimer=setTimeout(function(){b.set.SpinView.prototype.autoSpinStep.call(n)},j);this.spinparams.steps--;this.stepsFromStart++};b.set.SpinView.prototype.focusToFrame=function(d){this.nextFrame=d;this.nextFrame.setPriority(b.SpinFrame.MAX_PRIORITY);this.nextFrame.setTileRender(false);this.nextFrame.setDelayTileLoad(true);this.nextFrame.loadFrame();if(this.nextFrame.view==null){if(this.currentFrame!=null){this.currentFrame.view.writeOverlay("Please Wait ...");this.currentFrame.invalidate()}this.nextFrame.image.parentView=this;b.Event.addDOMListener(this.nextFrame.image,b.Event.VIEW_LOADED,b.set.SpinView.onFrameLoaded,false);this.paused=true}else{this.replaceFrame();this.frameInvalidated=true}};b.set.SpinView.prototype.mouseUp=function(f,e,d){this.mouseIsDown=false;if(this.inSpinDrag){this.inSpinDrag=false;var k=true;var g=d-this.spinFrameTimeStamp;if(g<30){if(f!=this.lastX||e!=this.lastY){this.setSpinDirection(f,e,this.lastX,this.lastY);this.lastX=f;this.lastY=e}if(this.previousDirection==this.direction){this.stopSpin();var j=(g)/this.maxFramesPerRow;this.spinFrameStepTime=j*0.8+this.spinFrameStepTime*0.2}else{this.spinFrameStepTime=0;k=false}}else{k=false}b.Logger.log(b.Logger.FINEST,"s7sdk.set.SpinView.mouseUp - spinFrameStepTime: %0",this.spinFrameStepTime);if(this.spinFrameStepTime<200&&k){this.spinFrameStepTime=(this.spinFrameStepTime>30)?this.spinFrameStepTime:30;this.stopSpin();this.flickTtl=2000;if(this.spinSet2D&&this.spinSetIsRect){var l,i;l=this.lastX+3000*Math.cos(this.directionRadians);i=this.lastY-3000*Math.sin(this.directionRadians);this.flickSet=this.getFrameSet(l,i)}var h=this;this.autoSpinTimer=setTimeout(function(){b.set.SpinView.prototype.flickSpinStep.call(h)},30)}else{this.stopSpin();this.invalidate()}return true}else{if(this.autoSpinTimer!=null){return true}}return false};b.set.SpinView.prototype.flickSpinStep=function(){if(this.flickTtl<=0||this.autoSpinTimer==null||(this.flickSet&&this.flickSet.length<1)){this.autoSpinTimer=null;return}this.spinFrameStepTime*=1.1;this.flickTtl-=this.spinFrameStepTime+5;if(this.spinSet2D&&this.spinSetIsRect){if(this.flickSet&&this.flickSet.length>0){this.frameQueue.push(this.flickSet.shift())}}else{this.moveFrame_(this.direction)}var d=this;this.autoSpinTimer=setTimeout(function(){b.set.SpinView.prototype.flickSpinStep.call(d)},this.spinFrameStepTime)};b.set.SpinView.prototype.stopSpin=function(){if(this.paused){this.currentFrame.view.writeOverlay(null);b.Event.removeDOMListener(this.nextFrame.image,b.Event.VIEW_LOADED,b.set.SpinView.onFrameLoaded,false);this.paused=false}while(this.frameQueue.length>0){var d=this.spinSetFrames[this.frameQueue.shift()];if(d&&d.image){b.Event.removeDOMListener(d.image,b.Event.VIEW_LOADED,b.set.SpinView.onFrameLoaded,false)}}};b.set.SpinView.deferClickHandler=function(e,d){d.doubleClickTestTimer=null;if(d.view.clickToZoom&b.Enum.CLICK_STATE.CLICK_TO_ZOOM){d.view.currentFrame.view.zoomClick(e.clientX,e.clientY,e.shiftKey)}else{if(d.view.clickToZoom&b.Enum.CLICK_STATE.CLICK_TO_RESET){d.view.currentFrame.view.zoomReset()}}};b.set.SpinView.prototype.invalidate=function(){if(this.currentFrame!=null&&this.frameInvalidated==false){this.currentFrame.setTileRender(true);this.currentFrame.setDelayTileLoad(false);this.currentFrame.invalidate();this.frameInvalidated=true;var d=new b.event.UserEvent(b.event.UserEvent.SPIN,[this.currentFrame.idx],true);b.Event.dispatch(this.obj,d,false);this.stateChangeNotify()}};b.set.SpinView.prototype.enterFrame=function(){if(this.paused==false&&this.frameQueue.length>0){this.loadFrames()}if(this.mouseIsDown==false&&this.frameQueue.length==0&&this.t==0){this.invalidate()}};b.set.SpinView.prototype.onEnterFrame=function(g){var f=b.Event.getTarget(g).s7gesture;var d=f.view.getDisplayElement().s7spinView;if(!d){return}d.enterFrame()};b.set.SpinView.prototype.moveFrame=function(e){var d=this.yReverse;this.yReverse=1;this.moveFrame_(e);this.yReverse=d};b.set.SpinView.prototype.moveFrame_=function(h){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.moveFrame - direction: %0",h);this.terminateAutospin();var f,i,d,e;var g=this.getCapabilityState_();switch(h){case b.Enum.SPIN_DIRECTION.EAST:if(!(g.hasCapability(b.SpinCapabilityState.SPIN_EAST)||g.hasCapability(b.SpinCapabilityState.SPIN_WEST))){return}break;case b.Enum.SPIN_DIRECTION.WEST:if(!(g.hasCapability(b.SpinCapabilityState.SPIN_EAST)||g.hasCapability(b.SpinCapabilityState.SPIN_WEST))){return}break;case b.Enum.SPIN_DIRECTION.NORTH:if(!(g.hasCapability(b.SpinCapabilityState.SPIN_NORTH))){return}break;case b.Enum.SPIN_DIRECTION.SOUTH:if(!(g.hasCapability(b.SpinCapabilityState.SPIN_SOUTH))){return}break;case b.Enum.SPIN_DIRECTION.NORTH_WEST:if(!(g.hasCapability(b.SpinCapabilityState.SPIN_WEST)||g.hasCapability(b.SpinCapabilityState.SPIN_NORTH))){return}break;case b.Enum.SPIN_DIRECTION.NORTH_EAST:if(!(g.hasCapability(b.SpinCapabilityState.SPIN_EAST)||g.hasCapability(b.SpinCapabilityState.SPIN_NORTH))){return}break;case b.Enum.SPIN_DIRECTION.SOUTH_WEST:if(!(g.hasCapability(b.SpinCapabilityState.SPIN_SOUTH)||g.hasCapability(b.SpinCapabilityState.SPIN_WEST))){return}break;case b.Enum.SPIN_DIRECTION.SOUTH_EAST:if(!(g.hasCapability(b.SpinCapabilityState.SPIN_EAST)||g.hasCapability(b.SpinCapabilityState.SPIN_SOUTH))){return}break;default:return}this.zoomReset();if(this.direction!=h){this.stopSpin()}i=new b.Point2D(0,0);if(this.spinSetFrames.length>=1){i.x=this.spinSetFrames[this.frameIdx(this.frame)].position.x;i.y=this.spinSetFrames[this.frameIdx(this.frame)].position.y;i.x+=this.spinSet2D?Math.round((this.maxFramesPerRow-this.spinSetDesc.items[i.y].items.length)/2):0}this.direction=h;switch(h){case b.Enum.SPIN_DIRECTION.EAST:i.x-=1;break;case b.Enum.SPIN_DIRECTION.WEST:i.x+=1;break;case b.Enum.SPIN_DIRECTION.NORTH:i.y+=1;break;case b.Enum.SPIN_DIRECTION.SOUTH:i.y-=1;break;case b.Enum.SPIN_DIRECTION.NORTH_WEST:i.y+=1;i.x+=1;break;case b.Enum.SPIN_DIRECTION.NORTH_EAST:i.y+=1;i.x-=1;break;case b.Enum.SPIN_DIRECTION.SOUTH_WEST:i.y-=1;i.x+=1;break;case b.Enum.SPIN_DIRECTION.SOUTH_EAST:i.y-=1;i.x-=1;break;default:return}if(i.y<0||i.y>=this.spinSetDesc.items.length){i.y=i.y<0?0:this.spinSetDesc.items.length-1}e=this.spinSet2D?Math.round((this.maxFramesPerRow-this.spinSetDesc.items[i.y].items.length)/2):0;i=this.wrapPoint(i);this.adjustSpeed();for(d=0;d<this.spinSetFrames.length;d++){f=this.spinSetFrames[d];if((f.position.x+e)==i.x&&f.position.y==i.y){this.frame=parseInt(d);this.frameQueue.push(parseInt(d));break}}};b.set.SpinView.prototype.adjustSpeed=function(){this.t+=2;if(this.idleSpeed==-1){this.idleSpeed=setInterval(b.Util.wrapContext(this.checkSpeed,this),500)}};b.set.SpinView.prototype.checkSpeed=function(){if(this.t==0){this.frameSpeed=1;clearInterval(this.idleSpeed);this.idleSpeed=-1}else{this.frameSpeed=this.smoothFactor*this.t+(1-this.smoothFactor)*this.frameSpeed}this.t=0};b.set.SpinView.prototype.idleLoad=function(){if(this.autoSpinTimer){return}if(this.startupSpin||!this.currentFrame){return}if(this.curIdle&&!this.curIdle.view.resetImageLoaded){return}var r=this.spinSet2D?Math.round((this.maxFramesPerRow-this.spinSetDesc.items[this.currentFrame.position.y].items.length)/2):0;var e=5-this.frameLoader.loading;var h=0;var o=0;var f;if(!this.chk){this.chk={};this.chk.tilesLoaded=false;this.chk.started=false;this.chk.complete=false}if((this.currentFrame!=this.chk.currentFrameChk||this.chk.adj!=r)&&!this.chk.tilesLoaded){if(e==0){return}var u;if(this.currentFrame!=this.chk.currentFrameChk){this.chk.idle=[];u=[];var v=0;var p=this.maxLoadRadius.radius==-1?this.spinSetFrames.length:this.maxRadius;if(this.spinSet2D&&this.maxLoadRadius.radius==-1){p=Math.ceil(Math.sqrt(this.spinSetDesc.items.length*this.spinSetDesc.items.length+this.maxCol2D*this.maxCol2D))}for(;v<p;v++){b.SpinViewUtil.filledCircle(this.currentFrame.position.x,this.currentFrame.position.y,v,b.SpinViewUtil.uniquePixelSetter(b.Util.wrapContext(function(k,z){var j=this.wrapPoint(new b.Point2D(k,z));var i=this.gridCoordsToFrameIndex(j);if(!isNaN(i)){if(!u[i]){u[i]=true;this.chk.idle.push(i)}}},this)))}this.chk.currentFrameChk=this.currentFrame;this.chk.tilesLoaded=true;for(o=0;o<this.spinSetFrames.length;o++){f=this.spinSetFrames[o];if(f&&!f.loaded){this.chk.tilesLoaded=false;break}}if(this.chk.tilesLoaded){if(this.chk.started&&!this.chk.complete){this.chk.started=false;this.chk.complete=false;var q=new b.event.StatusEvent(b.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);b.Event.dispatch(this.obj,q,false)}return}var d=true;for(;o<this.chk.idle.length;o++){f=this.spinSetFrames[o];if(f&&!f.loaded){d=false;break}}if(d){if(!this.chk.complete&&this.chk.started){var q=new b.event.StatusEvent(b.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);b.Event.dispatch(this.obj,q,false)}this.chk.started=false;this.chk.complete=false;return}else{if(this.chk.complete&&this.chk.started){this.chk.started=false;this.chk.complete=false}}}var g=[];var w=[];for(;h<e&&o<this.chk.idle.length;o++){if(h>=e){continue}var t=this.chk.idle[o];if(t=="undefined"){continue}if(!w[t]){var f=this.spinSetFrames[t];g.push(t);w[t]=true;if(f&&!f.loaded){this.needPreload.push(f);f.setPriority(Math.max(50-o,1));this.frameLoader.load(f);h++}}}if(!this.chk.started){if(this.needPreload.length!=0){this.chk.started=true;var q=new b.event.StatusEvent(b.event.StatusEvent.NOTF_PRELOAD_START,true);b.Event.dispatch(this.obj,q,false)}}else{if(!this.chk.complete){if(o==this.chk.idle.length&&this.needPreload.length==0){this.chk.complete=true;var q=new b.event.StatusEvent(b.event.StatusEvent.NOTF_PRELOAD_COMPLETE,true);b.Event.dispatch(this.obj,q,false);this.chk.tilesLoaded=true;for(o=0;o<this.spinSetFrames.length;o++){f=this.spinSetFrames[o];if(f&&!f.loaded){this.chk.tilesLoaded=false;break}}}}}this.chk.prev=this.chk.cur;this.chk.cur=g.join(",");this.chk.adj=this.maxLoadRadius.radius==-1?1:r}if(this.needPreload.length!=0){var m=true;for(var l=0;l<this.needPreload.length;l++){if(!this.needPreload[l].loaded){m=false;break}}if(m){if(this.maxLoadRadius.highquality){for(var l=0;l<this.chk.idle.length;l++){var s=this.spinSetFrames[this.chk.idle[l]];if(!s.loaded){s.setPriority(30);this.frameLoader.load(s);return}if(s.view.resetImageLoaded==false){s.view.loadImage();return}}}this.needPreload=[];if(this.chk.prev!=this.chk.cur){this.chk.adj++}}}if(this.maxRadius<=this.maxFramesPerRow/2&&(this.maxRadius<this.maxLoadRadius.radius||this.maxLoadRadius.radius==-1)){this.maxRadius++}if(this.maxLoadRadius.radius!=-1){return}for(o=0;h<e&&o<this.spinSetFrames.length;o++){f=this.spinSetFrames[o];if(f&&!f.loaded){f.setPriority(30);this.frameLoader.load(f);h++}}if(h==0){var n=true;for(o=0;o<this.spinSetFrames.length;o++){if(this.spinSetFrames[o].view==null||this.spinSetFrames[o].view.resetImageLoaded==false){n=false;if(this.maxLoadRadius.highquality){this.scheduleFramesExt();if(this.spinSetFrames[o].view){this.spinSetFrames[o].view.loadImage();this.curIdle=this.spinSetFrames[o]}}break}}if(n){window.clearInterval(this.idleLoadTimer)}}return};b.set.SpinView.prototype.createMediaSet=function(e){var h;var f=0;this.spinSetArray=[];this.spinSetFrames=[];this.spinSetItems=[];if(this.idleLoadTimer){clearInterval(this.idleLoadTimer);this.idleLoadTimer=null}if(this.enterFrameTimer){clearInterval(this.enterFrameTimer);this.enterFrameTimer=null}this.spinSetItems=e.items;while(this.spinSetItems.hasOwnProperty("length")&&this.spinSetItems.length>0&&this.spinSetItems[0]!=undefined&&this.spinSetItems[0].hasOwnProperty("items")&&this.spinSetItems[0].items.length>0){this.spinSetItems=this.spinSetItems[0].items}for(var d=0;d<this.spinSetItems.length;d++){if(typeof(this.spinSetItems[d])=="undefined"){b.Logger.log(b.Logger.WARNING,"s7sdk.set.SpinView - Malformed data in MediaSetDesc: %0",e.name);continue}h=this.spinSetItems[d].name||"";h=h.trim();this.spinSetArray.push(h);function g(j,i,k){j+=((j.indexOf("?")==-1)?"?":"&")+i;j+=(typeof k=="undefined")?"":"="+k;return j}if(this.iscommand!=null&&this.iscommand.length>0){h=g(h,this.iscommand)}if(b.Util.isNonEmptyString(this.locale)){h=g(h,"locale",this.locale)}if(b.Util.isNonEmptyString(this.spinSetItems[d].version)){h=g(h,"id",this.spinSetItems[d].version)}this.spinSetFrames[f]=new b.SpinFrame(this,this.serverUrl,h,f++,this.viewProps,this.spinSetItems[d].width,this.spinSetItems[d].height);this.spinSetFrames[f].position=new b.Point2D(f,0)}this.frame=-1;this.moveFrame(b.Enum.SPIN_DIRECTION.WEST);this.idleLoadTimer=setInterval(b.Util.wrapContext(this.idleLoad,this),100);this.enterFrameTimer=setInterval(b.Util.wrapContext(this.enterFrame,this),1000/24)};b.set.SpinView.prototype.isMediaSet2D=function(d){return d.items.hasOwnProperty("length")&&d.items.length>0&&d.items[0]!=undefined&&d.items[0].hasOwnProperty("items")&&d.items[0].items.length>0};b.set.SpinView.prototype.createMediaSet2D=function(l){var n=this,j,m,h,e,f,k=0,g=0;this.spinSetArray=[];if(this.spinSetFrames!=null){for(var j=0;j<this.spinSetFrames.length;j++){this.spinSetFrames[j].dispose();delete this.spinSetFrames[j]}}this.currentFrame=null;this.spinSetFrames=[];this.spinSetItems=[];this.maxFramesPerRow=0;if(this.idleLoadTimer){clearInterval(this.idleLoadTimer);this.idleLoadTimer=null}if(this.enterFrameTimer){clearInterval(this.enterFrameTimer);this.enterFrameTimer=null}if(this.autoSpinTimer!=null){clearTimeout(this.autoSpinTimer);this.autoSpinTimer=null;this.stopSpin()}this.spinSet2D=this.isMediaSet2D(l);b.Util.css.setCSSAttributeSelector(this.iconEffectObj.obj,"state",this.spinSet2D?"spin_2D":"spin_1D");this.spinSetIsRect=true;this.spinSetDesc=l;if(this.spinSet2D){this.maxCol2D=0;for(m=0;m<this.spinSetDesc.items.length;m++){h=this.spinSetDesc.items[m];f=0;for(j=0;h.items&&j<h.items.length;j++){if(typeof(h.items[j])=="undefined"){b.Logger.log(b.Logger.WARNING,"s7sdk.set.SpinView - Malformed data in MediaSetDesc: %0",l.name);continue}this.spinSetFrames[g]=d(h.items[j]);this.spinSetFrames[g-1].rowIdx=m;f+=1}if(this.maxCol2D<f){this.maxCol2D=f}k+=1;if(f>this.maxFramesPerRow){this.maxFramesPerRow=f}if(f!=this.maxFramesPerRow){this.spinSetIsRect=false}}}else{this.spinSetItems=l.items;while(this.spinSetItems.hasOwnProperty("length")&&this.spinSetItems.length>0&&this.spinSetItems[0]!=undefined&&this.spinSetItems[0].hasOwnProperty("items")&&this.spinSetItems[0].items.length>0){this.spinSetItems=this.spinSetItems[0].items}f=0;for(m=0;m<this.spinSetDesc.items.length;m++){if(typeof(this.spinSetDesc.items[m])=="undefined"){continue}this.spinSetFrames[g]=d(this.spinSetDesc.items[m]);f+=1;this.maxFramesPerRow=f}}this.maxLoadRadius.radius=(this.maxLoadRadius.radius>this.maxFramesPerRow/2)?Math.ceil(this.maxFramesPerRow/2):this.maxLoadRadius.radius;this.maxRadius=this.maxLoadRadius.radius>0?this.maxLoadRadius.radius:1;this.frame=typeof(this.initialFrame)!="undefined"?this.initialFrame:0;this.frameQueue.push(this.frame);this.idleLoadTimer=setInterval(b.Util.wrapContext(this.idleLoad,this),100);this.enterFrameTimer=setInterval(b.Util.wrapContext(this.enterFrame,this),1000/24);function d(i){e=i.name||"";e=e.trim();function p(r,q,s){r+=((r.indexOf("?")==-1)?"?":"&")+q;r+=(typeof s=="undefined")?"":"="+s;return r}if(n.iscommand!=null&&n.iscommand.length>0){e=p(e,n.iscommand)}if(b.Util.isNonEmptyString(n.locale)){e=p(e,"locale",n.locale)}if(b.Util.isNonEmptyString(i.version)){e=p(e,"id",i.version)}var o=new b.SpinFrame(n,n.serverUrl,e,g++,n.viewProps,i.width,i.height);o.position=new b.Point2D(f,k);n.spinSetArray.push(e);return o}};b.set.SpinView.prototype.ioErrorHandler=function(d){Logger.log(Logger.SEVERE,"SpinViewCC.ioErrorHandler Invalid image set response: %0",d);this.visible=false;this.dispatchEvent(d)};b.set.SpinView.prototype.frameIdx=function(d){return((d%this.spinSetFrames.length)+this.spinSetFrames.length)%this.spinSetFrames.length};b.set.SpinView.prototype.loadFrames=function(){if(this.spinSetFrames.length==0||this.frameQueue.length==0){return}this.nextFrame=this.spinSetFrames[this.frameQueue.shift()];if(typeof(this.nextFrame)=="undefined"){b.Logger.log(b.Logger.WARNING,"s7sdk.set.SpinView - undefined frame in mediaSet: %0",this.mediaSet_);return}this.nextFrame.setPriority(b.SpinFrame.MAX_PRIORITY);this.nextFrame.setTileRender(false);this.nextFrame.setDelayTileLoad(true);this.nextFrame.loadFrame();this.nextFrame.invalidate();if(this.nextFrame.view==null){if(this.currentFrame!=null){this.currentFrame.view.writeOverlay("Please Wait ...");this.currentFrame.invalidate()}this.nextFrame.image.parentView=this;b.Event.addDOMListener(this.nextFrame.image,b.Event.VIEW_LOADED,b.set.SpinView.onFrameLoaded,false);this.paused=true}else{if(!this.autospin.enabled||!this.spinparams||!this.spinparams.checkQueue){this.replaceFrame()}}this.scheduleFrames()};b.set.SpinView.prototype.replaceFrame=function(){if(this.currentFrame!=null&&this.currentFrame.view!=null){this.currentFrame.view.writeOverlay(null);this.currentFrame.unload(1);if(this.currentFrame.view.getDisplayElement()!=null){b.Event.removeDOMListener(this.currentFrame.view.getDisplayElement(),b.Event.ENTER_FRAME,this.onEnterFrame,false);this.currentFrame.view.getDisplayElement().s7spinView=null;this.currentFrame.view.detach()}}if(this.currentFrame&&this.currentFrame.view.viewReady){this.lastVisible=this.currentFrame.idx}this.currentFrame=this.nextFrame;this.frameInvalidated=false;this.currentFrame.view.attach(this);this.currentFrame.view.getDisplayElement().s7spinView=this;b.Event.addDOMListener(this.currentFrame.view.getDisplayElement(),b.Event.ENTER_FRAME,this.onEnterFrame,false);this.frame=this.currentFrame.idx;this.checkIconEffect();var d;if(this.spinSet2D){d=this.spinSetDesc.items[this.currentFrame.position.y]}else{d=this.spinSetItems[this.currentFrame.idx]}var e=new b.event.AssetEvent(b.event.AssetEvent.ASSET_CHANGED,d,this.currentFrame.idx,true);this.dispatchEvent(e)};b.set.SpinView.prototype.scheduleFramesExt=function(){if(this.startupSpin){return}var d=1;switch(this.direction){case b.Enum.SPIN_DIRECTION.WEST:d=1;break;case b.Enum.SPIN_DIRECTION.EAST:d=-1;break;default:}var e=this.spinSetFrames[this.frameIdx(this.lastScheduled.idx+d)];e.setPriority(this.lastScheduled.priority-1);this.lastScheduled=e;this.frameLoader.load(e)};b.set.SpinView.prototype.scheduleFrames=function(){if(this.frameQueue.length>0||this.startupSpin){return}this.nextFrame.invalidate();var f=(this.frameSpeed>2)?this.frameSpeed:4;this.frameLoader.toLoad=f;this.frameLoader.reducePriority();var e;var h;var d=b.SpinFrame.MAX_PRIORITY;var g=1;switch(this.direction){case b.Enum.SPIN_DIRECTION.WEST:g=1;break;case b.Enum.SPIN_DIRECTION.EAST:g=-1;break;default:}for(e=0;e<f;e++){h=this.spinSetFrames[this.frameIdx(this.nextFrame.idx+g*e)];h.setPriority(d--);this.lastScheduled=h;this.frameLoader.load(h);if(e<3&&this.frameSpeed<3){h.setDelayTileLoad(true);h.invalidate()}}h=this.spinSetFrames[this.frameIdx(this.nextFrame.idx-g)];h.setPriority(d);this.frameLoader.load(h)};b.set.SpinView.prototype.createWaitOverlay=function(){};b.set.SpinView.onFrameLoaded=function(f){var d=b.Event.getTarget(f);b.Event.removeDOMListener(d,b.Event.VIEW_LOADED,b.set.SpinView.onFrameLoaded,false);d.parentView.paused=false;d.parentView.replaceFrame()};b.set.SpinView.prototype.getFrameSpeed=function(){return this.frameSpeed};b.set.SpinView.prototype.cursorOn=function(){if(this.overrideCursor){for(var d=0;d<this.spinSetArray.length;d++){if(this.spinSetArray[d].view){d.view.overrideCursor=this}}this.overrideCursor=null}};b.set.SpinView.prototype.cursorOff=function(){if(!this.overrideCursor){for(var d=0;d<this.spinSetArray.length;d++){if(this.spinSetArray[d].view){d.view.overrideCursor=null}}this.overrideCursor=this.currentFrame.view}};b.set.SpinView.prototype.checkCursor=function(){if(!Boolean(this.viewState&4)){this.cursorOn();this.cursor=this.dragToSpin?"dragToSpin":"zoomIn"}else{if(this.dragToSpin&&this.mouseIsDown){this.cursorOn();this.cursor="dragToSpin"}else{this.cursorOff()}}};b.set.SpinView.prototype.checkIconEffect=function(){if(typeof this.iconEffectVisible=="undefined"){this.iconEffectVisible=true}if(this.iconEffectObj.enabled){if(!this.iconEffectVisible||this.frame!=0||(this.viewState&&(this.viewState&4))){this.iconEffectObj.hide()}else{if(this.iconEffectVisible&&!this.startupSpin){this.iconEffectObj.show(this.wid,this.hei)}}}};b.set.SpinView.prototype.viewInvalidate=function(m){if(this.currentFrame==null){return}var k=this.currentFrame.view;var g=new b.Rectangle(Math.round(m.x*k.imageWidth),Math.round(m.y*k.imageHeight),Math.round(m.width*k.imageWidth),Math.round(m.height*k.imageHeight));b.Event.dispatch(this.obj,new b.event.ZoomRgnEvent(b.event.ZoomRgnEvent.NOTF_ZOOM_NRGN,m),false);b.Event.dispatch(this.obj,new b.event.ZoomRgnEvent(b.event.ZoomRgnEvent.NOTF_ZOOM_RGN,g),false);if(!this.lastViewPort||this.lastViewPort.isEmpty()||m.equals(this.lastViewPort)){this.lastViewPort=m;return}var f=this.imagePixelsToViewPoint(g.topLeft());var d=this.imagePixelsToViewPoint(g.bottomRight());var h=(d.y-f.y)/(m.height*k.imageHeight);h=Math.round((h+0.00005)*10000)/100;if(h!=this.lastScale){if(!k.inTransition){}this.lastScale=h}else{var i=this.imagePixelsToViewPoint(new b.Point2D(Math.round(this.lastViewPort.x*k.imageWidth),Math.round(this.lastViewPort.y*k.imageHeight)));var n=Math.round(i.x-f.x);var l=Math.round(i.y-f.y);if(n!=0||l!=0){var j=new b.event.ZoomPanEvent(b.event.ZoomPanEvent.NOTF_ZOOM_NPAN,this.lastViewPort.x-m.x,this.lastViewPort.y-m.y);b.Event.dispatch(this.obj,j,false);j=new b.event.ZoomPanEvent(b.event.ZoomPanEvent.NOTF_ZOOM_PAN,n,l);b.Event.dispatch(this.obj,j,false)}}this.lastViewPort=m};b.set.SpinView.prototype.viewTransitionStop=function(){this.sendZoomEvent()};b.set.SpinView.prototype.sendZoomEvent=function(){if(this.lastScale!=this.lastZoomEventScale){var d=new b.event.UserEvent(b.event.UserEvent.ZOOM,[Math.round(this.lastScale)],true);b.Event.dispatch(this.obj,d,false);this.lastZoomEventScale=this.lastScale}};b.set.SpinView.prototype.viewStateChange=function(d){if(d==this.viewState){return}this.viewState=d;this.checkIconEffect();if(this.panSpinMode){this.applyPanSpin()}this.checkCursor();this.stateChangeNotify()};b.set.SpinView.prototype.viewStatusChange=function(d){};b.set.SpinView.prototype.getState=function(){b.Logger.log(b.Logger.WARNING,"s7sdk.set.SpinView.getState - This method has been deprecated, use getCapabilityState() instead!");return this.getCapabilityState()};b.set.SpinView.prototype.getZoomLevel=function(){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.getZoomLevel");if(this.currentFrame!=null&&this.currentFrame.view!=null){var d=this.currentFrame.view;var f=b.browser.name==="ie"&&(b.browser.version.major<11)?b.rgn.View.epsilon2:b.View.epsilon2;if(Math.abs(d.topScale-d.initScale)>f){var e=(d.viewToImage.d-d.initScale)/(d.topScale-d.initScale);if(!isNaN(e-0)){e=e<0?0:e;e=e>1?1:e;return Math.round(e*100)}}}return 0};b.set.SpinView.prototype.getFramesLength=function(){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.getFramesLength");return this.spinSetFrames.length};b.set.SpinView.prototype.getCurrentFrame=function(){return this.currentFrame};b.set.SpinView.prototype.getCurrentFrameIndex=function(){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.getCurrentFrameIndex");return this.frameIdx(this.frame)};b.set.SpinView.prototype.setCurrentFrameIndex=function(d){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.setCurrentFrameIndex - val: %0",d);this.terminateAutospin();if(this.isDisposed){return}this.setCurrentFrameIndexInternal(d)};b.set.SpinView.prototype.setCurrentFrameIndexInternal=function(e){if(!this.spinSetFrames||e<0||e>this.spinSetFrames.length-1||e==this.frameIdx(this.frame)){return}if(this.currentFrame&&this.currentFrame.view){this.currentFrame.view.zoomReset()}var d=(this.frameIdx(this.frame)<e)?b.Enum.SPIN_DIRECTION.WEST:b.Enum.SPIN_DIRECTION.EAST;if(this.direction!=d){this.stopSpin();this.direction=d}this.frame=e;this.frameQueue.push(e);this.adjustSpeed()};b.set.SpinView.prototype.imagePixelsToViewPoint=function(e){if(this.currentFrame==null||this.currentFrame.view==null){return new Point2D(Number.POSITIVEINFINITY,Number.POSITIVEINFINITY)}var d=this.currentFrame.view.imagePixelsToViewPoint(e);d.offset(this.currentFrame.view.x,this.currentFrame.view.y);return d};b.set.SpinView.prototype.viewPointToImagePixels=function(d){if(this.currentFrame==null||this.currentFrame.view==null){return new b.Point2D(Number.POSITIVEINFINITY,Number.POSITIVEINFINITY)}var f=new b.Point2D(0,0);var e=new b.Point2D(d.x-f.x,d.y-f.y);return this.currentFrame.view.viewPointToImagePixels(e)};b.set.SpinView.prototype.blockAutospin=function(){this.startupSpin=false;if(this.spinTimer){clearTimeout(this.spinTimer);this.spinTimer=null;this.checkIconEffect()}if(this.spinparams&&(this.spinparams.checkQueue||this.spinparams.inProgress)){this.frameQueue=[];this.spinparams.inProgress=this.spinparams.checkQueue=false}};b.set.SpinView.prototype.zoomIn=function(){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.zoomIn");this.blockAutospin();if(this.currentFrame.view){this.stopSpinning();if(this.startupSpin&&this.currentFrame.idx!=this.lastVisible&&this.lastVisible!=-1){this.nextFrame=this.spinSetFrames[this.lastVisible];this.replaceFrame()}this.currentFrame.view.zoomIn()}};b.set.SpinView.prototype.zoomOut=function(){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.zoomOut");if(this.currentFrame.view){this.currentFrame.view.zoomOut()}};b.set.SpinView.prototype.zoomReset=function(){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.zoomReset");if(this.currentFrame&&this.currentFrame.view){this.currentFrame.view.zoomReset()}};b.set.SpinView.prototype.zoomNPan=function(e,d){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.zoomNPan - dx: %0, dy: %1",e,d);if(this.currentFrame.view&&(e!=0||d!=0)){this.currentFrame.view.doNPan(e,d);var f=new b.event.UserEvent(b.event.UserEvent.PAN,[],true);b.Event.dispatch(this.obj,f,false)}};b.set.SpinView.prototype.imagePixelsToViewPoint=function(e){if(this.currentFrame==null||this.currentFrame.view==null){return new Point(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)}var d=this.currentFrame.view.imagePixelsToViewPoint(e);return d};b.set.SpinView.prototype.getCapabilityState=function(){var d=this.yReverse;this.yReverse=1;var e=this.getCapabilityState_();this.yReverse=d;return e};b.set.SpinView.prototype.getCapabilityState_=function(){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.getCapabilityState");var e=new b.SpinCapabilityState(this.viewState);e.removeCapability(b.SpinCapabilityState.SPIN_WEST|b.SpinCapabilityState.SPIN_EAST|b.SpinCapabilityState.SPIN_NORTH|b.SpinCapabilityState.SPIN_SOUTH);if(this.dragToSpin==true){e.removeCapability(b.SpinCapabilityState.PAN_LEFT|b.SpinCapabilityState.PAN_RIGHT|b.SpinCapabilityState.PAN_UP|b.SpinCapabilityState.PAN_DOWN)}if(this.spinSet2D&&this.currentFrame){var g=this.currentFrame.position;var d=this.maxFramesPerRow-1;var f=this.spinSetDesc.items.length-1;if(this.maxFramesPerRow>1){e.setCapability(b.SpinCapabilityState.SPIN_WEST|b.SpinCapabilityState.SPIN_EAST)}if(f>=1){if((g.y>0)&&(g.y<f)){e.setCapability(b.SpinCapabilityState.SPIN_NORTH|b.SpinCapabilityState.SPIN_SOUTH)}else{if(g.y==0){if(this.yReverse<0){e.removeCapability(b.SpinCapabilityState.SPIN_NORTH);e.setCapability(b.SpinCapabilityState.SPIN_SOUTH)}else{e.removeCapability(b.SpinCapabilityState.SPIN_SOUTH);e.setCapability(b.SpinCapabilityState.SPIN_NORTH)}}else{if(g.y==f){if(this.yReverse<0){e.removeCapability(b.SpinCapabilityState.SPIN_SOUTH);e.setCapability(b.SpinCapabilityState.SPIN_NORTH)}else{e.removeCapability(b.SpinCapabilityState.SPIN_NORTH);e.setCapability(b.SpinCapabilityState.SPIN_SOUTH)}}}}}}else{if(this.getFramesLength()>1){e.setCapability(b.SpinCapabilityState.SPIN_WEST|b.SpinCapabilityState.SPIN_EAST)}else{}}return e};b.set.SpinView.prototype.stateChangeNotify=function(){var d=this.getCapabilityState();if(!this.currentSpinState||this.currentSpinState.state!=d.state){this.dispatchEvent(new b.event.CapabilityStateEvent(b.event.CapabilityStateEvent.NOTF_SPIN_CAPABILITY_STATE,d));this.currentSpinState=d}};b.set.SpinView.prototype.zoomRgn=function(d){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.zoomRgn - rgn: %0",d);if(this.currentFrame.view){this.stopSpinning();this.currentFrame.view.zoomRgn(d)}};b.set.SpinView.prototype.zoomNRgn=function(d){b.Logger.log(b.Logger.FINE,"s7sdk.set.SpinView.zoomNRgn - rgn: %0",d);if(this.currentFrame.view){this.stopSpinning();this.currentFrame.view.zoomNRgn(d)}};b.set.SpinView.prototype.stopSpinning=function(){if(this.autoSpinTimer!=null){clearTimeout(this.autoSpinTimer);this.autoSpinTimer=null;this.stopSpin()}};b.set.SpinView.prototype.getCurrentAsset=function(){return typeof this.currentAsset=="undefined"?null:this.currentAsset};b.set.SpinView.prototype.setCurrentAsset=function(d){if(typeof(d)=="string"){this.setAssetInternal(d)}else{this.currentAsset=d}};b.SpinView=b.set.SpinView;(function a(){var g=b.Util.css.createCssRuleText;var f=b.Util.css.createCssImgUrlText;var e=b.browser&&b.browser.name=="ie"&&b.browser.version.major>=10;extraRulesText=(typeof extraRulesText==="string")?extraRulesText:"";var d=g(".s7spinview",{"background-color":"#ffffff",position:"absolute",width:"400px",height:"400px","user-select":"none","-moz-user-select":"-moz-none","-webkit-user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-ms-touch-action":e?"none":"","touch-action":e?"none":"",filter:"alpha(opacity=100)",opacity:"1","text-align":"left"})+g(".s7spinview img",{"max-width":"none","max-height":"none"})+g(".s7spinview .s7iconeffect",{width:"120px",height:"120px","-webkit-transform":"translateZ(0px)","background-repeat":"no-repeat","background-position":"center"})+g(".s7spinview .s7iconeffect[state='spin_1D']",{"background-image":f("spinicon.png")})+g(".s7spinview .s7iconeffect[state='spin_2D']",{"background-image":f("spinicon_2D.png")});b.Util.css.addDefaultCSS(d,"SpinView")})()}if(!b.SpinViewUtil){b.SpinViewUtil=new function c(){var f=this;this.line=function e(k,r,j,q,o){var t=Math.abs(j-k),s=Math.abs(q-r),p,n,l=t-s,m;p=(k<j)?1:-1;n=(r<q)?1:-1;while(1){o(k,r);if(k===j&&r===q){break}m=2*l;if(m>-s){l-=s;k+=p}if(m<t){l+=t;r+=n}}};this.circle=function i(k,r,n,p){var m=1-n,l=1,j=-2*n,q=0,o=n;p(k,r+n);p(k,r-n);p(k+n,r);p(k-n,r);while(q<o){if(m>=0){o--;j+=1;m+=j}q++;l+=2;m+=l;p(k+q,r+o);p(k-q,r+o);p(k+q,r-o);p(k-q,r-o);p(k+o,r+q);p(k-o,r+q);p(k+o,r-q);p(k-o,r-q)}};this.filledCircle=function d(k,m,j,l){this.circle(k,m,j,function(o,n){l(o,n);if(n<=m){f.line(o,n,o,n+(m-n)*2,l)}})};this.filledSlice=function h(l,s,q,u,t,r){var o=Math.round(q*Math.cos(u))+l;var k=Math.round(q*Math.sin(u))+s;var n=Math.round(q*Math.cos(t))+l;var j=Math.round(q*Math.sin(t))+s;var p={};this.line(l,s,o,k,m);this.line(l,s,n,j,m);this.line(o,k,n,j,m);function m(w,z){r(w,z);p[w]=p[w]||[];p[w].push(z)}for(var v in p){if(p.hasOwnProperty(v)){v=parseInt(v);this.line(v,Math.max.apply(null,p[v]),v,Math.min.apply(null,p[v]),r)}}};this.uniquePixelSetter=function g(k){var l={};return function j(m,n){l[m]=l[m]||{};if(!l[m][n]){l[m][n]=true;k(m,n)}}}}}})(s7getCurrentNameSpace());